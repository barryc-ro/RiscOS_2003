//SCART.c
//Control the SCART line
// 26/01/2000 NCE Created

#include "swis.h"
#include "debug.h"
#include "stdio.h"


//select RGB/CVBS
void SCART_RGB(int state)
{
  _kernel_swi_regs reg;
  _kernel_oserror *err = NULL;

  //reason code
  reg.r[0]=2;

  //EOR mask
  if (state==1)
  {
    reg.r[1]=0x0040;
    deprintf("SCART RGB\n");
  }
  else
  {
    reg.r[1]=0x0000;
    deprintf("SCART CVBS\n");
  }

  //AND mask
  reg.r[2]=0xFFBF;

  err=_kernel_swi(0x49305,&reg,&reg); //MPEGVideo_CardContol

  if(err)
    {
      deprintf("ERROR::%s\n",err->errmess);
    }
}

//switch between widescreen and normal mode
void SCART_ScreenMode(char *data)
{
  _kernel_oserror *err = NULL;
  _kernel_swi_regs reg;

  reg.r[0]=0x02;  //read macrovision state

  deprintf("SCART ScreenMode %s",data);

  err=_kernel_swi(0x4D540,&reg,&reg);   //Macrovision SetState

  if(err)
  {
    deprintf("ERROR::%s\n",err->errmess);
    return;
  }

  //current state should now be in r[1]

  reg.r[0]=0x01;     //change macrovision state

  if(data[0]=='1')
     reg.r[1]=reg.r[1] | 0x80;       //set bit 7
  else
     reg.r[1]=reg.r[1]&0xFFFFFF7F;   //clear bit 7

  if(data[1]=='1')
     reg.r[1]=reg.r[1] | 0x100;       //set bit 8
  else
     reg.r[1]=reg.r[1]&0xFFFFFEFF;   //clear bit 8

  err=_kernel_swi(0x4D540,&reg,&reg);   //Macrovision SetState

  if(err)
    {
      deprintf("ERROR::%s\n",err->errmess);
    }
}

void SCART_Pins(char *data)
{
  switch(data[0])
  {
    case '0':
      SCART_ScreenMode("01");
    break;

    case '1':
      SCART_ScreenMode("10");
    break;

    case '2':
      SCART_ScreenMode("11");
    break;

    case '3':
      SCART_RGB(0);
    break;

    case '4':
      SCART_RGB(1);
    break;
  }
}





