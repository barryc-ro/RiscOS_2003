;Peek and poke the 7500 registers
;NCE 3/12/1999

	GET	Hdr:ListOpts
	GET	Hdr:Macros
	GET	Hdr:System
	GET	Hdr:Machine.<Machine>
	$GetIO

	EXPORT	peek_reg
	EXPORT  poke_reg

	AREA	|PeeknPoke$$code|, REL, CODE, READONLY

	ALIGN

;Peek_reg(int register)

peek_reg
	SWI	&16			; Enter SVC mode (OS_EnterOS)

	MOV	r2, #IOMD_Base		; R2 points to the IOMD base address
					; defined in Hdr:IO.IOMDL
	LDRB	r0, [r2,r0]

	TEQP	pc, #0			; Restore original mode
	MOV	r0, r0			; NOP
	MOVS	pc, r14			; Return

;Poke_reg(int register,int value)

poke_reg
	SWI	&16			; Enter SVC mode (OS_EnterOS)

	MOV	r2, #IOMD_Base		; R2 points to the IOMD base address
					; defined in Hdr:IO.IOMDL
	STRB	r1, [r2,r0]

	TEQP	pc, #0			; Restore original mode
	MOV	r0, r0			; NOP
	MOVS	pc, r14			; Return

	END
