	GET	Hdr:ListOpts
	GET	Hdr:Macros
 	GET	Hdr:MEMM.ARM600

	EXPORT	find_cputype

	AREA	|CPUType$$code|, REL, CODE, READONLY

	ALIGN

	GBLL	DEBUG
DEBUG	SETL	{TRUE}

; extern int find_cputype (void);
find_cputype	ROUT

	SWI	&16			; Enter SVC mode (OS_EnterOS)

	MRC	Arm600Cop,0,r0,CR_ID,CR_ID ; Do co-processor read
	LDR	r1, =&FFF0		; Set up the mask
	AND	r0, r0, r1		; Mask off the not reqd. bits
	MOV	r0, r0, LSR#&04		; Shift right four bits
 					; Returning CPU ID in R0
	TEQP	pc, #0			; Restore original mode
	MOV	r0, r0			; NOP
	MOV	pc, lr			; Return to caller

	END
