; > Sources.PDriverPS.JobWS

; Print job workspace declarations for the PostScript printer driver

; The user-specified rectangle that will be processed next

currentrect     #       4

; The job level bounding box, in left, bottom, right, top order.

jobboundingbox  #       4*4

        [       PSCoordSpeedUps

; What the colour is currently supposed to be. This is used to delay the
; setting of the colour for an operation until after any gsave/grestore's
; associated with getting to the correct co-ordinate system have been
; done.

realcolour      #       4

        ]

; The stack of current colours (which correspond to the stacked graphics
; contexts in the PostScript program). At present, the maximum number of
; such colours we can get is seven (the original one, then a save/restore
; pair around a page, then a save/restore pair around the current box
; on the page, then a possible gsave/grestore pair for a particular clipping
; rectangle, then up to three gsave/grestore pairs for a sprite - one
; around the overall sprite plot, one around a chunk plot, one around a
; colour plane plot).

currentcolptr   #       4
currentcols     #       7*4
currentcolsend  #       0

        [       PSTextSpeedUps

; A similar stack for font handles

currentfontptr  #       4
currentfonts    #       7*4
currentfontsend #       0

        ]

; The current font colour settings

absfontcols     #       4               ;Bit 0 clear if absolute bg, bit 1
                                        ;  clear if absolute fg
bgfontrgb       #       4               ;Absolute RGB settings
fgfontrgb       #       4
bgfontgcol      #       4               ;GCOL settings
fgfontgcol      #       4
fgfontoff       #       4

; The checkpoint font colour settings

absfontcols2    #       4               ;Bit 0 clear if absolute bg, bit 1
                                        ;  clear if absolute fg
bgfontrgb2      #       4               ;Absolute RGB settings
fgfontrgb2      #       4
bgfontgcol2     #       4               ;GCOL settings
fgfontgcol2     #       4
fgfontoff2      #       4

; Position of the first character in the current VDU 5 string.

startofvdu5str  #       2*4

; Which VDU 5 character definitions have been sent to the PostScript
; interpreter and are still up to date. Character C is in this state if and
; only if bit (C MOD 32) is set in word (C DIV 32)-1 in the following array
; of seven words, or equivalently if bit (C MOD 8) is set in byte
; (C DIV 8)-4.

vducharsdefined #       7*4
vducharsdefend  #       0

        [       PSCoordSpeedUps

; Which co-ordinate system is currently in use. Options are:
;   coordsystem = 0: OS units as scaled to the box currently being
;                    processed, with origin at the box's origin.
;   coordsystem = 1: Ditto, except that units are text units, scaled from
;                    OS units by the scale factors 'coordscaleX' and
;                    'coordscaleY'.

coordsystem     #       4

coordscaleX     #       4
coordscaleY     #       4

        ]

; A list of the fonts declared by the application with DeclareFont.  The
; list consists of records, the first word is a pointer to the next record
; or zero for the end of the list.  The next word is the flags word passed
; by the user in R2.  The remainder of the record is the font name
; terminated by a zero.  The list is initialised to -1 this is to indicate
; that the SWI has not been called.  When the SWI is called, it must be
; called with and empty string as the last thing.  This is so that the
; printer driver can tell the difference between "fonts not used" and "old
; style application" which doesn't call DeclareFont even if it is going to
; use fonts. 

declaredfonts   #       4

; Whether to add a CTRL-D to the end of the current job. Zero => don't,
; non-zero => do.

jobusectrld     #       1

; Whether the user wants the original verbose prologue (generated by sending
; files or if they want and inteligent generated prolog which assumes that
; the fonts that will be used are the intersection of the fonts given
; translations (RISC OS <=> PostScript) and fonts available on the machine.
; Values are; True = 255, False = 0.

jobverbose      #       1

; Whether this job requires auto-accent generation (by MakePSFont)

jobaccents      #       1

; Whether the clipping region for the current job is at its original
; value. 0 => unclipped, non-0 => clipped.

jobclipped      #       1

; A flag to indicate if the prolog should be generated or not.  It is
; initialised to TRUE (255) when a job is started and is tested every page
; (by pagebox_setup), if it is TRUE then a prologue is generated and the
; variable is set to FALSE.  It would be possible to generate a job without
; a prologue by initialising this to FALSE (don't know why you'd ever want
; to but...).

sendprologue    #       1

                #       (-:INDEX:@):AND:3      ;Realign to a word boundary

; Two words for the X and Y offsets used by source clipping.  These
; should be zeroed for non-source-clipping sprite plot calls.

sourceclip_x    # 4
sourceclip_y    # 4

; Array to map RISCOS font handles to PostScript font names.  The pointers
; are to entries in the MiscOp list, so we don't free them from here.
; XXXX This thing consumes a lot of space!  Replace it with a linked list or something.

fontmapping     # 256 * 4

; The "pixel values" table - used to store values produced by the
; appropriate ColourTrans calls and to interpret sprite translation
; tables.
;   This table is only allocated if output is destined for a colour printer.
; Its size is therefore set to zero here, and 'managejob_allocate' increases
; the allocated amount of space if colour output is required. NOTE that this
; implies that 'pixelvalues' must be the last entry in this file.

pixelvalues     #       0

endofjobws      #       0
                ASSERT  pixelvalues = endofjobws

        END
