/*->c.open */


#include <stdio.h>
#include <stdlib.h>


#include "kernel.h"
#include "swis.h"


#include "Consts.h"
#include "AllErrs.h"
#include "RMInfo.h"
#include "Statics.h"
#include "veneers.h"
#include "Interface.h"
#include "fsentries.h"
#include "ModuleWrap.h"


#include "h.str"

#include "h.fs"
#include "h.mem"
#include "h.sfs"
#include "h.arcs"
#include "h.sff"
#include "h.sfi"



static _kernel_oserror *  formpath(FSEntry_Open_Parameter * parm)
{
 return(makepath(parm->open_definition.filename,
                 parm->open_definition.special.special_field));
}





_kernel_oserror *fsentry_open(FSEntry_Open_Parameter *parm)
{
 _kernel_oserror *err;
 int              acn;

 deb("open reason=%d ",parm->open_definition.reason);

 err=memcheck();
 if(!err)
 {
  err=formpath(parm);
  if(!err)
  {
   err=gethandle(arcname,&acn);
   if(!err)
   {
    switch(parm->open_definition.reason)
    {
     case       FSEntry_Open_Reason_Update:
                                        err=OpenUpdate(acn,parm);
                                        break;

     case     FSEntry_Open_Reason_OpenRead:
                                        err=OpenRead(acn,parm);
                                        break;

     case FSEntry_Open_Reason_CreateUpdate:
                                        err=OpenCreateUpdate(acn,parm);
                                        break;

                                default:
                                        err=&mb_nfserr_BadParameters;
                                        break;
    }
   }
  }
 }
 return(err);
}



