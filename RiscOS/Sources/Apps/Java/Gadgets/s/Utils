; Utils

; Revision History:
; piers    26/9/96 Created

	AREA    |C$$code|, CODE, READONLY

	GET	hdr:ListOpts
	GET	hdr:Macros
        GET     Hdr:System
        GET     Hdr:Wimp
        GET     Hdr:APCS.<APCS>

; APCS compliant
; SVC mode compatible (a4/r3 used as link register)

; work_to_screen_handle ----------------------------------------------------
; Converts a work area box to screen coords
;
; Prototype:	_kernel_oserror *work_to_screen_handle(BBox *visible,
;			BBox *work, int window_handle);
; On entry:	r0 = BBox *visible
;		r1 = BBox *work
;		r2 = window_handle
; On exit:	r0 = NULL (or pointer to error block)
work_to_screen_handle
	EXPORT	work_to_screen_handle

	stmfd	sp!, {r4-r9, lr}

	mov	r3, r1
	sub	sp, sp, #36
	mov	r1, sp
	str	r2, [sp]
	mov	r2, r0
	swi	XWimp_GetWindowState
	addvs	sp, sp, #36
        Return  "r4-r9",,VS

	; r2 = visible
	; r3 = work
	ldr	r4, [sp, #4]	; state->visible_area.xmin
	add	sp, sp, #16
	ldmia	sp, {r5, r6, r7}

	add	sp, sp, #36 - 16

	ldmia	r3, {r0, r1, r8, r9}

	sub	ip, r4, r6
	add	r0, r0, ip
	add	r8, r8, ip

	sub	ip, r5, r7
	add	r1, r1, ip
	add	r9, r9, ip

	stmia	r2, {r0, r1, r8, r9}

        Return  "r4-r9"

	END
