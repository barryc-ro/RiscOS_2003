Set Java$Dir <Obey$Dir>
Set File$Type_AE4 Java
Set Plugin$Type_AE4 Java
Set Plugin$About_AE4 <Obey$Dir>.About
Set JavaDLL$Path <Java$Dir>.Libraries.
Set Java$SymbolIndex <Java$Dir>.Index
If "<Java$ClassPath>" = "" Then Set Java$ClassPath <Java$Dir>.lib.ClassesZip,Resources:$.Resources.Java.WebSigner
If "<Java$Home>" = "" Then Set Java$Home <Java$Dir>

Run <Java$Dir>.SetVars

IconSprites <Java$Dir>.!Sprites

| Check we're running the nested window manager
| RMEnsure WindowManager 3.97 Error You need the nested Window Manager (version 3.97 or later) to run Java

WimpSlot -min 3000k -max 3000k

| Check we have a recent enough FPEmulator
|RMEnsure FPEmulator  4.00 RMLoad System:Modules.FPEmulator
|RMEnsure FPEmulator  4.00 Error You need FPEmulator 4.00 or later to run Java

| Load various toolbox modules
|RMEnsure Toolbox     1.23 RMLoad System:Modules.Toolbox.Toolbox
|RMEnsure Toolbox     1.23 Error You need Toolbox 1.23 or later to run Java
|RMEnsure Window      1.44 RMLoad System:Modules.Toolbox.Window
|RMEnsure Window      1.44 Error You need Window 1.44 or later to run Java
|RMEnsure Iconbar     1.12 RMLoad System:Modules.Toolbox.Iconbar
|RMEnsure Iconbar     1.12 Error You need Iconbar 1.12 or later to run Java
|RMEnsure SaveAs      0.12 RMLoad System:Modules.Toolbox.SaveAs
|RMEnsure SaveAs      0.12 Error You need SaveAs 0.12 or later to run Java
|RMEnsure Menu        0.24 RMLoad System:Modules.Toolbox.Menu
|RMEnsure Menu        0.24 Error You need Menu 0.24 or later to run Java

| Load Java's toolbox extensions
RMEnsure TextGadgets 0.08 RMLoad <Java$Dir>.Resources.TextGadget
RMEnsure TextGadgets 0.08 Error You need TextGadgets 0.08 or later to run Java
|RMEnsure FileDBox    1.00 RMLoad <Java$Dir>.Resources.FileDBox
|RMEnsure FileDBox    1.00 Error You need FileDBox 1.00 or later to run Java

| Load Java's support module
RMEnsure JavaSupport 0.06 RMLoad <Java$Dir>.Resources.JavaSpt
RMEnsure JavaSupport 0.06 Error You need a newer Java Support module

| Load the graphics context manager
RMEnsure GCManager   1.03 RMLoad <Java$Dir>.Resources.GCManager
RMEnsure GCManager   1.03 Error You need a newer Graphics Context Manager
GC_MemLimit 128

WimpSlot -min 1024K -max 1024K

if "<Java$JIT>" = "on" Then Set Java$JIT On
If "<Java$JIT>" = "On" Then Set Java$JITTemp -jit Else Unset Java$JITTemp

If "%*0" = "" Then Do Run <Java$Dir>.!RunImage -ss8k <Java$JITTemp> -pd<Java$PollDelay> -mx<Java$MaxHeap> acorn.plugin.Plugin <Java$Timeout> ><Java$Out> 2><Java$Err>

If "%*0" <> "" Then Do Run <Java$Dir>.!RunImage %*0