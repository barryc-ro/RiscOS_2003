/*
 * Name     : NCKeybd.h
 * Desc     : Onscreen software keyboard for Acorn RCA NC
 * Author   : Jonathan Larmour
 * Date     : 13th February 1997
 *
 * History
 * -------
 *
 *  20/10/98 ADH     IME support for Funai 3
 *  03/09/98 ADH     Changes for Funai 3 (project 866) - see CVS logs for details
 *  21/08/98 SBF     Doubled the window scrolling speed (OSKB_SCROLL_RATE)
 *  19/03/97 JIFL    Removed redundant EXIT_KEY definition
 *                   Changed Caps gadget id for new keyboard
 *                   Changed Starting gadget for extension to be starting gadget
 *                   for different layout
 *                   Removed layout env var
 *                   Added osbytes for get/set CMOS, and location of keyboard
 *                   layout
 *                   Added Iconhigh_ignoreNextChar SWI
 *  24/02/97 JIFL    Added OSKB_LAYOUT_ENV_VAR_NAME
 *  13/02/97 JIFL    Finished main coding
 *  15/02/97 JIFL    Created file
 *
 * Relevant Documents
 * ------------------
 *
 * 2107,738     Owen Love       RCA On-Screen Keyboard Software Functional Spec
 * 2107,217     Julian Smith    Icon Highlighter Functional Spec
 *
 * (and, of course, later specifications for revisions to the software).
 *
 * Summary
 * -------
 * This is the header file documenting most of the constants and definitions
 * used in the whole Onscreen Keyboard application.
 *
 * © Acorn Computers Ltd. 1997
 */

#ifndef OSKB_NCKEYBD_H
#define OSKB_NCKEYBD_H

/* CONSTANTS */
#define WimpVersion             310
#define OSKB_MESSAGE_CHUNK_BASE 0x4E700

#ifdef FUNAI3
#define OSKB_ERROR_CHUNK_BASE   0x816100
#else
/* Backwards compatible but invalid! Doh! */
#define OSKB_ERROR_CHUNK_BASE   0x4E700
#endif

#define SWI_NOT_KNOWN_ERROR     0x1E6
#define TAB_SPACES          8           /* number of spaces to output with tab */
#define RES_KEYB_GADGET_ID  0x00        /* gadget id of keyboard backb sprite */
#define READ_SPRITE_INFO    40          /* code to Wimp_SpriteOp to get sprite
                                         * geometry */
#define OSB_INSERT_CHAR_FN  138         /* OsByte function to insert char into
                                         * keyboard buffer */

#define OSKB_DEFAULT_EVENT_MASK (Wimp_Poll_NullMask + \
                                 Wimp_Poll_RedrawWindowRequestMask + \
                                 Wimp_Poll_PointerLeavingWindowMask + \
                                 Wimp_Poll_KeyPressedMask + \
                                 Wimp_Poll_LoseCaretMask + \
                                 Wimp_Poll_GainCaretMask + \
                                 Wimp_Poll_UserMessageRecordedMask + \
                                 Wimp_Poll_UserMessageAcknowledgeMask + \
                                 Wimp_Poll_PollWord)

#define OSKB_XEIG_FN        4           /* parameters to OS_ReadModeVariable */
#define OSKB_YEIG_FN        5           /* to read screen parameters such as */
#define OSKB_XLIMIT_FN      11          /* number of bits per pixel and      */
#define OSKB_YLIMIT_FN      12          /* screen geometry                   */
#define OSKB_SCROLL_RATE    8           /* speed of scrolling up/down screen - "1"
                                         * means scroll every pixel
                                         */

/* ERROR CODES */
#define OSKB_UNKNOWN_LAYOUT (OSKB_ERROR_CHUNK_BASE + 0) /* unknown layout (!) */

#define OSKB_BAD_KEYMAP     (OSKB_ERROR_CHUNK_BASE + 1) /* couldn't parse keymap
                                                         * entry
                                                         */

#define OSKB_KEY_ERR        (OSKB_ERROR_CHUNK_BASE + 2) /* error when key inserted
                                                         * into keyboard buffer
                                                         */

#define OSKB_BAD_MODE_INFO  (OSKB_ERROR_CHUNK_BASE + 3) /* bad mode data passed
                                                         * to OS_ReadModeVariable */

/* Misc constants */
#define OSKB_DEFAULT_CAPS_STATE     0                 /* Caps lock off at start */

#define OSKB_DEFAULT_KEYB_A_HIGHLIGHT 0x2D            /* Default key to highlight
                                                       * when starting on alpha
                                                       * keyboard layout */

#define OSKB_DEFAULT_KEYB_Q_HIGHLIGHT 0x2E            /* Default key to highlight
                                                       * when starting on qwerty
                                                       * keyboard layout */

#define OSKB_CAPS_ENV_VAR_NAME      "NCKeyboard$CapsLockState" /* Name of system
                                                                * variable to read
                                                                * to get caps lock
                                                                * state
                                                                */

#define OSKB_NVRAM_TAG          "KeyboardFormat"        /* NVRAM tag for keyboard format */

/* message number of message to use to publish window geometry */
#define OSKB_MESSAGE_NCKEYBOARD_WINDOWSIZE  (OSKB_MESSAGE_CHUNK_BASE + 1)

/* message number of close message from other apps */
#define OSKB_MESSAGE_NCKEYBOARD_CLOSE       (OSKB_MESSAGE_CHUNK_BASE + 2)

/* message number of close message to broadcast once we have closed */
#define OSKB_MESSAGE_NCKEYBOARD_CLOSED      (OSKB_MESSAGE_CHUNK_BASE + 3)

/* message number of control message from other apps, with flags */
#define OSKB_MESSAGE_NCKEYBOARD_CONTROL     (OSKB_MESSAGE_CHUNK_BASE + 4)
/* (These are bit numbers) */
#define OSKB_CONTROL_CLOSE_AND_QUIT         0
#define OSKB_CONTROL_CHANGE_TO_FULL_SIZE    1
#define OSKB_CONTROL_CHANGE_TO_TOOLBAR      2

/* ModeFiles definitions */
#define OSKB_SWI_MODEFILES_SAFEAREA     0x4D481

/* Iconhigh definitions */
#define OSKB_SWI_ICONHIGH_START         0x4E702    /* SWI to start iconhigh */
#define OSKB_SWI_ICONHIGH_STOP          0x4E703    /* SWI to stop iconhigh */
#define OSKB_SWI_ICONHIGH_IGNORE_NEXT_CHAR 0x4E707 /* SWI to warn iconhigh about
                                                    * a key being inserted into
                                                    * the keyboard buffer */
#define OSKB_ICONHIGH_START_FLAGS       0x00       /* Flags to use when starting
                                                    * iconhigh. See iconhigh
                                                    * spec */
/* KeyWatch definitions */
#define OSKB_SWI_KEYWATCH_BASE          0x4E940
#define OSKB_SWI_KEYWATCH_REGISTER      (OSKB_SWI_KEYWATCH_BASE + 0)
#define OSKB_SWI_KEYWATCH_DEREGISTER    (OSKB_SWI_KEYWATCH_BASE + 1)

/* SoundFX definitions */
#define OSKB_SWI_SOUNDFX_PLAY           0x4EF41    /* SWI to play sound */
#define OSKB_SOUND_KBUP                 1
#define OSKB_SOUND_KBDOWN               2

/* TaskModule definitions */
#ifndef TaskModule_RegisterService
#define TaskModule_RegisterService      0x4d302
#endif
#ifndef TaskModule_DeRegisterService
#define TaskModule_DeRegisterService    0x4d303
#endif
#ifndef Message_Service
#define Message_Service                 0x4d300
#endif
#ifndef Service_IME
#define Service_IME                     0xc8
#endif

/* IME definitions - the configure SWI number */
#define OSKB_IME_CONFIGURE              0x524C4
/* Reason code to read or adjust the status flags */
#define OSKB_IME_CONFIGURE_REASON_FLAGS 1
/* Bit to use to enable / disable the IME */
#define OSKB_IME_FLAGS_ENABLE           0
/* Distance in bits the mode flags are shifted up in the flags word,  */
/* and a complimentary mask value to get at just the mode information */
#define OSKB_IME_FLAGS_MODE_SHIFT       1
#define OSKB_IME_FLAGS_MODE_MASK        (7 << 1)
/* OS_Byte 202 status bit for Romaji / Kana lock */
#define OSKB_IME_LOCK_BIT               5
/* OS_Byte 202 status bit value for Romaji lock on, Kana off */
#define OSKB_IME_LOCK_IS_ROMAJI         1

/* Type definitions */

#ifdef FUNAI3
  typedef int oskb_layout_t;
#else
  typedef enum { OSKB_ALPHA=0, OSKB_QWERTY=1 } oskb_layout_t; /* keyboard layout */
#endif

typedef int object_id;

/* Globals - for comments see main.c */

extern object_id       window_oid;
extern MessagesFD      oskb_messages;
extern oskb_layout_t   oskb_layout;
extern int             oskb_capsstate;
extern int             scrollup;
extern int             scroll_point;
extern void          * poll_word;

extern int             mm_caps_gadget;
extern int             mm_shift_gadget;
extern int             mm_ex_back_gadget;

extern int             task_handle;
extern unsigned int    event_mask;

#ifdef FUNAI3

  extern int           layers;
  extern int           toolbar_mode;
  extern ComponentId * default_gadgets;

  extern int           ime_support_on;
  extern int           ime_mode;

  extern ComponentId   ime_lock_indicator;
  extern ComponentId   ime_cycle_mode;
  extern ComponentId   ime_on_off;

#else

  extern int           mm_alpha_gadget;
  extern int           mm_qwerty_gadget;

#endif

#endif
