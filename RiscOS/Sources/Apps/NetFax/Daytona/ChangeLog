********************************************************************************
Component:	!Daytona
Type:		RISC OS Toolbox application, written in C
Purpose:	Daytona project "glue application"
Owner:		Richard Manby
Project(s)	Daytona
********************************************************************************

================================================================================
Version:	0.80
Date:		1998-06-12
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_80

Change SendQ and QuCommon, so that documents that cannot be delivered by email
are not considered by the mime encoder space reservation system.

Expand number capture/dial buffers to try an improve behaviour with mercury
account phone numbers. 

Daytona version numbers changed to 0.80.

================================================================================
Version:	0.79
Date:		1998-06-10
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_79

Added MemCheck support to certain sections of code (simple email send and
receive).  This showed up some memory leaks, which have been fixed.

Fixed problem with email receive high watermarks not releasing all memory after
successful download session.

Tweaked ISP hangup script to improve speed.

Daytona version numbers changed to 0.79.

================================================================================
Version:	0.78
Date:		1998-06-10
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_78

Prevent memory leakage from SendQ and PrintQ by disposing of document PageList
when document is disposed of.

PAN-01799
Cancelling a scan (SQ_LX_ABORT_INCOMING) may leave a partially complete
(and therefore uncounted) page in memory.
Delete page (ScanPage+1) when the document is removed from the SendQ.

PAN-01098
If an incoming ZModem call failed, we may have a partially complete
(and therefore uncounted) page in memory.
Delete page (ScanPage+1) when the document is removed from the PrintQ.

PAN-02063
MimeIF: Callers of NFE lib now allow up to five NFE_NOTENOUGHTIME errors in a row,
repeating the failed operation on the next timeslice, before reporting it as an error.

Daytona version numbers changed to 0.78.

================================================================================
Version:	0.77
Date:		1998-06-04
Name:		Ben Laughton
CVS tag:        blaughto_Daytona-0_77

Main remote answer script was not restarted if it failed, which meant that
Daytona could have got into a situation where it would not answer an incoming
call until after the next outgoing dial.

ISP and fast-fax hangup scripts are now different.  May alleviate some script
failures.


================================================================================
Version:	0.76
Date:		1998-06-04
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_76

ISP connections that occur while still scanning now have the download phase
suppressed. When the scan completes, another ISP connection is triggered to
allow send/download.

Fixes PAN-02059. Streaming email sends should only download after the last
                 send.
Fixes PAN-02064. User pressing 'connect to ISP' or schedler request while
                 scanning will send mail but won't steal all the memory by
                 downloading. 

Make the 'resume ISP download on PrintQ going empty' code do just that. Was
triggering a redial if the PrintQ was already empty, which may have been the
cause of the repeated redials in PAN-02082. 

Any page >=200K triggers streaming, even if streaming watermark has not been
reached.  This helps to get rid of large pages early, reducing memory problems.

Any email fax with a page >300K will be automatically re-routed as a direct
fax if possible, as we cannot mime encode pages that big.

PAN-02084
Message HL004 changed from: 'HL004:Scan cancelled at fax machine (FX%03d)'
                      to  : 'HL004:Scan cancelled at {local fax|remote device}
                             (FX%03d)'

Increased Mailfile header estimate by 300 bytes.

Daytona version numbers changed to 0.76.


================================================================================
Version:	0.75
Date:		1998-05-28
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_75

PAN-02022: Fixed fault in finding the next message to delete, which was
sometimes crashing Daytona.

PAN-02040: Fixed typo that was causing cover sheets to be generated for fax
documents with more than one fax page in a single email message when they
weren't required.

PAN-00910: Changed wording when Daytona has finished scanning (and maybe
retrieving email from) a POP3 mailbox so that user's won't think that some
messages could have been downloaded when in fact none had.

Fixed return-recepit for fax messages, which I'd managed to break in version
0.55.

Daytona version numbers changed to 0.75.


================================================================================
Version:	0.74
Date:		1998-05-28
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_74

PAN-00784 & PAN-01809
When exchanging address details, don't add a record to the address book
if fax number and email address are missing (no way to contact the other
device).

PAN-00899
Messages in the messages file can now have alternative wording for local/remote
errors. eg 'The {local|remote} device did not respond'.

PAN-02023 Extended external access prefix field to accept at least 60
characters.

Messages file: Added an error message for fax error 15
"FX015:Fax {scan|reception} aborted (FX%03d)"

PAN-01293 (revisited): Now adds date and time to enote hardcopy.

Daytona version numbers changed to 0.74.


================================================================================
Version:	0.73
Date:		1998-05-21
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_73

Fixed the changes to the LED code in 0.70.  LEDs should be switched on while a
call is costing you money, not as soon as a dial starts.

Fixed a bug in the new High Water-Mark code in 0.72.  Wasn't resetting the
space reserved back to zero before the start of downloads after the first one.

Daytona version numbers changed to 0.73.

================================================================================
Version:	0.72
Date:		1998-05-20
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_72

PAN-01797 Added hack to reinitialise the PPP module before calling PPPConnect.

PAN-01848 Now shuts down cleanly with the PrintQ if an error occurs while a
document is being placed in the PrintQ.  Prevent situation where an error could
prevent any subsequent printing until the box was reset.

PAN-01769 Email receive now integrates with the official High Water-Mark system
(it uses it's own home-grown one before).

Fixed a few more bugs that I encountered in my travels:

* Non NetFax messages would be downloaded again if you reconnected to the
  email account before they had been printed.

* Messages that are too large for Daytona to handle are ignored instead of
  Daytona continually reconnecting in the hope that there might now be enough
  space.

* Daytona would sometimes not download partially supported messages (those
  which only have their first page downloaded and printed) even though it had
  plenty of space.  This was because it was budgeting for the size of the
  entire message and not just the first page.

Daytona version numbers changed to 0.72.


================================================================================
Version:	0.71
Date:		1998-05-20
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_71

PAN-01761 Unable to dial ISP when clock wound back
SendQ Connection.RetryTime fields now initialised to 0, rather than time().

PAN-01727 
Redial delay after PPP connection failure or SMTP send failure set to five
minutes.

PAN-01694
Screen.c popup_close() now does a wimp_set_caret_position to put the input
focus into the window being returned to when we back our popup window.

Daytona version numbers changed to 0.71.


================================================================================
Version:	0.70
Date:		1998-05-19
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_70

Active LED is now switched on when starting a dial, see PAN 1607.
Also made a few small changes to get the current sources to build a Laguna


================================================================================
Version:	0.69
Date:		1998-05-19
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_69

Now displays "Establishing connection to local fax" rather than "Off hook" when
starting a scan or print.
Fixes PAN-01840.

MimeQ, state ME_S2, message SQ_ME_THIS_DOCUMENT was setting
mail.estimated_mailsize to ESTIMATE_MAILFILE_HEADER instead of zero.  This
caused HWM_MailSend_Extra to claim that the largest page wouldn't fit in the
space already allocated to it!.  Fixes PAN-01734 and (part of) PAN-01853.

HWM_Check abort code took account of the space mime encoder was using when doing
a streaming send, but not the reserved minimum_requirement for sending the
largest page.  So when streaming started, HWM_Check got a nasty shock at how
little memory was left and aborted the scan.  Fixes (part of) PAN-01853 &
(part of) PAN-01803.

Call HWM_Check from SendQ and PrintQ tickers, allows streaming trigger part way
through a large page scan.
Should help PAN-01784.

PAN-01975
Implemented StateKicker_BreakThread flag. All users of email library now set
this flag on receipt of NFE_COMPLETED. This will force a Wimp_Poll before
any more internal messages are delivered.

PAN-01803
Sending SQ_LX_ABORT_INCOMING to LocXfer used to issue LX_SQ_DOCUMENT_COMPLETE
& LX_LM_HANGUP immediatly after calling FaxIF_Abort. This seems to upset some
fax machines (or !Fax).  We now call FaxIF_Abort only. The reply of error
'aborted' complete/hangup sequence normal to an error.   

Sending PQ_RX_ABORT_INCOMING to RemXfer used to issue RX_PQ_DOCUMENT_COMPLETE
& RX_RM_HANGUP immediatly after calling FaxIF_Abort. This seems to upset some
fax machines (or !Fax).  We now call FaxIF_Abort only. The reply of error
'aborted' complete/hangup sequence normal to an error.   

Now reads 'high-level' messages from messages file.

PAN-00895
FaxIF now reports fax errors 0x7f, 0x8f and 0xbf as a highlevel
code_RxCancelled.  SendQ treats this as meaning 'user cancelled fax by pressing
STOP on fax machine' and deletes the document from memory.

PAN-01753
Document ID number held in EEPROM over power cycles.

Daytona version numbers changed to 0.69.


================================================================================
Version:	0.68
Date:		1998-05-15
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_68

Partial fix for PAN 2005.  
Added some extra !Fax error messages.  
If a message can not be translated the token will now be printed to aid 
debugging.


================================================================================
Version:	0.67
Date:		1998-05-14
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_67

Fixed Laguna tftp update backdoor.


================================================================================
Version:	0.66
Date:		1998-05-14
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_66

Rearranged Resources into Resources.UK.Daytona and Resources.UK.Laguna.
One of these wil be chosen by the build depending on the value of the env
variable 'System'.


================================================================================
Version:	0.65
Date:		1998-05-13
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_65

Added 'Laguna' and 'Daytona' make files.  The main makefile calls one of these
depending on the 'System' env variable.


================================================================================
Version:	0.64
Date:		1998-05-12
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_64

Added local modem poll to Laguna main.


================================================================================
Version:	0.63
Date:		1998-05-12
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_63

Some small changes to allow Laguna to be built from the current sources.


================================================================================
Version:	0.62
Date:		1998-05-12
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_62

Implemented SQ_LX_SLOW_INCOMING & PQ_RX_SLOW_INCOMING to slow fax reception
when memory nearly full.

Daytona version numbers changed to 0.62.


================================================================================
Version:	0.61
Date:		1998-05-11
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_61

Added a Ticker call to LocModem, should allow the 'Local fax not connected'
timout timer to work.
Fixes PAN-01042.

SendQ.c QueueWalker now prints a report to the local fax machine if unable
to deliver a fax/enote.
Fixes PAN-01746 & PAN-00845

Adds header to hardcopy of sent enotes giving recipient name & address.
Fixes PAN-01530.

Daytona version numbers changed to 0.61.


================================================================================
Version:	0.60
Date:		1998-05-08
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_60

Small change to buildflags to allow the Daytona/Laguna build switch to be
doe by the makefile.  The Laguna Makefile now defines the Laguna Flag 
which does the switch.  If this is not present you just get a standard 
Daytona build.

Daytona version numbers changed to 0.60.


================================================================================
Version:	0.59
Date:		1998-05-08
Name:		Simon Forrest
CVS tag:	sforrest_Daytona-0_59

Fixed the animation slideshow functionality (PAN-01728); only trivial changes
were required.  Just noticed that this fault has been removed from the
database....it's fixed anyway!

Daytona version numbers changed to 0.59.


================================================================================
Version:	0.58
Date:		1998-05-07
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_58

Fixed a careless bug introduced by the new email code that caused aborts
to happen if you connected to an empty mailbox.

Daytona version numbers changed to 0.58.


================================================================================
Version:	0.57
Date:		1998-05-07
Name:		Simon Forrest
CVS tag:	sforrest_Daytona-0_57

Some slight changes to get Daytona to build from the current sources; the
previous version had some dubious #defines in some funny places, plus the
Daytona build flag (in BuildFlags.h) was set to zero.


================================================================================
Version:	0.56
Date:		1998-05-06
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_56

Some trivial changes to get Laguna to build from the current sources.


================================================================================
Version:	0.55
Date:		1998-05-06
Name:		Ben Laughton
CVS tag:	blaughton_Daytona-0_55

Significant re-work of the email receive code:
 * Should fix problems with cover sheets for large documents involving multiple
   download sessions (PAN-01772).
 * Missing page reports now work (PAN-01193).
 * Messages will not be deleted from the server until they have been printed
   (PAN-01673).
 * Daytona will automatically re-dial if it left messages on the server that
   it could no download (once the PrintQ is empty).

Changed ZModem hangup script to (hopefully) cure the hangup-after-ZModem
problems once and for all.  Added a more TIMEOUTs to the remote answer
script and also an ATZ. 

Daytona version numbers changed to 0.55.


================================================================================
Version:	0.54
Date:		1998-05-06
Name:		Simon Forrest
CVS tag:	sforrest_Daytona-0_54

Message file alteration made to fix PAN-01894.

Daytona version numbers changed to 0.54.


================================================================================
Version:	0.53
Date:		1998-05-06
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_53

Code required for 'PAN-01770 Fails to reconnect to ISP'
Partially complete Email downloads that are abandoned due to lack of space
can now request a resumption of the download when the PrintQ empties.
To prevent interleaving of incoming direct fax/zmodem calls with partially
downloaded email, incoming calls are ignored after the download is restarted.
N.B. Requires BLaughtons new email receive code to do this.

MimeQ now defines ENTITY_LIST_SIZE of 20 rather than 3.

PAN-01744 Infinite retries if call fails after connection
Now counts failures after connection, aborts document if too many failures.

Daytona version numbers changed to 0.53.


================================================================================
Version:	0.52
Date:		1998-05-05
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_52

Intermediate drop. Messages needed for BLaughtons email receive code.


================================================================================
Version:	0.51
Date:		1998-04-30
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_51

If a fax cannot be sent Laguna prints the first page of the fax along with the
error message.


================================================================================
Version:	0.50
Date:		1998-04-28
Name:		Nick Evans
CVS tag:	nicke_Daytona-0_50

Got rid of compiler warnings in T-Fax build.


================================================================================
Version:	0.49
Date:		1998-04-28
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_49

Fixed PAN-01708: Page not found errors when SendQ reconnects to recipient during
a streaming send.

Better MimeEncoder space tracking. Should fix some of the 'NFELib error -4'
problems.


================================================================================
Version:	0.48
Date:		1998-04-21
Name:		Nick Evans
CVS tag:	<None, it was forgotten!>

More conditional compilation wrappers added to make compilation of T-Fax
code easier.


================================================================================
Version:	0.47
Date:		1998-04-21
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_47

ZModem send now terminates at hiPage rather than file not found, which may be
cleaner.  Done by sending a non-existant file name "<document dir>.Stop".

Various conditional compilation wrappers added to make compilation of T-Fax
code easier.


================================================================================
Version:	0.46
Date:		1998-04-07
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_46

Fixed PAN-01725 User sets retries (as per spec) rather than total number of
dialups (though internally we convert from retries to dialups).

Preliminary work for PAN-01755 (Validate configuration before allowing fax/email
operation)

Type mismatch between !Setup and !Daytona's view of external_access_pausewait
and international_access_pausewait fixed. !Setup passes the string to use rather
than a number.

Added extra fax error message texts to messages file

Also the Version strings in both the Messages file and Resource file have been
updated to V0.46, dated 07-Apr-1998.


================================================================================
Version:	0.45
Date:		1998-04-06
Name:		Ben Laughton
CVS tag:	blaughto_Daytona-0_45

Fixed some bugs that were affecting 'complicated' email downloads.  eg.
Mailboxes with quite large multi-page documents where only part of
document may be downloaded.  The effects that these had could have been
many and varied depending on the individual mailbox, but in general:

* 'Acorn POP3 null address' errors should no longer occur as described in
   PAN-01773.

* In cases where Daytona only downloads part of a mailbox (possibly
  splitting a document in the process) it should download messages in a
  sensible order: before it may have done odd things like leave a single
  page out of a document and print it at the end.  This doesn't fix a specific
  fault report, but would alter the sequence of events desribed in:
  PAN-01769 to PAN-01773 (unfortunatley by the time you do what's described
  in PAN-01770 things have gone wrong to the extent where any further behaviour
  will be unpredictable).


================================================================================
Version:	0.44
Date:		1998-04-03
Name:		Richard Manby
CVS tag:	rmanby_Daytona-0_44

Dialling in data mode, finding a fax machine now reports:
  "Connection failed, retrying in fax mode"

Low level ZModem error messages now show the error number rather than
  "ZModem error (0x%.2x)"

Fixed PAN-01748 Memory leak creating email message.

Also the Version strings in both the Messages file and Resource file have been
updated to V0.44, dated 03-Apr-1998.


================================================================================
Version:	0.43
Date:		1998-04-02
Name:		Simon Forrest
CVS tag:	sforrest_Daytona-0_43

Basically a user-interface message tidy up, for example, ensuring consistency
of use of words such as "Email" and capilisation throughout.  A number of
minor code alterations were required to "SendQ.c", "Screen.h" and "Screen.c"
in order to fix the following faults:

	PAN-00909
	PAN-01295
	PAN-01357

But mostly the Messages file has been altered to include more generic terms,
for example, replacing "Fax to..." with "Sending direct to...", etc.

Also the Version strings in both the Messages file and Resource file have been
updated to V0.43, dated 02-Apr-1998.


================================================================================
Version:	0.42
Date:		1998-03-26
Name:		Richard Manby & Ben Laughton
CVS tag:	blaughto_Daytona-0_42

Daytona now copes with email messages being deleted behind its back. 
Also copes with POP3 servers that lie about the size of messages.  Fixed
bug in email retrieval not freeing resources at a certain point.

Fix for PAN-01713
When Daytona dials expecting to find another Daytona but finds a fax machine
(dialler reports no carrier or timeout) we retry in fax mode. The retry is
now immediate rather than after 30 seconds.

Error box now used sprite "confirm_1" rather than "decide_0" ie ! instead of ?

Better internal error message passing.

Now searches the application messages file for user friendy messages rather
than just showing error numbers. Only a small number of messages at present.

Redial delays now closer to TLFS:
  No dialtone - retries after 5 minutes.
  Line busy   - first retry after 30 seconds, then every 5 minutes
These will be revised later.


================================================================================
