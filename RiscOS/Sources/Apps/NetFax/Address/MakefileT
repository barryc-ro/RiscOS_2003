# Makefile for Daytona address book test harness
# ==============================================
#

# -----------------------------------------------------------------------------
# Program specific options
#

TARGET 		= Targets.Test
TARGET_D 	= Targets.TestT

INCLUDES	= -Itbox:,C:

# -----------------------------------------------------------------------------
# Generic options
#

MKDIR		= cdir
AS		= objasm
CC		= ${MemCheckCC} cc
CMHG		= cmhg
CP		= copy
LD		= link #${MemCheckLD} link
RM		= remove
SQUEEZE		= squeeze
WIPE		= -wipe

AFLAGS		= -depend !Depend -nocache -stamp -quit ${THROWBACK}
CFLAGS		= -depend !Depend -ffah ${INCLUDES} -wp ${THROWBACK}
CPFLAGS		= ~cfr~v~n
SQFLAGS		= -f
WFLAGS		= ~cf~vr

# -----------------------------------------------------------------------------
# Flags
#

# These are for the standard Desktop build (plus debug)

DFLAGS		= 
DDFLAGS		= -fn -DDEBUGLIB -DDEBUG

# -----------------------------------------------------------------------------
# Libraries
#

LIBDIR		= <Lib$Dir>

DEBUGLIB 	= ${LIBDIR}.Debuglib.o.Debuglib
MSGLIB		= ${LIBDIR}.MsgLib.o.MsgLib
FLASHLIB_T 	= ${LIBDIR}.NetFax.FlashLib.o.flashlib_t
FLASHLIB 	= ${LIBDIR}.NetFax.FlashLib.o.flashlib
NUMCONVERTLIB 	= ${LIBDIR}.NumConvert.o.numconv

INETLIB		= TCPIPLibs:o.inetlib
SOCKLIB		= TCPIPLibs:o.socklib

LIBS = \
 C:o.stubs \
 tbox:o.eventlib \
 tbox:o.toolboxlib \
 tbox:o.wimplib \
 ${MSGLIB} \
 ${FLASHLIB} \
 ${NUMCONVERTLIB} \

LIBSD = \
 C:o.stubs \
 tbox:o.eventlib \
 tbox:o.toolboxlib \
 tbox:o.wimplib \
 ${DEBUGLIB} \
 ${MSGLIB} \
 ${SOCKLIB} \
 ${INETLIB} \
 ${FLASHLIB_T} \
 ${NUMCONVERTLIB} \



# -----------------------------------------------------------------------------
# Include files (objects)
#

OBJS = \
 o.test \
 o.misc \
 o.strings \
 o.flash \
 o.miscwimp \

OBJD = \
 od.test \
 od.misc \
 od.strings \
 od.flash \
 od.miscwimp \


# -----------------------------------------------------------------------------
# Rule patterns
#

.SUFFIXES: .o .oz .od .odz .s .c

.c.o:;		${CC} ${CFLAGS} ${DFLAGS} ${EXTRAFLAGS} -c -o $@ $<

.c.oz:;		${CC} ${CFLAGS} ${DZFLAGS} ${EXTRAFLAGS} -c -zM -zps1 -DROM -o $@ $<

.c.od:;		${CC} ${CFLAGS} ${DDFLAGS} ${EXTRAFLAGS} -c -o $@ $<

.c.odz:;	${CC} ${CFLAGS} ${DDZFLAGS} ${EXTRAFLAGS} -c -zM -zps1 -DROM -o $@ $<

.s.o:;		${AS} ${AFLAGS} $< $@

# -----------------------------------------------------------------------------
# Main rules
#

all: ${TARGET_D} ${TARGET}

normal: ${TARGET}

debug: ${TARGET_D}

clean:
	${RM}	${TARGET_D}
	${RM}   ${TARGET}
	${RM}	o.test
	${RM}	od.test

o.dirs:
	@${MKDIR} abs
	@${MKDIR} aof
	@${MKDIR} linked
	@${MKDIR} map
	@${MKDIR} o
	@${MKDIR} od
	@${MKDIR} oz
	@${MKDIR} odz
	@${MKDIR} rm
	@${MKDIR} syms
	@${MKDIR} Targets
	@${MKDIR} Targets.!DayAdd
	create o.dirs
	stamp  o.dirs


# -----------------------------------------------------------------------------
# Static dependencies
#

${TARGET}: ${OBJS} ${LIBS} o.dirs
	${LD} ${LDFLAGS} -o $@ ${OBJS} ${LIBS}

${TARGET_D}: ${OBJD} ${LIBSD} o.dirs
	${LD} ${LDFLAGS} -o $@ ${OBJD} ${LIBSD}


# Dynamic dependencies:
