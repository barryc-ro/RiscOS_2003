/*
 * globals.h
 */

#ifndef __globals_h
#define __globals_h

extern int wimpcodes[];
extern int tbcodes [];

extern MessagesFD message_block;
extern IdBlock event_id_block;

extern ObjectId Address_WindowHandle;
extern ObjectId ABSearch_WindowHandle;
extern ObjectId ABAdd_WindowHandle;
extern ObjectId ABEdit_WindowHandle;
extern ObjectId ABShot_WindowHandle;
extern ObjectId ProgInfo_WindowHandle;

extern ObjectId Ibar_MenuHandle;
extern ObjectId Icon_BarHandle;

extern int current_wimp;
extern int task_id;
extern int *flash_used_records_list;
extern confirm_action_t action_after_confirm;

extern AddeditAction_Code addedit_action;

extern int selected_record;

extern int quit;

extern char op[4];
extern char ip[5];
extern char np[4];
extern char cc[3];
extern char ac[10];

/*
extern int search_mode;
*/

/* Isn't data hiding in C _marvellous?? */
#ifndef __searchchain_types
#define __searchchain_types

#define BufferSize 20

typedef struct search_chain_record
{
  char *search_term;
  int *result_list;
  struct search_chain_record *next, *previous;
}search_chain_record;

typedef struct interactive_search_state
{
  /* globals */
  int search_mode;

  /* new stuff */
  int working;

  /* flag for names search, specifying notes/forms search,
     0 = notes, 1 = forms */
  char names_search_type;

  /* results returning stuff */
  int your_ref, sender_taskid;

  /* main search engine stuff */
  int current_result_selection;
  int search_result;
  search_chain_record *search_chain_top;
  search_chain_record *search_chain_current;

  /* home/oneshot handling flag */
  char search_halted;

  /* add_char stuff */
  int addchar_result_list[2000];

  /* resync stuff */
  struct resync_state
  {
    int result_counter;
    int count;
    char *partial_field;
  }resync_state;

  /* interactive_search stuff */
  struct intsearch_state
  {
    int count, result_counter;
    int operation;
  }intsearch_state;

  /* All state to do with the searchfield */
  struct searchfield_state
  {
    /* State to do with the searchfield buffer */
    struct buffer_state
    {
      char buffer[BufferSize];
      int index_in, index_out;
      char full;
    }buffer_state;

    int old_len, new_len;
    char *old_field, *new_field;
    WimpCaret caret_position;
  }searchfield_state;
}
interactive_search_state;

#endif   /* of __searchchain_types */

extern interactive_search_state *intsearch_state_current;

#endif

/* End of globals.h */
