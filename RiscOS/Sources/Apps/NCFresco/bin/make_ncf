#!/bin/sh

# The cvsroot equivalent
ROOT=/projects2/smiddle/tmp/TestBuild

# From where to take copies of build libraries
EXPORT=/projects2/renaissa/Build/Export/

# From where to take copies of WebImage files
WEBEXPORT=/projects2/smiddle/Fresco/WebImage/source

# the file name munger
MUNGE=/home/smiddle/python/roixmunge.py 

# This is used within the make files to read export files from
RISCOS_BUILD_EXPORT=$ROOT/RiscOS/Export
#
export RISCOS_BUILD_EXPORT

# copy and process a Lib directory
Do()
{
	echo Copying library $1
	cp -pr $EXPORT/Lib/$1 $RISCOS_BUILD_EXPORT/Lib
	$MUNGE $RISCOS_BUILD_EXPORT/Lib/$1
}

case $1 in

    "setup")

	echo making directories
	mkdir $ROOT
	mkdir $ROOT/RiscOS
	mkdir $ROOT/RiscOS/Export
	mkdir $ROOT/RiscOS/Export/Lib
	mkdir $RISCOS_BUILD_EXPORT/Lib/WebImage

	# copy and process the standard headers
	cp -pr $EXPORT/C $RISCOS_BUILD_EXPORT
	$MUNGE $RISCOS_BUILD_EXPORT/C

	Do CLib
	Do RISC_OSLib
	Do TCPIPLibs
	Do debug

	cp -pr $EXPORT/Hdr $RISCOS_BUILD_EXPORT

	# make the memory library (cross-compiled)
	echo checking out memlib
	cd $ROOT
	cvs -d /projects2/renaissa/cvsroot checkout -r Spinner RiscOS/Sources/Lib/MemLib
	echo making memlib
	cd $ROOT/RiscOS/Sources/Lib/MemLib
	make riscos_export

	# get the WebImage library
	echo copying webimage
	cp -p $WEBEXPORT/h/webimage $RISCOS_BUILD_EXPORT/Lib/WebImage/webimage.h
	cp -p $WEBEXPORT/wi1_nnOLD,ffd $RISCOS_BUILD_EXPORT/Lib/WebImage/webimage1da.o

	# get NCFresco
	cd $ROOT

	echo checking out NCFresco
	cvs -d /projects2/renaissa/cvsroot checkout -r Spinner RiscOS/Sources/Apps/NCFresco

	echo checking out NCFrescoRO
	cvs -d /projects2/renaissa/cvsroot checkout -r Spinner RiscOS/Sources/Apps/NCFrescoRO

	echo fixing up permissions
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/cvs-checks
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/cvs-checks.py
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/MAKE_ETAGS
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/makelinks
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/parser/attrgen.py
	chmod a+x $ROOT/RiscOS/Sources/Apps/NCFresco/bin/*
    ;;

    "clean")
	cd $ROOT/RiscOS/Sources/Apps/NCFresco

	echo making NCFresco basics
	make realclean fresh
    ;;


    "rom")
	# make NCFresco
	cd $ROOT/RiscOS/Sources/Apps/NCFresco

	echo making NCFresco ROM
	make NCFRESCO_ROM NCFRESCO_BUILD_ROM_EXPORT

	echo check in ROM NCFresco
	cd $ROOT/RiscOS/Sources/Apps/NCFrescoRO
	cvs commit .
    ;;

    "test")
	# make NCFresco
	cd $ROOT/RiscOS/Sources/Apps/NCFresco

	echo making NCFresco debug on bungle
	make NCFRESCO_TEST
    ;;
esac

echo finished
