<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML/3.2//EN">
<html>
  <!-- ======================================================================= -->
  <!--         Template for software functional specifications.                -->
  <!-- ======================================================================= -->
  <head>
    <title>
      Browser Software Functional Specification
    </title>
  </head>

  <body BGCOLOR="#ffffff">


    <h1 align=center>
      Browser Software Functional Specification 
    </h1>

    <p>
    <hr>
    <p align=center><strong>CONFIDENTIAL</strong></p>
    <hr>

    <CENTER>
      <TABLE BORDER=0 WIDTH="40%">
	<TR><TD>Document ref:	<TD>1314,610/FS
	<TR><TD>Project:	<TD>NTT STB VE II (Bedpan)
	<TR><TD>Revision:	<TD>$Revision$
	<TR><TD>Date:		<TD>$Date$
	<TR><TD>Author(s):	<TD><A HREF="mailto:smiddleton@acorn.com">Simon Middleton</a>
	<TR><TD>Change:		<TD>*** LIVE ***
	<TR><TD>Classification:	<TD>Acorn Confidential
      </TABLE>
    </CENTER>

    <!-- ======================================================================= -->

    <hr>
    <h2> Contents </h2>
    <TABLE BORDER=0 WIDTH="100%">
      <TR><TD WIDTH="8%">1.0		<TD><A HREF="#overview">	Overview </A>
      <TR><TD>2.0		<TD><A HREF="#outstanding">	Outstanding issues </A>
      <TR><TD>3.0		<TD><A HREF="#technical">	Technical background </A>
      <TR><TD>4.0		<TD><A HREF="#user">		User interface </A>
      <TR><TD>5.0		<TD><A HREF="#programmer">	Programmer interface </A>
      <TR><TD>6.0		<TD><A HREF="#interchange">     Data interchange </A>
      <TR><TD>7.0             <TD><A HREF="#formats">         Data formats </A>
      <TR><TD>8.0             <TD><A HREF="#external">        External dependencies </A>
      <TR><TD>9.0		<TD><A HREF="#acceptance">	Acceptance test </A>
      <TR><TD>10.0            <TD><A HREF="#noncompliances">  Non compliances </A>
      <TR><TD>11.0		<TD><A HREF="#test">		Development test strategy </A>
      <TR><TD>12.0		<TD><A HREF="#organisation">	Product organisation </A>
      <TR><TD>13.0		<TD><A HREF="#enhancements">	Future enhancements </A>
      <TR><TD>14.0	<TD><A HREF="#glossary">	Glossary </A>
      <TR><TD>15.0	<TD><A HREF="#references">	References </A>
      <TR><TD>16.0	<TD><A HREF="#history">		History </A>
    </TABLE>

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="overview"> 1.0 Overview </a> </h2>

    <P> This document contains the software functional specification for
      the Web browser included in the applications package for the 
      STB VE II <A HREF="#toplevel">[1]</A>.

    <P>This document only describes changes from the version of the
      browser included in Acorn NC2 ROM <A
	HREF="#nc2">[2]</A>. Specifications for the previous versions of
      the browser may be of interest <A HREF="#rca116">[3]</A>, <A
	HREF="#rca115">[4]</A> <A HREF="#model1">[5]</A>

    <P>The baseline specification for the HTML implementation is
      HTML 3.2 <A HREF="#html32">[6]</A> although some elements from
      its successor, HTML 4 <A HREF="#html40">[7]</A>, have been implemented.

    <P>Italicised text is used where issues are still to be decided
      or where contents are liable to change.

    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="outstanding"> 2.0 Outstanding issues </a> </h2>

    <P>There are no outstanding issues.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="technical"> 3.0 Technical background </a> </h2>

    <P>The browser for the STB VE II is largely the same as that
      included in Acorn NC2 with the addition of 16 bit font support. It
      also incorporates various minor bug fixes introduced since the NC2
      release.

    <P>The following changes are made to the internals of the browser
      to support the introduction of 16bit fonts.

    <H3>3.1 Determining encoding </H3>

    <P>The encoding used is found from the following sources (in
      this order).
    <OL>
      <LI>Encoding set by the user (if the override option is set)

      <LI><TT>charset</TT> parameter to the <TT>Content-Type</TT>
	HTTP header

      <LI><TT>charset</TT> parameter to the <TT>Content-Type</TT>
	META tag within the document

      <LI>Encoding set by the user (if the override option is not
	set)
    </OL>

    <H3>3.2 Auto detecting encoding </H3>

    <P>Auto detection code is used to detect which of a limited number
      of character sets is in use in a document. For this project it
      is only used to detect which of JIS, Shift-JIS and EUC
      encodings are in use.

    <P>The auto detection algorithm is applied to characters before
      they pass through the encoding code. After a character is received
      then the algorithm can be in one of four states.

    <OL>
      <LI>A definite decision on which encoding is in being used can
	be made - pass text to appropriate utf8 encoder.
      <LI>No part of a valid japanese character stream has been
	received - pass text to ASCII to utf8 encoder.
      <LI>The encoding is either EUC or SJIS but no decision can be
	made as to which - hold text in buffer.
      <LI>The last character has been received and it is either EUC or
	SJIS - pass held text through as SJIS.
    </OL>

    <P>The actual algorithm used is as described in <CITE>Understanding
	Japanese Information Processing</CITE>.

      <!--
    <P>The auto detection code is applied before the character data is
      converted to Unicode and passed to the parser. The data fetched is
      kept in the cache until the encoding is determined at which point
      parsing starts as normal.

    <P>The rules for determining the character encoding are as follows

    <UL>
    <LI>If an escape character (character 17) is detected then the
      encoding must be JIS.

    <LI>If the sequence top bit clear, top bit set, top bit clear is
      detected then the encoding must be Shift-JIS.

    <LI>If neither of these patterns appear within a specified
      number of bytes (specified in the Config file as
    <VAR>encoding.autodetect.limit</VAR> and defaulting to 1024
      bytes) then the encoding is assumed to be EUC.
    </UL>
      -->

    <H3>3.3 Parser input</H3>

    <OL>
      <LI>Input to the parser is translated into UTF-8 and the
	original encoding recorded.  

      <LI>Character entities are decoded into the appropriate UTF-8
	characters.

      <LI>Numeric entities are treated as Unicode character
	numbers.

      <LI>The existing code for translating the character codes in the
	undefined region of the Latin-1 character set to allow them to
	be displayed as expected by users is removed. This translation
	is handled by the input mapping files instead.

    </OL>

    <H3>3.4 Word parsing</H3>

    <P>The parser outputs a stream of words. A word being defined as a
      group of characters which have no change in style (eg font size or
      colour) within them and which cannot be split up when determining
      line breaks. 

    <P>For Latin 1 only use this parser used the space character to
      determine word breaks. In the context of a Unicode character
      stream this is more complicated. Characters are classed into one
      of a number of groups. 

    <UL>
      <LI>Paragraph and line separators
      <LI>Spaces
      <LI>Non breaking spaces
      <LI>Letters, numbers, dash punctuation, currency and math symbols
      <LI>Ideographic characters
      <LI>Opening punctuation
      <LI>Closing and other punctuation
    </UL>

    <P>The rules for breaking are 
    <UL>
      <LI>Break after paragraph separators
      <LI>Break after spaces
      <LI>Break after ideographs unless followed by closing punctuation
      <LI>Break before ideographs unless preceded by opening
	punctuation
    </UL>


    <H3>3.5 Display code changes</H3>

    <P>All text display routines are modified to assume UTF-8
      encoding. This includes
    <UL>
      <LI>Page text
      <LI>ALT text
      <LI>Menus
      <LI>Menu display fields
      <LI>Buttons
      <LI>Writeable fields
    </UL>

    <P>The display routines can switch fonts so that Latin text can
      still have bold and italic styles applied to it and can be plotted
      in both proportional and monospaced fonts. Each word has a style
      bit associated with it that says whether the text within includes
      characters only from within the Latin1 set - in which case it is
      plotted using the configured font, or outside - in which case it
      is plotted using the configured wide font.    

      
    <H3>3.6 Text output</H3>

    <P>Output from forms (GET or POST) is translated back to the
      required encoding before being sent to the server. 

    <P>The ACCEPT-CHARSET attribute to the FORM element is used to
      determine the encoding to be used. If this attribute is not
      present then the original document encoding is used.
    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="user"> 4.0 User interface </a> </h2>

    <P>The base user interface presented is that created for
      Acorn NC2 and described in the Acorn NC2 CIS <A
	HREF="#nc2_cis">[8]</A>. 

    <h3> 4.1 Options </h3>

    <P>Due to the lack of extended NVRAM space in the STB the full
    Options interface described in the NC2 CIS is not included.  The
    following choices available on the screen opened by the Options
    button on the toolbar.
      

    <UL>
      <LI>Text
      <LI>Fonts
      <LI>Copyright
    </UL>

    <H4> 4.1.1 Text screen </H4>

    <P>The following options are available presented as radio buttons.

    <DL>
      <DT><B>Text size</B>
      <DD>
	<UL>
	  <LI>Small
	  <LI>Medium
	  <LI>Large
	</UL>

      <DT><B>Horizontal scaling</B>
      <DD>
	<UL>
	  <LI>Off
	  <LI>On
	</UL>
    </DL>
    </TABLE>
    <H4> 4.1.2 Font screen </H4>

    <P>Two options are available:

    <P>The first option is the default character encoding to be
      used. This is presented as a popup menu box.

    <DL>
      <DT><B>Which character encoding do you wish to use?</B>
      <DD>
	<UL>
	  <LI>Western
	  <LI>Auto-detect (japanese)
	  <LI>JIS
	  <LI>Shift-JIS
	  <LI>EUC
	</UL>
    </DL>

    <P>The second option is whether the choice above is used only if
      the encoding cannot be determined by another means or all the
      time. This is presented as a pair of radio buttons.

    <DL>
      <DT><B>Do you wish to override the encoding given by the server or
	web page?</B>
      <DD>
	<UL>
	  <LI>Yes
	  <LI>No
	</UL>
    </DL>

    <P>If Yes is selected then the configured encoding is always
      used. If No then that encoding is only used if there is nothing
      specified in the HTTP headers or META tags.
    <P>

    <H4> 4.1.3 Copyright screen</H4>

    <P>This page displays copyright and acknowledgement messages.

    <H4> 4.1.4 Other screens</H4>

    <P> The Printing, Screen. Sounds, Telephone and Call waiting
      screens are removed.

    <h3> 4.2 Notes </h3>

    <P>All messages and screens are presented in English as in NC2.
      No translation is performed.

    <P>No processing is performed on user input. Characters are
      accepted as entered and the resulting character stream interpreted
      as UTF-8.

    <h3> 4.3 Key mappings </H3>

    <P>The following key mappings are in effect. The key name is as it
    appears on the RT-2 handset. The name in brackets is the
    equivalent key on a standard keyboard. The key and event codes are
    as stored in the Config file.

    <TABLE>
      <TR>
	<TH>Key <TH>Code <TH>Event <TH>Description
      <TR>
	<TD>Help (F1)
	<TD>0x181
	<TD>None
	<TD>No action

      <TR>
	<TD>Status (F2)
	<TD>0x182
	<TD>0x2001
	<TD>Toggle toolbar

      <TR>
	<TD>Home (F3)
	<TD>0x183
	<TD>0x3032
	<TD>Load home page

      <TR>
	<TD>Back (F4)
	<TD>0x184
	<TD>0x3011
	<TD>Go to previous page

      <TR>
	<TD>Select (Enter)
	<TD>0x0D
	<TD>0x2065
	<TD>Activate current link or button

      <TR>
	<TD>Up Left (Home)
	<TD>0x1E
	<TD>W14
	<TD>Start of input line

      <TR>
	<TD>Down Left (End)
	<TD>0x18B
	<TD>W15
	<TD>End of input line

      <TR>
	<TD>Up Right (Page Up)
	<TD>0x19F
	<TD>0x2054
	<TD>Scroll up a page

      <TR>
	<TD>Down Right (Page Down)
	<TD>0x19E
	<TD>0x2055
	<TD>Scroll down a page

      <TR>
	<TD>Rewind (F8)
	<TD>0x188
	<TD>None
	<TD>No action

      <TR>
	<TD>Play (F6)
	<TD>0x186
	<TD>None
	<TD>No action

      <TR>
	<TD>FFwd (F10)
	<TD>0x1CA
	<TD>None
	<TD>no action

      <TR>
	<TD>Previous (F5)
	<TD>0x185
	<TD>0x205C
	<TD>Scroll left

      <TR>
	<TD>Stop (F9)
	<TD>0x189
	<TD>0x30B3
	<TD>Stop page loading or reload if stopped

      <TR>
	<TD>Next (F7)
	<TD>0x187
	<TD>0x205C
	<TD>Scroll right

      <TR>
	<TD>Pause (F9)
	<TD>0x189
	<TD>None
	<TD>No action

      <TR>
	<TD>Red (Sh F1)
	<TD>0x191
	<TD>0x3027
	<TD>Open hotlist

      <TR>
	<TD>Green (Sh F2)
	<TD>0x192
	<TD>0x3017
	<TD>Open history list

      <TR>
	<TD>Yellow (Sh F3)
	<TD>0x193
	<TD>0x3039
	<TD>Open new URL

      <TR>
	<TD>Blue (Sh F4)
	<TD>0x194
	<TD>0x203E
	<TD>Show info

      <TR>
	<TD>Numeric keys
	<TD>0x30 - 0x39
	<TD>0x30 - 0x39
	<TD>Characters 0-9

      <TR>
	<TD>Cursor keys
	<TD>0x18C - 0x18F
	<TD>0x2060 - 0x2063
	<TD>Move highlight

    </TABLE>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="programmer"> 5.0 Programmer interface </a> </h2>

    <P>There are no new programmer interfaces defined in this spec.

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="interchange"> 6.0 Data interchange </a> </h2>
    
    <P>There are no new data interchange protocols defined in this spec.

    <P>
      <!-- ======================================================================= --> 

    <hr  noshade>
    <h2> <a name="formats"> 7.0 Data formats </a> </h2>

    <h3>7.1 Favorites file</H3>

    <P>The favorites file format is changed in two ways.

    <DL>
      <DT>The <TT>Format</TT> is incremented to 2.

      <DD>This denotes that the titles are defined to be stored in
      UTF8 rather than Latin1 as previously.

      <DT>The language name for the title is stored in the file.
      <DD>So the fifth line of each record will either be empty or
      contain a two letter language code (e.g. <i>en</i> or <i>ja</i>).
    </DL>


    <h3>7.2 Config file</H3>

    <P>The following configure file entries are added

    <DL>
      <DT><TT>encoding.user</TT> 
      
      <DD>This stores the user specified encoding (as set from the
      Fonts screen) by its MIB number. e.g. 

	<TABLE>
	  <TR>
	    <TD>Western
	    <TD>2252
	    <TD>Microsoft Latin1
	  <TR>
	    <TD>Japanese Auto detect 
	    <TD>4004
	    <TD>Internal code

	  <TR>
	    <TD>JIS
	    <TD>39
	    <TD>

	  <TR>
	    <TD>ShiftJIS
	    <TD>17
	    <TD>

	  <TR>
	    <TD>EUC
	    <TD>18
	    <TD>
	</TABLE>

      <DT><TT>encoding.user.override</TT>

      <DD>This stores the user override choise as set on the Fonts screen.

      <DT><TT>encoding.internal</TT>

      <DD>This sets the format in which strings are held internally. It can be set to two values
	<TABLE>
	  <TR>
	    <TD>0
	    <TD>Latin 1 

	  <TR>
	    <TD>1
	    <TD>UTF-8
	</TABLE>


	<P>To enable use of non-Latin fonts this must be set to 1.
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="external"> 8.0 External dependencies </a> </h2>

    <P>There are no external dependencies.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="acceptance"> 9.0 Acceptance test </a> </h2>

    <P>The browser will display a test set of web pages <i>defined by
	the customer</i> accurately.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="noncompliances"> 10.0 Non compliances </a> </h2>

    <P>The following elements of the HTML 3.2 specification are not implemented.
    <DL>
      <DT>LINK
      <DD>This element is very rarely used.
      <DT>INPUT TYPE=FILE
      <DD>This element is for file upload over HTTP and is not
	relevant to the NC as there is no local storage.
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="test"> 11.0 Development test strategy </a> </h2>

    <P>A set of test pages for the various character encodings
      supported will be found or created and tested against.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="organisation"> 12.0 Product organisation </a> </h2>

    <P>The browser is built via a Solaris hosted cross-compiling
      version of ARM cc (Acorn port) v5.06. For ROM release a
      partially linked <TT>AOF</TT> file is created which is imported into
      the RISC&nbsp;OS build tree. The browser runs from ROM.

    <P>There are several support modules.
    <UL>
      <LI>HTTP transport
      <LI>FTP transport
      <LI>Gopher transport
      <LI>Resolver
    </UL>

    <P>These are all written in C and integrated into the build
      tree.

    <P>The SSLeay library that provides SSL support for the HTTP
      module is cross-compiled on Solaris and creates two ALF format
      files that are linked with the HTTP module in the main ROM build.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="enhancements"> 13.0 Future enhancements </a> </h2>

    <P>Use of an IM to allow 16bit text entry.

    <P>FontManager interface that can pick fonts sensibly to avoid
      having to swap font handles between words within the browser.

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="glossary"> 14.0 Glossary </a> </h2>

    <TABLE WIDTH="100%" BORDER=0>
      <TR><TD>CIS		<TD>Customer Interface Specification.
      <TR><TD>FORM		<TD>An HTML element that allows the
	  user to make selections and enter text that is then sent
	  to a server.
      <TR><TD>IM		<TD>Input Method. Specifically a software application to enter non-latin fonts.
      <TR><TD>NVRAM		<TD>Non-volatile RAM. Maintains its
	  contents when power is off.
      <TR><TD>PDD		<TD>Product Definition Document.
    </TABLE>

    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="references"> 15.0 References </a> </h2>

    <P>The following external standards are referenced in this spec.

    <DL>

      <DT>[1] <A NAME="toplevel">STB VE II Top Level Functional Specification </A>
      <DD>Document ref: 1214,630/FS

      <DT>[2] <A NAME="nc2" HREF="http://www.acorn.com/NCdevelopment/doc.public/2-00/specifications/apps/browser.html">
	  Browser Software Functional Specification [Acorn NC2]</A>
      <DD>Document ref: 2107,611/FS

      <DT>[3] <A NAME="rca116" HREF="http://www.acorn.com/NCdevelopment/doc.public/1-16/specifications/apps/browser.html">
	  Browser Software Functional Specification [NC100 1.16]</A>
      <DD>Document ref: 2107,510/FS

      <DT>[4] <A NAME="rca115" HREF="http://www.acorn.com/NCdevelopment/doc.public/rca_nc100/software_docs/apps/browserrca.html">
	  Browser Software Functional Specification [NC100 1.15]</A>
      <DD>Document ref: 2107,702

      <DT>[5] <A NAME="model1" HREF="http://www.acorn.com/NCdevelopment/doc.public/rca_nc100/referenced_soft/apps/browser.html">
	  Browser Software Functional Specification [Model 1]</A>
      <DD>Document ref: 2103,702

      <DT>[6] <A NAME="html32" HREF="http://www.w3.org/TR/">HTML 3.2
	  Reference Specification</a>
      <DD>The base document for the NCBrowser HTML implementation.

      <DT>[7] <A NAME="html40" HREF="http://www.w3.org/TR/">HTML 4.0
	  Draft Specification</a>
      <DD>Specification of some advanced features.

      <DT>[8] <A NAME="nc2_cis">NC2 CIS</a>
      <DD>Acorn NC2 Customer Interface Specification.

    </DL>

    <P>

      <!-- ======================================================================= -->

    <hr>
    <h2> <a name="history"> 16.0 History </a> </h2>

    <PRE>
$Log$
Revision 1.1.2.3  1997/11/12 12:39:12  smiddle
Rewrite Options description as it must be done by the browser as the
STB doesn't have extended NVRAM and so cannot sensibly run NVRAM and
NCOptions modules.

Revision 1.1.2.2  1997/10/22 09:11:58  smiddle
Partial update.

Revision 1.1.2.1  1997/10/13 10:35:42  smiddle
Added some specifications

    </PRE>

    <hr>
    <P>

    <TABLE BORDER=1 WIDTH="100%">
      <TR>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    This document is issued under license and must not be copied, reproduced
	    or disclosed in part or whole outside the terms of the license.
	  </SMALL>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    &#169; Acorn Computers Ltd 1997
	  </SMALL>
    </TABLE>

    <HR>
    <!-- Created: Mon Aug 11 16:18:39 BST 1997 -->
    <!-- hhmts start -->
Last modified: Mon Dec 15 13:36:18 GMT 1997
<!-- hhmts end -->
  </body>
</html>
