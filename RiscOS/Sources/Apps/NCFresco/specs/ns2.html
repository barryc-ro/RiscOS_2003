<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML Experimental 19960712//EN">
<html>
  <!-- ======================================================================= -->
  <!--         Template for software functional specifications.                -->
  <!-- ======================================================================= -->
  <head>
    <title>
      Browser Software Functional Specification
    </title>
  </head>

  <body BGCOLOR="#ffffff">


    <h1 align=center>
      Browser Software Functional Specification 
    </h1>

    <p>
    <hr>
    <p align=center><strong>CONFIDENTIAL</strong></p>
    <hr>

    <CENTER>
      <TABLE BORDER=0 WIDTH="40%">
	  <TR><TD>Document ref:	<TD>2108,225/FS
	  <TR><TD>Project:	<TD>NetProducts NetStation II
	  <TR><TD>Revision:	<TD>$Revision$
	  <TR><TD>Date:		<TD>$Date$
	  <TR><TD>Author(s):	<TD><A HREF="mailto:smiddleton@acorn.com">Simon Middleton</a>
	  <TR><TD>Change:		<TD>
	  <TR><TD>Classification:	<TD>Acorn Confidential
      </TABLE>
    </CENTER>

    <!-- ======================================================================= -->

    <hr>
    <h2> Contents </h2>
    <TABLE BORDER=0 WIDTH="100%">
	<TR><TD WIDTH="8%">1.0		<TD><A HREF="#overview">	Overview </A>
	<TR><TD>2.0		<TD><A HREF="#outstanding">	Outstanding issues </A>
	<TR><TD>3.0		<TD><A HREF="#technical">	Technical background </A>
	<TR><TD>4.0		<TD><A HREF="#user">		User interface </A>
	<TR><TD>5.0		<TD><A HREF="#programmer">	Programmer interface </A>
	<TR><TD>6.0		<TD><A HREF="#interchange">     Data interchange </A>
	<TR><TD>7.0             <TD><A HREF="#formats">         Data formats </A>
	<TR><TD>8.0             <TD><A HREF="#external">        External dependencies </A>
	<TR><TD>9.0		<TD><A HREF="#acceptance">	Acceptance test </A>
	<TR><TD>10.0            <TD><A HREF="#noncompliances">  Non compliances </A>
	<TR><TD>11.0		<TD><A HREF="#test">		Development test strategy </A>
	<TR><TD>12.0		<TD><A HREF="#organisation">	Product organisation </A>
	<TR><TD>13.0		<TD><A HREF="#enhancements">	Future enhancements </A>
	<TR><TD>14.0	<TD><A HREF="#glossary">	Glossary </A>
	<TR><TD>15.0	<TD><A HREF="#references">	References </A>
	<TR><TD>16.0	<TD><A HREF="#history">		History </A>
    </TABLE>

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="overview"> 1.0 Overview </a> </h2>

    <P> This document contains the software functional specification
    for the Web browser included in the system ROM of the NetProducts
    Network Computer version 2.0 <A HREF="#cis">[1]</A>.

    <P>This document only describes changes from the version of the
    browser included in Acorn Generic NC OS 2. Specifications for the
    previous versions of the browser may be of interest:

	NC OS 2.00 <A HREF="#nc2">[2]</A>, 
	NC OS 1.16 <A HREF="#rca116">[3]</A>, 
	NC OS 1.15 <A HREF="#rca115">[4]</A>,
        NC OS 1.06 <A HREF="#model1">[5]</A>.

      <P>The baseline specification for the HTML implementation is
      HTML 3.2 <A HREF="#html32">[6]</A> although some elements from
      its successor, HTML 4 <A HREF="#html40">[7]</A>, have been implemented.

    <P>Italicised text is used where issues are still to be decided
      or where contents are liable to change.

    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="outstanding"> 2.0 Outstanding issues </a> </h2>

    <P> None.
    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="technical"> 3.0 Technical background </a> </h2>

    <H3>3.1 NVRAM support</H3>

    <P>The following new NVRAM tags are recognised.

    <UL>
      <LI>BrowserPrintBackgrounds
      <LI>BrowserPrintImages
      <LI>BrowserDisplayBackgrounds
      <LI>BrowserDisplayImages
    </UL>

    <H4>3.1.1 Print options</H4>

    <P>The Print Backgrounds and Print Images tags are described in
    section 4.2.1.

    <H4>3.1.2 Display Backgrounds</H4>

    <P>If this option is not set then none of the background image or
    foreground or background colours set in the page are
    displayed. The page is displayed in the default colours, ie with
    black text on a grey background with links in blue. This
      guarantees that the page is readable.

    <H4>3.1.3 Display Images</H4>

    <P>If this option is not set then no images are fetched or
    displayed. Instead the image box and any ALT text given are
    displayed.


    <P>
      <!-- ======================================================================= -->

    <hr  noshade>

    <h2> <a name="user"> 4.0 User interface </a> </h2>
    <P>The changes to the user interface, or in support of user
    interface features are listed here. See the CIS for exact details
    of how these changes will appear visually.


    <h3>4.1 Toolbar changes</h3>

    <P>Three toolbars are supplied as in NC2, Main, Secondary and
    Codecs. The toolbars affected by each change are described below.


    <h4>4.1.1 Add Zip disc button</h4>

    <P><i>Affects Main and Secondary toolbars</i>

    <P>A new button is added labelled 'Zip'. This has component id
    <CODE>0x2101</CODE> and generates event code
    <CODE>0x3101</CODE>. When this event is raised the file on the Zip
      disc is run.

    <P>The browser <CODE>!Run</CODE> file sets up system variables as
      follows (ignoring line breaks due to formatting):-

    <PRE>
Set Alias$URLOpen_ZipRunFile /&lt;Zip$RunFile&gt;
SetMacro NCFresco$EventURL01 ZipRunFile:
    </PRE>

<!--
Set Alias$URLOpen_ZipRunFile IfThere &lt;Zip$RunFile&gt; Then
	/&lt;Zip$RunFile&gt; Else Set NCFresco$ReturnedFrames
	url=file:/NCFresco:NoZip.html&amp;target=__dbox

    <P>An apology page is created to be used if the file is obviously
      not available to save the time that trying to access file and
      failing would cause.
-->

    <h4>4.1.2 Add Disconnect button</h4>

    <P><i>Affects Main and Secondary toolbars</i>

    <P>A new button is added labelled 'Disconnect'. This has component
    id <CODE>0x2102</CODE> and generates event code
    <CODE>0x3102</CODE>. When this event is raised the modem
    disconnects and hangs up the line.

    <P>The browser <CODE>!Run</CODE> file sets up system variables as follows:-

    <PRE>
Set Alias$URLOpenCLI_Disconnect NCDial_Hangup %%*0
Set NCFresco$EventURL02  Disconnect:
    </PRE>


    <h4>4.1.3 Add Indicator lights</h4>

    <P><i>Affects Main and Secondary toolbars</i>
 
    <P>Four indicator lights are added to the toolbars. These are
    creaated with unselectable ToolAction gadgets and pairs of sprites
    as for the SSL icon. They reflect the state of the following
      system items.

    <UL>
      <LI>Num lock
      <LI>Caps lock
      <LI>Scroll lock
      <LI>Modem state
    </UL>

    <P>The browser polls the state of the keyboard locks once per
    second and updates the display when any state changes.

    <P>The browser always tracked the state of the modem connection
    for redial support. This code is extended to set the light state
    when the connection state changes. The logic used for the
    front-panel LED is maintained as regards when the transitions
    occur.


    <h4>4.1.4 Remove fast forward and rewind buttons</h4>

    <P><i>Affects Codec toolbar</i>

     <P>The referenced buttons are removed from the toolbar and their
     sprites removed from the sprite set.


    <h3>4.2 Popup screen changes</h3>

    <P>The popup screens are modified as follows.

    <h4>4.2.1 Print popup</h4>

    <P>Two new checkbox options are added to the Print dialogue
    box. They are set according to the values in the NVRAM referenced
    by tags PrintBackgrounds and PrintImages. Their affects are as
    follows.

    <DL>
      <DT><B>Print backgrounds</B>

      <DD>When set then background images or colours are foreground
	colours are printed.<BR>

	When clear then:-
	<UL>
	  <LI>The page background (whether solid or tiled) is not
	    printed.

	  <LI>Text colours specified in the BACKGROUND tag are
	  ignored, ie all text and links are printed in the default
	  colours (ie black and blue respectively) - unless local FONT
	  COLOR tags have been used.
	</UL>

      <DT><B>Print images</B>

      <DD>When set images are printed. When clear then a box of the
	correct size is drawn and any ALT text given is printed
	instead. 
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="programmer"> 5.0 Programmer interface </a> </h2>

    <P>There is no change to the programmer interface.

<!--
    <H3>5.1 Message_NCFresco</H3>

    <P>The Wimp message Message_NCFresco, reason code 0 (LoadConfig)
    is extended to allow the browser to be notified that NVRAM
    locations it uses have been changed and so it should update its
    internal copies.

    <P>The new complete specification for this message is as follows.

      <H4>MESSAGE_NCFRESCO (&amp;4AF84)</H4>
      <PRE>
    R1+16   Message_NCFresco
    R1+20   Reason code
		0: LoadUserFiles
		1: Die
		2: reserved
		3: LoadConfig
    R1+24   flags (reason code dependent)
    R1+28.. data (reason code dependent)
      </PRE>


	<h5>LoadUserFiles (0)</h5>
	
      <PRE>
    R1+24 flags
		  bit 0: 0 = load all user files 
			     (bits 1-7 ignored)
			 1 = load only specified user files
		  bit 1: 0 = don't load user config
			 1 = load user config
		  bit 2: 0 = don't load cookies
			 1 = load cookies
		  bit 3: 0 = don't load passwords
			 1 = load passwords
		  bit 4: 0 = don't load hotlist
			 1 = load hotlist
		  bit 5: 0 = don't load plugin list
			 1 = load plugin list
		  bit 6: 0 = don't load allow and deny files
			 1 = load allow and deny files
		  bit 7: 0 = don't flush user data
			 1 = flush user data
		  bit 8: 0 = don't read NVRAM
			 1 = read NVRAM and update soft copies
		  bits 9-31: reserved (must be zero)
      </PRE>

	<P>When this message is received the browser will attempt to
	load the user specific files, ie the Cookies, Passwords,
	Plugin config and User config. Each of the files can be
	disabled by setting the appropriate flag. If disabled the
	existing values continue to be used.

      <P>If bit 0 is clear or bit 7 is set then all transient user data
      is flushed from memory. eg history lists, cookies etc. and also the
      browser cache is flushed.

	<P>Note that the locations of each file can be changed by
	values in the config file. The order defined is that the
	user config file is loaded first and if this changes the
	locations of any of the other user files then they are loaded
	from the new locations.	

    <P>The NVRAM locations read are:-

    <UL>
      <LI>BrowserFontSize
      <LI>BrowserMusicStatus
      <LI>BrowserBeepStatus
      <LI>BrowserScaling
      <LI>PrinterColour
      <LI>PrinterOrientation
    </UL>

	<h5>Die (1)</h5>

      <PRE>
    R1+24 flags
		  bits 0-31: reserved (must be zero)
      </PRE>

	<P>When this message is received the browser will perform a
	  clean exit.

	<h5>LoadConfig (3)</h5>

      <PRE>
    R1+24 flags
		  bits 0-31: reserved (must be zero)
    R1+28 null-terminated filename
      </PRE>

      <P>Load the config file given by the filename at offset 28.

    <h3>5.2 ncfrescointernal commands</h3>

    <P>Some new internal URLs are defined.

    <DL>
      <DT><CODE>ncfrescointernal:openpanel?name=favswitch[&amp;mode={delete|show}]</CODE>

      <DD>This opens the new style favourites page that includes a
      button to switch between show favourites and delete favourites.

	<BR>It takes an optional argument which determines which style
	  of page to open.
	<P>

      <DT><CODE>ncfrescointernal:openpanel?name=historyswitch[&amp;mode={alpha|recent}]</CODE>
      <DD>This opens the new style history page that includes a
      button to switch between showing the recent and alphabetical
	history lists.

	<BR>It takes an optional argument which determines which style
	  of page to open.
    </DL>
 -->

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="interchange"> 6.0 Data interchange </a> </h2>
    
    <P>There are no new data interchange protocols defined in this spec.

    <P>
      <!-- ======================================================================= --> 

    <hr  noshade>
    <h2> <a name="formats"> 7.0 Data formats </a> </h2>

    <P>The following changes are made to the Config file.

    <h3>7.1 Keyboard mapping</H3>

    <P>The Web section (7) of the Kep mappings are of the Config file is
      changed to provide the values specified in the CIS.

    <P>The new mapping list is as follows

    <TABLE BGCOLOR=grey80 CELLPADDING=1>
	<TR>
	  <TH>Key code
	  <TH>Event code
	  <TH>Key name
	  <TH>Description

	<TR>
	  <TD>0x181	<TD>0x3032
	  <TD>F1	<TD>Home
	<TR>
	  <TD>0x182	<TD>0x3011
	  <TD>F2	<TD>Back
	<TR>
	  <TD>0x183	<TD>0x3013
	  <TD>F3	<TD>Forward
	<TR>
	  <TD>0x184	<TD>0x3039
	  <TD>F4	<TD>Goto
	<TR>
	  <TD>0x185	<TD>0x3020
	  <TD>F5	<TD>Favs
	<TR>
	  <TD>0x186	<TD>0x20AE
	  <TD>F6	<TD>More/Close
	<TR>
	  <TD>0x187	<TD>0x3016
	  <TD>F7	<TD>History
	<TR>
	  <TD>0x188	<TD>0x203E
	  <TD>F8	<TD>Info
	<TR>
	  <TD>0x189	<TD>0x3021
	  <TD>F9	<TD>Save
	<TR>
	  <TD>0x1CA	<TD>0x3100
	  <TD>F10	<TD>Options
	<TR>
	  <TD>0x1CB	<TD>0x3033
	  <TD>F11	<TD>Print
	<TR>
	  <TD>0x1CC	<TD>0x30B3
	  <TD>F12	<TD>Stop/Reload
	<TR>
	  <TD>0x191	<TD>0x3102
	  <TD>Shift F1	<TD>Disconnect
	<TR>
	  <TD>0x192	<TD>0x3101
	  <TD>Shift F2	<TD>Zip drive
	<TR>
	  <TD>0x193	<TD>0x20C0
	  <TD>Shift F3	<TD>Codec Stop
	<TR>
	  <TD>0x194	<TD>0x20C2
	  <TD>Shift F4	<TD>Codec Pause
	<TR>
	  <TD>0x195	<TD>0x20C1
	  <TD>Shift F5	<TD>Codec Play
	<TR>
	  <TD>0x196	<TD>0x20Af
	  <TD>Shift F6	<TD>Codec Close
	<TR>
	  <TD>0x1DA	<TD>0x2001
	  <TD>Shift F10	<TD>Toggle toolbar
	<TR>
	  <TD>0x1DC	<TD>0x3103
	  <TD>Shift F12	<TD>Standby
    </TABLE>

    <P>The following system variable is set to support the Standby
      command.

<PRE>
Set NCFresco$EventURL03 ncma:standby
</PRE>

    <P>The following new event is created.

    <TABLE BGCOLOR=grey80 CELLPADDING=1>
	<TR>
	  <TH>Event code
	  <TH>Name
	  <TH>Description
	<TR>
	  <TD>0x20AE
	  <TD>TOOLBAR_CYCLE
	  <TD>This event will cause the toolbar to change to the next
	    in the list, wrapping around at the end of the list,
	    excepting the codec toolbar.
    </TABLE>
      


<!--
    <h3>7.2 EventURL handling</H3>

    <P>The generic event to URL handling mechanism introduced in the
      NC2 is modified to be able to give RISC OS file names instead of
      URLs. Now the contents of the System variable will be considered
      to be a filename unless prefixed by <CODE>-url</CODE>.
 -->

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="external"> 8.0 External dependencies </a> </h2>

    <P>There are no external dependencies.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="acceptance"> 9.0 Acceptance test </a> </h2>

    <P>The browser must pass the acceptance criteria described in the
      Work Package document.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="noncompliances"> 10.0 Non compliances </a> </h2>

      <P>The following elements of the HTML 3.2 specification are not implemented.
	<DL>
	  <DT>LINK
	  <DD>This element is very rarely used.
	  <DT>INPUT TYPE=FILE
	  <DD>This element is for file upload over HTTP and is not
	    relevant to the NC as there is no local storage.
	</DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="test"> 11.0 Development test strategy </a> </h2>

    <P>In addition to checking that the acceptance tests are passed
      the following additional tests will be performed.

    <UL>
      <LI>Check that the behaviour of the Zip button and key shortcut
      are acceptable when no Zip disc is present, the file named is
      not present, or the disc is corrupt.
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="organisation"> 12.0 Product organisation </a> </h2>

    <P>The browser is built via a Solaris hosted cross-compiling
      version of ARM cc (Acorn port) v5.06. For ROM release a
      partially linked <TT>AOF</TT> file is created which is imported into
      the RISC&nbsp;OS build tree. The browser runs from ROM.

    <P>There are several support modules.
    <UL>
      <LI>HTTP transport
      <LI>FTP transport
      <LI>Gopher transport
      <LI>Resolver
    </UL>

    <P>These are all written in C and integrated into the build
      tree.

    <P>The SSLeay library that provides SSL support for the HTTP
      module is cross-compiled on Solaris and creates two ALF format
      files that are linked with the HTTP module in the main ROM build.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="enhancements"> 13.0 Future enhancements </a> </h2>

    <P>See earlier specifications for possibilities.

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="glossary"> 14.0 Glossary </a> </h2>

    <TABLE WIDTH="100%" BORDER=0>
	<TR><TD>CIS		<TD>Customer Interface Specification.
	<TR><TD>HTML		<TD>Hyper Text Markup Language.
	<TR><TD>HTML 3.2	<TD>The current base-line HTML standard.
	<TR><TD>HTTP		<TD>Hyper Text Transport Protocol.
	<TR><TD>NC		<TD>Network Computer.
	<TR><TD>NVRAM		<TD>Non-volatile RAM. Maintains its
	    contents when power is off.
	<TR><TD>OS		<TD>Operating System.
	<TR><TD>PDD		<TD>Product Definition Document.
	<TR><TD>Sprite		<TD>An Acorn proprietary bitmap
	    graphics file format.
	<TR><TD>SSL		<TD>Secure Sockets Layer.
	<TR><TD>SWI		<TD>Software Interrupt.
	<TR><TD>UI		<TD>User Interface.
	<TR><TD>URL		<TD>Uniform Resource Locator.
	<TR><TD>W3C		<TD>World Wide Web Consortium. Closest thing 
	    to a useful standards body for web software.
    </TABLE>

    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="references"> 15.0 References </a> </h2>

    <P>The following external standards are referenced in this spec.

    <DL>

      <DT>[1] <A NAME="ns2" HREF="">NetProducts Network Computer Project Specification</a>
      <DD>Document ref: 2308,200

      <DT>[2] <A NAME="nc200" HREF="http://www.acorn.com/NCdevelopment/doc.public/2-00/specifications/apps/browser.html">
	  Browser Software Functional Specification [Acorn Generic NC2 2.00]</A>
      <DD>Document ref: 2107,611/FS

      <DT>[3] <A NAME="rca116" HREF="http://www.acorn.com/NCdevelopment/doc.public/1-16/specifications/apps/browser.html">
	  Browser Software Functional Specification [NC100 1.16]</A>
      <DD>Document ref: 2107,510/FS

      <DT>[4] <A NAME="rca115" HREF="http://www.acorn.com/NCdevelopment/doc.public/rca_nc100/software_docs/apps/browserrca.html">
	  Browser Software Functional Specification [NC100 1.15]</A>
      <DD>Document ref: 2107,702

      <DT>[5] <A NAME="model1" HREF="http://www.acorn.com/NCdevelopment/doc.public/rca_nc100/referenced_soft/apps/browser.html">
	  Browser Software Functional Specification [Model 1]</A>
      <DD>Document ref: 2103,702

      <DT>[6] <A NAME="html32" HREF="http://www.w3.org/TR/">HTML 3.2
	  Reference Specification</a>
      <DD>The base document for the NCBrowser HTML implementation.

      <DT>[7] <A NAME="html40" HREF="http://www.w3.org/TR/">HTML 4.0
	  Draft Specification</a>
      <DD>Specification of some advanced features.

      <DT>
    </DL>

    <P>

      <!-- ======================================================================= -->

    <hr>
    <h2> <a name="history"> 16.0 History </a> </h2>

    <PRE>
$Log$
    </PRE>

    <hr>
    <P>

    <TABLE BORDER=1 WIDTH="100%">
	<TR>
	  <TD WIDTH="50%" VALIGN=TOP>
	    <SMALL>
	      This document is issued under license and must not be copied, reproduced
	      or disclosed in part or whole outside the terms of the license.
	    </SMALL>
	  <TD WIDTH="50%" VALIGN=TOP>
	    <SMALL>
	      &#169; Acorn Computers Ltd 1997
	    </SMALL>
    </TABLE>

    <HR>
    <!-- Created: Mon Aug 11 16:18:39 BST 1997 -->
    <!-- hhmts start -->
Last modified: Wed Nov 12 12:30:49 GMT 1997
<!-- hhmts end -->
  </body>
</html>
