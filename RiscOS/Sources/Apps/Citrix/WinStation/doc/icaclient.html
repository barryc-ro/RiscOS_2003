<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML/3.2//EN">
<html>
  <!-- ======================================================================= -->
  <!--         Template for software functional specifications.                -->
  <!-- ======================================================================= -->
  <head>
    <title>
      ICA-3 Client Functional Specification
    </title>
  </head>

  <body BGCOLOR="#ffffff">


    <h1 align=center>
      ICA-3 Client Functional Specification 
    </h1>

    <p>
    <hr>
    <p align=center><strong>CONFIDENTIAL</strong></p>
    <hr>

    <CENTER>
      <TABLE BORDER=0 WIDTH="40%">
	<TR><TD>Document ref:	<TD>1315,500/FS
	<TR><TD>Project:	<TD>ICA-3 (834)
	<TR><TD>Revision:	<TD>Issue F<!--  $Revision$ -->
	<TR><TD>Date:		<TD>20th May 1998 <!-- $Date$ -->
	<TR><TD>Author(s):	<TD><A HREF="mailto:mnevillesmith@acorn.com">Martin Neville-Smith</a>, <A HREF="mailto:smiddleton@acorn.com">Simon Middleton</a>
	<TR><TD>Change:		<TD>*** LIVE ***
	<TR><TD>Classification:	<TD>Acorn Confidential
      </TABLE>
    </CENTER>

    <!-- ======================================================================= -->

    <hr>
    <h2> Contents </h2>
    <TABLE BORDER=0 WIDTH="100%">
      <TR><TD WIDTH="8%">1.0		<TD><A HREF="#overview">	Overview </A>
      <TR><TD>2.0		<TD><A HREF="#outstanding">	Outstanding issues </A>
      <TR><TD>3.0		<TD><A HREF="#technical">	Technical background </A>
      <TR><TD>4.0		<TD><A HREF="#user">		User interface </A>
      <TR><TD>5.0		<TD><A HREF="#programmer">	Programmer interface </A>
      <TR><TD>6.0		<TD><A HREF="#interchange">     Data interchange </A>
      <TR><TD>7.0             <TD><A HREF="#formats">         Data formats </A>
      <TR><TD>8.0             <TD><A HREF="#external">        External dependencies </A>
      <TR><TD>9.0		<TD><A HREF="#acceptance">	Acceptance test </A>
      <TR><TD>10.0            <TD><A HREF="#noncompliances">  Non compliances </A>
      <TR><TD>11.0		<TD><A HREF="#test">		Development test strategy </A>
      <TR><TD>12.0		<TD><A HREF="#organisation">	Product organisation </A>
      <TR><TD>13.0		<TD><A HREF="#enhancements">	Future enhancements </A>
      <TR><TD>14.0	<TD><A HREF="#glossary">	Glossary </A>
      <TR><TD>15.0	<TD><A HREF="#references">	References </A>
      <TR><TD>16.0	<TD><A HREF="#history">		History </A>
    </TABLE>

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="overview"> 1.0 Overview </a> </h2>

    <h3> <a name="icaoverview"> 1.1 Citrix ICA Overview </a> </h3>

    <P>The wide acceptance of Microsoft applications across the whole
    spectrum of market areas has always presented a problem to Acorn,
    as many potential customers would like to have the ability to run
    such applications, even if this is not the prime reason to
    purchase a computer system. This ability now goes far beyond the
    traditional desktop machine, and is relevant to Network Computers,
    STBs and even small embedded systems. Market areas that have
    particular influence include the corporate network, distance
    workers, small office users, and as an additional service to TV
    Centric STB technology.  

    <P>With the introduction of Windows 95 and Windows NT, Microsoft
    Windows is rapidly becoming the predominant 32-bit application
    platform. As I/S managers begin to introduce advanced Windows
    applications into the extended enterprise, they face the challenge
    of how to effectively deploy 32-bit applications beyond
    LAN-connected, PC users. This falls mainly into the domain of the
    NC, and presents a challenge.  

    <P>The challenge is two-fold. First, users may be remote to the
    LAN, connecting into the corporate network through high-bandwidth
    WANs, over the Internet, or from low-bandwidth dial-up lines. The
    second challenge is to provide this service from low-cost
    platforms that appear to the user to have a responsiveness of an
    expensive desktop PC.  

    <P>This is the area that Citrix have addressed with their WinFrame
    technology. This involves a network-centric, three-tiered
    application architecture. Under this model, the application
    execution and data storage occurs on a central server (or
    servers), and only a thin piece of client software is required at
    the client system. This uses universal, thin-client software in
    conjunction with an application server and a distributed Windows
    display protocol.  

    <P>Citrix WinFrame is a multi-user Windows application server
    based on Windows NT under license from Microsoft that supports
    enterprise application deployment using a thin-client
    architecture. This network-centric approach includes universal,
    thin-client software that works in conjunction with WinFrame
    multi-user application server software. Enterprise applications
    execute on the WinFrame server and are accessed through
    thin-client software over dial-up, LAN, WAN and Internet
    connections. The thin-client architecture provides users with
    consistent, high-performance and universal access to any type of
    application, including DOS, Windows 16, Windows 32 and
    client/server programs, regardless of available bandwidth or
    client hardware. The multi-user application server design provides
    I/S managers with an economical and manageable way to deliver
    applications across the extended corporate network or public
    Internet.  

    <P>The key to this thin-client architecture is a distributed
    Windows presentation protocol developed by Citrix, called
    ICA. This is a general-purpose presentation services protocol for
    Microsoft Windows. Conceptually, ICA is similar to the UNIX
    X-Windows protocol. ICA allows an application's logic to execute
    on a WinFrame multi-user Windows application server, located
    remotely. Only the user interface, keystrokes and mouse movement
    are transferred between the server and the client device over any
    network or communications protocol, resulting in minimal client
    resource consumption. ICA is designed to run over
    industry-standard network protocols, such as TCP/IP, NetBEUI,
    IPX/SPX, and PPP and industry-standard transport protocols, such
    as async, ISDN, Frame Relay and ATM.  

    <P>The ICA protocol presents only the user interface from an
    executing machine on the display of another machine. ICA provides
    true location independence for Windows applications by running the
    Windows application at one location and executing the program's
    user interface somewhere else. This distributed Windows
    architecture allows Windows 16, Windows 32 and client/server
    applications to perform at very high speed over low bandwidth
    connections. It also allows 16- and 32-bit applications to run on
    legacy PCs, old and existing Acorn computers as well as STB and NC
    platforms.  

    <P>Citrix has come into partnership with Acorn to provide a full
    end-to-end solution, and Acorn have agreed to supply the ICA
    client software into all appropriate platforms in the future.

    <h3> <a name="deliverables"> 1.2 Project Deliverables </a> </h3>

    <P>The project deliverables are as follows.

    <OL>
      <LI>A standalone application, !ICAClient, as detailed in <A
    HREF="#appversion">section 12.3</A>. 

      <LI>A ROM application, !ICAClient, as detailed in <A
    HREF="#romversion">section 12.4</A> supplied as a linkable aof
    file and set of resources. 

      <LI>A document characterising the performance of the client in
      a typical configuration.

      <LI>A user guide, based on the Citrix Windows client user
	guide. 

      <LI>This document, which will constitute all technical
	information about the client. 
    </OL>

    <P>Note that this project is not supplying audited software. It
    supplies a set of sources development tested in typical
      configurations. It is the responsibility of separate projects to
      audit the software for release.

    <h3> <a name="server"> 1.3 Server requirements </a> </h3>

    <P>Note that this client is designed to run with a WinFrame 1.7
    server. This server consists of a modified Windows NT 3.51 kernel
    plus custom connectivity software, purchased as a complete pack
    from a Citrix authorised reseller.

    <P>The Windows NT 4 equivalent of this server software is in beta
    test currently and is expected to be shipping by the end of this
    project. It consists of two parts, the Windows Based Terminal
    Server from Microsoft and the MetaFrame software from Citrix.

    <P>The RISC OS client will be development tested against a
    WinFrame 1.6 server and the beta pICAsso server as much as
    possible but testing is concentrated on the WinFrame 1.7 server.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="outstanding"> 2.0 Outstanding issues </a> </h2>

    <UL>
      <LI>How serial port driver works.
      <LI>How clipboard driver works.
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="technical"> 3.0 Technical background </a> </h2>

    <UL>
      <LI><A HREF="#icafunc">3.1 ICA Functionality</A>
      <LI><A HREF="#icaprot">3.2 ICA Protocol</A>
      <LI><A HREF="#icacmds">3.3 ICA Commands</A>
      <LI><A HREF="#icatrans">3.4 ICA Protocol and Transport layers</A>
      <LI><A HREF="#icaext">3.5 ICA Extensibility</A>
    </UL>

    <h3><A NAME="icafunc">3.1 ICA Functionality</A></h3>

    <P>The ICA protocol is designed to provide high-performance
    Windows display over low-bandwidth connections, to run over any
    common transport mechanism, and to require minimal client
    resources. ICA is a robust and extensible protocol that includes
    protocol definitions for the following capabilities:

    <DL>
      <DT>Full-screen text presentation (<a href="#fullscreentext">3.2.2</a>)
      <DD>This is used for when running DOS applications full screen.

      <DT>Graphical Windows application screen presentation
      <DD>This is the default display mode and gives a screen that
	appears to be a Windows NT desktop.

      <DT>Keyboard (<A HREF="#keyboard">3.3.3</A>) and mouse (<A HREF="#mouse">3.3.4</A>) input

      <DT>Session control

      <DD>A session is identified by the client machine from which it
      came. If the client disconnects from the server without logging
      out then the session is saved to disc and is available next time
	it logs in.

      <DT>File system redirection (<A HREF="#drivemapper">3.3.5.2</A>)

      <DD>This allows drives and directories visible from the client
      machine, whether local or remote, to be accessed from within the
      WinFrame session.

      <DT>Print redirection (<A HREF="#printerspooler">3.3.5.3</A>)

      <DD>This allows printers connected to the client machine,
	directly or via a network, to be accessed from within the
	WinFrame session and to be visible to other clients conncected
	to the same WinFrame server.

      <DT>Memory cache

      <DD>Up to 8Mbytes of memory can be allocated to the cache. This
	keeps bitmaps and brushes that have been fetched from the
	server so they can be quickly reused.

      <DT>WinFrame server browsing

      <DD>A broadcast protocol is used to determine what WinFrame
      servers exist on the network, this allows the Remote Application
      Manager (<A HREF="#mgr">4.8</A>) to automatically give a list of
      available servers and for load balancing to work.

      <DT>Memory cache

      <DD>Up to 8Mbytes of memory can be allocated to the cache. This
	keeps bitmaps and brushes that have been fetched from the
	server so they can be quickly reused.

      <DT>Persistent disc cache

      <DD>A connection can be set to use a persistent disc cache. This
      is kept across sessions and keeps compressed bitmaps sent by the
      server so that they need not be re-requested.
    </DL>

    <P>The ICA protocol is defined in the Citrix confidential
    specification <CITE>Intelligent Console Architecture</CITE><A
    HREF="#icaspec">[5]</A>. This document and the accompanying
    virtual driver specifications only define the protocols as
    implemented in the WinFrame 1.6 server release. Therefore the
    definitive specification is the source code provided by Citrix<A
    HREF="#icasource">[6]</A>.

    <h3><a name="icaprot">3.2 ICA Protocol</a></h3>

    <P>ICA is the physical line protocol used for communication
    between the client machine and the Citrix WinFrame application
    server. Thinwire is the name of the data protocol that exports the
    application's graphical screen image. Thinwire is a logical
    datastream that flows encapsulated in an ICA packet. Thinwire is
    not a physical protocol. The physical protocol, ICA, must
    guarantee the delivery of the thinwire datastream with no errors
    and no missing or out-of-sequence data.

    <P>From the perspective of the WinFrame application server, the
    major portion of the thinwire component is part of the GDI and
    video driver subsystem. This thinwire component, in conjunction
    with key elements in the WinFrame Win32 subsystem, generates
    highly optimized drawing primitives called the thinwire protocol.

    <P>The output of the thinwire protocol driver is a logical
    datastream that is sent back up a virtual channel API, which takes
    the datastream and encapsulates it into an ICA packet. Once the
    ICA packet is formed, it optionally passes through a series of
    protocol drivers to add functionality like encryption, compression
    and framing. It is then put on the transport layer and sent to the
    client. Once at the ICA client, the data packet passes through the
    same layers in opposite order, resulting in the graphical display
    of the remote application user interface on the client.

    <P>ICA packets consist of a required one-byte command, followed by
    optional data. This packet can be prefixed by optional preambles,
    negotiated at connection time, to manage the transmission of the
    packet. The nature of the transmission medium (LAN vs Async) and
    user defined options (e.g. compression) influence the total packet
    definition.

    <P>All ICA commands have the following format:

    <CENTER>
      <TABLE BORDER=1 CELLPADDING=8>
	<TR>
	  <TH WIDTH="14%">Frame Head</TH>
	  <TH WIDTH="14%">Reliable</TH>
	  <TH WIDTH="14%">Library</TH>
	  <TH WIDTH="14%">Encrypt</TH>
	  <TH WIDTH="14%">Compress Data</TH>
	  <TH WIDTH="14%">Command</TH>
	  <TH WIDTH="14%">Frame Tail</TH>
	</TR>
      </TABLE>
    </CENTER>

    <DL COMPACT>
      <DT><B>Frame Head</B> <DD>Optional framing protocol
      header. Preamble for framing stream-oriented transport data.

      <DT><B>Reliable</B> <DD>Optional reliable transmission protocol
      header. Preamble for error detection and recovery.

      <DT><B>Encrypt</B> <DD>Optional encryption protocol
      header. Preamble for managing encrypted data.

      <DT><B>Compress</B> <DD>Optional compression protocol
      header. Preamble for managing compressed data.

      <DT><B>Command</B> <DD>ICA command byte. Beginning of base ICA
      protocol packet.

      <DT><B>Command Data</B> <DD>Optional data bytes associated with
      the specified COMMAND. The length of the data is dependent on
      the COMMAND and can be zero. COMMAND DATA can also contains
      virtual channel protocol packets.

      <DT><B>Frame Trail</B> <DD>Optional framing protocol
      trailer. Postamble for framing async transport data.
    </DL>

    <P>Only Command is always present in the packet. The preambles and
    postambles depend on the transport and the negotiation that takes
    place during initialization. The presence of Command Data depends
    on the Command itself.


    <h3><a name="icacmds">3.3 ICA Commands</a></h3>

    <P>There are several different categories of ICA commands. These
    categories are discussed below along with implementation notes.

    <h4>3.3.1 Control Commands</h4>

    <P>Control commands are a category of ICA command packets that
    manage the connection to the application server and the
    relationship to the local client user interface. This category of
    commands includes:

    <UL>
      <LI> Server browsing
      <LI> Connection initialization and negotiation
      <LI> Screen control between the application server and the local client user interface
	<P>e.g. connect, disconnect and reconnect messages.

      <LI> Screen control between the application server and the local
	client user interface
	<P>e.g. which of the available full-screen text modes should
	be used.
      <LI> Keyboard and mouse input to the application server
      <LI> Control of the local keyboard LEDs
    </UL>

    <h4><A NAME="fullscreentext">3.3.2 Full-Screen Text</A></h4>

    <P>Full-screen Text is a category of ICA command packets which
    allow the application server to control the local client display
    in a full-screen text mode.

    <P>These commands are rarely used for Windows
    applications. However, they are important for the support of very
    low-end devices and are encountered if a user runs a full-screen
    DOS session from within Windows. These commands involve less data
    transfer, and thus, higher display performance. Packets are
    sent from the server to perform the following:

    <UL>
      <LI> Set the text modes
      <LI> Write characters
      <LI> Adjust character attributes
      <LI> Scroll
      <LI> Control the cursor
    </UL>

    <P>This is implemented by :-

    <UL>
      <LI>Switching to a suitable full-screen 16 colour mode (ie that
      matches those supported by VGA cards).

      <LI>Setting the palette to the 16 colour VGA palette.

      <LI>Running the display in text (VDU 4) mode.

      <LI>Reprogramming the font. Note that any DOS code page can be
      set by the server - however only the default code page is
      supported by this software.
    </UL>

    <h4><A NAME="keybaord">3.3.3 Keyboard</A></h4> 

    <P>PC scan codes are transmitted from the client to the server
    application. An ICA command packet can contain multiple scan
    codes.

    <P>The RISC OS keyboard API only provides key down information
    with ASCII or internal key values. To allow key up and down events
    to be generated with the correct PS/2 scan code values the
    KeyWatch module, originally written for the NC100 project <A
    HREF="#ncos">[1]<A>, is extended to provide this extra
    information. This work is detailed in its own specification <A
    HREF="#keywatch">[2]</A>.

    <P>Each key on the keyboard is sent in its PS/2 scan code
    form. The interpretation of the keys is performed by the
      server. 

    <P>No specific mechanism is provided within the client to enter
    keys not on the keyboard (eg Windows key). However since the PS/2
    codes are reverse mapped from the Acorn internal key numbers then
    any mechanisms used to provide extra keys (eg by use of Fn keys on
    IR and portable keyboards) also provide these keys to the WinFrame
    server. Special keys that have no equivalent PS/2 codes are
    ignored.

    <P>The keyboard layout in use is sent to the server on
    connection. This can be according to the user profile on the
    server or as specified. By default the RISC OS client identifies
    the keyboard layout from the configured Keyboard setting and send
    the appropriate code. This can be overridden by editing the ini
    file by hand.

    <DL>
      <DT><CODE>KeyboardLayout=(User Profile)</CODE>
      <DD>Use layout specified in the user profile on the WinFrame server.

      <DT><CODE>KeyboardLayout=(Auto Detect)</CODE>
      <DD>Use layout determined from configured keyboard value.

      <DT><CODE>KeyboardLayout=<i>&lt;country&gt;</i> | <i>&lt;language&gt;</i></CODE>
      <DD>The country or language name is looked up in the Module.ini
	file to a layout code.
    </DL>

    <h4><A NAME="mouse">3.3.4 Mouse</A></h4>

    <P>The ICA command set includes commands to input the position of
    the mouse using normalized coordinates. These commands can also
    track the mouse button status.

    <P>The mouse status is polled in the main client poll loop and
      changes in state are transmitted to the server. A configuration
      entry <i>MouseTimer</i> limits how often movement only commands
      are sent.

    <P>The protocol supports up to 3 buttons.

    <h4>3.3.5 Virtual Channel Commands</h4>

    <P>The ICA protocol provides multiplexed management of multiple
    virtual channels. A virtual channel is a session-oriented
    transmission connection that can be used by application layer
    code. Virtual channels are used to add functional enhancements to
    the client, independently of the ICA protocol itself. There is a
    set of ICA Virtual Channel commands that are used to send and
    receive this ICA protocol independent data.

    <h5><A NAME="thinwire">3.3.5.1 Thinwire Virtual Channel</A></h5>

    <P>Thinwire protocol is an ICA virtual channel protocol used to
    transmit presentation commands from Windows applications running
    on the application server to the client. The Thinwire protocol is
    highly tuned for transmission of Windows object display over
    low-bandwidth connections. This is accomplished through:

    <UL>
      <LI> Command and object specific intelligent compression with state persistence, e.g. run-length encoding for bitmaps
      <LI> Outboard complex clipping and complex curve drawing,
      <LI> Intelligent caching of Windows objects, such as bitmaps, brushes, glyphs and pointers
      <LI> Remote SaveScreenBitmaps
      <LI> Cross-session persistent caching
    </UL>

    <P>Rendering of the Thinwire graphics commands is accomplished by
    the use of a library implementing a subset of the Windows GDI
    calls. These are called by the Thinwire driver to write to the
    screen. Certain portions of the thinwire driver are rewritten to
    provide better speed and more efficient use of resources with the
    RISC OS back end.

    <P>Persistent caching is configurable. The default location for
      the cache is in <CODE>&lt;Wimp$ScrapDir&gt;.ICAClient.Cache</CODE>.

    <h5><A NAME="printerspooler">3.3.5.2 Printer Spooling Virtual Channel</A></h5>

    <P>ICA includes a virtual channel protocol to transmit printer
    data to a client. There are two versions of the protocol which are
      sufficiently different that they are implemented in two
      different modules. One supports printing from DOS and Windows,
      the other from Windows only.

    <h6>3.3.5.2.1 DOS compatible printing</h6>

    <P>In the older version of the protocol the available printers are
      directly mapped onto virtual ports, Virtual LPT1 to LPT4 and
      Virtual COM1 to COM4.

    <P>The RISC OS client always maps the currently selected printer
    to Virtual LPT1. This happens whether the printer is connected to
      the parallel port or whether it is actually connected to the
      serial port or via a network.

    <P>The printer manager selection appears like this 
      <CENTER><IMG SRC="pics/printer1.gif"></CENTER>

    <P>It is the users responsibility to select the correct Windows
      printer driver for the printer as no facility exists to pass the
      name of the printer to the server.

    <h6>3.3.5.2.2 Windows printing</h6>

    <P>The newer protocol works in a very different way. The client
      printers appear in the Client Network and are connected to in
      the same way as normal network printers like this.

    <CENTER><IMG SRC="pics/printer2.gif"></CENTER>

    <P>As before, printer selection is performed under RISC
    OS. Whichever printer is selected as being active is the one that
      appears in this window. 

    <P>The client network is common to all the clients connected to
      this WinFrame server thus clients can be used as print servers
      for other clients.

    <P>Normally the user will have to select a compatible Windows
      driver manually however under certain circumstances this can be
      automated.

    <UL>
      <LI>If the <CODE>WindowsPrinter</CODE> ini file entry contains a
	valid Windows printer driver name then this is used.

      <LI>If all the following are true 
	<OL>
	  <LI>the ICAClient is running in iconbar mode
	  <LI>!Printers is running 
	  <LI>a Postcript printer is selected
	  <LI>the type of the Postscript printer is listed in the
	    Module ini file
	</OL>
	<P>then the printer type is converted to a Windows printer
	  driver name and this is used.
    </UL>
      
    <h5><A NAME="drivemapper">3.3.5.3 Drive Mapping Virtual Channel</A></h5>

    <P>ICA includes a virtual channel protocol to transmit file system
    functions between the WinFrame server and the client. The drives
    appear as network drives on the client network. The drive names
    aren't transferred so they must be identified by their drive type.

    <P>Drives are accessed through standard RISC OS methods so only
    capabilities supported by RISC OS are available. eg if a CD is
    only accessible from Windows then it will not be accessible
    through the ICA client when placed in the client CDROM player.

    <P>Any drive visible from RISC OS can be exported to the WinFrame
    session including network drives.

    <CENTER><IMG SRC="pics/drives.gif"></CENTER>

    <h6><A NAME="driveconfig">3.3.5.3.1 Configuration</A></h6>

    <P>The file systems and drives that are exported are defined in
    the INI files for security.

    <P>The WFClient section supports the following extra commands.
    <DL>
      <DT><CODE>DrivePath1=<em>RISC OS path</em></CODE>
      <DD>What to export
      <DT><CODE>DrivePathEnabled1=[yes|no]</CODE>
      <DD>Whether this path is currently enabled
      <DT><CODE>DrivePathWriteAccess1=[yes|no]</CODE>
      <DD>Whether writing to this path is permitted.
    </DL>

    <P>As many groups of these can be given as is necessary as long as
    they are contiguous. From the WinFrame session the drives appear
      as drives A through Z in order, with one exception.
      
    <P>The WinFrame server assumes that drives A and B are floppy
      drives - it doesn't treat them any differently but labels them
      as such. Therefore the following scheme is used.

    <UL>
      <LI>A list of drives to be exported is built up by enumerating the
	DrivePathN INI entries and further enumerating the filing
	systems specified where appropriate.

      <LI>If the first entry is removeable and not a CDROM or network
	drive then it is given the driver letter A otherwise it is
	given the letter C.

      <LI>If the first entry was given A and the second entry is also
      removeable and not a CDROM or network drive then it is given the
      driver letter B otherwise it is given the letter C.

      <LI>All further entries are allocated letters in order.
    </UL>

    <P>The RISC OS path is in one of the the following forms.

    <DL>
      <DT><CODE><em>&lt;filing system&gt;</em>::<em>&lt;drive&gt;</em>.$.<em>&lt;directory path&gt;</em></CODE>
      <DD>A fully specified directory is exported.

      <DT><CODE><em>&lt;filing system</em>::<em>&lt;drive&gt;</em></CODE>
      <DD>A given drive on a filing system is exported.

      <DT><CODE><em>&lt;filing system&gt;</em></CODE>
      <DD>All drives on the given filing system are exported. <P>The
	  following filing systems support this option
	<UL>
	  <LI>All filecore based systems
	  <LI>CDFS (version 2 and version 3)
	  <LI>ShareFS
	</UL>
    </DL>


    <h6><A NAME="filemodes">3.3.5.3.2 File modes</A></h6>

    <P>The protocol only supports DOS 3 style file modes which are
    mapped to RISC OS as follows.

    <DL>
      <DT><B>File sharing mode</B>
      <DD>This parameter is ignored as RISC OS is not configurable in this area.

      <DT><B>Access mode</B>
      <DD>A file can be opened for read, write or update which maps
	directly to the RISC OS read, write or update modes. 

      <DT><B>File attributes</B>
      <DD>The RISC OS <i>owner write</i> bit maps (inverted) to the DOS <i>read
	only</i> bit. Other DOS attributes are always reported as
	unset and are ignored when an attempt is made to set them.
    </DL>

    <h6><A NAME="filenames">3.3.5.3.3 Filename translation</A></h6>

    <P>The protocol supports file names in two formats, DOS style 8.3
      names and long filenames. File names always have to be reported
      in the 8.3 form, but can be reported as a full name also.

    <P>The RISC OS client reports to the server that it understands
      long file names and then behaves as follows.

    <P>When the server requests that the client enumerate a directory
      the following is done before any names are sent back.

    <UL>
      <LI>The complete directory is enumerated via standard RISC OS calls.

      <LI>Any forward slashes in the file names (/) are converted to dots (.).

      <LI>If the name fits the 8.3 form and is all in uppercase then it
	is left as a DOS name.

      <LI>Otherwise unique (within this directory) 8.3 versions of
	each name are created and cached.
    </UL>

    <P>The full name to 8.3 name mappings for a directory are retained
    as long as there is at least one open file in the directory and
    for at least twice the server directory cache timeout period after
    the directory scan finishes or the last open file in the directory
    closes. This ensures that the filename mapping does not change
    whilst the server holds information about the directory.

    <h4>3.3.5.4 Serial Port Mapping Virtual Channel</h4>

    <P>ICA includes a virtual channel protocol to provide full duplex
    access to the client's serial ports from server applications and
    spooler.

    <P><i>RISC OS mechanism to be decided</i>.


    <h4>3.3.5.5 Clipboard Virtual Channel</h4>

    <P>ICA includes a virtual channel protocol to provide Windows
    clipboard support, allowing users to cut and paste between server
    and client applications.

    <P><i>RISC OS mechanism to be decided</i>.


    <h4>3.3.5.6 Client Audio Virtual Channel</h4>

    <P>ICA 3.5 includes a virtual channel protocol to allow audio
      generated by the server to be heard at the client end.

    <P><i>RISC OS mechanism to be decided</i>.


    <h4>3.3.5.7 Client Management System Virtual Channel</h4>

    <P>ICA 3.5 includes a driver to allow the server to control
      various elements of the client configuration. 

    <P>The initial use of this is to allow updated software to be
    automatically downloaded to the client machine's hard disc. This
      driver if not supported under RISC OS.


    <h3><a name="icatrans">3.4 ICA Protocol and Transport Layers</a></h3>

    <P>Beneath the ICA data packets, there are several optional
    protocol driver layers. ICA does not depend on these layers. Their
    existence and use is negotiated during the ICA handshaking that
    occurs at the start of a session. Since these layers sit below
    ICA, they can be removed or replaced. Additional protocol drivers
    can also be added. A wide range of supplied protocol modules allow
    ICA to work with all of the most prevalent transport technologies,
    such as TCP/IP, NetBIOS, IPX/SPX, and PPP/SLIP, supplying ICA true
    protocol independence.

    <P>The ICA protocol stack is dynamically configured to meet the
    needs of each transport protocol. For example, IPX is not
    reliable, so a reliable protocol driver is added above the IPX
    transport driver. However, since IPX is a frame-based protocol, a
    frame driver is not included in this particular ICA protocol
    stack. TCP, however, is a stream protocol; in this case, a frame
    driver is included. TCP is reliable, however, so this driver is
    not added to the stack.

    <P>The following diagram illustrates the ICA protocol stack and
    transport:

    <CENTER>
      <IMG SRC="pics/icastack.gif" WIDTH=350 HEIGHT=305 ALT="Protocol stack">
    </CENTER>

    <h4><a name="pd">3.4.1 Protocol Drivers</a></h4>
    <DL>
      <DT><B> Compression</B>

      <DD>The Compression protocol can encapsulate an encrypted ICA
      packet. The compression protocol is system replaceable and is
      not strictly defined in the ICA protocol definition.

	<P>The source to this driver is not included in the source
	distribution from Citrix so this functionality is not
	available in the RISC OS client.

      <DT><B> Encryption</B>

      <DD>The Encryption protocol can encapsulate an encrypted ICA
      packet. The encryption protocol is system replaceable and is not
      strictly defined in the ICA protocol definition.

	<P>The RISC OS client supports the basic encryption
	mechanism. Citrix make available a <i>Secure ICA</i> pack
	which implements better security using RSA cryptography. This
	is not available to us due to US Export controls.

      <DT><B> Reliable</B>

      <DD>The Reliable protocol is a transmission packaging protocol
      used to detect transmission errors and to request re-sends of
      data.  This protocol is used in conjunction with any transport
      mechanism that does not provide guaranteed delivery. Two such
      mechanisms are Novell's IPX and standard asynchronous
      connections.

	<P>This driver is included when the Async transport is in use.

      <DT><B> Framing</B>

      <DD>The Framing is a transmission packaging protocol used to
      manage stream-oriented communications, such as async and TCP. It
      is used in conjunction with Reliable protocol to provide an
      error-free data transmission.

	<P>The RISC OS client incorporates the RFrame protocol driver
	which provides framing for reliable transports (eg TCP/IP) as
	well as the full Framing driver for use with the Async transport.

      <DT><B> Modem Control</B>

      <DD>The Modem control protocols allow for modem detection and
      initialization prior to connection.

	<P>These are not supported by the RISC OS client as it is
	  assumed that an external dialler has responsibility for
	  bringing a TCP/IP connection up.

	<P>See section 4.3 for a description of bringing the line up
	  on connection.

	<P>If the line drops whilst the session is in progress then
	  the Windows session is disconnected and the user is returned
	  to the desktop or browser.

    </DL>

    <H4><a name="tcpip">3.4.2 TCP/IP transport driver</a></H4>

    <P>The TCP/IP transport implements a transport layer for
      connection over the internet or a TCP/IP intranet.
    <P>

    <H4><a name="async">3.4.3 Async transport driver</a></H4>

    <P>The Async transport implements the transport layer for
    connection to a WinFrame server via a serial cable. It requires
    the Reliable and Framing protocol drivers to be implemented.
    <P>
      

    <H3><a name="icaext">3.5 ICA Extensibility</a></H3>

    <P>ICA is a flexible and extensible protocol. First, the protocol
    is designed to accommodate varying degrees of client
    capability. During handshaking, the ICA client communicates such
    information as screen resolution, color depth, cache size, among
    other things. The protocol then adjusts to this information. This
    communication allows for a wide variety of ICA clients, ranging
    from fixed-function monochrome terminals to high-end workstations.

    <P>Through its virtual channel architecture, ICA can be extended
    to include new data types, such as sound and video (sound in ICA
    3.0 encompasses only the system beep, video is supported only when
    performed entirely through the standard Windows graphical display
    interface). Virtual channels can also be used to support auxiliary
    client devices, such as badge readers, wands and scanners.

    <P>Finally, the very modular design of the ICA protocol allows the
    supporting layers below it to be expanded. For example, the
    existing encryption layer could be augmented with RSA or DES
    encryption. Converters, such as an ICA to X.11, can be added
    in. And new transport protocols such as ATM can easily be
    supported.

    <P>The RISC OS client is composed of one linked application, thus
    extending it with new virtual drivers or protocol modules requires
    compilation of a new application. They cannot be added at run-time
    as is possible with the Windows implementation. The extensibility
      model of the original source code is maintained however to ease
      adding new drivers.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="user"> 4.0 User interface </a> </h2>

    <UL>
      <LI><A HREF="#launch">4.1 Launching the client</A>
      <LI><A HREF="#startup">4.2 Start up</A>
      <LI><A HREF="#iconbar">4.3 Icon bar</A>
      <LI><A HREF="#connecting">4.4 Connecting</A>
      <LI><A HREF="#modes">4.5 Display modes</A>
      <LI><A HREF="#errors">4.6 Error messages</A>
      <LI><A HREF="#help">4.7 Help messages</A>
      <LI><A HREF="#mgr">4.8 Remote Application Manager</A>
    </UL>

    <H3><A NAME="launch">4.1 Launching the client</A></H3>

    <P>There are three ways of launching the ICA client.

    <OL>
      <LI>Running the application with no arguments (eg by
	double-clicking on its icon).

      <LI>Running an <a href="#icafile">ICA file</a> when the
	application is not already loaded.

      <LI>Launching an <a href="#urlscheme">ICA:</a> URL.
    </OL>

    <P>Any of these will cause the client to load and the splash
      screen to be displayed.

    <H3><A NAME="startup">4.2 Initialisation</A></H3>

    <P>The client, when loaded, first ensures that a splash
    screen, conforming to Citrix's specification, is displayed to
    the user. 

    <CENTER><IMG SRC="pics/splash.gif" WIDTH=176 HEIGHT=182></CENTER>

    <P>This is described in detail in the Citrix Agreement,
    Exhibit D. The Splash screen is displayed for a minimum of
    two seconds.

    <P>After the splash screen has been removed the client 
    continues in one of two ways depending on how it has been
    configured and launched.

    <OL>
      <LI>Place an icon on the iconbar.
      <LI>Start an immediate connection.
    </OL>

    <H4>4.2.1 Starting with icon</H4>

    <P>An icon is installed on the iconbar from where a
    connection can be made or the configure application run. The
    loaded application also picks up when ICA files are run and
    starts a server session.

    <P>In this 'persistent' mode the client stays loaded until
    explicitly quit by the user. The user can switch in and out of a
    loaded session and its state is maintained whilst it is suspended.

    <P>This is the default behaviour when the client is run directly.
    In a non-desktop environment the client should be configured to go
    into persistent non-iconbar mode if suspension of sessions is
    necessary.

    <H4>4.2.2 Immediate connection</H4>

    <P>If the client is started by running an ICA file or by use of
    the ICA: URL pseudo-scheme with a server argument then it
    immediately opens the connection to the remote server and does not
    install itself on the iconbar. In this case the the switch out
    function is not available.

    <P>In this mode it only loads the Toolbox and Window modules thus
    possibly using less memory.

    <H3><A NAME="iconbar">4.3 Icon bar functions</A></H3>

    <P>The icon bar icon has the following properties.

    <DL>
      <DT><B>SELECT click</b>

      <DD>If a session has been suspended then resume that session. If
      no session is in progress then run the Remote Application
      Manager. If it is not available then give an error.

      <DT><b>MENU click</b>

      <DD>Open iconbar menu.

      <DT><b>ADJUST click</b>

      <DD>Launch Remote Application Manager if available, or give an
      error.
    </DL>

    <H4>4.3.1 Icon bar menu</H4>

    <P>The icon bar menu has the following structure:-

    <DL>
      <DT><b>Info</b>

      <DD>Leads to standard Info window. This info window references
	both Citrix and Acorn as authors.

      <DT><b>Configure...</b>

      <DD>This runs the Remote Application Manager, a separate
      application, to edit the AppSrv and WFClient INI files. If this
      application is not available then this entry is
      unselectable. The application is available if either the system
      variable <CODE>ICAMgr$Dir</CODE> is set (and the directory
      exists) or the directory <CODE>ICAClient:!ICAMgr</CODE> exists.

      <DT><b>Connect</b>

      <DD>Leads to a submenu listing available servers. Choosing a
	server from this list connects in the same way as running an
	ICA file. These servers are defined in the AppSrv INI file.
	The submenu is greyed out if a session is already open.

      <DT><b>Resume</b>

      <DD>Resumes a suspended session. Greyed out if no session is in progress.

      <DT><b>Disconnect</b>

      <DD>Disconnect from the current server. This brings up a
      dialogue asking if the user is sure before disconnecting. Greyed
      out if no session is in progress.

      <DT><b>Quit</b>

      <DD>Quit the client. If a session is open then a warning dialogue
	is opened first as with Disconnect.
    </DL>

    <H3><A NAME="connecting">4.4 Connecting</A></H3>

    <P>When a server is selected from the menu or via an ICA file the client

    <UL>
      <LI>Loads the Module, WFClient and either the AppSrv or ICA file.
      <LI>Possibly call the dialler
      <LI>Initialises all its components
      <LI>Resolves the host name
      <LI>Opens a connection to the server
      <LI>Enters the initial handshaking
    </UL>

    <P>A connection status box is opened when the connection process
      starts. This box gives some information about the status of the
      connection and offers a Cancel button that can be used to abort
      the transfer.

    <P>If the NC is connecting via modem and off-line when the client
      is started then it initiates a dial using the standard NC
      dialler. This causes the usual dialling status box to
      appear. If the login succeeds then the client continues with its
      connection to the WinFrame server. If it fails then it quits
      without further reporting and returns control to the browser.

    <P>Once the handshaking is complete the client goes single-tasking
      and switches screen mode. From this point the user is within
      Windows until they log out, disconnect or switch out.

    <H3><A NAME="modes">4.5 Display modes</A></H3>

    <P>There are three display modes possible:-

    <DL>
      <DT><b>Scrolling text mode</b>

      <DD>This is the mode until a connection with the server is
	made. This enables error messages from the server to be
	displayed without any sophisticated protocol.
	<P>

      <DT><b>Full-screen text mode</b>

      <DD>This is used if a DOS box is started and then full-screen
	mode selected from its preferences window.

      <DT><b>Windows emulation mode</b>

      <DD>This is the full graphical user interface.
    </DL>

    <H4><A NAME="tv">4.5.1 Overscan support</A></H4>

    <P>When used on an NC or STB on a TV the edges of the screen are
    lost due to the overscan mode used. To counteract this the ICA
    client need to be put into an underscan mode so that it doesn't
    use the whole screen.

    <P>This can only happen when

    <OL TYPE="a">
      <LI>The WinFrame server being used supports variable
	resolution (all current shipping versions do), and
      <LI>One of the following cases is true.<P>

    <OL TYPE="1">
      <LI>If no specific resolution is set and the client can tell
      that it is running on a TV.  

	<P>e.g. The <CODE>ModeFiles_MonitorType</CODE> SWI returns 0
	or 8 (this happens on NC Model 1 hardware with a TV attached)
	or the system variable <VAR>TV$Type</VAR> is set to
	<CODE>PAL</CODE> or <CODE>NTSC</CODE>.

      <LI>If no specific resolution is set and the new command
      <CODE>UseSafeArea=On</CODE> is set in the ICA or AppSrv file.

      <LI>If the resolution specified in the ICA or AppSrv file does
	not match an available screen resolution then only that amount
	of area is used, centered on the screen.

	<P>e.g. Specifying the size as <CODE>DesiredHRes=576</CODE>
	and <CODE>DesiredVRes=432</CODE> would cause the client to use
	a 640 by 480 screen mode with a 5% safe area border all round.
    </OL>
    </OL>

    <P>Note that the ICA client can <strong>not</strong> be used on a
    TV with a Model 1 NC or STB as <strong>no</strong> support for 16
    or 24 bit screen modes is implemented. A suitable error message is
    displayed when a session is started on these platforms.

    <H3><A NAME="errors">4.6 Error messages</A></H3>

    <P>Various errors are possible when initiating a connection. These
    all result in a standard RISC OS error box being displayed and the
    connection being aborted. Errors whilst in the Windows environment
    are in general ignored and an attempt to continue as best as
    possible is made.

    <P>The actual error messages are taken from the Citrix sources,
    modified where necessary to reflect the RISC OS environment and
    localised appropriately.

    <H3><A NAME="help">4.7 Help messages</A></H3>

    <P>All the user interface elements are provided by a toolbox
    Res file so suitable interactive help messages are embedded there
    as usual.

    <H3><A NAME="mgr">4.8 Remote Application Manager</A></H3>

    <P>This is a separate application that edits the AppSrv and
    WFClient INI files of the client and can also be used to create
    standalone ICA files. It is a separate application to keep the
    executable size down and so that it can easily be removed when
    the client is in use in a school environment or an NC.

    <P>The user interface is broadly the same as the equivalent
      Windows or Mac client. 
    <UL>
      <LI>A single main window holds a list of servers/applications. 
      <LI>A toolbar has buttons for adding, removing and editing
	connections.
      <LI>From the menu default choices can be made.
    </UL>

    <P>The files are always read from
    <CODE>ICAClientINI:WFClient</CODE> and
    <CODE>ICAClientINI:AppSrv</CODE>. This gives the version of the
      file in Choices if it exists or in the application if not.

    <P>The files are read when the manager starts. Any options set in
      the files which are not recognised or modified by the manager
      application are maintained when the file is saved.

    <P>Changes are automatically saved to the equivalent files within
    <CODE>&lt;Choices$Write&gt;.ICAClient.INI</CODE>. If
      &lt;Choices$Write&gt; is not set or is unwriteable then an error
      is given.

    <H4>4.8.1 Main window</H4>

    <P ALIGN=center><IMG SRC="pics/mgr.gif" WIDTH=527 HEIGHT=183></p>

    <P>This window shows the available connections.
      
    <DL>
      <DT><b>SELECT click</b>
      <DD>Selects the entry under the pointer and
      deselects all others.

    <DT><b>ADJUST click</b>
      <DD>Toggles the selected state of the the
      entry under the pointer.

    <DT><b>SELECT double-click</b> 

      <DD>On an entry tries to connect to that server.
      
    <DT><b>ADJUST double-click</b>
      <DD>On an entry opens the Edit Entry
      window. On no entry opens the New Entry
    window.
    </DL>

    <H4>4.8.2 Entry window</H4>

    <P ALIGN=center><IMG SRC="pics/entry.gif" WIDTH=468 HEIGHT=453></p>

    <P>This window allows the user to set the parameters for this
    connection.

    <P>Whilst either of the <i>default</i> buttons in the screen
    section are selected then the corresponding row of buttons is
    unselectable.

    <P>The 256 colour entry is unselectable if a fully programmable
    palette is not being used (ie on pre Risc PC hardware) and the 16
    colour option is automatically chosen. Unavailable resolutions are
    unselectable and the next lowest size available is chosen instead.

    <P>Clicking on the popup menu button will bring up a list of
    available servers or published applications. This list is built by
    broadcasting on the network so there may be a delay of a few
    seconds before it opens. The application single-tasks until this
    operation is complete.

    <P>The following values in the connection section of AppSrv ini
    file are set from this window.

    <UL>
      <LI><CODE>Address</CODE>
      <LI><CODE>InitialProgram</CODE>
      <LI><CODE>WorkDirectory</CODE>
      <LI><CODE>Username</CODE>
      <LI><CODE>Password</CODE>
      <LI><CODE>Domain</CODE>
      <LI><CODE>PersistentCacheEnabled</CODE>
      <LI><CODE>DesiredHRes</CODE>
      <LI><CODE>DesiredVRes</CODE>
      <LI><CODE>DesiredColor</CODE>
    </UL>

    <H4><a name="settings">4.8.3 Settings window</a></H4>

    <P ALIGN=center><IMG SRC="pics/settings.gif" WIDTH=498 HEIGHT=337></p>

    <P>This window allows the user to set the default screen size
    (unless overridden by connection information) and the disc cache
    location and parameters. It also allows them to clear the cache.

    <P>The 256 colour entry is unselectable if a fully programmable
    palette is not being used (ie on pre Risc PC hardware) and the 16
    colour option is automatically chosen. Unavailable resolutions are
    unselectable and the next lowest size available is chosen instead.

    <P>The following values in the WFClient ini file are set from
    this window. 

    <UL>
      <LI><CODE>DesiredHRes</CODE>
      <LI><CODE>DesiredVRes</CODE>
      <LI><CODE>DesiredColor</CODE>
      <LI><CODE>PersistentCacheSize</CODE>
      <LI><CODE>PersistentCachePercent</CODE>
      <LI><CODE>PersistentCacheMinBitmap</CODE>
      <LI><CODE>PersistentCachePath</CODE>
    </UL>


    <H4>4.8.4 Main Menu</H4>

    <DL>
      <DT><b>File</b>

      <DD>Leads to the File submenu

      <DT><b>Entry</b>

      <DD>Leads to the Entry submenu

      <DT><b>Settings... (Ctrl-S)</b>

      <DD>Opens the settings dialogue box.

      <DT><b>Quit (Ctrl-F2)</b>

      <DD>Quits the Remote Application Manager
    </DL>

    <H4>4.8.5 File Menu</H4>

    <DL>
      <DT><b>Copy AppSrv (Ctrl-F3)</b>

      <DD>Leads to a standard save as dialogue box with a default name
      of AppSrv and filetype of text. This saves out the current
      server list, as would be written to the default AppSrv file, but
      to the filename specified instead. The filename is remembered
	and used next time this box is opened.

      <DT><b>Copy WFClient (Sh-Ctrl-F3)</b>

      <DD>Leads to a standard save as dialogue box with a default name
      of WFClient and filetype of text. This saves out the current
      settings, as would be written to the default WFClient file, but
      to the filename specified instead. The filename is remembered
      and used next time this box is opened.
    </DL>

    <P>Note 'Copy' is used here to reinforce the fact that 'Save As'
    since the ICAMgr always edits the copies of the files in Choices
    unaffected by where copies of the files may have been saved out
    to.

    <H4>4.8.6 Entry Menu</H4>

    <DL>
      <DT><b>New... (Ctrl-N)</b>

      <DD>Opens a blank Entry window to create a new entry.

      <DT><b>Copy (Ctrl-C)</b>

      <DD>Creates an Entry window with a copy of the currently
	highlighted entry. When OK'd a new entry is created.

      <DT><b>Delete (Delete)</b>

      <DD>Deletes the currently	highlighted entry. 

      <DT><b>Edit... (Ctrl-E)</b>

      <DD>Edit the currently highlighted entry. 

      <DT><b>Connect (Enter)</b>

      <DD>Connect to the server specified by the currently highlighted
      entry.

      <DT><b>Export ICA (Shift-F3)</b>

      <DD>Export an ICA file containing the details specified in the
	currently highlighted entry.
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="programmer"> 5.0 Programmer interface </a> </h2>

    <h3>5.1 Command line switches</h3>

    <P>Various options can be given on the command line to enable
      features as follows.

    <DL>
      <DT><B><CODE>-c</B></CODE> 

      <DD>If this option is set then client assumes that it is
	running on a modem NC and ensures that it is on line before
	continuing with the connection.

      <DT><B><CODE>-f <i>filename</i></B></CODE> 

      <DD><i>filename</i> is an ICA file which is used to
      immediately connect to a server. Depending on the state of other
      switches the client may quit when the session finished.

      <DT><B><CODE>-i</B></CODE>
      <DD>Install an icon on the iconbar. Implies -s and -m.

      <DT><B><CODE>-m</B></CODE>
      <DD>Multitasking startup. This allows printer name enquiries and
	NC dialling to work.

      <DT><B><CODE>-o</B></CODE>
      <DD>Once a connection has been made, never exit. If the session
	finishes restart it.

      <DT><B><CODE>-s</B></CODE>
      <DD>Allow suspend and resume. If this is set then Hotkey1 within
	an WinFrame session switches back to RISC OS, leaving the
	session suspended and able to be resumed later. If this is not
	set then Hotkey1 disconnects and quits the client. Implies -m.

      <DT><B><CODE>-u <i>url</i> [<i>post file</i>]</B></CODE>
      <DD><i>url</i> specifies the server to connect to. If the
	request came from a posted form then <i>post file</i> is the
	filename of a temporary file containing further arguments.

      <DT><B><CODE>-</B></CODE>
      <DD>This is a dummy argument that can be set in one of the
	Options variables to stop ICAClient from initialising it
	itself.
    </DL>

    <P>The following switches control debug output and may not do
      anything on release versions.

    <DL>
      <DT><B><CODE>-d</B></CODE>
      <DD>Output postmortem to standard error on error.

      <DT><B><CODE>-g</B></CODE>
      <DD>Log file is enabled

      <DT><B><CODE>-l &lt;logfile&gt;</B></CODE>
      <DD>Logfile to which to write log messages.

      <DT><B><CODE>-r</B></CODE>
      <DD>Remote debug output is enabled.
    </DL>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="interchange"> 6.0 Data interchange </a> </h2>

    <UL>
      <LI><A HREF="#sysvars">6.1 System variables</A>
      <LI><A HREF="#wimpmsgs">6.2 Wimp messages</A>
      <LI><A HREF="#urlscheme">6.3 URL scheme</A>
    </UL>


    <H3><A NAME="sysvars">6.1 System variables</A></H3>

    <P>The following system variables are set in the !Boot file so
      they are available before the client is run. They are also set
      identically in the !Run files.

    <DL>
      <DT><B><CODE>ICAClient$Dir</CODE></B> 

      <DD>Application directory for client. Resources directory for
      ROM builds.

      <DT><B><CODE>ICAClient$Path</CODE></B>

      <DD>Resource path for client.

      <DT><B><CODE>File$Type_AD0</CODE></B>

      <DD>File type name for ICA files (ICA).

      <DT><B><CODE>Alias$@RunType_AD0</CODE></B>

      <DD>Run type for ICA files.

      <DT><B><CODE>Alias$URLOpen_ICA</CODE></B>
      <DT><B><CODE>Alias$Open_URI_ICA</CODE></B>

      <DD>Run types for <CODE>ica:</CODE> URL pseudo-scheme for ANT
	and Acorn protocols.
    </DL>

    <P>The following system variables are set by the ICAMgr !Boot and
      !Run files. 
      
    <DL>
      <DT><B><CODE>ICAMgr$Dir</CODE></B> 

      <DD>Application directory for Remote Application Manager.

      <DT><B><CODE>ICAMgr$Path</CODE></B>

      <DD>Resource path for Remote Application Manager.
    </DL>

    <P>The following system variables can be overridden by the
      user. If they are set before the client is run then the given
      values are used rather than the client defaults.

    <DL>
      <DT><B><CODE>ICAClientINI$Path</CODE></B>

      <DD>Path for in-built INI files. Can be used to override
      defaults when the application is in ROM or a read-only
      partition/mount.  <P>If Choices$Path exists then it Defaults to
      <CODE>Choices:ICAClient.INI.,<WBR>ICAClient:INI.</CODE> otherwise
	  to <CODE>ICAClient:INI.</CODE>.

      <DT><B><CODE>ICAClient$Options</CODE></B>

      <DD>Can give command line options to be used when client
	starts. <P>Defaults to empty.

      <DT><B><CODE>ICAClient$FileOptions</CODE></B>

      <DD>Command line options to be used when client starts with a
	file given as an argument.
	<P>Defaults to <CODE>-m</CODE>.

      <DT><B><CODE>ICAClient$NoFileOptions</CODE></B>

      <DD>Command line options to be used when client starts with no
	file given as an argument. 

	<P>Defaults to <CODE>-i</CODE>.

      <DT><B><CODE>ICAClient$ClientName</CODE></B>

      <DD>If set then this is the name for this client sent to the
      server on connection.

      <DT><B><CODE>ICAClient$Errors</CODE></B>

      <DD>Redirection of standard error output. 
	<P>Defaults to <CODE>2&gt;&nbsp;null:</CODE>.

      <DT><B><CODE>ICAClient$Run</CODE></B>

      <DD>Command to use to start client.
	<P>Defaults to <CODE>Run</CODE>.
    </DL>

    <P>The following system variables are referenced by the client but
      should never be set by it.

    <DL>
      <DT><B><CODE>Inet$HostName</CODE></B>

      <DD>Name sent to the server on connection for this client if
	<CODE>ICAClient$ClientName</CODE> is not set.

      <DT><B><CODE>Choices$Write</CODE></B>

      <DD>When the Remote Application Manager edits ini files they are
	saved back into
	<CODE>&lt;Choices$Write&gt;.ICAClient.INI</CODE> rather than
	into the application.
    </DL>

    <H3><A NAME="wimpmsgs">6.2 Wimp Messages</A></H3>

    <P>The ICA client broadcasts various messages when
      connecting/disconnecting etc to allow other tasks to provide
      suitable user feedback. It can also be controlled via messages
      so that all configuration and user interface details can be
      performed externally.

    <H4>6.2.1 Status Messages</H4>

    <P>The format of the status messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f80	(message_ICACLIENT_STATUS)
	+20 = reason
	+24 = flags
    </PRE>

    <P>They are all for information only.

    <H5>6.2.1.1 ICAClient Starting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 0		(icaclient_STATUS_STARTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client runs so that other
      tasks can record the task handle for future use if they wish.


    <H5>6.2.1.2 ICAClient Quitting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(icaclient_STATUS_QUITTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client is about to
    quit. Note that it will be dead by the time that any task receives
    the message.

    <H5>6.2.1.3 ICAClient Connected</H5>

    <PRE>
	 +0 = 72	(message size)
	+20 = 2		(icaclient_STATUS_CONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
	+32 = server description
    </PRE>

    <P>This message is broadcast when the client has successfully
      connected to a WinFrame server. 

    <P>The server description is as set in the [ApplicationServers]
    section of the ICA file, is null-terminated, and is a maximum of
    40 characters (including terminator) long. If no description was
      available then the server host name is used, failing that a
      string version of the IP address.

    <P>Note in the current implementation this message may not be
    received by another task until the client suspends or disconnects.


    <H5>6.2.1.4 ICAClient Suspended</H5>

    <PRE>
	 +0 = 32	(message size)
	+20 = 3		(icaclient_STATUS_SUSPENDED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client is suspended by the
      user switching back to the RISC OS desktop environment.

    <H5>6.2.1.5 ICAClient Disconnected</H5>

    <PRE>
	 +0 = 32	(message size)
	+20 = 4		(icaclient_STATUS_DISCONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client disconnects from the
      ICAClient server.

    <H4>6.2.2 Control Messages</H4>

    <P>The format of the control messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f81	(message_ICACLIENT_CONTROL)
	+20 = reason
	+24 = flags
    </PRE>

    <P>Any control message is immediately replied to with a
    CONTROL_ACK message that says whether the requested action is
    being performed or not. Note that just because an action is taken
    doesn't mean that it will be completed successfully. Status
    messages must be monitored to determine exactly what the state of
      the client is.

    <H5>6.2.2.1 ICAClient Connect</H5>

    <PRE>
	+20 = 0		(icaclient_CONTROL_CONNECT)
	+24 = flags
		bits 0,1: 
			0 = use server description
			1 = use server name
			2 = use ICA file
			3 = reserved
		bit 2: 1 = delete ICA file when finished
		bits 3-31: reserved

	if bits 0,1 = 0
		+28 = server description
	if bits 0,1 = 1
		+28 = server name
	if bits 0,1 = 2
		+28 = filename of ICA file
    </PRE>

    <P>Ask the client to connect to the given host. 

    <P>A server description is upto 40
    characters and must match a description in the AppSrv INI file.

    <P>The server name is a host name or IP address of upto
      40 characters.

    <P>The ICA file name is a maximum of 228
    characters and can be either a permanent file or a temporary
    one. If flags bit 2 is set then when it is no longer needed (which
    will normally be when the session finishes) the file is deleted.

    <P>All string lengths include a terminating null character.

    <H5>6.2.2.2 ICAClient Reconnect</H5>

    <PRE>
	 +0 = 32	(message size)
	+20 = 1		(icaclient_CONTROL_RECONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to reconnect to the session it has suspended. It
      is an error if it is not currently suspended.

    <H5>6.2.2.3 ICAClient Disconnect</H5>

    <PRE>
	 +0 = 32	(message size)
	+20 = 1		(icaclient_CONTROL_DISCONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to disconnect from the given server. It is an
      error if the server is not connected.

    <H5>6.2.2.4 ICAClient Quit</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(icaclient_CONTROL_QUIT)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>Ask the client to quit. It refuses to die if it still has
      open sessions.

    <H4>6.2.2 Control Ack Messages</H4>

    <P>The format of the control ack messages is as follows

    <PRE>
	+12 = ref	(my_ref from CONTROL message)
	+16 = 0x50f82	(message_ICACLIENT_CONTROL_ACK)
	+20 = reason	(reason code  of control message)
	+24 = flags
	     bit 0: 1 = control message succeeded
		    0 = control message failed
	+28 = session handle (CONNECT, RECONNECT and DISCONNECT)
	+32 = error number (not a RISC OS error number)
	+36 = error message (to +256)
    </PRE>


    <H4>6.2.3 Config Messages</H4>

    <P>The format of the config messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f83	(message_ICACLIENT_CONFIG)
	+20 = reason
	+24 = flags
    </PRE>

    <H5>6.2.3.1 ICAClient Config file updated</H5>

    <P>This message is broadcast by the !ICAMgr application when it
    updates the files it is editing so that the ICAClient can updated
    any internally cached information.

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(icaclient_CONFIG_FILE_UPDATED)
	+24 = flags
	     bit 0: 1 = AppSrv file changed
	     bit 1: 1 = WFClient file changed
	     bit 2: 1 = AppSrv file moved
	     bit 3: 1 = WFClient file moved
	     bits 4-31: reserverd
    </PRE>


    <H3><A NAME="urlscheme">6.3 URL scheme</a></H3>

    <P>For greater flexibility in the NC environment, the client
    supports a level of control via a URL scheme. Note that
    more control is available through the messages and the ICA files
    and these should be used where possible.

    <P>The client supports both the ANT URL protocol <A
    HREF="anturl">[3]</A> and the Acorn URI protocol <A
    HREF="acornuri">[4]</A>.

    <P>The format of the URL expected is as follows. Optional
      sections are within square brackets

    <P><CODE>ica:[//<i>server name</i>][/<i>server description</i>][?<i>arg1</i>[&<i>arg2</i>]...]</CODE>

    <DL>
      <DT><B><i>server name</i></B> 

      <DD>A name or IP address of a server (the Address field of an
      ICA file).

      <DT><b><i>server description</i></b> 

      <DD>As listed in the ApplicationServers section of the AppSrv
      ini file.

      <DT><b><i>argN</i></b> 

      <DD>A <i>name=value pair</i> that can be used to set
	any of the allowed fields in the server section of an ICA
	file.

	<P>A special argument of <i>PassClear</i> can be used to pass
	  in an unencrypted password. The normal <i>Password</i> entry
	  must be given an encrypted password as generated by the
	  remote application manager.
    </DL>

    <P>The server name and the args both override the details in
      the AppSrv file. The server name takes precedence if an
      Address arg is given also.
	
      <P>e.g. <CODE>ica:/Test%20Server?username=simon&password=00012jha987sdosd</CODE>
	would use the connection details of the "Test Server" entry
	overridden with the given name and password. Note that the
	space character has to be escaped in the usual manner for URLs.

    <P>e.g  <CODE>ica:?address=nc-nt</CODE> or
      <CODE>ica://nc-nt/</CODE> would log on to the
      server whose name was nc-nt whatever was in the AppSrv file.

    <P>
      <!-- ======================================================================= --> 

    <hr  noshade>
    <h2> <a name="formats"> 7.0 Data formats </a> </h2>

    <H3>7.1 INI files</H3>

    <P>Configuration of the ICA Client is performed with Windows style
    INI files. These are chosen because the code is provided to handle
    reading these files and also the configuration file that is
    fetched over the web to initiate a plugin instance is formatted as
    an INI file.

    <P>There are three INI files. They are stored in an INI directory
    within the ICA Client application with their extensions removed.

    <P>An INI file is a plain text files, one item to a line,
    line-ending unspecified. There are four sorts of lines.

    <OL>
      <LI>Blank lines. Contain nothin but whitespace.
      <LI>Comment lines. Start with a semicolon.
      <LI>Section headings. The contents of the line are enclosed
	within square brackets.
      <LI>Options. Consist of <i>name</i> = <i>value</i>. The value is
	optional but the name and equality sign must be present.
    </OL>

    <H4>7.1.1 MODULE.INI</H4>
    
    <P>This INI file has two main uses. Firstly it contains details of
    what components of the system are available. Secondly it contains
    general defaults for all the components which can be overridden on
    the command line or by other INI files. This should never be
      changed for any given release.

    <P>The default contents of this file are as follows.
    <PRE>
;**********************************************************************
;**
;** MODULE.INI - module information file and fixed UI list strings
;**
;** This file contains all the configuration information for the
;** demand loadable client modules.  Some modules are not supplied with
;** this release, but are planned for future releases
;**
;** Support is included for the following:
;**
;**  - Transport Drivers
;**  - Protocol Drivers
;**  - Winstation Drivers
;**  - Virtual Drivers
;**
;** Also included in this file are sections defining the contents of
;** various UI lists.
;**
;***********************************************************************

[WFClient]
Version=2

;***********************************************************************
;**
;** Transport Driver
;**
;** These drivers are responsible for the transport level protocol.
;**
;***********************************************************************

[TransportDriver]
  Standard COM Port             =
  TCP/IP                        =

;***********************************************************************
;**
;** Serial Transport Driver
;**
;** This driver is a full function serial driver that works with
;** the following UARTS: 8250, 16450 and 16550.  The values listed
;** are default values and may be overridden in the APPSRV.INI profile.
;**
;**
;** Windows Standard COM Port Driver
;**
;** This driver uses the Windows COM port APIs.  The values listed
;** are default values and may be overridden in the APPSRV.INI profile.
;**
;***********************************************************************

[Standard COM Port]
  DriverName          = TDASYNC
  ProtocolSupport     = Modem, Frame, Reliable, Encrypt
  UseSerialDevice     = Yes
  DeviceName          = COM1
  PortName            = COM1
  PortNumber          = 1
  IOBase              = Default
  Interrupt           = Default
  BaudRate            = 9600
  Parity              = None
  StopBits            = 1
  DataBits            = 8
  HardwareFlowControl = On
  ReceiveFlowControl  = RTS
  TransmitFlowControl = CTS
  SoftwareFlowControl = Off
  XonChar             = 0x11
  XoffChar            = 0x13
  DTR                 = On
  RTS                 = Off
  Modem               = Off
  OutBufCountHost     = 12
  OutBufCountClient   = 12
  OutBufLength        = 530
  Frame               = On
  Reliable            = On
  Encrypt             = On
  Compress            = On

;***********************************************************************
;**
;** TCP/IP Transport Driver (win16,win32,riscos)
;**
;***********************************************************************

[TCP/IP]
  DriverName          = TDTCPRO
  Address             =
  ICAPortNumber       =
  ProtocolSupport     = RFrame, Encrypt
  NameEnumerator      = 
  NameResolver        = NRICA
  OutBufCountHost     = 6
  OutBufCountClient   = 6
  OutBufLength        = 530
  RFrame              = On
  Encrypt             = On

;***********************************************************************
;**
;** WinStations Drivers
;**
;** WinStation drivers are responsible for the terminal emulation
;** level of the client stack.
;**
;***********************************************************************

[WinStationDriver]
  ICA 3.0             =

;***********************************************************************
;**
;** ICA 3.0 WinStation Driver
;**
;** Text and Graphics WinStation driver based on the ICA 3.0 protocol.
;**
;***********************************************************************

[ICA 3.0]
  DriverName          = WDICA30
  ProtocolSupport     = RFrame, Frame, Reliable, Encrypt
  VirtualDriver       = Thinwire3.0, ClientDrive, ClientPrinter, ClientPrinter1.5
  BufferLength        = 2048
  ConnectTTY          = On
  ConnectTTYDelay     = 1000

;***********************************************************************
;**
;** Protocol Drivers
;**
;** These drivers are responsible for various features of the
;** client/host connection.  Depending on the WinStation Driver (WD) and
;** the Transport Driver (TD) some Protocol Drivers (PD) may or may not
;** be available. The ProtocolSupport list, for the the WDs and TDs,
;** define which PDs are valid for use.  To utilize these drivers
;** the host system must have an equivalent protocol stack, the one
;** notable exception is the Modem Driver which does not need a host
;** side PD.
;**
;***********************************************************************

[ProtocolDriver]
  RFrame              =
  Frame               =
  Reliable            =
  Encrypt             =

;***********************************************************************
;**
;** Framing Protocol Driver for Reliable Transports
;**
;** This protocol driver is responsible for framing stream level
;** data (TCP/IP) into a packet level data.
;**
;***********************************************************************

[RFrame]
  DriverName          = PDRFRAM

;***********************************************************************
;**
;** Framing Protocol Driver
;**
;** This protocol driver is responsible for framing stream level
;** data (Serial) into a packet level data. It also appends and checks
;** a 16 bit crc
;**
;***********************************************************************

[Frame]
  DriverName          = PDFRAME

;***********************************************************************
;**
;** Reliable Protocol Driver
;**
;** This protocol driver is responsible for providing an error
;** free data stream. It's currently used with serial and ipx protocol
;** drivers.
;**
;***********************************************************************

[Reliable]
  DriverName          = PDRELI
  MaxRetryTime        = 30000
  RetransmitTimeDelta = 500
  DelayedAckTime      = 200

;***********************************************************************
;**
;** Encryption Protocol Driver
;**
;***********************************************************************


[EncryptionLevelAuth]
  Basic               = Encrypt

[EncryptionLevelSession]
  Basic               = Encrypt

[Encrypt]
  DriverName          = PDCRYPT

[Encryption Levels]
  Basic               = Encrypt


;***********************************************************************
;**
;** Virtual Drivers
;**
;** These drivers are responsible for additional function not provided
;** by the base WinStation Drivers.
;**
;***********************************************************************

[VirtualDriver]
  Thinwire3.0         =
  ClientDrive         =
  ClientPrinter       =
  ClientPrinter1.5    =

;***********************************************************************
;**
;** Thinwire 3.0 Virtual Driver
;**
;** This virtual driver is responsible for the graphics support to
;** supplement the ICA 3.0 driver.
;**
;***********************************************************************

[Thinwire3.0]
  DriverName          = VDTW30
  MinSpecialCache16Color = 8
  MaxSpecialCache16Color = 32
  MinMemoryCache      = 750
  MaxMemoryCache      = 8192
  MaxCache16Color     = 8192
  MaxDiskCache        = 2048
  MinDiskLeft         = 2048
  DiskCacheDirectory  =
  SVGACapability      = Off
  DesiredHRes         = 640
  DesiredVRes         = 480
  DesiredColor        = 1
  WindowsCache        = 3072
  UseSafeArea         = Off
  PersistentCacheEnabled  = Off
  PersistentCacheSize     = 0
  PersistentCacheMinBitmap= 0
  PersistentCachePath     =

;***********************************************************************
;**
;** Client Drive Virtual Driver
;**
;** This virtual driver is responsible for providing client disk drive
;** access to supplement the ICA 3.0 driver.
;**
;***********************************************************************

[ClientDrive]
  DriverName                = Unsupported
;  DriverName                = VDCDM30
  MaxWindowSize             = 6276
  MaxRequestSize            = 1046
  CacheTimeout              = 600
  CacheTimeoutHigh          = 0
  CacheTransferSize         = 0
  CacheDisable              = FALSE
  CacheWriteAllocateDisable = FALSE

;***********************************************************************
;**
;** Client Printer Virtual Driver
;**
;** This virtual driver is responsible for providing client printer
;** port access to supplement the ICA 3.0 driver.
;**
;***********************************************************************

[ClientPrinter]
  DriverName          = VDCPM30
  WindowSize          = 1024
  MaxWindowSize       = 2048

[ClientPrinter1.5]
  DriverName          = VDSPL30
  WindowSize          = 1024
  WindowsPrinter      =

  ; Mapping from RISC OS printer name to Windows Printer driver name
  Canon BJ-10e=Canon Bubble-Jet BJ-10e
  Canon BJ-200=Canon Bubble-Jet BJ-200
  Canon BJC-600=Canon Bubble-Jet BJC-600
  Epson Stylus 800=Epson Stylus 800 ESC/P 2
  Epson Stylus Color=Epson Stylus COLOR ESC/P 2
  Epson Stylus Color=Epson Stylus COLOR ESC/P 2
  HP PaintJet XL300=HP PaintJet XL 300
  Acorn JP 150=Olivetti JP 150
  Epson compatible=Epson Compatible 24 Pin

;**********************************************************************
;**
;** Hotkey lists (UI)
;**
;**********************************************************************

[Hotkey Shift States]
(none)=0
Shift=3
Ctrl=4
Alt=8

[Hotkey Keys]
(none)=0
F1=59
F2=60
F3=61
F4=62
F5=63
F6=64
F7=65
F8=66
F9=67
F10=68
F11=87
F12=88
Esc=1
minus=74
plus=78
star=55
tab=15

;**********************************************************************
;**
;** Keyboard Layout lists (UI)
;**
;**********************************************************************

[KeyboardLayout]
(User Profile)=0x00000000
Belgian Dutch=0x00000813
Belgian French=0x0000080C
Brazilian (ABNT)=0x00000416
British=0x00000809
Bulgarian=0x00000402
Canadian English (Multilingual)=0x00001009
Canadian French=0x00000C0C
Canadian French (Multilingual)=0x00010C0C
Croatian=0x0000041A
Czech=0x00000405
Danish=0x00000406
Dutch=0x00000413
Finnish=0x0000040B
French=0x0000040C
German=0x00000407
Greek=0x00000408
Hungarian=0x0000040E
Icelandic=0x0000040F
Italian=0x00000410
Italian (142)=0x00010410
Latin American=0x0000080A
Norwegian=0x00000414
Polish (Programmers)=0x00000415
Portuguese=0x00000816
Romanian=0x00000418
Russian=0x00000419
Slovak=0x0000041B
Slovenian=0x00000424
Spanish=0x0000040A
Spanish variation=0x0001040A
Swedish=0x0000041D
Swiss French=0x0000100C
Swiss German=0x00000807
Turkish (F)=0x0001041F
Turkish (Q)=0x0000041F
US=0x00000409
US-Dvorak=0x00010409
US-International=0x00020409

; Acorn keyboard names
(Auto Detect)=0xFFFFFFFF
UK=0x00000809
Master=0x00000809
Compact=0x00000809
Italian=0x00000410
Spain=0x0000040A
France=0x0000040C
Germany=0x0000047
Portugal=0x00000816
Esperanto=0x00000809
Greece=0x00000408
Sweden=0x0000041D
Finland=0x0000040B
Denmark=0x00000406
Norway=0x00000414
Iceland=0x0000040F
Canada1=0x00000C0C
Canada2=0x00001009
Canada=0x000010C0C
Turkey=0x0000041F
Arabic=0x00000000
Ireland=0x00000000
Russia=0x00000419
Russia2=0x00000419
Israel=0x00000000
Mexico=0x00000000
LatinAm=0x00000000
Austria=0x00000000
Belgium=0x0000080C
Japan=0x00000000
MiddleEast=0x00000000
Netherlands=0x00000413
Switzerland=0x00000807
Wales=0x00000809
ISO1=0x00000809
    </PRE>

    <H4>7.1.2 WFCLIENT.INI</H4>

    <P>This file contains general parameters to override those in the
    MODULE.INI file. These can be set from the <a
    href="#settings">Settings window</a> in the <a href="#mgr">Remote
    Application Manager</a>.

    <P>The default contents of this file are as follows.

    <PRE>
;**********************************************************************
;**
;** WFCLIENT.INI - WinFrame Client Configuration File.
;**
;** This file contains initialization information for the
;** WinFrame Client program.
;**
;**********************************************************************

[WFClient]
Version=2
KeyboardLayout=(Auto Detect)
LogFile=&lt;Wimp$ScrapDir&gt;.ICAClient.Log
LogAppend=Off
LogConnect=On
LogErrors=On
LogTransmit=Off
LogReceive=Off
LogKeyboard=Off
Hotkey1Char=F1
Hotkey1Shift=Shift
Hotkey2Char=F3
Hotkey2Shift=Shift
Hotkey3Char=F2
Hotkey3Shift=Shift
Hotkey4Char=F1
Hotkey4Shift=Ctrl
Hotkey5Char=F2
Hotkey5Shift=Ctrl
Hotkey6Char=F2
Hotkey6Shift=Alt
Hotkey7Char=plus
Hotkey7Shift=Alt
Hotkey8Char=minus
Hotkey8Shift=Alt
DisableSound=Off
DisableCtrlAltDel=On
MouseTimer=100
ConnectTTY=Off
ConnectTTYDelay=1000
ScriptDriver=SCRIPT
ScriptFile=
PersistentCacheEnabled=Off
PersistentCacheSize=10485760
PersistentCachePercent=3
PersistentCacheMinBitmap=8192
PersistentCachePath=&lt;Wimp$ScrapDir&gt;.ICAClient.Cache

[Thinwire3.0]
SVGACapability=Auto
DesiredHRES=-1
DesiredVRES=-1
DesiredColor=0x0002
    </PRE>

    <P>In summary this means
    <UL>
      <LI>Read keyboard layout from NVRAM
      <LI>Allow screen modes other than 640x480
      <LI>Use the current screen size in 256 colours.
    </UL>


    <H4>7.1.3 APPSRV.INI</H4>

    <P>This file contains a list of known application servers. The
    servers in this file can be referenced by name from the icon bar
    menu and via the CONNECT control message.  Each server listing can
    contain overrides to any of the parameters in the MODULE.INI file.

    <P>It also contains overrides for UI values in WFCLIENT.INI

    <P>It is not used if a connection is made with an ICA file.

    <P>The release contents of this file are as follows.

    <PRE>
;**********************************************************************
;**
;** APPSRV.INI - Application Server Configuration File.
;**
;** This file contains user settings which define application
;** servers and other preferences.
;**
;**********************************************************************

[WFClient]
Version=2
    </PRE>

    <H3><A NAME="icafile">7.2 ICA file type</A></H3>

    <P>A new filetype ICA (0xAD0) is allocated. This corresponds to the
    MIME type <CODE>application/x-ica</CODE>. Running an ICA file runs
    the ICA Client application, connecting immediately to the server
    given in the file.

    <P>The ICA file format is as for the INI files described in
      section 7.1.

    <DL>
      <DT><CODE>WindowsPrinter=<i>windows driver name</i></CODE>
      <DD>Specify the windows printer driver to be used for the
      currently selected printer. This is ignored if no printer is
      active.
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="external"> 8.0 External dependencies </a> </h2>

    <P>There are no external dependencies.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="acceptance"> 9.0 Acceptance test </a> </h2>

    <H3>9.1 Acceptance criteria</H3>

    <P>Before allowing release of the software, the following conditions will be met;	

    <UL>
      <LI>The level of recorded unfixed faults in the Fault Database
      is deemed to be acceptable. No urgent or high priority bugs
      should be remaining.

      <LI>The majority of trial sites are operating successfully and
      are happy. This will be quantified using a check-list.

      <LI>The product audit is complete with an acceptable
      report. (Approx 4 man weeks audit time).

      <LI>Xemplar technical support specialists explicitly give the go
      ahead.
	
      <LI>Relevant Acorn SQA, Workstation and Consultancy
      representatives confirm its suitability for release on the
      available evidence.
    </UL>

    <P>Citrix currently have no requirement for any audit of the software.

    <H3>9.2 Performance Targets</H3>

    <P>The performance of ICA-3 is mostly independent of the
    implementation, and is governed by network access performance
    and server load.

    <P>However, it is important that our implementation performs as
    least as well as equivalent PC platforms, and that no additional
    bottlenecks are apparent.

    <P>From a user's perspective, a cluster of approximately 10
    clients accessing a server via an Ethernet network should feel
    close to the responsiveness of a low-medium performance PC running
    the applications natively. Over a modem connection, typical word
    processing type applications where response to keyboard and mouse
    activity is paramount, the system should be responsive and not
    suffer from significant delays caused by client porting
    architectural issues.


    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="noncompliances"> 10.0 Non compliances </a> </h2>

    <P>The following are the major differences between the RISC OS and
      Windows ICA clients.

    <UL>
      <LI>Only runs full screen.
      <LI>Only runs one session at a time.
      <LI>Only supports TCP/IP and Async transports
      <LI>Doesn't include Compression Protocol Driver.
      <LI>Secure ICA add-on is not available.
      <LI>Hardware mouse cursor is used limiting cursor images to 2
	colours.
    </UL>

    <P>The following are examples of Windows applications that will
      not work well with the client.

    <UL>
      <LI>Any program that bypasses the standard Windows drawing
      routines. eg one that directly accesses video memory or uses a
      interface such as OpenGL or DirectX.

      <LI>Any program that relies on audio.
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="test"> 11.0 Development test strategy </a> </h2>

    <P>Initial development testing will utilise Acorn House WinFrame
    NT Servers running on the House Net. It may be advantageous to use
    a sub-net, in order that packet monitoring can be performed
    without being swamped by unrelated traffic.  It is hoped that it
    will not be necessary to use isolated servers and clients as the
    network layer will be largely unaffected. A PC running Citrix
    released code will be used as a comparison.
      
    <P>Testing of the product will make heavy use of trial sites, for
    it is the integration of the many components in a variety of
    different network environments that are the most difficult to
    predict and test. These sites will include Xemplar identified
    ones, other mixed school sites and other third parties where
    WinFrame products are in use. We may seek such reference sites
    from Citrix. Site visits to each of the major sites will be made
    to check the installation and operation of the software.

    <P>A formal audit of the software will be made, in conjunction
    with the explicit and directed testing that will be undertaken
    during the Beta phase of the project. Specifically, the Audit will
    also focus on 'out of the box' consistency and useability,
    software/documentation consistency, as well as reliability and
    functionality.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="organisation"> 12.0 Product organisation </a> </h2>

    <UL>
      <LI><A HREF="#targets">12.1 Target Platforms</A>
      <LI><A HREF="#userguide">12.2 User Guide</A>
      <LI><A HREF="#discorg">12.3 Disc organisation</A>
      <LI><A HREF="#romversion">12.4 ROM organisation</A>
      <LI><A HREF="#standalone">12.5 Standalone version</A>
      <LI><A HREF="#build">12.6 Build organisation</A>
    </UL>

    <h3><a name="targets">12.1 Target Platforms</a></h3>

    <P>Acorn is contractually obliged to supply the ICA client
    software on all future releases of RISC OS, except in
    circumstances where it would clearly be inappropriate. As a
    ROMable RISC OS application, it will therefore be included as
    part of the standard build, in STBs, NCs and Desktop machines. 

    <P>The application will be released in standalone form to enable
    existing platforms to take advantage of this technology. 

    <P>ICA-3 does not consume very significant processor resources or
    memory (other than the cache). It is recommended that the
    following footprint is specified as a minimum:

    <UL>
      <LI>ARM250 processor.
      <LI>For execute in place, 300Kbytes of ROM plus 700K RAM.
      <LI>For an application build, 1 MByte free RAM.
      <LI>VGA monitor.
    </UL>

    <P>The software relies on a working TCP/IP network stack being
    installed and configured. This project only uses TCP/IP; any
    other stack eg NetBEUI or ATM will be considered as a future
    development.


    <H3><a name="userguide">12.2 User Guide</a></H3>

    <P>A user manual will be supplied with every copy of RISC OS
    shipped, be this direct from Acorn, or via a third party. This
    documentation will draw heavily on copy produced by Citrix, but be
    converted into suitable house style.


    <H3><A NAME="appversion">12.3 Application disc organisation</A></H3>

    <P>The application structure on disc is as follows. It lives in
      the Apps directory of the hard disc.

    <PRE>
!ICAClient
	!Boot			obey
	!Help			text
	!Run			obey
	!RunImage		absolute
	!Sprites		sprite
	!ICAMgr
		!Boot		obey
		!Run		obey
		!RunImage	absolute
		Res		res
		Sprites		sprite
	EnsureTB		obey
	KeyWatch		module
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text

    </PRE>

    <P>The ICAMgr application saves the edited AppSrv file out 
      as follows.
    <PRE>
&lt;Choices$Write&gt;.ICAClient.INI
	AppSrv			text
	WFClient		text
    </PRE>


    <P>The external requirements are 

    <UL>
      <LI>Toolbox module
      <LI>Window module
      <LI>Menu module
      <LI>Iconbar module
      <LI>Internet stack (version 4 or version 5).
    </UL>

    <H3><a name="romversion">12.4 ROM organisation</a></H3>

    <P>The application structure when in ROM is as follows. Note the
      ICAMgr application is not included.

    <PRE>
$.Apps.!ICAClient
	!Boot			obey
	!Help			text
	!Run			obey
	!Sprites		sprite

$.Resources.ICAClient
	EnsureTB		obey
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text
    </PRE>

    <P>The requirements for the ROM are as follows.

    <OL>
      <LI>KeyWatch module version 0.06 or greater (this is an upgrade
      to that provided in NC 2).

      <LI>!ICAClient module.

      <LI>Latest MimeMap file if !NCFresco is included. 

      <LI>Internet stack (version 4 or version 5).

      <LI>Toolbox and Window modules.
    </OL>

    <H3><a name="standalone">12.5 Standalone version</a></H3>

    <P>Although not covered by the agreement between Acorn and Citrix,
    Acorn will ship a standalone version of the software, complete
    with the documentation above. This will take the form of an A5
    style wallet containing disc, installation instructions and
    manual.

    <P>For RISC OS 3.1, RISC OS 3.5, RISC OS 3.6, RISC OS 3.7, RISC OS
    3.71 and RISC OS 4.0 this will comprise the !ICAClient and !ICAMgr
    applications, a new style !Boot structure as developed for
    Expresso/Ursula and an Installer containing the latest versions of
    the toolbox modules. These will be placed on an ADFS F format disc.

    <P>For NC OS 1.06/1.1 licensees a pack containing a tar file of
    the ICAClient application and example connection scripts will be
    provided via the usual support channels. If this needs to be on
    floppy disc then a high density MSDOS disc will be used.

    <H3><a name="build">12.6 Build organisation</a></H3>

    <P>The ICAClient sources are part of the renaissa CVS build tree at
    <CODE>RiscOS/Sources/Apps/Citrix/WinStation/</CODE>. They are
    cross-compiled under solaris and resulting ROM binaries are
      checked into 
    <CODE>RiscOS/Sources/Apps/Citrix/WinFrameRO/</CODE> for importing
      into the build process.
    <P>

      <!-- ======================================================================= -->


   <hr  noshade>
    <h2> <a name="enhancements"> 13.0 Future enhancements </a> </h2>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="glossary"> 14.0 Glossary </a> </h2>

    <DL>
      <DT>Async    <DD>A serial based transport layer
      <DT>GDI      <DD>Graphical Device Interface.
      <DT>ICA      <DD>Independent Computing Architecture.
      <DT>ICA client <DD>Software that implements the client end of the ICA protocol.
      <DT>ICA protocol <DD>The fundamental data channel organisation.
      <DT>LAN      <DD>Local Area Network.
      <DT>STB      <DD>Set Top Box.
      <DT>Thinwire <DD>Graphics protocol that runs over ICA.
      <DT>WAN      <DD>Wide Area Network.
      <DT>WinFrame <DD>The server package that implements ICA.
    </DL>
    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="references"> 15.0 References </a> </h2>

    <DL>
      <DT>[1] <A NAME="ncos">NC OS version 1.15. On Screen Keyboard
	  Functional Specification</A>
      <DD>Document 2107,738

      <DT>[2] <A NAME="keywatch">KeyWatch Module Functional
	  Specification<A>
      <DD><A HREF="keywatch.html">Document 1215,501</A>

      <DT>[3] <A NAME="anturl">ANT Ltd. URL broadcast mechanism</A>
      <DD><A HREF="anturl.html">Version dated 14 Feb 97</A>

      <DT>[4] <A NAME="acornuri">Acorn URI Handler Functional Specification</A>
      <DD><A
	  HREF="http://www.acorn.com/browser/uri/funcspec.html">Document 1215,215/FS, Issue 1.</A>

      <DT>[5] <A NAME="icaspec">Intelligent Console Architecture ICA 3.0</A>
      <DD>Revision 3.1 - May 14, 1996.

      <DT>[6] <A NAME="icasource">Windows Client Source V1.7</A>
      <DD>CD ROM: Build i324 10/01/97.

      <DT>[7] <A NAME="screenmodes">ModeFiles module</A>
      <DD>Document 2103,732 - Miscellaneous OS Software Functional Specification
    </DL>

      <!-- ======================================================================= -->

    <hr>
    <h2> <a name="history"> 16.0 History </a> </h2>

    <PRE>
$Log$
Issue F		SJM   20th May 1998       Various updates
Issue E		SJM   25th March 1998     more details on Printer and Drive config
					  plus overscan support.
Issue D		SJM   20th March 1998     Updated after comments from CW.
Issue C		SJM   10th March 1998     Rewrote in HTML and brought up to date.
Issue B 	MNS    2nd December 1997  Comments from CAW incorporated.
Issue A		MNS   12th November 1997  Initial version
    </PRE>

    <hr>
    <P>

    <TABLE BORDER=1 WIDTH="100%">
      <TR>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    This document is issued under license and must not be copied, reproduced
	    or disclosed in part or whole outside the terms of the license.
	  </SMALL>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    &#169; Acorn Computers Ltd 1997
	  </SMALL>
    </TABLE>

    <HR>
    <address><a href="mailto:smiddleton@acorn.com">Simon Middleton</a></address>
<!-- Created: Wed Dec  3 17:30:52 GMT 1997 -->
<!-- hhmts start -->
Last modified: Tue May 19 16:56:22 BST 1998
<!-- hhmts end -->
  </body>
</html>
