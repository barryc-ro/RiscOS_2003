<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML/3.2//EN">
<html>
  <!-- ======================================================================= -->
  <!--         Template for software functional specifications.                -->
  <!-- ======================================================================= -->
  <head>
    <title>
      ICA-3 Client Functional Specification
    </title>
  </head>

  <body BGCOLOR="#ffffff">


    <h1 align=center>
      ICA-3 Client Functional Specification 
    </h1>

    <p>
    <hr>
    <p align=center><strong>CONFIDENTIAL</strong></p>
    <hr>

    <CENTER>
      <TABLE BORDER=0 WIDTH="40%">
	<TR><TD>Document ref:	<TD>1315,500/FS
	<TR><TD>Project:	<TD>ICA-3
	<TR><TD>Revision:	<TD>Issue C <!--$Revision$-->
	<TR><TD>Date:		<TD>3rd March 1998 <!-- $Date$ -->
	<TR><TD>Author(s):	<TD><A HREF="mailto:mnevillesmith@acorn.com">Martin Neville-Smith</a>, <A HREF="mailto:smiddleton@acorn.com">Simon Middleton</a>
	<TR><TD>Change:		<TD>*** LIVE ***
	<TR><TD>Classification:	<TD>Acorn Confidential
      </TABLE>
    </CENTER>

    <!-- ======================================================================= -->

    <hr>
    <h2> Contents </h2>
    <TABLE BORDER=0 WIDTH="100%">
      <TR><TD WIDTH="8%">1.0		<TD><A HREF="#overview">	Overview </A>
      <TR><TD>2.0		<TD><A HREF="#outstanding">	Outstanding issues </A>
      <TR><TD>3.0		<TD><A HREF="#technical">	Technical background </A>
      <TR><TD>4.0		<TD><A HREF="#user">		User interface </A>
      <TR><TD>5.0		<TD><A HREF="#programmer">	Programmer interface </A>
      <TR><TD>6.0		<TD><A HREF="#interchange">     Data interchange </A>
      <TR><TD>7.0             <TD><A HREF="#formats">         Data formats </A>
      <TR><TD>8.0             <TD><A HREF="#external">        External dependencies </A>
      <TR><TD>9.0		<TD><A HREF="#acceptance">	Acceptance test </A>
      <TR><TD>10.0            <TD><A HREF="#noncompliances">  Non compliances </A>
      <TR><TD>11.0		<TD><A HREF="#test">		Development test strategy </A>
      <TR><TD>12.0		<TD><A HREF="#organisation">	Product organisation </A>
      <TR><TD>13.0		<TD><A HREF="#enhancements">	Future enhancements </A>
      <TR><TD>14.0	<TD><A HREF="#glossary">	Glossary </A>
      <TR><TD>15.0	<TD><A HREF="#references">	References </A>
      <TR><TD>16.0	<TD><A HREF="#history">		History </A>
    </TABLE>

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="overview"> 1.0 Overview </a> </h2>

    <P>The wide acceptance of Microsoft applications across the whole
    spectrum of market areas has always presented a problem to Acorn,
    as many potential customers would like to have the ability to run
    such applications, even if this is not the prime reason to
    purchase a computer system. This ability now goes far beyond the
    traditional desktop machine, and is relevant to Network Computers,
    STBs and even small embedded systems. Market areas that have
    particular influence include the corporate network, distance
    workers, small office users, and as an additional service to TV
    Centric STB technology.  

    <P>With the introduction of Windows 95 and Windows NT, Microsoft
    Windows is rapidly becoming the predominant 32-bit application
    platform. As I/S managers begin to introduce advanced Windows
    applications into the extended enterprise, they face the challenge
    of how to effectively deploy 32-bit applications beyond
    LAN-connected, PC users. This falls mainly into the domain of the
    NC, and presents a challenge.  

    <P>The challenge is two-fold. First, users may be remote to the
    LAN, connecting into the corporate network through high-bandwidth
    WANs, over the Internet, or from low-bandwidth dial-up lines. The
    second challenge is to provide this service from low-cost
    platforms that appear to the user to have a responsiveness of an
    expensive desktop PC.  

    <P>This is the area that Citrix have addressed with their WinFrame
    technology. This involves a network-centric, three-tiered
    application architecture. Under this model, the application
    execution and data storage occurs on a central server (or
    servers), and only a thin piece of client software is required at
    the client system. This uses universal, thin-client software in
    conjunction with an application server and a distributed Windows
    display protocol.  

    <P>Citrix WinFrame is a multi-user Windows application server
    based on Windows NT under license from Microsoft that supports
    enterprise application deployment using a thin-client
    architecture. This network-centric approach includes universal,
    thin-client software that works in conjunction with WinFrame
    multi-user application server software. Enterprise applications
    execute on the WinFrame server and are accessed through
    thin-client software over dial-up, LAN, WAN and Internet
    connections. The thin-client architecture provides users with
    consistent, high-performance and universal access to any type of
    application, including DOS, Windows 16, Windows 32 and
    client/server programs, regardless of available bandwidth or
    client hardware. The multi-user application server design provides
    I/S managers with an economical and manageable way to deliver
    applications across the extended corporate network or public
    Internet.  

    <P>The key to this thin-client architecture is a distributed
    Windows presentation protocol developed by Citrix, called
    ICA. This is a general-purpose presentation services protocol for
    Microsoft Windows. Conceptually, ICA is similar to the UNIX
    X-Windows protocol. ICA allows an application's logic to execute
    on a WinFrame multi-user Windows application server, located
    remotely. Only the user interface, keystrokes and mouse movement
    are transferred between the server and the client device over any
    network or communications protocol, resulting in minimal client
    resource consumption. ICA is designed to run over
    industry-standard network protocols, such as TCP/IP, NetBEUI,
    IPX/SPX, and PPP and industry-standard transport protocols, such
    as async, ISDN, Frame Relay and ATM.  

    <P>The ICA protocol presents only the user interface from an
    executing machine on the display of another machine. ICA provides
    true location independence for Windows applications by running the
    Windows application at one location and executing the program's
    user interface somewhere else. This distributed Windows
    architecture allows Windows 16, Windows 32 and client/server
    applications to perform at very high speed over low bandwidth
    connections. It also allows 16- and 32-bit applications to run on
    legacy PCs, old and existing Acorn computers as well as STB and NC
    platforms.  

    <P>Citrix has come into partnership with Acorn to provide a full
    end-to-end solution, and Acorn have agreed to supply the ICA
    client software into all appropriate platforms in the future.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="outstanding"> 2.0 Outstanding issues </a> </h2>

    <P> None currently.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="technical"> 3.0 Technical background </a> </h2>


    <h3>3.1 ICA Functionality</h3>

    <P>The ICA protocol is designed to provide high-performance
    Windows display over low-bandwidth connections, to run over any
    common transport mechanism, and to require minimal client
    resources. ICA is a robust and extensible protocol that includes
    protocol definitions for the following capabilities:

    <UL>
      <LI> Full-screen text presentation
      <LI> Graphical Windows application screen presentation
      <LI> Keyboard and mouse input
      <LI> Session control
      <LI> Framing for asynchronous connections
      <LI> Error detection and recovery
      <LI> Encryption
      <LI> Compression hooks
      <LI> File system redirection
      <LI> Print redirection
      <LI> Multiple generic virtual channels
      <LI> Cut and paste across servers
      <LI> Serial port redirection
      <LI> General purpose WinFrame server browsing
    </UL>

    <h3>3.2 ICA Protocol</h3>

    <P>ICA is the physical line protocol used for communication
    between the client machine and the Citrix WinFrame application
    server. Thinwire is the name of the data protocol that exports the
    application's graphical screen image. Thinwire is a logical
    datastream that flows encapsulated in an ICA packet. Thinwire is
    not a physical protocol. The physical protocol, ICA, must
    guarantee the delivery of the thinwire datastream with no errors
    and no missing or out-of-sequence data.

    <P>From the perspective of the WinFrame application server, the
    major portion of the thinwire component is part of the GDI and
    video driver subsystem. This thinwire component, in conjunction
    with key elements in the WinFrame Win32 subsystem, generates
    highly optimized drawing primitives called the thinwire protocol.

    <P>The output of the thinwire protocol driver is a logical
    datastream that is sent back up a virtual channel API, which takes
    the datastream and encapsulates it into an ICA packet. Once the
    ICA packet is formed, it optionally passes through a series of
    protocol drivers to add functionality like encryption, compression
    and framing. It is then put on the transport layer and sent to the
    client. Once at the ICA client, the data packet passes through the
    same layers in opposite order, resulting in the graphical display
    of the remote application user interface on the client.

    <P>ICA packets consist of a required one-byte command, followed by
    optional data. This packet can be prefixed by optional preambles,
    negotiated at connection time, to manage the transmission of the
    packet. The nature of the transmission medium (LAN vs Async) and
    user defined options (e.g. compression) influence the total packet
    definition.

    <P>All ICA commands have the following format:

    <CENTER>
      <TABLE BORDER=1 CELLPADDING=8>
	<TR>
	  <TH WIDTH="14%">Frame Head</TH>
	  <TH WIDTH="14%">Reliable</TH>
	  <TH WIDTH="14%">Library</TH>
	  <TH WIDTH="14%">Encrypt</TH>
	  <TH WIDTH="14%">Compress Data</TH>
	  <TH WIDTH="14%">Command</TH>
	  <TH WIDTH="14%">Frame Tail</TH>
	</TR>
      </TABLE>
    </CENTER>

    <DL COMPACT>
      <DT><B>Frame Head</B> <DD>Optional framing protocol
      header. Preamble for framing stream-oriented transport data.

      <DT><B>Reliable</B> <DD>Optional reliable transmission protocol
      header. Preamble for error detection and recovery.

      <DT><B>Encrypt</B> <DD>Optional encryption protocol
      header. Preamble for managing encrypted data.

      <DT><B>Compress</B> <DD>Optional compression protocol
      header. Preamble for managing compressed data.

      <DT><B>Command</B> <DD>ICA command byte. Beginning of base ICA
      protocol packet.

      <DT><B>Command Data</B> <DD>Optional data bytes associated with
      the specified COMMAND. The length of the data is dependent on
      the COMMAND and can be zero. COMMAND DATA can also contains
      virtual channel protocol packets.

      <DT><B>Frame Trail</B> <DD>Optioional framing protocol
      trailer. Postamble for framing async transport data.
    </DL>

    <P>Only Command is always present in the packet. The preambles and
    postambles depend on the transport and the negotiation that takes
    place during initialization. The presence of Command Data depends
    on the Command itself.


    <h3>3.3 ICA Commands</h3>

    <P>There are several different categories of ICA commands. These
    categories are discussed below along with implementation notes.

    <h4>3.3.1 Control Commands</h4>

    <P>Control commands are a category of ICA command packets that
    manage the connection to the application server and the
    relationship to the local client user interface. This category of
    commands includes:

    <UL>
      <LI> Server browsing
      <LI> Connection initialization and negotiation
      <LI> Screen control between the application server and the local client user interface
      <LI> Keyboard and mouse input to the application server
      <LI> Control of the local keyboard LEDs
    </UL>

    <h4>3.3.2 Full-Screen Text</h4>

    <P>Full-screen Text is a category of ICA command packets which
    allow the application server to control the local client display
    in a full-screen text mode.

    <P>These commands are rarely used for Windows
    applications. However, they are important for the support of very
    low-end devices and are encountered if a user runs a full-screen
    DOS session from within Windows. These commands involve less data
    transfer, and thus, higher display per performance. Packets are
    sent from the server to perform the following:

    <UL>
      <LI> Set the text modes
      <LI> Write characters
      <LI> Adjust character attributes
      <LI> Scroll
      <LI> Control the cursor
    </UL>

    <P>This is implemented by :-

    <UL>
      <LI>Switching to a suitable full-screen 16 colour mode (ie that
      matches those supported by VGA cards).

      <LI>Running the display in text (VDU 4) mode.

      <LI>Reprogramming the font according to the given DOS code page
      (which can be set by the server).
    </UL>

    <h4>3.3.3 Keyboard</h4> 

    <P>PC scan codes are transmitted from the client to the server
    application. An ICA command packet can contain multiple scan
    codes.

    <P>The RISC OS keyboard API only provides key down information
    with ASCII or internal key values. To allow key up and down events
    to be generated with the correct PS/2 scan code values the
    KeyWatch module, originally written for the NC100 project <A
    HREF="ncos">[1]<A>, is extended to provide this extra
    information. This work is detailed in its own specification <A
    HREF="#keywatch">[2]</A>.

    <h4>3.3.4 Mouse</h4>

    <P>The ICA command set includes commands to input the position of
    the mouse using normalized coordinates. These commands can also
    track the mouse button status.

    <h4>3.3.5 Virtual Channel Commands</h4>

    <P>The ICA protocol provides multiplexed management of multiple
    virtual channels. A virtual channel is a session-oriented
    transmission connection that can be used by application layer
    code. Virtual channels are used to add functional enhancements to
    the client, independently of the ICA protocol itself. There is a
    set of ICA Virtual Channel commands that are used to send and
    receive this ICA protocol independent data.

    <h5>3.3.5.1 Thinwire Virtual Channel</h5>

    <P>Thinwire protocol is an ICA virtual channel protocol used to
    transmit presentation commands from Windows applications running
    on the application server to the client. The Thinwire protocol is
    highly tuned for transmission of Windows object display over
    low-bandwidth connections. This is accomplished through:

    <UL>
      <LI> Command and object specific intelligent compression with state persistence, e.g. run-length encoding for bitmaps
      <LI> Outboard complex clipping and complex curve drawing,
      <LI> Intelligent caching of Windows objects, such as bitmaps, brushes, glyphs and pointers
      <LI> Remote SaveScreenBitmaps
      <LI> Cross-session persistent caching
    </UL>

    <P>Rendering of the Thinwire graphics commands is accomplished by
    the use of a library implementing a subset of the Windows GDI
    calls. These are called by the Thinwire driver to write to the
    screen. Certain portions of the thinwire driver are rewritten to
    provide better speed and more efficient use of resources with the
    RISC OS back end.

    <P>Persistent caching is configurable. The defauilt location for
      the cache is in <CODE>&lt;Wimp$ScrapDir&gt;.WinFrame</CODE>.

    <h5>3.3.5.2 Printer Spooling Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to transmit printer
    data to a client.

    <P>Printer selection is performed under RISC OS. Whichever printer
      is selected as being active when the session is started is the
      one that is used from within the session.

    <h5>3.3.5.3 Drive Mapping Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to transmit file system
    functions between the WinFrame server and the client.

    <P>The file systems and drives that are exported are defined in
    the INI files for security.

    <h5>3.3.5.4 Parallel Port Mapping Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to provide outbound
    access to the client's parallel ports from server applications and
    spooler.

    <h5>3.3.5.5 Serial Port Mapping Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to provide full duplex
    access to the client's serial ports from server applications and
    spooler.

    <h5>3.3.5.6 Clipboard Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to provide Windows
    clipboard support, allowing users to cut and paste between server
    and client applications.

    <P>This is not supported under RISC OS in release 1.

    <h5>3.3.5.7 Audio Virtual Channel</h5>

    <P>ICA 3.5 includes a virtual channel protocol to allow audio
    generated on the server to be played on the client. This
    technology is still in beta currently but will be ported after
    it is released by Citrix.

    <h3>3.4 ICA Protocol and Transport Layers</h3>

    <P>Beneath the ICA data packets, there are several optional
    protocol driver layers. ICA does not depend on these layers. Their
    existence and use is negotiated during the ICA handshaking that
    occurs at the start of a session. Since these layers sit below
    ICA, they can be removed or replaced. Additional protocol drivers
    can also be added. A wide range of supplied protocol modules allow
    ICA to work with all of the most prevalent transport technologies,
    such as TCP/IP, NetBIOS, IPX/SPX, and PPP/SLIP, supplying ICA true
    protocol independence.

    <P>The ICA protocol stack is dynamically configured to meet the
    needs of each transport protocol. For example, IPX is not
    reliable, so a reliable protocol driver is added above the IPX
    transport driver. However, since IPX is a frame-based protocol, a
    frame driver is not included in this particular ICA protocol
    stack. TCP, however, is a stream protocol; in this case, a frame
    driver is included. TCP is reliable, however, so this driver is
    not added to the stack.

    <P>The following diagram illustrates the ICA protocol stack and
    transport:

    <CENTER>
      <IMG SRC="icastack.gif" WIDTH=350 HEIGHT=305 ALT="Protocol stack">
    </CENTER>

    <DL>
      <DT><B> Compression</B>

      <DD>The Compression protocol can encapsulate an encrypted ICA
      packet. The compression protocol is system replaceable and is
      not strictly defined in the ICA protocol definition.

	<P>The source to this driver is not included inm the source
	distribution from Citrix so this functionality is not
	available in the RISC OS client.

      <DT><B> Encryption</B>

      <DD>The Encryption protocol can encapsulate an encrypted ICA
      packet. The encryption protocol is system replaceable and is not
      strictly defined in the ICA protocol definition.

	<P>The RISC OS client supports the basic encryption
	mechanism. Citrix make available a <i>Secure ICA</i> pack
	which implements better security using RSA cryptography. This
	is not available to us due to US Export controls.

      <DT><B> Reliable</B>

      <DD>The Reliable protocol is a transmission packaging protocol
      used to detect transmission errors and to request re-sends of
      data.  This protocol is used in conjunction with any transport
      mechanism that does not provide guaranteed delivery. Two such
      mechanisms are Novell's IPX and standard asynchronous
      connections.

	<P>As the RISC OS client is only implemented over TCP/IP this
	protocol driver is not included.

      <DT><B> Framing</B>

      <DD>The Framing is a transmission packaging protocol used to
      manage stream-oriented communications, such as async and TCP. It
      is used in conjunction with Reliable protocol to provide an
      error-free data transmission.

	<P>The RISC OS client incorporates the RFrame protocol driver
	which provides framing for reliable transports (eg TCP/IP).

      <DT><B> Modem Control</B>

      <DD>The Modem control protocols allow for modem detection and
      initialization prior to connection.

	<P>These are not supported by the RISC OS client as it is
	assumed that an external dialler has responsibility for
	bringing a TCP/IP connection up.

    </DL>

    <H3>3.5 ICA Extensibility</H3>

    <P>ICA is a flexible and extensible protocol. First, the protocol
    is designed to accommodate varying degrees of client
    capability. During handshaking, the ICA client communicates such
    information as screen resolution, color depth, cache size, among
    other things. The protocol then adjusts to this information. This
    communication allows for a wide variety of ICA clients, ranging
    from fixed-function monochrome terminals to high-end workstations.

    <P>Through its virtual channel architecture, ICA can be extended
    to include new data types, such as sound and video. Virtual
    channels can also be used to support auxiliary client devices,
    such as badge readers, wands and scanners.

    <P>Finally, the very modular design of the ICA protocol allows the
    supporting layers below it to be expanded. For example, the
    existing encryption layer could be augmented with RSA or DES
    encryption. Converters, such as an ICA to X.11, can be added
    in. And new transport protocols such as ATM can easily be
    supported.

    <P>The RISC OS client is composed of one linked application, thus
    extending it with new virtual drivers or protocol modules requires
    compilation of a new application. They cannot be added at run-time
    as is possible with the Windows implementation.

<!--
    <P>This application makes use of Citrix supplied sources wherever
    possible. 

    <H3>UI application</H3>

    <PRE>
CLIENT
	LIB
		BINI
			BINIAPI.C	buffered INI file read
			BINIGUTS.C	buffered INI file read

		CFGINI
			CFGINI.C	resolves multiple INI files and
					passes data to protocol stack

		CFGLOAD
			CFGLOAD.C	veneers for loading drivers

		INI
			HELPER.C	INI file read library
			(INIAPI.C	unbuffered INI file read)

		UTILSUB
			PARSE.C		command line parsing

    </PRE>

    <P>The basic flow of control for the single-tasking UI is as
    follows.

    <OL>
      <LI>Display splash screen

      <LI>Read the WFClient.ini file to determine the default UI setup

      <LI>Change screen mode amd enter single-tasking mode.

      <LI>If connection details passed in on command line or via .ica
	file then connect directly to server.

      <LI>Otherwise display scrollable list of servers available and wait
       for server to be selected, then connect to it.

      <LI>On receipt of a two presses of the break key prompt for
	dropping the connection and return to server browser screen
	or exit (depending on how the UI was entered).
    </OL>
 -->

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="user"> 4.0 User interface </a> </h2>

    <H3>4.1 Start up</H3>

    <P>The client, when initialised, ensures that a splash
    screen, conforming to Citrix's specification, is displayed to
    the user. This described in detail in the Citrix Agreement,
    Exhibit D. The Splash screen is displayed for a minimum of
    two seconds.

    <P>The RISC OS port of the ICA-3 client is not a normal
    desktop application in the first release, but occupies the full
    screen when it is activated.  When in operation, the normal RISC
    OS user interface is replaced by the ICA-3 user interface,
    including operation of mouse buttons, keyboard LEDs, and
    peripheral devices. It is not therefore possible to run Acorn
    native applications in parallel.

    <P>CMOS settings are defined to establish the action of ICA-3
    on start-up: Immediate entry, or deferred entry - that is user
    action is required to quit the desktop and enter an ICA
    session. CMOS bits TBD.

    <P>Reversion from ICA-3 mode and RISC OS is possible by a
    coded key sequence, possibly a double break sequence.


    <P>There are two possible ways of starting up the client. 

    <OL>
      <LI>Place an icon on the iconbar.
      <LI>Display a full screen connection.
    </OL>

    <H3>4.2 Icon bar functions</H3>

    <P>The icon bar icon has the following properties.

    <DL>
      <DT>SELECT click on icon.  <DD>If a session has been
      suspended then resume that session. Otherwise give an error
      asking the user to start a session.

      <DT>MENU click on icon.
      <DD>Open iconbar menu.

      <DT>ADJUST click on icon.
      <DD>NO action.
    </DL>

    <H4>4.2.1 Icon bar menu</H4>

    <P>The icon bar menu has the following structure:-

    <DL>
      <DT>Info
      <DD>Leads to standard Info window. This info window references
	both Citrix and Acorn as authors.

      <DT>Resume
      <DD>Resumes a suspended session. Greyed out if no session is in progress.

      <DT>Disconnect 

      <DD>Disconnect from the current server. This brings up a
      dialogue asking if the user is sure before disconnecting. Greyed
      out if no session is in progress.

      <DT>Quit
      <DD>Quit the client. If a session is open then a warning dialogue
	is opened first as with Disconnect.
    </DL>


    <H3>4.3 Display modes</H3>

    <P>There are three display modes possible:-

    <OL>
      <LI>Scrolling text mode
      <P>This is the mode until a connection with the server is
	made. This enabled error messages from the server to be
	displayed without any sophisticated protocol.

      <LI>Full-screen text mode
      <P>This is used if you start a DOS box on the server and then
	  select full-screen mode from its perferences window.

      <LI>Windows emulation mode
      <P>This is the full graphical user interface.
    </OL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="programmer"> 5.0 Programmer interface </a> </h2>

    <h3>5.1 Command line switches</h3>

    <P>Various options can be given on the command line to enable
      features as follows.

    <DL>
      <DT><B><CODE>-f &lt;filename&gt;</B></CODE>
      <DD><i>filename</i> is an ICA file which is used to immediately
	connect to a server. Depending on the state of other switches
	the client may quit when the session finished.

      <DT><B><CODE>-i</B></CODE>
      <DD>Install an icon on the iconbar. Implies -s.

      <DT><B><CODE>-o</B></CODE>
      <DD>Once a connection has been made, never exit. If the session
	finishes restart it.

      <DT><B><CODE>-s</B></CODE>
      <DD>Allow suspend and resume. If this is set then Hotkey1 within
	an WinFrame session switches back to RISC OS, leaving the
	session suspended and able to be resumed later. If this is not
	set then Hotkey1 disconnects and quits the client.

      <DT><B><CODE>-u</B></CODE>
      <DD>The filename given to the -f switch is in fact a URL
	specifying the server to connect to.
    </DL>

    <P>The following switches control debug output and may not do
      anything on release versions.

    <DL>
      <DT><B><CODE>-d</B></CODE>
      <DD>Output postmortem to standard error on error.

      <DT><B><CODE>-g</B></CODE>
      <DD>Log file is enabled

      <DT><B><CODE>-l &lt;logfile&gt;</B></CODE>
      <DD>Logfile to which to write log messages.

      <DT><B><CODE>-r</B></CODE>
      <DD>Remote debug output is enabled.
    </DL>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="interchange"> 6.0 Data interchange </a> </h2>

    <UL>
      <LI><A HREF="#sysvars">6.1 System variables</A>
      <LI><A HREF="#wimpmsgs">6.2 Wimp messages</A>
      <LI><A HREF="#urlscheme">6.3 URL scheme</A>
    </UL>


    <H3><A NAME="sysvars">6.1 System variables</A></H3>

    <P>The following system variables are set in the !Boot file so
      they are available before the client is run.

    <DL>
      <DT><B><CODE>WinFrame$Dir</CODE></B> 

      <DD>Application directory for WinFrame. Resources directory for
      ROM builds.

      <DT><B><CODE>WinFrame$Path</CODE></B>

      <DD>Resource path for application.

      <DT><B><CODE>File$Type_AD0</CODE></B>

      <DD>File type name for ICA files (ICA).

      <DT><B><CODE>Alias$@RunType_AD0</CODE></B>

      <DD>Run type for ICA files.

      <DT><B><CODE>Alias$URLOpen_ICA</CODE></B>

      <DD>Run type for <CODE>ica:</CODE> URL pseudo-scheme.

    </DL>

    <P>The following system variables can be overridden by the
      user. If they are set before the client is run then the given
      values are used rather than the client defaults.

    <DL>
      <DT><B><CODE>WinFrameINI$Path</CODE></B>

      <DD>Path for in-built INI files. Can be used to override
      defaults when the application is in ROM or a read-only
      partition/mount.  <P>Defaults to <CODE>WinFrame:INI.</CODE>

      <DT><B><CODE>WinFrame$Options</CODE></B>

      <DD>Can give command line options to be used when client
	starts. <P>Defaults to empty.

      <DT><B><CODE>WinFrame$FileOptions</CODE></B>

      <DD>Command line options to be used when client starts with a
	file given as an argument.
	<P>Defaults to empty.

      <DT><B><CODE>WinFrame$NoFileOptions</CODE></B>

      <DD>Command line options to be used when client starts with no
	file given as an argument. 

	<P>Defaults to -i.

      <DT><B><CODE>WinFrame$ClientName</CODE></B>

      <DD>If set then this is the name for this client sent to the
      server on connection.

      <DT><B><CODE>WinFrame$Errors</CODE></B>

      <DD>Redirection standard error output. 
	<P>Defaults to <CODE>2&gt;&nbsp;null:</CODE>.
    </DL>

    <P>The following system variables are referenced by the client but
      should never be set by it.

    <DL>
      <DT><B><CODE>Inet$HostName</CODE></B>

      <DD>Name sent to the server on connection for this client if
	<CODE>WinFrame$ClientName</CODE> is not set.
    </DL>

    <H3><A NAME="wimpmsgs">6.2 Wimp Messages</A></H3>

    <P>The ICA client broadcasts various messages when
      connecting/disconnecting etc to allow other tasks to provide
      suitable user feedback. It can also be controlled via messages
      so that all configuration and user interface details can be
      performed externally.

    <H4>6.2.1 Status Messages</H4>

    <P>The format of the status messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f80	(message_WINFRAME_STATUS)
	+20 = reason
	+24 = flags
    </PRE>

    <P>They are all for information only.

    <H5>6.2.1.1 WinFrame Starting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 0		(winframe_STATUS_STARTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client runs so that other
      tasks can record the task handle for future use if they wish.


    <H5>6.2.1.2 WinFrame Quitting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_STATUS_QUITTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client is about to
    quit. Note that it will be dead by the time that any task receives
    the message.

    <H5>6.2.1.3 WinFrame Connected</H5>

    <PRE>
	 +0 = 72	(message size)
	+20 = 2		(winframe_STATUS_CONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
	+32 = server description
    </PRE>

    <P>This message is broadcast when the client has successfully
      connected to a WinFrame server. 

    <P>The server description is as set in the [ApplicationServers]
    section of the ICA file, is null-terminated, and is a maximum of
    40 characters (including terminator) long. If no description was
      available then the server host name is used, failing that a
      string version of the IP address.

    <P>Note in the current implementation this message may not be
    received by another task until the client suspends or disconnects.


    <H5>6.2.1.4 WinFrame Suspended</H5>

    <PRE>
	 +0 = 68	(message size)
	+20 = 3		(winframe_STATUS_SUSPENDED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client is suspended by the
      user switching back to the RISC OS desktop environment.

    <H5>6.2.1.5 WinFrame Disconnected</H5>

    <PRE>
	 +0 = 68	(message size)
	+20 = 4		(winframe_STATUS_DISCONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client disconnects from the
      WinFrame server.

    <H4>6.2.2 Control Messages</H4>

    <P>The format of the control messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f81	(message_WINFRAME_CONTROL)
	+20 = reason
	+24 = flags
    </PRE>

    <P>Any control message is immediately replied to with a
    CONTROL_ACK message that says whether the requested action is
    being performed or not. Note that just because an action is taken
    doesn't mean that it will be completed successfully. Status
    messages must be monitored to determine exactly what the state of
      the client is.

    <H5>6.2.2.1 WinFrame Connect</H5>

    <PRE>
	+20 = 0		(winframe_CONTROL_CONNECT)
	+24 = flags
		bit 0: 1 = with ICA file: 0 = with server name
		bit 1: 1 = delete ICA file when finished
		bits 1-31: reserved

	if bit 0 = 0
		+28 = server name
	if bit 0 = 1
		+28 = filename of ICA file
    </PRE>

    <P>Ask the client to connect to the given host. 

    <P>The server name is a host name or IP address which
      should be null-terminated (max 40 characters).

    <P>The ICA file name should be null-terminated (max 228
    characters) and can be either a permanent file or a temporary
    one. If flags bit 1 is set then when it is no longer needed (which
    will normally be when the session finishes) the file is deleted.

    <H5>6.2.2.2 WinFrame Reconnect</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_RECONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to reconnect to the session it has suspended. It
      is an error if it is not currently suspended.

    <H5>6.2.2.3 WinFrame Disconnect</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_DISCONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to disconnect from the given server. It is an
      error if the server is not connected.

    <H5>6.2.2.4 WinFrame Quit</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_QUIT)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>Ask the client to quit. It refuses to die if it still has
      open sessions.

    <H4>6.2.2 Control Ack Messages</H4>

    <P>The format of the control ack messages is as follows

    <PRE>
	+12 = ref	(my_ref from CONTROL message)
	+16 = 0x50f82	(message_WINFRAME_CONTROL_ACK)
	+20 = reason	(reason code  of control message)
	+24 = flags
	     bit 0: 1 = control message succeeded
		    0 = control message failed
	+28 = session handle (CONNECT, RECONNECT and DISCONNECT)
	+32 = error number (not a RISC OS error number)
	+36 = error message (to +256)
    </PRE>


    <H3><A NAME="urlscheme">6.3 URL scheme</a></H3>

    <P>For greater flexibility in the NC environment, the client
    supports a level of control via a pseudo-URL scheme. Note that
    more control is available through the messages and the ICA files
    and these should be used where possible.

    <P>The client supports both the ANT URL protocol <A
    HREF="anturl">[3]</A> and the Acorn URI protocol <A
    HREF="acornuri">[4]</A>.

    <P>The format of the URL expected is as follows. Optional
      sections are within square brackets

    <DL>
      <DT><CODE>ica:[//<i>hostname</i>][/<i>application</i>][?<i>arg1</i>[&<i>arg2</i>]]</CODE>

      <DD><i>hostname</i> is the server name or IP address (<CODE>Address</CODE> field
	in ICA file).
	<BR><i>application</i> is the name of the initial application to
	  run (<CODE>InitialProgram</CODE> field in ICA file).
	<BR><i>args</i> have yet to be defined.

    </DL>

    <P>
      <!-- ======================================================================= --> 

    <hr  noshade>
    <h2> <a name="formats"> 7.0 Data formats </a> </h2>

    <H3>7.1 INI files</H3>

    <P>Configuration of the ICA Client is performed with Windows style
    INI files. These are chosen because the code is provided to handle
    reading these files and also the configuration file that is
    fetched over the web to initiate a plugin instance is formatted as
    an INI file.

    <P>There are three INI files. They are stored in an INI directory
    within the ICA Client application with their extensions removed.

    <H4>7.1.1 MODULE.INI</H4>
    
    <P>This INI file has two main uses. Firstly it contains details of
    what components of the system are available. Secondly it contains
    general defaults for all the components which can be overriden on
    the command line or by other INI files. This should never be
      changed for any given release.

    <H4>7.1.2 WFCLIENT.INI</H4>

    <P>This file contains general parameters to override those in the
      MODULE.INI file.

    <H4>7.1.3 APPSRV.INI</H4>

    <P>This file contains a list of known application servers. It is
    this file which determines what the user sees on the initial login
    screen when starting the application. Each server listing can
    contain overrides to any of the parameters in the MODULE.INI file.

    <P>It also contains overrides for UI values in WFCLIENT.INI

    <P>It is not used if a connection is made with an ICA file.


    <H3>7.2 ICA file type</H3>

    <P>A new filetype ICA (0xAD0) is allocated. This corresponds to the
    MIME type <CODE>application/x-ica</CODE>. Running an ICA file runs
    the ICA Client application, connecting immediately to the server
    given in the file.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="external"> 8.0 External dependencies </a> </h2>

    <P>There are no external dependencies.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="acceptance"> 9.0 Acceptance test </a> </h2>

    <H3>9.1 Acceptance criteria</H3>

    <P>Before allowing release of the software, the following conditions will be met;	

    <UL>
	<LI>	The level of recorded unfixed faults in the Fault Database is deemed to be acceptable. No urgent or high
		priority bugs should be remaining. 
	<LI>	We have passed Citrix's audit. (Details TBD).
	<LI>	The majority of trial sites are operating successfully and are happy. This will be quantified using a check-list.
	<LI>	The product audit is complete with an acceptable report. (Approx 4 man weeks audit time).
	<LI>	Xemplar technical support specialists explicitly give the go ahead.
	<LI>	Acorn SQA, Product Group and Support areas confirm its suitability for release on the available evidence.
    </UL>

    <H3>9.2 Performance Targets</H3>

    <P>The performance of ICA-3 is mostly independent of the
    implementation, and is governed by network access performance
    and server load.

    <P>However, it is important that our implementation performs as
    least as well as equivalent PC platforms, and that no additional
    bottlenecks are apparent.

    <P>From a user's perspective, a cluster of approximately 10
    clients accessing a server via an Ethernet network should feel
    close to the responsiveness of a low-medium performance PC running
    the applications natively. Over a modem connection, typical word
    processing type applications where response to keyboard and mouse
    activity is paramount, the system should be responsive and not
    suffer from significant delays caused by client porting
    architectural issues.


    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="noncompliances"> 10.0 Non compliances </a> </h2>

    <P>The following are the major differences between the RISC OS and
      Windows ICA clients.

    <UL>
      <LI>Only runs full screen.
      <LI>Only runs one session at a time.
      <LI>Only supports TCP/IP transport.
      <LI>Doesn't include Compression Protocol Driver.
      <LI>Secure ICA add-on is not available.
      <LI>Hardware mouse cursor is used limiting cursor images to 2 colours.
      <LI>Desktop connection manager not included.
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="test"> 11.0 Development test strategy </a> </h2>

    <P>Initial development testing will utilise Acorn House WinFrame
    NT Servers running on the House Net. It may be advantageous to use
    a sub-net, in order that packet monitoring can be performed
    without being swamped by unrelated traffic.  It is hoped that it
    will not be necessary to use isolated servers and clients as the
    network layer will be largely unaffected. A PC running Citrix
    released code will be used as a comparison.
      
    <P>Testing of the product will make heavy use of trial sites, for
    it it is the integration of the many components in a variety of
    different network environments that are the most difficult to
    predict and test. These sites will include Xemplar identified
    ones, other mixed school sites and other third parties where
    WinFrame products are in use. We may seek such reference sites
    from Citrix. Site visits to each of the major sites will be made
    to check the installation and operation of the software.

    <P>A formal audit of the software will be made, in conjuction with
    the explicit and directed testing that will be undertaken during
    the Beta phase of the project. Specifically, the Audit will also
    focus on 'out of the box' consistency and useability, installation
    and operation with a variety of common machine types and
    configurations, and software/documentation consistency, as well as
    reliability and functionality.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="organisation"> 12.0 Product organisation </a> </h2>

    <h3>12.1 Target Platforms</h3>

    <P>Acorn is contractually obliged to supply the ICA client
    software on all future releases of RISC OS, except in
    circumstances where it would clearly be inappropriate. As a RISC
    OS module, it will therefore be included as part of the standard
    build, in STBs, NCs and Desktop machines. We plan to release the
    module in soft-loadable form to enable existing platforms to take
    advantage of this technology.

    <P>ICA-3 does not consume very significant processor resources or
    memory. It is recommended that the following footprint is
    specified as a minimum:

    <UL>
      <LI>7500FE processor or equivalent
      <LI>2 MBytes free RAM for execution, including any cache area.
      <LI>ROM module area will be approximately 300k.
      <LI>All versions of RISC OS from 3.1, including NC OS variants, are supported.
      <LI>VGA monitor.
    </UL>

    <P>The software relies on a working TCP/IP network stack being
    installed and configured. This project only uses TCP/IP; any
    other stack eg NetBEUI or ATM will be considered as a future
    development.


    <H3>12.2 User Guide</H3>

    <P>A user manual will be supplied with every copy of RISC OS
    shipped, be this direct from Acorn, or via a third party. This
    documentation will draw heavily on copy produced by Citrix, but be
    converted into suitable house style.

    <H3>12.3 Soft loadable version</H3>

    <P>Although not covered by the agreement between Acorn and Citrix,
    Acorn will ship a soft-loadable version of the software, complete
    with the documentation above. This will take the form of an A5
    style wallet containing disc, installation instructions and
    manual.


    <H3>12.4 Application disk structure</H3>

    <P>The application structure on disc is as follows. 

    <PRE>
!WinFrame
	!Boot			obey
	!Help			text
	!Run			obey
	!RunImage		absolute
	!Sprites		sprite
	KeyWatch		module
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text
    </PRE>


    <H3>12.5 Application ROM structure</H3>

    <P>The application structure when in ROM is as follows

    <PRE>
$.Apps.!WinFrame
	!Boot			obey
	!Help			text
	!Run			obey
	!Sprites		sprite

$.Resources.WinFrame
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text
    </PRE>

    <P>
      <!-- ======================================================================= -->


   <hr  noshade>
    <h2> <a name="enhancements"> 13.0 Future enhancements </a> </h2>

    <P>No major future enhancements are visualised in the short term
    other than a possible port of later versions of the ICA
    architecture which may be made available from Citrix from time to
    time. Other protocol support, such as NetBEUI and ATM may be
    considered if customer requirements dictate.

    <P>The development of an 'Acorn desktop' version may be considered
    if the traditional Acorn market could justify the development.

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="glossary"> 14.0 Glossary </a> </h2>

    <DL>
      <DT>Async    <DD>A serial based transport layer
      <DT>GDI      <DD>Graphical Device Interface.
      <DT>ICA      <DD>Independent Computing Architecture.
      <DT>ICA client <DD>Software that implements the client end of the ICA protocol.
      <DT>ICA protocol <DD>The fundamental data channel organisation.
      <DT>LAN      <DD>Local Area Network.
      <DT>STB      <DD>Set Top Box.
      <DT>Thinwire <DD>Graphics protocol that runs over ICA.
      <DT>WAN      <DD>Wide Area Network.
      <DT>WinFrame <DD>The server package that implements ICA.
      <DT>      <DD>
    </DL>
    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="references"> 15.0 References </a> </h2>

    <DL>
      <DT>[1] <A NAME="ncos">NC OS version 1.15. On screen Keyboard
	  Functional Specification</A>
      <DD><A HREF="">Document 2107,738</A>

      <DT>[2] <A NAME="keywatch">KeyWatch Module Functional
	  Specification<A>
      <DD><A HREF="keywatch.html">Document 1315,xxx</A>

      <DT>[3] <A NAME="anturl">ANT Ltd. URL broadcast mechanism</A>
      <DD><A HREF="http://www.ant.co.uk/support/tech/notes/url.html">http://www.ant.co.uk/support/tech/notes/url.html</A>

      <DT>[4] <A NAME="acornuri">Acorn URI Handler Functional Specification</A>
      <DD><A HREF="http://www.acorn.com/browser/uri/funcspec.html">Document 1215,215/FS</A>
    </DL>

      <!-- ======================================================================= -->

    <hr>
    <h2> <a name="history"> 16.0 History </a> </h2>

    <PRE>
Issue A		MNS   12th November 1997
Issue B 	MNS    2nd December 1997  Comments from CAW incorporated.
Issue C		SJM   10th March 1998     Rewrote in HTML and brought up to date
    </PRE>

    <hr>
    <P>

    <TABLE BORDER=1 WIDTH="100%">
      <TR>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    This document is issued under license and must not be copied, reproduced
	    or disclosed in part or whole outside the terms of the license.
	  </SMALL>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    &#169; Acorn Computers Ltd 1997
	  </SMALL>
    </TABLE>

    <HR>
    <address><a href="mailto:smiddleton@acorn.com">Simon Middleton</a></address>
<!-- Created: Wed Dec  3 17:30:52 GMT 1997 -->
<!-- hhmts start -->
Last modified: Thu Mar 12 17:41:30 GMT 1998
<!-- hhmts end -->
  </body>
</html>
