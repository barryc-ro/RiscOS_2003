<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML/3.2//EN">
<html>
  <!-- ======================================================================= -->
  <!--         Template for software functional specifications.                -->
  <!-- ======================================================================= -->
  <head>
    <title>
      ICA-3 Client Functional Specification
    </title>
  </head>

  <body BGCOLOR="#ffffff">


    <h1 align=center>
      ICA-3 Client Functional Specification 
    </h1>

    <p>
    <hr>
    <p align=center><strong>CONFIDENTIAL</strong></p>
    <hr>

    <CENTER>
      <TABLE BORDER=0 WIDTH="40%">
	<TR><TD>Document ref:	<TD>1315,500/FS
	<TR><TD>Project:	<TD>ICA-3 (834)
	<TR><TD>Revision:	<TD>Issue E <!--  $Revision$ -->
	<TR><TD>Date:		<TD>25the March 1998 <!-- $Date$ -->
	<TR><TD>Author(s):	<TD><A HREF="mailto:mnevillesmith@acorn.com">Martin Neville-Smith</a>, <A HREF="mailto:smiddleton@acorn.com">Simon Middleton</a>
	<TR><TD>Change:		<TD>*** LIVE ***
	<TR><TD>Classification:	<TD>Acorn Confidential
      </TABLE>
    </CENTER>

    <!-- ======================================================================= -->

    <hr>
    <h2> Contents </h2>
    <TABLE BORDER=0 WIDTH="100%">
      <TR><TD WIDTH="8%">1.0		<TD><A HREF="#overview">	Overview </A>
      <TR><TD>2.0		<TD><A HREF="#outstanding">	Outstanding issues </A>
      <TR><TD>3.0		<TD><A HREF="#technical">	Technical background </A>
      <TR><TD>4.0		<TD><A HREF="#user">		User interface </A>
      <TR><TD>5.0		<TD><A HREF="#programmer">	Programmer interface </A>
      <TR><TD>6.0		<TD><A HREF="#interchange">     Data interchange </A>
      <TR><TD>7.0             <TD><A HREF="#formats">         Data formats </A>
      <TR><TD>8.0             <TD><A HREF="#external">        External dependencies </A>
      <TR><TD>9.0		<TD><A HREF="#acceptance">	Acceptance test </A>
      <TR><TD>10.0            <TD><A HREF="#noncompliances">  Non compliances </A>
      <TR><TD>11.0		<TD><A HREF="#test">		Development test strategy </A>
      <TR><TD>12.0		<TD><A HREF="#organisation">	Product organisation </A>
      <TR><TD>13.0		<TD><A HREF="#enhancements">	Future enhancements </A>
      <TR><TD>14.0	<TD><A HREF="#glossary">	Glossary </A>
      <TR><TD>15.0	<TD><A HREF="#references">	References </A>
      <TR><TD>16.0	<TD><A HREF="#history">		History </A>
    </TABLE>

    <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="overview"> 1.0 Overview </a> </h2>

    <P>The wide acceptance of Microsoft applications across the whole
    spectrum of market areas has always presented a problem to Acorn,
    as many potential customers would like to have the ability to run
    such applications, even if this is not the prime reason to
    purchase a computer system. This ability now goes far beyond the
    traditional desktop machine, and is relevant to Network Computers,
    STBs and even small embedded systems. Market areas that have
    particular influence include the corporate network, distance
    workers, small office users, and as an additional service to TV
    Centric STB technology.  

    <P>With the introduction of Windows 95 and Windows NT, Microsoft
    Windows is rapidly becoming the predominant 32-bit application
    platform. As I/S managers begin to introduce advanced Windows
    applications into the extended enterprise, they face the challenge
    of how to effectively deploy 32-bit applications beyond
    LAN-connected, PC users. This falls mainly into the domain of the
    NC, and presents a challenge.  

    <P>The challenge is two-fold. First, users may be remote to the
    LAN, connecting into the corporate network through high-bandwidth
    WANs, over the Internet, or from low-bandwidth dial-up lines. The
    second challenge is to provide this service from low-cost
    platforms that appear to the user to have a responsiveness of an
    expensive desktop PC.  

    <P>This is the area that Citrix have addressed with their WinFrame
    technology. This involves a network-centric, three-tiered
    application architecture. Under this model, the application
    execution and data storage occurs on a central server (or
    servers), and only a thin piece of client software is required at
    the client system. This uses universal, thin-client software in
    conjunction with an application server and a distributed Windows
    display protocol.  

    <P>Citrix WinFrame is a multi-user Windows application server
    based on Windows NT under license from Microsoft that supports
    enterprise application deployment using a thin-client
    architecture. This network-centric approach includes universal,
    thin-client software that works in conjunction with WinFrame
    multi-user application server software. Enterprise applications
    execute on the WinFrame server and are accessed through
    thin-client software over dial-up, LAN, WAN and Internet
    connections. The thin-client architecture provides users with
    consistent, high-performance and universal access to any type of
    application, including DOS, Windows 16, Windows 32 and
    client/server programs, regardless of available bandwidth or
    client hardware. The multi-user application server design provides
    I/S managers with an economical and manageable way to deliver
    applications across the extended corporate network or public
    Internet.  

    <P>The key to this thin-client architecture is a distributed
    Windows presentation protocol developed by Citrix, called
    ICA. This is a general-purpose presentation services protocol for
    Microsoft Windows. Conceptually, ICA is similar to the UNIX
    X-Windows protocol. ICA allows an application's logic to execute
    on a WinFrame multi-user Windows application server, located
    remotely. Only the user interface, keystrokes and mouse movement
    are transferred between the server and the client device over any
    network or communications protocol, resulting in minimal client
    resource consumption. ICA is designed to run over
    industry-standard network protocols, such as TCP/IP, NetBEUI,
    IPX/SPX, and PPP and industry-standard transport protocols, such
    as async, ISDN, Frame Relay and ATM.  

    <P>The ICA protocol presents only the user interface from an
    executing machine on the display of another machine. ICA provides
    true location independence for Windows applications by running the
    Windows application at one location and executing the program's
    user interface somewhere else. This distributed Windows
    architecture allows Windows 16, Windows 32 and client/server
    applications to perform at very high speed over low bandwidth
    connections. It also allows 16- and 32-bit applications to run on
    legacy PCs, old and existing Acorn computers as well as STB and NC
    platforms.  

    <P>Citrix has come into partnership with Acorn to provide a full
    end-to-end solution, and Acorn have agreed to supply the ICA
    client software into all appropriate platforms in the future.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="outstanding"> 2.0 Outstanding issues </a> </h2>

    <UL>
      <LI>Should the disc cache option auto-select based on whether
	there is a local disc or not?    

      <LI>Should options menu item just be settings...?

      <LI>Acceptance criteria and performance targets.

      <LI>Is is worth listing the module.ini file in this spec?
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="technical"> 3.0 Technical background </a> </h2>

    <UL>
      <LI><A HREF="#icafunc">3.1 ICA Functionality</A>
      <LI><A HREF="#icaprot">3.2 ICA Protocol</A>
      <LI><A HREF="#icacmds">3.3 ICA Commands</A>
      <LI><A HREF="#icatrans">3.4 ICA Protocol and Transport layers</A>
      <LI><A HREF="#icaext">3.5 ICA Extensibility</A>
    </UL>

    <h3><A NAME="icafunc">3.1 ICA Functionality</A></h3>

    <P>The ICA protocol is designed to provide high-performance
    Windows display over low-bandwidth connections, to run over any
    common transport mechanism, and to require minimal client
    resources. ICA is a robust and extensible protocol that includes
    protocol definitions for the following capabilities:

    <UL>
      <LI> Full-screen text presentation
      <LI> Graphical Windows application screen presentation
      <LI> Keyboard and mouse input
      <LI> Session control
      <LI> Framing for asynchronous connections
      <LI> Error detection and recovery
      <LI> Encryption
      <LI> Compression hooks
      <LI> File system redirection
      <LI> Print redirection
      <LI> Multiple generic virtual channels
      <LI> Cut and paste across servers
      <LI> Serial port redirection
      <LI> General purpose WinFrame server browsing
    </UL>

    <P>The ICA protocol is defined in the Citrix confidential
    specification <CITE>Intelligent Console Architecture</CITE><A
    HREF="#icaspec">[5]</A>. This document and the accompanying
    virtual driver specifications only define the protocols as
    implemented in the WinFrame 1.6 server release. Therefore the
    definitive specification is the source code provided by Citrix<A
    HREF="#icasource">[6]</A>.

    <h3><a name="icaprot">3.2 ICA Protocol</a></h3>

    <P>ICA is the physical line protocol used for communication
    between the client machine and the Citrix WinFrame application
    server. Thinwire is the name of the data protocol that exports the
    application's graphical screen image. Thinwire is a logical
    datastream that flows encapsulated in an ICA packet. Thinwire is
    not a physical protocol. The physical protocol, ICA, must
    guarantee the delivery of the thinwire datastream with no errors
    and no missing or out-of-sequence data.

    <P>From the perspective of the WinFrame application server, the
    major portion of the thinwire component is part of the GDI and
    video driver subsystem. This thinwire component, in conjunction
    with key elements in the WinFrame Win32 subsystem, generates
    highly optimized drawing primitives called the thinwire protocol.

    <P>The output of the thinwire protocol driver is a logical
    datastream that is sent back up a virtual channel API, which takes
    the datastream and encapsulates it into an ICA packet. Once the
    ICA packet is formed, it optionally passes through a series of
    protocol drivers to add functionality like encryption, compression
    and framing. It is then put on the transport layer and sent to the
    client. Once at the ICA client, the data packet passes through the
    same layers in opposite order, resulting in the graphical display
    of the remote application user interface on the client.

    <P>ICA packets consist of a required one-byte command, followed by
    optional data. This packet can be prefixed by optional preambles,
    negotiated at connection time, to manage the transmission of the
    packet. The nature of the transmission medium (LAN vs Async) and
    user defined options (e.g. compression) influence the total packet
    definition.

    <P>All ICA commands have the following format:

    <CENTER>
      <TABLE BORDER=1 CELLPADDING=8>
	<TR>
	  <TH WIDTH="14%">Frame Head</TH>
	  <TH WIDTH="14%">Reliable</TH>
	  <TH WIDTH="14%">Library</TH>
	  <TH WIDTH="14%">Encrypt</TH>
	  <TH WIDTH="14%">Compress Data</TH>
	  <TH WIDTH="14%">Command</TH>
	  <TH WIDTH="14%">Frame Tail</TH>
	</TR>
      </TABLE>
    </CENTER>

    <DL COMPACT>
      <DT><B>Frame Head</B> <DD>Optional framing protocol
      header. Preamble for framing stream-oriented transport data.

      <DT><B>Reliable</B> <DD>Optional reliable transmission protocol
      header. Preamble for error detection and recovery.

      <DT><B>Encrypt</B> <DD>Optional encryption protocol
      header. Preamble for managing encrypted data.

      <DT><B>Compress</B> <DD>Optional compression protocol
      header. Preamble for managing compressed data.

      <DT><B>Command</B> <DD>ICA command byte. Beginning of base ICA
      protocol packet.

      <DT><B>Command Data</B> <DD>Optional data bytes associated with
      the specified COMMAND. The length of the data is dependent on
      the COMMAND and can be zero. COMMAND DATA can also contains
      virtual channel protocol packets.

      <DT><B>Frame Trail</B> <DD>Optioional framing protocol
      trailer. Postamble for framing async transport data.
    </DL>

    <P>Only Command is always present in the packet. The preambles and
    postambles depend on the transport and the negotiation that takes
    place during initialization. The presence of Command Data depends
    on the Command itself.


    <h3><a name="icacmds">3.3 ICA Commands</a></h3>

    <P>There are several different categories of ICA commands. These
    categories are discussed below along with implementation notes.

    <h4>3.3.1 Control Commands</h4>

    <P>Control commands are a category of ICA command packets that
    manage the connection to the application server and the
    relationship to the local client user interface. This category of
    commands includes:

    <UL>
      <LI> Server browsing
      <LI> Connection initialization and negotiation
      <LI> Screen control between the application server and the local client user interface
      <LI> Keyboard and mouse input to the application server
      <LI> Control of the local keyboard LEDs
    </UL>

    <h4>3.3.2 Full-Screen Text</h4>

    <P>Full-screen Text is a category of ICA command packets which
    allow the application server to control the local client display
    in a full-screen text mode.

    <P>These commands are rarely used for Windows
    applications. However, they are important for the support of very
    low-end devices and are encountered if a user runs a full-screen
    DOS session from within Windows. These commands involve less data
    transfer, and thus, higher display per performance. Packets are
    sent from the server to perform the following:

    <UL>
      <LI> Set the text modes
      <LI> Write characters
      <LI> Adjust character attributes
      <LI> Scroll
      <LI> Control the cursor
    </UL>

    <P>This is implemented by :-

    <UL>
      <LI>Switching to a suitable full-screen 16 colour mode (ie that
      matches those supported by VGA cards).

      <LI>Setting the palette to the 16 colour VGA palette.

      <LI>Running the display in text (VDU 4) mode.

      <LI>Reprogramming the font according to the given DOS code page
      (which can be set by the server).
    </UL>

    <h4>3.3.3 Keyboard</h4> 

    <P>PC scan codes are transmitted from the client to the server
    application. An ICA command packet can contain multiple scan
    codes.

    <P>The RISC OS keyboard API only provides key down information
    with ASCII or internal key values. To allow key up and down events
    to be generated with the correct PS/2 scan code values the
    KeyWatch module, originally written for the NC100 project <A
    HREF="#ncos">[1]<A>, is extended to provide this extra
    information. This work is detailed in its own specification <A
    HREF="#keywatch">[2]</A>.

    <P>Each key on the keyboard is sent in its PS/2 scan code
    form. The interpretation of the keys is performed by the
      server. 

    <P>No specific mechanism is provided within the client to enter
    keys not on the keyboard (eg Windows key). However since the PS/2
    codes are reverse mapped from the Acorn internal key numbers then
    any mechanisms used to provide extra keys (eg by use of Fn keys on
    IR and portable keyboards) also provide these keys to the WinFrame
    server.

    <P>The keyboard layout in use is sent to the server on
    connection. This can be according to the user profile on the
    server or as specified. By default the RISC OS client will
    identify the keyboard layout from the configured Keyboard setting
    and send the appropriate code. This can be overridden by editing
    the ini file by hand.

    <h4>3.3.4 Mouse</h4>

    <P>The ICA command set includes commands to input the position of
    the mouse using normalized coordinates. These commands can also
    track the mouse button status.

    <P>The mouse status is polled in the main client poll loop and
      changes in state are transmitted to the server. A configuration
      entry <i>MouseTimer</i> limits how often movement only commands
      are sent.

    <P>The protocol supports up to 3 buttons.

    <h4>3.3.5 Virtual Channel Commands</h4>

    <P>The ICA protocol provides multiplexed management of multiple
    virtual channels. A virtual channel is a session-oriented
    transmission connection that can be used by application layer
    code. Virtual channels are used to add functional enhancements to
    the client, independently of the ICA protocol itself. There is a
    set of ICA Virtual Channel commands that are used to send and
    receive this ICA protocol independent data.

    <h5>3.3.5.1 Thinwire Virtual Channel</h5>

    <P>Thinwire protocol is an ICA virtual channel protocol used to
    transmit presentation commands from Windows applications running
    on the application server to the client. The Thinwire protocol is
    highly tuned for transmission of Windows object display over
    low-bandwidth connections. This is accomplished through:

    <UL>
      <LI> Command and object specific intelligent compression with state persistence, e.g. run-length encoding for bitmaps
      <LI> Outboard complex clipping and complex curve drawing,
      <LI> Intelligent caching of Windows objects, such as bitmaps, brushes, glyphs and pointers
      <LI> Remote SaveScreenBitmaps
      <LI> Cross-session persistent caching
    </UL>

    <P>Rendering of the Thinwire graphics commands is accomplished by
    the use of a library implementing a subset of the Windows GDI
    calls. These are called by the Thinwire driver to write to the
    screen. Certain portions of the thinwire driver are rewritten to
    provide better speed and more efficient use of resources with the
    RISC OS back end.

    <P>Persistent caching is configurable. The default location for
      the cache is in <CODE>&lt;Wimp$ScrapDir&gt;.ICAClient.Cache</CODE>.

    <h5>3.3.5.2 Printer Spooling Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to transmit printer
    data to a client.

    <P>Printer selection is performed under RISC OS. Whichever printer
      is selected as being active when the session is started is the
      one that is used from within the session.

    <P>There are in fact two printer protocols in use at any time. One
    primarily for use from DOS, one from Windows. Both are supported
    by the RISC OS client. For the DOS client the selected printer
    appears to be on the clients LPT0: port. For the Windows client
    then the printer appears by name in the Client Network as normal.

    <P>A file provided within the client maps from known Acorn printer
    driver names to the equivalent Windows printer driver name. This
    allows the virtual driver to automatically set up the correct
    printer for the session. If the printer configured under RISC OS
    isn't listed in this file then it is the users responsibility to
    correctly set up the printer in Windows. If the correct printer
    driver is not selected then this will result in incorrect output
    as would normally happen with an incorrectly configured printer.

    <P>This auto-mapping is only available when all of the following are true.
    <OL>
      <LI>Using the Windows protocol.
      <LI>Using a Postscript printer.
      <LI>Launching a session from an iconbar icon.
    </OL>

    <P>An alternative way of specifying the Windows driver to use is
    via the ini files.  The following option can be added to the
    server portion of an ICA file or WFClient.ini to set the driver.

    <DL>
      <DT><CODE>WindowsPrinter=<i>windows driver name</i></CODE>
      <DD>Specify the windows printer driver to be used for the
      currently selected printer. This is ignored if no printer is
      active.
    </DL>

    <h5>3.3.5.3 Drive Mapping Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to transmit file system
    functions between the WinFrame server and the client.

    <P>The file systems and drives that are exported are defined in
    the INI files for security.

    <P>The WFClient section supports the following extra commands.
    <DL>
      <DT><CODE>DrivePath1=<em>RISC OS path</em></CODE>
      <DD>What to export
      <DT><CODE>DrivePathEnabled1=[yes|no]</CODE>
      <DD>Whether this path is currently enabled
      <DT><CODE>DrivePathWriteAccess1=[yes|no]</CODE>
      <DD>Whether writing to this path is permitted.
    </DL>

    <P>As many groups of these can be given as is necessary as long as
    they are contiguous.

    <P>The RISC OS path is in one of the the following forms.

    <DL>
      <DT><CODE><em>filing system</em>::<em>drive</em>.$.<em>directory path</em></CODE>
      <DD>A fully specified directory is exported.

      <DT><CODE><em>filing system</em>::<em>drive</em></CODE>
      <DD>A given drive on a filing system is exported.

      <DT><CODE><em>filing system</em></CODE>
      <DD>All drives on the given filing system are exported. <P>The
	  following filing systems support this option
	<UL>
	  <LI>All filecore based systems
	  <LI>CDFS
	  <LI>ShareFS
	</UL>
    </DL>

    <h5>3.3.5.4 Serial Port Mapping Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to provide full duplex
    access to the client's serial ports from server applications and
    spooler.

    <P>This is not supported under RISC OS in release 1.

    <h5>3.3.5.5 Clipboard Virtual Channel</h5>

    <P>ICA includes a virtual channel protocol to provide Windows
    clipboard support, allowing users to cut and paste between server
    and client applications.

    <P>This is not supported under RISC OS in release 1.

    <h5>3.3.5.6 Audio Virtual Channel</h5>

    <P>ICA 3.5 will include a virtual channel protocol to allow audio
    generated on the server to be played on the client. This will be
      supported in future releases.

    <h3><a name="icatrans">3.4 ICA Protocol and Transport Layers</a></h3>

    <P>Beneath the ICA data packets, there are several optional
    protocol driver layers. ICA does not depend on these layers. Their
    existence and use is negotiated during the ICA handshaking that
    occurs at the start of a session. Since these layers sit below
    ICA, they can be removed or replaced. Additional protocol drivers
    can also be added. A wide range of supplied protocol modules allow
    ICA to work with all of the most prevalent transport technologies,
    such as TCP/IP, NetBIOS, IPX/SPX, and PPP/SLIP, supplying ICA true
    protocol independence.

    <P>The ICA protocol stack is dynamically configured to meet the
    needs of each transport protocol. For example, IPX is not
    reliable, so a reliable protocol driver is added above the IPX
    transport driver. However, since IPX is a frame-based protocol, a
    frame driver is not included in this particular ICA protocol
    stack. TCP, however, is a stream protocol; in this case, a frame
    driver is included. TCP is reliable, however, so this driver is
    not added to the stack.

    <P>The following diagram illustrates the ICA protocol stack and
    transport:

    <CENTER>
      <IMG SRC="pics/icastack.gif" WIDTH=350 HEIGHT=305 ALT="Protocol stack">
    </CENTER>

    <DL>
      <DT><B> Compression</B>

      <DD>The Compression protocol can encapsulate an encrypted ICA
      packet. The compression protocol is system replaceable and is
      not strictly defined in the ICA protocol definition.

	<P>The source to this driver is not included in the source
	distribution from Citrix so this functionality is not
	available in the RISC OS client.

      <DT><B> Encryption</B>

      <DD>The Encryption protocol can encapsulate an encrypted ICA
      packet. The encryption protocol is system replaceable and is not
      strictly defined in the ICA protocol definition.

	<P>The RISC OS client supports the basic encryption
	mechanism. Citrix make available a <i>Secure ICA</i> pack
	which implements better security using RSA cryptography. This
	is not available to us due to US Export controls.

      <DT><B> Reliable</B>

      <DD>The Reliable protocol is a transmission packaging protocol
      used to detect transmission errors and to request re-sends of
      data.  This protocol is used in conjunction with any transport
      mechanism that does not provide guaranteed delivery. Two such
      mechanisms are Novell's IPX and standard asynchronous
      connections.

	<P>As the RISC OS client is only implemented over TCP/IP this
	protocol driver is not necessary and so is not included.

      <DT><B> Framing</B>

      <DD>The Framing is a transmission packaging protocol used to
      manage stream-oriented communications, such as async and TCP. It
      is used in conjunction with Reliable protocol to provide an
      error-free data transmission.

	<P>The RISC OS client incorporates the RFrame protocol driver
	which provides framing for reliable transports (eg TCP/IP).

      <DT><B> Modem Control</B>

      <DD>The Modem control protocols allow for modem detection and
      initialization prior to connection.

	<P>These are not supported by the RISC OS client as it is
	assumed that an external dialler has responsibility for
	bringing a TCP/IP connection up.

    </DL>

    <H3><a name="icaext">3.5 ICA Extensibility</a></H3>

    <P>ICA is a flexible and extensible protocol. First, the protocol
    is designed to accommodate varying degrees of client
    capability. During handshaking, the ICA client communicates such
    information as screen resolution, color depth, cache size, among
    other things. The protocol then adjusts to this information. This
    communication allows for a wide variety of ICA clients, ranging
    from fixed-function monochrome terminals to high-end workstations.

    <P>Through its virtual channel architecture, ICA can be extended
    to include new data types, such as sound and video (sound in ICA
    3.0 encompasses only the system beep, video is supported only when
    performed entirely through the standard Windows graphical display
    interface). Virtual channels can also be used to support auxiliary
    client devices, such as badge readers, wands and scanners.

    <P>Finally, the very modular design of the ICA protocol allows the
    supporting layers below it to be expanded. For example, the
    existing encryption layer could be augmented with RSA or DES
    encryption. Converters, such as an ICA to X.11, can be added
    in. And new transport protocols such as ATM can easily be
    supported.

    <P>The RISC OS client is composed of one linked application, thus
    extending it with new virtual drivers or protocol modules requires
    compilation of a new application. They cannot be added at run-time
    as is possible with the Windows implementation. The extensibility
      model of the original source code is maintained however to ease
      adding new drivers.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="user"> 4.0 User interface </a> </h2>

    <UL>
      <LI><A HREF="#launch">4.1 Launching the client</A>
      <LI><A HREF="#startup">4.2 Start up</A>
      <LI><A HREF="#iconbar">4.3 Icon bar</A>
      <LI><A HREF="#connecting">4.4 Connecting</A>
      <LI><A HREF="#modes">4.5 Display modes</A>
      <LI><A HREF="#errors">4.6 Error messages</A>
      <LI><A HREF="#help">4.7 Help messages</A>
      <LI><A HREF="#mgr">4.8 Remote Application Manager</A>
    </UL>

    <H3><A NAME="launch">4.1 Launching the client</A></H3>

    <P>There are three ways of launching the ICA client.

    <OL>
      <LI>Running the application with no arguments (eg by
	double-clicking on its icon).

      <LI>Running an <a href="#icafile">ICA file</a> when the
	application is not already loaded.

      <LI>Launching an <a href="#urlscheme">ICA:</a> URL.
    </OL>

    <P>Any of these will cause the client to load and the splash
      screen to be displayed.

    <H3><A NAME="startup">4.2 Initialisation</A></H3>

    <P>The client, when loaded, first ensures that a splash
    screen, conforming to Citrix's specification, is displayed to
    the user. 

    <CENTER><IMG SRC="pics/splash.gif" WIDTH=176 HEIGHT=182></CENTER>

    <P>This is described in detail in the Citrix Agreement,
    Exhibit D. The Splash screen is displayed for a minimum of
    two seconds.

    <P>After the splash screen has been removed the client 
    continues in one of two ways depending on how it has been
    configured and launched.

    <OL>
      <LI>Place an icon on the iconbar.
      <LI>Start an immediate connection.
    </OL>

    <H4>4.2.1 Starting with icon</H4>

    <P>An icon is installed on the iconbar from where a
    connection can be made or the configure application run. The
    loaded application also picks up when ICA files are run and
    starts a server session.

    <P>In this 'persistent' mode the client stays loaded until
    explicitly quit by the user. The user can switch in and out of a
    loaded session and its state is maintained whilst it is suspended.

    <P>This is the default behaviour when the client is run directly.
    In a non-desktop environment the client should be configured to go
    into persistent non-iconbar mode if suspension of sessions is
    necessary.

    <H4>4.2.2 Immediate connection</H4>

    <P>If the client is started by running an ICA file or by use of
    the ICA: URL pseudo-scheme with a server argument then it
    immediately opens the connection to the remote server and does not
    install itself on the iconbar. If the switch out function is used
    then it quits the client immediately.

    <P>In this mode it also doesn't ensure any toolbox modules (other
    than the Toolbox itself) are loaded thus possibly using less
    memory.

    <H3><A NAME="iconbar">4.3 Icon bar functions</A></H3>

    <P>The icon bar icon has the following properties.

    <DL>
      <DT>SELECT click on icon.  

      <DD>If a session has been suspended then resume that session. If
      no session is in progress then run the Remote Application
      Manager. If it is not available then give an error.

      <DT>MENU click on icon.

      <DD>Open iconbar menu.

      <DT>ADJUST click on icon.

      <DD>Launch Remote Application Manager if available, or give an
      error.
    </DL>

    <H4>4.3.1 Icon bar menu</H4>

    <P>The icon bar menu has the following structure:-

    <DL>
      <DT>Info

      <DD>Leads to standard Info window. This info window references
	both Citrix and Acorn as authors.

      <DT>Configure...

      <DD>This runs the Remote Application Manager, a separate
      application, to edit the AppSrv and WFClient INI files. If this
      application is not available then this entry is unselectable. The
      application is available if either the system variable
      <CODE>ICAMgr$Dir</CODE> is set or the file
      <CODE>ICAClient:!ICAMgr.!Run</CODE> exists.

      <DT>Connect

      <DD>Leads to a submenu listing available servers. Choosing a
	server from this list connects in the same way as running an
	ICA file. These servers are defined in the AppSrv INI file.
	The submenu is greyed out if a session is already open.

      <DT>Resume

      <DD>Resumes a suspended session. Greyed out if no session is in progress.

      <DT>Disconnect 

      <DD>Disconnect from the current server. This brings up a
      dialogue asking if the user is sure before disconnecting. Greyed
      out if no session is in progress.

      <DT>Quit

      <DD>Quit the client. If a session is open then a warning dialogue
	is opened first as with Disconnect.
    </DL>


    <H3><A NAME="connecting">4.4 Connecting</A></H3>

    <P>When a server is selected from the menu or via an ICA file the
      connection is started. The client does the following

    <UL>
      <LI>Loads the Module, WFClient and possibly AppSrv files.
      <LI>Initialises all its components
      <LI>Resolves the host name
      <LI>Opens a connection to the server
      <LI>Enters the initial handshaking
    </UL>

    <P>A connection status box is opened when the connection process
      starts. This box gives some information about the status of the
      connection and offers a Cancel button that can be used to abort
      the transfer.

    <P>Once the handshaking is complete the client goes single-tasking
      and switches screen mode. From this point the user is within
      windows until they log out or switch out.

    <H3><A NAME="modes">4.5 Display modes</A></H3>

    <P>There are three display modes possible:-

    <OL>
      <LI>Scrolling text mode
      <P>This is the mode until a connection with the server is
	made. This enables error messages from the server to be
	displayed without any sophisticated protocol.

      <LI>Full-screen text mode 

	<P>This is used if a DOS box is started and then full-screen
	mode selected from its preferences window.

      <LI>Windows emulation mode
      <P>This is the full graphical user interface.
    </OL>

    <H4><A NAME="tv">4.5.1 Overscan support</A></H4>

    <P>When used on an NC on a TV the edges of the screen are lost due
    to the overscan mode used. A new command is added to the ini file
    that can be used in the connection section of an ICA or AppSrv
    file.

    <DL>
      <DT><CODE>OverscanMode=[<em>Yes</em>|<em>No</em>]</CODE>

      <DD>When this is set to yes then the screen margins are read
	from the ModeFiles module <A HREF="#screenmodes">[7]</A> 
	and the screen area provided to the WinFrame server takes
	into this account.
    </DL>

    <P>Note that the ICA client cannot be used on a TV with a Model 1
    NC or STB as no support for 16 bit screen modes is implemented. A
    suitable error message is displayed when session is started on
    these platforms.

    <H3><A NAME="errors">4.6 Error messages</A></H3>

    <P>Various errors are possible when initiating a connection. These
    all result in a standard RISC OS error box being displayed and the
    connection being aborted. Errors whilst in the Windows environment
    are in general ignored and an attempt to continue as best as
    possible is made.

    <P>The actual error messages are taken from the Citrix sources,
      modified where necessary to reflect the RISC OS environment.

    <H3><A NAME="help">4.7 Help messages</A></H3>

    <P>All the user interface elements are provided by a toolbox
    Res file so suitable interactive help messages are embedded there
    as usual.

    <H3><A NAME="mgr">4.8 Remote Application Manager</A></H3>

    <P>This is a separate application that edits the AppSrv and
    WFClient INI files of the client and can also be used to create
    standalone ICA files. It is a separate application to keep the
    executeable size down and so that it can easily be removed when
    the client is in use in a school environment.

    <P>The user interface is broadly the same as the equivalent
      Windows or Mac client. 
    <UL>
      <LI>A single main window holds a list of servers/applications. 
      <LI>A toolbar has buttons for adding, removing and editing
	connections.
      <LI>From the menu default choices can be made.
    </UL>

    <P>The files are always read from
    <CODE>ICAClientINI:WFClient</CODE> and
    <CODE>ICAClientINI:AppSrv</CODE>. This gives the version of the
      file in Choices if it exists or in the application if not.

    <P>The files are read when the manager starts. Any options set in
      the files which are not recognised or modified by the manager
      application are maintained when the file is saved.

    <P>Changes are automatically saved to the equivalent files within
    <CODE>&lt;Choices$Write&gt;.ICAClient.INI</CODE>. If
      &lt;Choices$Write&gt; is not set or is unwriteable then an error
      is given.

    <H4>4.8.1 Main window</H4>

    <P><IMG SRC="pics/mgr.gif" WIDTH=527 HEIGHT=183>

    <P>This window shows the available connections.
      
    <P>Clicking with SELECT selects the entry under the pointer and
      deselects all others.

    <P>Clicking with ADJUST toggles the selected state of the the
      entry under the pointer.

    <P>Double-clicking with SELECT on an entry tries to connect to
      that server.
      
    <P>Double-clicking with ADJUST on an entry opens the Edit Entry
      window.

    <P>Double-clicking with ADJUST on no entry opens the New Entry
    window.

    <H4>4.8.2 Entry window</H4>

    <IMG SRC="pics/entry.gif" WIDTH=468 HEIGHT=453>

    <P>This window allows the user to set the parameters for this
    connection.

    <P>Whilst the <i>Published application</i> button is selected the
    <i>Application</i> and <i>Working dir</i> fields are faded.

    <P>Whilst either of the <i>default</i> buttons in the screen
    section are selected then the corresponding row of buttons is
    unselectable.

    <P>The 256 colour entry is unselectable if a fully programmable
    palette is not being used (ie on pre Risc PC hardware) and the 16
    colour option is automatically chosen. Unavailable resolutions are
    unselectable and the next lowest size available is chosen instead.

    <P>Clicking on the popup menu button will bring up a list of
    available servers or published applications. This list is built by
    broadcasting on the network so there may be a delay of a few
    seconds before it opens. The application single-tasks until this
    operation is complete.

    <P>The following values in the connection section of AppSrv ini
    file are set from this window.

    <UL>
      <LI><CODE>Address</CODE>
      <LI><CODE>InitialProgram</CODE>
      <LI><CODE>WorkDirectory</CODE>
      <LI><CODE>Username</CODE>
      <LI><CODE>Password</CODE>
      <LI><CODE>Domain</CODE>
      <LI><CODE>PersistentCacheEnabled</CODE>
      <LI><CODE>DesiredHRes</CODE>
      <LI><CODE>DesiredVRes</CODE>
      <LI><CODE>DesiredColor</CODE>
    </UL>

    <H4><a name="settings">4.8.3 Settings window</a></H4>

    <IMG SRC="pics/settings.gif" WIDTH=498 HEIGHT=337>

    <P>This window allows the user to set the default screen size
    (unless overridden by connection information) and the disk cache
    location and parameters. It also allows them to clear the cache.

    <P>The 256 colour entry is unselectable if a fully programmable
    palette is not being used (ie on pre Risc PC hardware) and the 16
    colour option is automatically chosen. Unavailable resolutions are
    unselectable and the next lowest size available is chosen instead.

    <P>The following values in the WFClient ini file are set from
    this window. 

    <UL>
      <LI><CODE>DesiredHRes</CODE>
      <LI><CODE>DesiredVRes</CODE>
      <LI><CODE>DesiredColor</CODE>
      <LI><CODE>PersistentCacheSize</CODE>
      <LI><CODE>PersistentCachePercent</CODE>
      <LI><CODE>PersistentCacheMinBitmap</CODE>
      <LI><CODE>PersistentCachePath</CODE>
    </UL>


    <H4>4.8.4 Main Menu</H4>

    <DL>
      <DT>File

      <DD>Leads to the File submenu

      <DT>Entry

      <DD>Leads to the Entry submenu

      <DT>Options

      <DD>Leads to the Options Submenu

      <DT>Quit (Ctrl-F2)

      <DD>Quits the Remote Application Manager
    </DL>

    <H4>4.8.5 File Menu</H4>

    <DL>
      <DT>Copy AppSrv (Ctrl-F3)

      <DD>Leads to a standard save as dialogue box with a default name
      of AppSrv and filetype of text. This saves out the current
      server list, as would be written to the default AppSrv file, but
      to the filename specified instead. The filename is remembered
	and used next time this box is opened.

      <DT>Copy WFClient (Sh-Ctrl-F3)

      <DD>Leads to a standard save as dialogue box with a default name
      of WFClient and filetype of text. This saves out the current
      settings, as would be written to the default WFClient file, but
      to the filename specified instead. The filename is remembered
      and used next time this box is opened.
    </DL>

    <P>Note 'Copy' is used here to reinforce the fact that 'Save As'
    since the ICAMgr always edits the copies of the files in Choices
    unaffected by where copies of the files may have been saved out
    to.

    <H4>4.8.6 Entry Menu</H4>

    <DL>
      <DT>New... (Ctrl-N)

      <DD>Opens a blank Entry window to create a new entry.

      <DT>Copy (Ctrl-C)

      <DD>Creates an Entry window with a copy of the currently
	highlighted entry. When OK'd a new entry is created.

      <DT>Delete (Delete)

      <DD>Deletes the currently	highlighted entry. 

      <DT>Edit... (Ctrl-E)

      <DD>Edit the currently highlighted entry. 

      <DT>Connect (Enter)

      <DD>Connect to the server specified by the currently highlighted
      entry.

      <DT>Export ICA (Shift-F3)

      <DD>Export an ICA file containing the details specified in the
	currently highlighted entry.
    </DL>

    <H4>4.8.7 Options Menu</H4>

    <DL>
      <DT>Settings... (Ctrl-S)

      <DD>Opens the settings dialogue box.
    </DL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="programmer"> 5.0 Programmer interface </a> </h2>

    <h3>5.1 Command line switches</h3>

    <P>Various options can be given on the command line to enable
      features as follows.

    <DL>
      <DT><B><CODE>-f <i>filename</i></B></CODE> 

      <DD><i>filename</i> is an ICA file which is used to
      immediately connect to a server. Depending on the state of other
      switches the client may quit when the session finished.

      <DT><B><CODE>-i</B></CODE>
      <DD>Install an icon on the iconbar. Implies -s.

      <DT><B><CODE>-o</B></CODE>
      <DD>Once a connection has been made, never exit. If the session
	finishes restart it.

      <DT><B><CODE>-s</B></CODE>
      <DD>Allow suspend and resume. If this is set then Hotkey1 within
	an WinFrame session switches back to RISC OS, leaving the
	session suspended and able to be resumed later. If this is not
	set then Hotkey1 disconnects and quits the client.

      <DT><B><CODE>-u <i>url</i> [<i>post file</i>]</B></CODE>
      <DD><i>url</i> specifies the server to connect to. If the
	request came from a posted form then <i>post file</i> is the
	filename of a temporary file containing further arguments.

      <DT><B><CODE>-</B></CODE>
      <DD>This is a dummy argument that can be set in one of the
	Options variables to stop ICAClient from initialising it
	itself.
    </DL>

    <P>The following switches control debug output and may not do
      anything on release versions.

    <DL>
      <DT><B><CODE>-d</B></CODE>
      <DD>Output postmortem to standard error on error.

      <DT><B><CODE>-g</B></CODE>
      <DD>Log file is enabled

      <DT><B><CODE>-l &lt;logfile&gt;</B></CODE>
      <DD>Logfile to which to write log messages.

      <DT><B><CODE>-r</B></CODE>
      <DD>Remote debug output is enabled.
    </DL>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="interchange"> 6.0 Data interchange </a> </h2>

    <UL>
      <LI><A HREF="#sysvars">6.1 System variables</A>
      <LI><A HREF="#wimpmsgs">6.2 Wimp messages</A>
      <LI><A HREF="#urlscheme">6.3 URL scheme</A>
    </UL>


    <H3><A NAME="sysvars">6.1 System variables</A></H3>

    <P>The following system variables are set in the !Boot file so
      they are available before the client is run. They are also set
      identically in the !Run files.

    <DL>
      <DT><B><CODE>ICAClient$Dir</CODE></B> 

      <DD>Application directory for client. Resources directory for
      ROM builds.

      <DT><B><CODE>ICAClient$Path</CODE></B>

      <DD>Resource path for client.

      <DT><B><CODE>File$Type_AD0</CODE></B>

      <DD>File type name for ICA files (ICA).

      <DT><B><CODE>Alias$@RunType_AD0</CODE></B>

      <DD>Run type for ICA files.

      <DT><B><CODE>Alias$URLOpen_ICA</CODE></B>

      <DD>Run type for <CODE>ica:</CODE> URL pseudo-scheme.
    </DL>

    <P>The following system variables are set by the ICAMgr !Boot and
      !Run files. 
      
    <DL>
      <DT><B><CODE>ICAMgr$Dir</CODE></B> 

      <DD>Application directory for Remote Application Manager.

      <DT><B><CODE>ICAMgr$Path</CODE></B>

      <DD>Resource path for Remote Application Manager.
    </DL>

    <P>The following system variables can be overridden by the
      user. If they are set before the client is run then the given
      values are used rather than the client defaults.

    <DL>
      <DT><B><CODE>ICAClientINI$Path</CODE></B>

      <DD>Path for in-built INI files. Can be used to override
      defaults when the application is in ROM or a read-only
      partition/mount.  <P>If Choices$Path exists then it Defaults to
      <CODE>Choices:ICAClient.INI.,<WBR>ICAClient:INI.</CODE> otherwise
	  to <CODE>ICAClient:INI.</CODE>.

      <DT><B><CODE>ICAClient$Options</CODE></B>

      <DD>Can give command line options to be used when client
	starts. <P>Defaults to empty.

      <DT><B><CODE>ICAClient$FileOptions</CODE></B>

      <DD>Command line options to be used when client starts with a
	file given as an argument.
	<P>Defaults to empty.

      <DT><B><CODE>ICAClient$NoFileOptions</CODE></B>

      <DD>Command line options to be used when client starts with no
	file given as an argument. 

	<P>Defaults to <CODE>-i</CODE>.

      <DT><B><CODE>ICAClient$ClientName</CODE></B>

      <DD>If set then this is the name for this client sent to the
      server on connection.

      <DT><B><CODE>ICAClient$Errors</CODE></B>

      <DD>Redirection of standard error output. 
	<P>Defaults to <CODE>2&gt;&nbsp;null:</CODE>.
    </DL>

    <P>The following system variables are referenced by the client but
      should never be set by it.

    <DL>
      <DT><B><CODE>Inet$HostName</CODE></B>

      <DD>Name sent to the server on connection for this client if
	<CODE>ICAClient$ClientName</CODE> is not set.

      <DT><B><CODE>Choices$Write</CODE></B>

      <DD>When the Remote Application Manager edits ini files they are
	saved back into
	<CODE>&lt;Choices$Write&gt;.ICAClient.INI</CODE> rather than
	into the application.
    </DL>

    <H3><A NAME="wimpmsgs">6.2 Wimp Messages</A></H3>

    <P>The ICA client broadcasts various messages when
      connecting/disconnecting etc to allow other tasks to provide
      suitable user feedback. It can also be controlled via messages
      so that all configuration and user interface details can be
      performed externally.

    <H4>6.2.1 Status Messages</H4>

    <P>The format of the status messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f80	(message_WINFRAME_STATUS)
	+20 = reason
	+24 = flags
    </PRE>

    <P>They are all for information only.

    <H5>6.2.1.1 ICAClient Starting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 0		(winframe_STATUS_STARTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client runs so that other
      tasks can record the task handle for future use if they wish.


    <H5>6.2.1.2 ICAClient Quitting</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_STATUS_QUITTING)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>This message is broadcast when the client is about to
    quit. Note that it will be dead by the time that any task receives
    the message.

    <H5>6.2.1.3 ICAClient Connected</H5>

    <PRE>
	 +0 = 72	(message size)
	+20 = 2		(winframe_STATUS_CONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
	+32 = server description
    </PRE>

    <P>This message is broadcast when the client has successfully
      connected to a WinFrame server. 

    <P>The server description is as set in the [ApplicationServers]
    section of the ICA file, is null-terminated, and is a maximum of
    40 characters (including terminator) long. If no description was
      available then the server host name is used, failing that a
      string version of the IP address.

    <P>Note in the current implementation this message may not be
    received by another task until the client suspends or disconnects.


    <H5>6.2.1.4 ICAClient Suspended</H5>

    <PRE>
	 +0 = 68	(message size)
	+20 = 3		(winframe_STATUS_SUSPENDED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client is suspended by the
      user switching back to the RISC OS desktop environment.

    <H5>6.2.1.5 ICAClient Disconnected</H5>

    <PRE>
	 +0 = 68	(message size)
	+20 = 4		(winframe_STATUS_DISCONNECTED)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>This message is broadcast when the client disconnects from the
      ICAClient server.

    <H4>6.2.2 Control Messages</H4>

    <P>The format of the control messages is as follows

    <PRE>
	 +0 = size
	+12 = 0		(never a reply)
	+16 = 0x50f81	(message_WINFRAME_CONTROL)
	+20 = reason
	+24 = flags
    </PRE>

    <P>Any control message is immediately replied to with a
    CONTROL_ACK message that says whether the requested action is
    being performed or not. Note that just because an action is taken
    doesn't mean that it will be completed successfully. Status
    messages must be monitored to determine exactly what the state of
      the client is.

    <H5>6.2.2.1 ICAClient Connect</H5>

    <PRE>
	+20 = 0		(winframe_CONTROL_CONNECT)
	+24 = flags
		bits 0,1: 
			0 = use server description
			1 = use server name
			2 = use ICA file
			3 = reserved
		bit 2: 1 = delete ICA file when finished
		bits 3-31: reserved

	if bits 0,1 = 0
		+28 = server description
	if bits 0,1 = 1
		+28 = server name
	if bits 0,1 = 2
		+28 = filename of ICA file
    </PRE>

    <P>Ask the client to connect to the given host. 

    <P>A server description is upto 40
    characters and must match a description in the AppSrv INI file.

    <P>The server name is a host name or IP address of upto
      40 characters.

    <P>The ICA file name is a maximum of 228
    characters and can be either a permanent file or a temporary
    one. If flags bit 2 is set then when it is no longer needed (which
    will normally be when the session finishes) the file is deleted.

    <P>All string lengths include a terminating null character.

    <H5>6.2.2.2 ICAClient Reconnect</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_RECONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to reconnect to the session it has suspended. It
      is an error if it is not currently suspended.

    <H5>6.2.2.3 ICAClient Disconnect</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_DISCONNECT)
	+24 = 0		(flags all reserved)
	+28 = session handle
    </PRE>

    <P>Ask the client to disconnect from the given server. It is an
      error if the server is not connected.

    <H5>6.2.2.4 ICAClient Quit</H5>

    <PRE>
	 +0 = 28	(message size)
	+20 = 1		(winframe_CONTROL_QUIT)
	+24 = 0		(flags all reserved)
    </PRE>

    <P>Ask the client to quit. It refuses to die if it still has
      open sessions.

    <H4>6.2.2 Control Ack Messages</H4>

    <P>The format of the control ack messages is as follows

    <PRE>
	+12 = ref	(my_ref from CONTROL message)
	+16 = 0x50f82	(message_WINFRAME_CONTROL_ACK)
	+20 = reason	(reason code  of control message)
	+24 = flags
	     bit 0: 1 = control message succeeded
		    0 = control message failed
	+28 = session handle (CONNECT, RECONNECT and DISCONNECT)
	+32 = error number (not a RISC OS error number)
	+36 = error message (to +256)
    </PRE>


    <H3><A NAME="urlscheme">6.3 URL scheme</a></H3>

    <P>For greater flexibility in the NC environment, the client
    supports a level of control via a URL scheme. Note that
    more control is available through the messages and the ICA files
    and these should be used where possible.

    <P>The client supports both the ANT URL protocol <A
    HREF="anturl">[3]</A> and the Acorn URI protocol <A
    HREF="acornuri">[4]</A>.

    <P>The format of the URL expected is as follows. Optional
      sections are within square brackets

    <P><CODE>ica:[//<i>server name</i>][/<i>server description</i>][?<i>arg1</i>[&<i>arg2</i>]...]</CODE>

    <DL>
      <DT><B><i>server name</i></B> 

      <DD>A name or IP address of a server (the Address field of an
      ICA file).

      <DT><b><i>server description</i></b> 

      <DD>As listed in the ApplicationServers section of the AppSrv
      ini file.

      <DT><b><i>argN</i></b> 

      <DD>A <i>name=value pair</i> that can be used to set
	any of the allowed fields in the server section of an ICA
	file.

	<P>A special argument of <i>PassClear</i> can be used to pass
	  in an unencrypted password. The normal <i>Password</i> entry
	  must be given an encrypted password as generated by the
	  remote application manager.
    </DL>

    <P>The server name and the args both override the details in
      the AppSrv file. The server name takes precedence if an
      Address arg is given also.
	
      <P>e.g. <CODE>ica:/Test%20Server?username=simon&password=00012jha987sdosd</CODE>
	would use the connection details of the "Test Server" entry
	overridden with the given name and password. Note that the
	space character has to be escaped in the usual manner for URLs.

    <P>e.g  <CODE>ica:?address=nc-nt</CODE> or
      <CODE>ica://nc-nt/</CODE> would log on to the
      server whose name was nc-nt whatever was in the AppSrv file.

    <P>
      <!-- ======================================================================= --> 

    <hr  noshade>
    <h2> <a name="formats"> 7.0 Data formats </a> </h2>

    <H3>7.1 INI files</H3>

    <P>Configuration of the ICA Client is performed with Windows style
    INI files. These are chosen because the code is provided to handle
    reading these files and also the configuration file that is
    fetched over the web to initiate a plugin instance is formatted as
    an INI file.

    <P>There are three INI files. They are stored in an INI directory
    within the ICA Client application with their extensions removed.

    <P>An INI file is a plain text files, one item to a line,
    line-ending unspecified. There are four sorts of lines.

    <OL>
      <LI>Blank lines. Contain nothin but whitespace.
      <LI>Comment lines. Start with a semicolon.
      <LI>Section headings. The contents of the line are enclosed
	within square brackets.
      <LI>Options. Consist of <i>name</i> = <i>value</i>. The value is
	optional but the name and equality sign must be present.
    </OL>

    <H4>7.1.1 MODULE.INI</H4>
    
    <P>This INI file has two main uses. Firstly it contains details of
    what components of the system are available. Secondly it contains
    general defaults for all the components which can be overridden on
    the command line or by other INI files. This should never be
      changed for any given release.

    <H4>7.1.2 WFCLIENT.INI</H4>

    <P>This file contains general parameters to override those in the
    MODULE.INI file. These can be set from the <a
    href="#settings">Settings window</a> in the <a href="#mgr">Remote
    Application Manager</a>.

    <H4>7.1.3 APPSRV.INI</H4>

    <P>This file contains a list of known application servers. The
    servers in this file can be referenced by name from the icon bar
    menu and via the CONNECT control message.  Each server listing can
    contain overrides to any of the parameters in the MODULE.INI file.

    <P>It also contains overrides for UI values in WFCLIENT.INI

    <P>It is not used if a connection is made with an ICA file.


    <H3><A NAME="icafile">7.2 ICA file type</A></H3>

    <P>A new filetype ICA (0xAD0) is allocated. This corresponds to the
    MIME type <CODE>application/x-ica</CODE>. Running an ICA file runs
    the ICA Client application, connecting immediately to the server
    given in the file.

    <P>The ICA file format is as for the INI files described in
      section 7.1.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="external"> 8.0 External dependencies </a> </h2>

    <P>There are no external dependencies.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="acceptance"> 9.0 Acceptance test </a> </h2>

    <H3>9.1 Acceptance criteria</H3>

    <P>Before allowing release of the software, the following conditions will be met;	

    <UL>
      <LI>The level of recorded unfixed faults in the Fault Database
      is deemed to be acceptable. No urgent or high priority bugs
      should be remaining.

      <LI>The majority of trial sites are operating successfully and
      are happy. This will be quantified using a check-list.

      <LI>The product audit is complete with an acceptable
      report. (Approx 4 man weeks audit time).

      <LI>Xemplar technical support specialists explicitly give the go
      ahead.
	
      <LI>Relevant Acorn SQA, Workstation and Consultancy
      representatives confirm its suitability for release on the
      available evidence.
    </UL>

    <P>Citrix currently have no requirement for any audit of the software.

    <H3>9.2 Performance Targets</H3>

    <P>The performance of ICA-3 is mostly independent of the
    implementation, and is governed by network access performance
    and server load.

    <P>However, it is important that our implementation performs as
    least as well as equivalent PC platforms, and that no additional
    bottlenecks are apparent.

    <P>From a user's perspective, a cluster of approximately 10
    clients accessing a server via an Ethernet network should feel
    close to the responsiveness of a low-medium performance PC running
    the applications natively. Over a modem connection, typical word
    processing type applications where response to keyboard and mouse
    activity is paramount, the system should be responsive and not
    suffer from significant delays caused by client porting
    architectural issues.


    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="noncompliances"> 10.0 Non compliances </a> </h2>

    <P>The following are the major differences between the RISC OS and
      Windows ICA clients.

    <UL>
      <LI>Only runs full screen.
      <LI>Only runs one session at a time.
      <LI>Only supports TCP/IP transport.
      <LI>Doesn't include Compression Protocol Driver.
      <LI>Secure ICA add-on is not available.
      <LI>Hardware mouse cursor is used limiting cursor images to 2
	colours.
      <LI>No support for serial or clipboard virtual drivers in
	release 1.
    </UL>

    <P>The following are examples of Windows applications that will
      not work well with the client.

    <UL>
      <LI>Any program that bypasses the standard Windows drawing
      routines. eg one that directly accesses video memory or uses a
      interface such as OpenGL or DirectX.

      <LI>Any program that relies on audio.
    </UL>

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="test"> 11.0 Development test strategy </a> </h2>

    <P>Initial development testing will utilise Acorn House WinFrame
    NT Servers running on the House Net. It may be advantageous to use
    a sub-net, in order that packet monitoring can be performed
    without being swamped by unrelated traffic.  It is hoped that it
    will not be necessary to use isolated servers and clients as the
    network layer will be largely unaffected. A PC running Citrix
    released code will be used as a comparison.
      
    <P>Testing of the product will make heavy use of trial sites, for
    it is the integration of the many components in a variety of
    different network environments that are the most difficult to
    predict and test. These sites will include Xemplar identified
    ones, other mixed school sites and other third parties where
    WinFrame products are in use. We may seek such reference sites
    from Citrix. Site visits to each of the major sites will be made
    to check the installation and operation of the software.

    <P>A formal audit of the software will be made, in conjunction with
    the explicit and directed testing that will be undertaken during
    the Beta phase of the project. Specifically, the Audit will also
    focus on 'out of the box' consistency and useability, installation
    and operation with a variety of common machine types and
    configurations, and software/documentation consistency, as well as
    reliability and functionality.

    <P>
      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="organisation"> 12.0 Product organisation </a> </h2>

    <UL>
      <LI><A HREF="#targets">12.1 Target Platforms</A>
      <LI><A HREF="#userguide">12.2 User Guide</A>
      <LI><A HREF="#discorg">12.3 Disc organisation</A>
      <LI><A HREF="#romversion">12.3 ROM organisation</A>
      <LI><A HREF="#standalone">12.4 Standalone version</A>
      <LI><A HREF="#build">12.5 Build organisation</A>
    </UL>

    <h3><a name="targets">12.1 Target Platforms</a></h3>

    <P>Acorn is contractually obliged to supply the ICA client
    software on all future releases of RISC OS, except in
    circumstances where it would clearly be inappropriate. As a
    ROMable RISC OS application, it will therefore be included as
    part of the standard build, in STBs, NCs and Desktop machines. 

    <P>The application will be released in standalone form to enable
    existing platforms to take advantage of this technology. 

    <P>ICA-3 does not consume very significant processor resources or
    memory. It is recommended that the following footprint is
    specified as a minimum:

    <UL>
      <LI>7500FE processor or equivalent.
      <LI>2 MBytes free RAM for execution, including any cache area.
      <LI>300Kbytes of ROM space.
      <LI>VGA monitor.
    </UL>

    <P>The software relies on a working TCP/IP network stack being
    installed and configured. This project only uses TCP/IP; any
    other stack eg NetBEUI or ATM will be considered as a future
    development.


    <H3><a name="userguide">12.2 User Guide</a></H3>

    <P>A user manual will be supplied with every copy of RISC OS
    shipped, be this direct from Acorn, or via a third party. This
    documentation will draw heavily on copy produced by Citrix, but be
    converted into suitable house style.


    <H4>12.3 Application disc organisation</H4>

    <P>The application structure on disc is as follows. It lives in
      the Apps directory of the hard disc.

    <PRE>
!ICAClient
	!Boot			obey
	!Help			text
	!Run			obey
	!RunImage		absolute
	!Sprites		sprite
	!ICAMgr
		!Boot		obey
		!Run		obey
		!RunImage	absolute
		Res		res
		Sprites		sprite
	EnsureTB		obey
	KeyWatch		module
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text

    </PRE>

    <P>The ICAMgr application saves the edited AppSrv file out 
      as follows.
    <PRE>
&lt;Choices$Write&gt;.ICAClient.INI
	AppSrv			text
	WFClient		text
    </PRE>


    <H3><a name="romversion">12.4 ROM organisation</a></H3>

    <P>The application structure when in ROM is as follows. Note the
      ICAMgr application is not included.

    <PRE>
$.Apps.!ICAClient
	!Boot			obey
	!Help			text
	!Run			obey
	!Sprites		sprite

$.Resources.ICAClient
	EnsureTB		obey
	Messages		text
	Res			res
	Splash			sprite
	ini
		AppSrv		text
		Module		text
		WFClient	text
    </PRE>

    <P>The requirements for the ROM are as follows.

    <OL>
      <LI>KeyWatch module version 0.04 or greater (this is an upgrade
      to that provided in NC 2).

      <LI>!ICAClient module.

      <LI>Latest MimeMap file if !NCFresco is included. 

      <LI>Internet stack (version 4 or version 5).
    </OL>

    <H3><a name="standalone">12.4 Standalone version</a></H3>

    <P>Although not covered by the agreement between Acorn and Citrix,
    Acorn will ship a standalone version of the software, complete
    with the documentation above. This will take the form of an A5
    style wallet containing disc, installation instructions and
    manual.

    <P>For RISC OS 3.1, RISC OS 3.5, RISC OS 3.6, RISC OS 3.7, RISC OS
    3.71 and RISC OS 3.8 this will comprise the !ICAClient and !ICAMgr
    applications, a new style !Boot structure as developed for
    Expresso/Ursula and an Installer containing the latest versions of
    the toolbox modules. These will be placed on an ADFS F format disc.

    <P>For NC OS 1.06/1.1 licensees a pack containing a tar file of
    the ICAClient application and example connection scripts will be
    provided via the usual support channels. If this needs to be on
    floppy disc then a high density MSDOS disc will be used.

    <H3><a name="build">12.5 Build organisation</a></H3>

    <P>The ICAClient sources are part of the renaissa CVS build tree at
    <CODE>RiscOS/Sources/Apps/Citrix/WinStation/</CODE>. They are
    cross-compiled under solaris and resulting ROM binaries are
      checked into 
    <CODE>RiscOS/Sources/Apps/Citrix/WinFrameRO/</CODE> for importing
      into the build process.
    <P>

      <!-- ======================================================================= -->


   <hr  noshade>
    <h2> <a name="enhancements"> 13.0 Future enhancements </a> </h2>

    <P>Phase 2 of the client development will start as soon as phase 1
    is finished and will complete the virtual driver support missing
    from releaase 1 and update the client with the ICA 3.5 sources
    from Citrix. This is expected to add audio support and 
    performance improvements.
    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="glossary"> 14.0 Glossary </a> </h2>

    <DL>
      <DT>Async    <DD>A serial based transport layer
      <DT>GDI      <DD>Graphical Device Interface.
      <DT>ICA      <DD>Independent Computing Architecture.
      <DT>ICA client <DD>Software that implements the client end of the ICA protocol.
      <DT>ICA protocol <DD>The fundamental data channel organisation.
      <DT>LAN      <DD>Local Area Network.
      <DT>STB      <DD>Set Top Box.
      <DT>Thinwire <DD>Graphics protocol that runs over ICA.
      <DT>WAN      <DD>Wide Area Network.
      <DT>WinFrame <DD>The server package that implements ICA.
    </DL>
    <P>

      <!-- ======================================================================= -->

    <hr  noshade>
    <h2> <a name="references"> 15.0 References </a> </h2>

    <DL>
      <DT>[1] <A NAME="ncos">NC OS version 1.15. On Screen Keyboard
	  Functional Specification</A>
      <DD>Document 2107,738

      <DT>[2] <A NAME="keywatch">KeyWatch Module Functional
	  Specification<A>
      <DD><A HREF="keywatch.html">Document 1215,501</A>

      <DT>[3] <A NAME="anturl">ANT Ltd. URL broadcast mechanism</A>
      <DD><A HREF="anturl.html">Version dated 14 Feb 97</A>

      <DT>[4] <A NAME="acornuri">Acorn URI Handler Functional Specification</A>
      <DD><A
	  HREF="http://www.acorn.com/browser/uri/funcspec.html">Document 1215,215/FS, Issue 1.</A>

      <DT>[5] <A NAME="icaspec">Intelligent Console Architecture ICA 3.0</A>
      <DD>Revision 3.1 - May 14, 1996.

      <DT>[6] <A NAME="icasource">Windows Client Source V1.7</A>
      <DD>CD ROM: Build i324 10/01/97.

      <DT>[7] <A NAME="screenmodes">ModeFiles module</A>
      <DD>Document 2103,732 - Miscellaneous OS Software Functional Specification
    </DL>

      <!-- ======================================================================= -->

    <hr>
    <h2> <a name="history"> 16.0 History </a> </h2>

    <PRE>
$Log$
Issue E		SJM   25th March 1998     more details on Printer and Drive config
					  plus overscan support.
Issue D		SJM   20th March 1998     Updated after comments from CW.
Issue C		SJM   10th March 1998     Rewrote in HTML and brought up to date.
Issue B 	MNS    2nd December 1997  Comments from CAW incorporated.
Issue A		MNS   12th November 1997  Initial version
    </PRE>

    <hr>
    <P>

    <TABLE BORDER=1 WIDTH="100%">
      <TR>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    This document is issued under license and must not be copied, reproduced
	    or disclosed in part or whole outside the terms of the license.
	  </SMALL>
	<TD WIDTH="50%" VALIGN=TOP>
	  <SMALL>
	    &#169; Acorn Computers Ltd 1997
	  </SMALL>
    </TABLE>

    <HR>
    <address><a href="mailto:smiddleton@acorn.com">Simon Middleton</a></address>
<!-- Created: Wed Dec  3 17:30:52 GMT 1997 -->
<!-- hhmts start -->
Last modified: Wed Mar 25 10:34:14 GMT 1998
<!-- hhmts end -->
  </body>
</html>
