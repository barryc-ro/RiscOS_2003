/************************************************************************/
/* File:    PopUp.c                                                     */
/* Purpose: Code relating to popup dialogue boxes.                      */
/*                                                                      */
/* Author:  Neil Bingham <mailto:nbingham@acorn.com>                    */
/* History: 0.01  Mon 05th October 1998                                 */
/*                Created.                                              */
/************************************************************************/


/* -------------------------------------- LIBRARY IMPORTS --------------------------------------- */
#include "PopUp.h"


/* ---------------------------------- PRE-PROCESSOR DIRECTIVES ---------------------------------- */


/* -------------------------------------- GLOBAL VARIABLES -------------------------------------- */


/* ----------------------------------------- FUNCTIONS ------------------------------------------ */

/************************************************************************/
/* popup_message_received                                               */
/*                                                                      */
/* Function is called when the library receives an ncmail: message from */
/* a PopUp box.                                                         */
/*                                                                      */
/* Parameters: num_args - number of arguments passed in arg.            */
/*             arg      - list of the name= & value= bits from the HTML */
/*                                                                      */
/* Returns:    TRUE.                                                    */
/*                                                                      */
/************************************************************************/
bool popup_message_received(int num_args, url_param *  arg)
{
  uint32	 counter;

  dprintf(("UI", "WE RECEIVED A POPUP URL MESSAGE!!!!\n"));

  for (counter = 0; counter < num_args; counter++)
  {
    if (nb_case_insensitive_strcmp(arg[counter].name, PopUp_OK) == 0)
    {
      dprintf(("UI", "User clicked on OK\n"));
    }
    else if (nb_case_insensitive_strcmp(arg[counter].name, PopUp_Cancel) == 0)
    {
      dprintf(("UI", "User clicked on Cancel\n"));
    }
  }
  return(true);
}




/* ============================================================================================== */
/* ==================================== POPUP NO BUTTON CODE ==================================== */
/* ============================================================================================== */

/************************************************************************/
/* popup_open_dialogue                                                  */
/*                                                                      */
/* Function is called to open a Popup dialogue with no buttons.         */
/*                                                                      */
/* Parameters:                                                          */
/*                                                                      */
/* Returns:                                                             */
/*                                                                      */
/************************************************************************/
bool popup_open_dialogue(char *text)
{
  bool		 rc = false;

  rc = parser_parse_file(PageType_PopUp, Template_PopUp, Generated_PopUp, text);

  if (rc == true)
  {
    if (browserif_sendurl(Open_PopUp, true) == false)
    {
      ncmui_error_display(25);
      /* We are screwed.  */
      error_parser_failed();
    }
    return(true);
  }
  else
  {
    ncmui_error_display(24);
    dprintf(("", "State: %d\n", status.state));
    error_parser_failed();
    return(false);
  }
}


/* ============================================================================================== */
/* ===================================== PAGE BUILDING CODE ===================================== */
/* ============================================================================================== */

/************************************************************************/
/* popup_active_comment_found                                           */
/*                                                                      */
/* Function is called when the UI page type is PopUp & an active comment*/
/* is found in the web page being parsed.                               */
/*                                                                      */
/* Parameters:                                                          */
/*                                                                      */
/* Returns:                                                             */
/*                                                                      */
/************************************************************************/
void popup_active_comment_found(char *comment, FILE *out, char *text)
{
  if (nb_case_insensitive_strcmp(comment, PopUp_AC_Body) == 0)
  {
    fprintf(out, "%s\n", text);
  }
  /* Not a known tag */
  else
  {
    ncmui_error_display(23);
#ifdef DEBUGLIB
    fprintf(out, "<H1>Unknown tag '%s' received</H1><BR>\n", comment);
#endif
  }
}
