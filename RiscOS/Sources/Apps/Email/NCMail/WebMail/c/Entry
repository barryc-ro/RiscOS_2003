/************************************************************************/
/* File:    Entry.c                                                     */
/* Purpose: Code relating to entering the email client.                 */
/*                                                                      */
/* Author:  Neil Bingham <mailto:nbingham@acorn.com>                    */
/* History: 0.01  Wed 23rd September 1998                               */
/*                Created.                                              */
/************************************************************************/


/* -------------------------------------- LIBRARY IMPORTS --------------------------------------- */
#include "Entry.h"

/* ---------------------------------- PRE-PROCESSOR DIRECTIVES ---------------------------------- */


/* -------------------------------------- GLOBAL VARIABLES -------------------------------------- */


/* ----------------------------------------- FUNCTIONS ------------------------------------------ */

/************************************************************************/
/* entry_message_received                                               */
/*                                                                      */
/* Function is called when the library receives an ncmail: message from */
/* the either NCFresco directly or from the splash web page.            */
/*                                                                      */
/* Parameters: num_args - number of arguments passed in arg.            */
/*             arg      - list of the name= & value= bits from the HTML */
/*                                                                      */
/* Returns:    TRUE.                                                    */
/*                                                                      */
/************************************************************************/
bool entry_message_received(int num_args, url_param *  arg)
{
  int		 counter, count2;

  dprintf(("UI", "WE RECEIVED AN ENTRY REQUEST URL MESSAGE!!!!\n"));

  /* Lock the UI now, but don't check for a prior lock as it will be locked */
  status.ui_locked = true;

  for (counter = 0; counter < num_args; counter++)
  {
    if (nb_case_insensitive_strcmp(arg[counter].value, Entry_Link) == 0)
    {
      for (count2 = 0; count2 < num_args; count2++)
      {
        if (nb_case_insensitive_strcmp(arg[count2].name, Entry_Value) == 0)
        {
          entry_start_email_selected(arg[count2].value);
        }
      }
    }
  }
  return(true);
}


/************************************************************************/
/* entry_start_email_selected                                           */
/*                                                                      */
/* Function is called when we get a valid enter email request.  Must    */
/* then store the URL passed as a parameter so that we can return there */
/* when the user quits the email client.                                */
/*                                                                      */
/* Parameters: url  - URL to return to.  Could be Splash screen or      */
/*                    anywhere on the web.                              */
/*                                                                      */
/* Returns:    void.                                                    */
/*                                                                      */
/************************************************************************/
void entry_start_email_selected(char *url)
{
  dprintf(("UI", "entry_start_email_selected entered\n"));
  dprintf(("UI", "URL is: %s\n", url));

  if ((status.exit_url= malloc(strlen(url) +5)) == NULL)
  {
    dprintf(("UI", "ERROR: Not enough memory to store URL upon entering email client.\n"));
  }
  else
  {
    strcpy(status.exit_url, url);

    /* Now inform the engine that we are active, unlock the UI, and render the inbox */
    status.ui_locked = false;
    eng_email_active(true);
    inbox_build_screen();
  }
}

