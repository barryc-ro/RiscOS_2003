/************************************************************************/
/* File:    Entry.c                                                     */
/* Purpose: Code relating to entering the email client.                 */
/*                                                                      */
/* Author:  Neil Bingham <mailto:nbingham@acorn.com>                    */
/* History: 0.01  Wed 23rd September 1998                               */
/*                Created.                                              */
/************************************************************************/


/* -------------------------------------- LIBRARY IMPORTS --------------------------------------- */
#include "Entry.h"

/* ---------------------------------- PRE-PROCESSOR DIRECTIVES ---------------------------------- */


/* -------------------------------------- GLOBAL VARIABLES -------------------------------------- */


/* ----------------------------------------- FUNCTIONS ------------------------------------------ */

/************************************************************************/
/* entry_message_received                                               */
/*                                                                      */
/* Function is called when the library receives an ncmail: message from */
/* the either NCFresco directly or from the splash web page.            */
/*                                                                      */
/* Parameters: num_args - number of arguments passed in arg.            */
/*             arg      - list of the name= & value= bits from the HTML */
/*                                                                      */
/* Returns:    TRUE.                                                    */
/*                                                                      */
/************************************************************************/
bool entry_message_received(uint32 num_args, url_param *  arg)
{
  int		 counter;

  for (counter = 0; counter < num_args; counter++)
  {
    if (nb_case_insensitive_strcmp(arg[counter].name, Entry_Link) == 0)
    {
      entry_start_email_selected(arg[counter].value);
    }
  }
  return(true);
}


/************************************************************************/
/* entry_start_email_selected                                           */
/*                                                                      */
/* Function is called when we get a valid enter email request.  Must    */
/* then store the URL passed as a parameter so that we can return there */
/* when the user quits the email client.                                */
/*                                                                      */
/* Parameters: url  - URL to return to.  Could be Splash screen or      */
/*                    anywhere on the web.                              */
/*                                                                      */
/* Returns:    void.                                                    */
/*                                                                      */
/************************************************************************/
void entry_start_email_selected(char *url)
{
  if (status.exit_url != NULL)
  {
    /* We have a problem.  Something is already stored in the status struct. */
    dprintf(("UI", "ERROR: Entering email client, but status.exit_url already contains data\n"));
  }
  else
  {
    if ((status.exit_url= malloc(strlen(url) +5)) == NULL)
    {
      dprintf(("UI", "ERROR: Not enough memory to store URL upon entering email client.\n"));
    }
    else
    {
      strcpy(status.exit_url, url);

      /* Now render the inbox */
      inbox_build_screen();
    }
  }
}

