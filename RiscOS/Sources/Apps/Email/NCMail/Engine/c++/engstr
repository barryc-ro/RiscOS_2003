/*
** Email Engine
** String and variable routines
*/

#include "string.h"
#include "ctype.h"
#include "kernel.h"
#include "swis.h"
#include "stdlib.h"

#include "DebugLib/DebugLib.h"

#include "engtypes.h"
#include "enginit.h"

/*
** LeftString() compares the first len characters of s1 with s2,
** ignoring case, and returns a boolean result.
** If len==0, whole string is compared.
*/

bool LeftString(char *s1, char *s2, int len)
{

  int i;

  if (!len)
  {
    int l1 = strlen(s1), l2 = strlen(s2);
    len = (l2 > l1) ? l2 : l1;
  }
  for (i = 0; i < len; i++)
  {
    if (tolower(s1[i]) != tolower(s2[i]))
      return false;
  }

  return true;

}


/*
** StringLength() gets the length of a string
** which may not be null-terminated
*/


int StringLength(char *s)
{
  
  char *i;
  
  for (i = s; *i > 31; i++);
  
  return i - s;

}


char *GetSysVar(char *var)
{

  char *ptr;

  regs.r[0] = (int) var;
  regs.r[1] = 0;
  regs.r[2] = -1;
  regs.r[3] = 0;
  regs.r[4] = 0;
  _kernel_swi(OS_ReadVarVal,&regs,&regs);
  if (regs.r[2] == 0)
    return 0;

  regs.r[2] = -regs.r[2];
  if ((ptr = malloc(regs.r[2])) == 0)
    return 0;
  regs.r[0] = (int) var;
  regs.r[1] = (int) ptr;
  regs.r[3] = 0;
  regs.r[4] = 0;
  _kernel_swi(OS_ReadVarVal,&regs,&regs);
  ptr[regs.r[2]] = 0;

  return ptr;

}
