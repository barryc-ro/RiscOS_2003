/*
** Email Engine
** Message trans
*/

#include "kernel.h"
#include "string.h"
#include "swis.h"

#include "tboxlibs/toolbox.h"

#include "DebugLib/DebugLib.h"

#include "enginit.h"
#include "engtypes.h"

#ifdef MemCheck_MEMCHECK
  #include "MemCheck:MemCheck.h"
#endif

MessagesFD infobuf;

char *ReadToken(char *tok)
{

  regs.r[0] = (int) &infobuf;
  regs.r[1] = (int) tok;
  regs.r[2] = 0;
  regs.r[4] = 0;
  regs.r[5] = 0;
  regs.r[6] = 0;
  regs.r[7] = 0;
  if ((err = _kernel_swi(MessageTrans_Lookup,&regs,&regs)) != 0)
    return 0;

#ifdef MemCheck_MEMCHECK
  MemCheck_RegisterMiscBlock((char*)regs.r[2], regs.r[3]+1);
#endif
  
  *((char *)(regs.r[3] + regs.r[2])) = 0;
  return (char *) regs.r[2];

}
