/*
** Email Engine
** File routines
*/

#include "kernel.h"
#include "swis.h"
#include "string.h"

#include "DebugLib/DebugLib.h"

#include "engtypes.h"
#include "enginit.h"
#include "engfile.h"

/*
** SetFilename() sets the filename to be used to store a message.
** The name is "NCMailStore:M" plus the message ID.
** If the boolean t is set, a "t" is appended to the name
** as this is a temporary file (e.g. to store headers).
*/

void SetFilename(uint32 id, bool t)
{

  sprintf(msgfilename, "NCMailStore:M%d%s\0", id, (t) ? "t" : "");

}


uint32 GetFileLength(char *p)
{

  regs.r[0] = 17;
  regs.r[1] = (int) p;
  _kernel_swi(OS_File,&regs,&regs);

  return regs.r[4];

}


bool FileExists(char *f)
{

  regs.r[0] = 17;
  regs.r[1] = (int) f;
  _kernel_swi(OS_File, &regs, &regs);

  return (bool) (regs.r[0] != 0);

}


void SetAttribs(char *f, char *attr)
{

  if (FileExists(f))
  {
    regs.r[0] = 24;
    regs.r[1] = (int) f;
    regs.r[2] = (int) attr;
    _kernel_swi(OS_FSControl,&regs,&regs);
  }

}


void UnlockFile(char *f)
{
  
  SetAttribs(f, "WR");

}


void LockFile(char *f)
{
  
  SetAttribs(f, "LWR");

}


void MakeFilePublic(char *f)
{
  
  SetAttribs(f, "WR/wr");

}


void CreateDirectory(char *s)
{
  
  regs.r[0] = 8;
  regs.r[1] = (int) s;
  _kernel_swi(OS_File,&regs,&regs);

}
