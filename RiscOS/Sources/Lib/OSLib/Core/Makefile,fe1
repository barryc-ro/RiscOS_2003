# Makefile for OSLib Core

# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date          Name         Description
# ----          ----         -----------
# 21st Jun 1995 JRC          Created.

LIBDIR = <Lib$Dir>.OSLib

#
# Generic options:
#
include StdTools

#
# Program specific options:
#
COMPONENT = OSLib

LIBS = \
o.Buffer \
o.Cache \
o.ColourTrans \
o.Debugger \
o.DMA \
o.FPEmulator \
o.IIC \
o.MessageTrans \
o.OS \
o.OSByte \
o.OSHeap \
o.OSModule \
o.OSReadSysInfo \
o.OSSpriteOp \
o.OSWord \
o.Podule \
o.Portable \
o.ScreenBlanker \
o.ScreenModes \
o.ServiceInternational \
o.SharedCLibrary \
o.Sound \
o.Squash \
o.Territory

EXTRAHDRS = Hdr.Shell

HDRS     := ${patsubst o.%,Hdr.%,${LIBS}} ${EXTRAHDRS}
CHEADERS := ${patsubst Hdr.%,h.%,${HDRS}}
CSTRONG  := ${patsubst Hdr.%,Help.%,${HDRS}}

FILES    := ${HDRS} ${CHEADERS} ${CSTRONG} ${LIBS}

all: $(FILES)

release: ${FILES}
   ${CP} h       ${LIBDIR}.Core.oslib.h    ${CPFLAGS}
   ${CP} Hdr     ${LIBDIR}.Core.oslib.Hdr  ${CPFLAGS}
   ${CP} CStrong <StrongHelp$Dir>.HelpData ${CPFLAGS}

#------------------------------------------------------------------------
hdrs: ${HDRS}
libs: ${LIBS}
cheaders: ${CHEADERS}
cstrong: ${CSTRONG}

.SUFFIXES: .o .h .h++ .def .ch .Hdr .ah .Help

.def.s:     ;DefMod -s -byte_wide ^.ByteWide < $< > $@
.def.h:     ;DefMod -h < $< > $@
.def.h++:   ;DefMod -h++ < $< > $@
.def.Hdr:   ;DefMod -hdr < $< > $@
.def.ch:    ;DefMod -chelp < $< > $@
.def.ah:    ;DefMod -asmhelp < $< > $@
.def.o:     ;DefMod -l -o l.$* -byte_wide ^.ByteWide < $<
            LibFile -c -o $@ -via ViaFile
            x LibFile -d ^.o.OSLib l.$*.*
            LibFile -i -o ^.o.OSLib -via ViaFile
            Wipe l.$* ~C~FR~V
.def.Help:  ;DefMod -cstrong -o CStrong.$* < $<
            Create $@

#------------------------------------------------------------------------
# RISC OS Build targets:
#
export: export_${PHASE}

export_hdrs:
        @echo ${COMPONENT}: export complete (hdrs)

export_libs: ${HDRS} ${CHEADERS} ${LIBS}
        ${CP} h       ${LIBDIR}.Core.oslib.h    ${CPFLAGS}
        ${CP} Hdr     ${LIBDIR}.Core.oslib.Hdr  ${CPFLAGS}
        @echo ${COMPONENT}: export complete (libs)

clean:
        @echo ${COMPONENT}: *** NOT cleaned *** clean locally if required

clean_lib:
        ${WIPE} o.* ${WFLAGS}
        @echo ${COMPONENT}: cleaned

# End of RISC OS Build targets
#------------------------------------------------------------------------
# Dynamic dependencies:
