        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System

        EXPORT  _get_t0_count

        AREA    |Asm$$Code|, CODE, READONLY
_get_t0_count
        MOV     r12,lr
        SWI     XOS_EnterOS             ; Must be in SVC mode to peek IOC/IOMD
        MOV     r3,#IOC
; Shut off interrupts (briefly) to ensure an atomic read of these
; silly hardware registers.
        TEQP    pc,#I_bit :OR: SVC_mode
        STRB    r3,[r3,#Timer0LR]
        LDRB    r1,[r3,#Timer0CL]
        LDRB    r0,[r3,#Timer0CH]
        ORR     r0,r1,r0,LSL #8
        MOVS    pc,r12                  ; Will restore mode and interrupt status

        END
