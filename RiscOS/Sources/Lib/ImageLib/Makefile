# Makefile for ImageLib
#
# ***********************************
# ***    C h a n g e   L i s t    ***
# ***********************************
# Date       Name         Description
# ----       ----         -----------
# 1997-06-25 BAL          Created.
#

#
# Paths
#
EXP_HDR = <export$dir>
LIBDIR = <Lib$Dir>

#
# Generic options:
#
MKDIR   = cdir
AS      = objasm
CP      = copy
CC      = cc
CM      = cmhg
RM      = remove
LD      = link
LB      = libfile
WIPE    = wipe

CCFLAGS = -c -depend !Depend -ff -throwback ${INCLUDES} ${DFLAGS}
ASFLAGS = -depend !Depend -Stamp -quit
CPFLAGS = ~cfr~v
LBFLAGS = -c
WFLAGS  = ~CFR~V

#
# Libraries
#
CLIB      = CLIB:o.stubs
RLIB      = RISCOSLIB:o.risc_oslib
RSTUBS    = RISCOSLIB:o.rstubs
ROMSTUBS  = RISCOSLIB:o.romstubs
ROMCSTUBS = RISCOSLIB:o.romcstubs
ABSSYM    = RISC_OSLib:o.AbsSym
PNGLIB    = PNG.o.libpng-lib
PNGLIBZ   = PNG.o.libpng-lzm
ZLIB      = ZLib.o.zlib_lib
ZLIBZ     = ZLib.o.zlib_libzm
LIBS      = ${PNGLIB} ${PNGLIBZ} ${ZLIB} ${ZLIBZ}

#
# Include files
#
INCLUDES = -Itbox:,C:
DFLAGS    = -DRISCOS -DPNG_DEBUG=0

#
# Program specific options:
#
COMPONENT  = ImageLib
COMPONENTZ = ImageLibzm
SOURCE     = ...
TARGET     = ${COMPONENT}
TARGETZ    = ${COMPONENTZ}
EXPORTS    = ${EXP_HDR}.${COMPONENT}

OBJS =\
 o.cfsi\
 o.gif\
 o.gif_stream\
 o.imagetrans\
 o.jpeg\
 o.lzw_comp\
 o.lzw_decomp\
 o.png\
 o.render\
 o.rml_misc\
 o.sprite\
 o.xbm
 
OBJSZ =\
 z.cfsi\
 z.gif\
 z.gif_stream\
 z.imagetrans\
 z.jpeg\
 z.lzw_comp\
 z.lzw_decomp\
 z.png\
 z.render\
 z.rml_misc\
 z.sprite\
 z.xbm

#
# Rule patterns
#
.SUFFIXES: .o .s .h .cmhg .c .z
.c.o:;     ${CC} ${CCFLAGS} -o $@ $<
.c.z:;     ${CC} ${CCFLAGS} -zM -o $@ $<
.s.o:;     ${AS} ${ASFLAGS} -o $@ $<
.cmhg.o:;  ${CM} ${CMFLAGS} -o $@ $<
.cmhg.h:;  ${CM} ${CMFLAGS} -d $@ $<

#
# build a the library:
#
all:	${COMPONENT} ${COMPONENTZ} ${LIBS}

${PNGLIB}:
	dir PNG
	amu ${MFLAGS}
	back

${PNGLIBZ}:
	dir PNG
	amu ${MFLAGS}
	back

${ZLIB}:
	dir ZLib
	amu ${MFLAGS}
	back

${ZLIBZ}:
	dir ZLib
	amu ${MFLAGS}
	back

#
# RISC OS ROM build rules:
#
export: export_${PHASE}

clean:
        ${WIPE}		o.*		${WFLAGS}
        ${WIPE}		z.*		${WFLAGS}
        ${RM}		${TARGET}
	${RM}		${TARGETZ}	
        @echo ${COMPONENT}: cleaned

clean_all:
	Dir		PNG
	amu		clean
	back
	Dir		ZLIB
	amu		clean
	back
        @echo ${COMPONENT}: cleaned
        ${WIPE}		o.*		${WFLAGS}
        ${WIPE}		z.*		${WFLAGS}
        ${RM}		${TARGET}
	${RM}		${TARGETZ}

export_hdrs: h.imagetrans dirs
	${CP} h.imagetrans	ImageLib:h.imagetrans	~CFLNR~V
        @echo ${COMPONENT}: export complete (hdrs)

export_libs: ${TARGET} ${TARGETZ} dirs
	${CP}	o.${TARGET}	ImageLib:o.${TARGET}	~CFLNR~V
	${CP}	o.${TARGETZ}	ImageLib:o.${TARGETZ}	~CFLNR~V
	${CP}	${PNGLIB}	ImageLib:o.libpng-lib	~CFLNR~V
	${CP}	${PNGLIBZ}	ImageLib:o.libpng-lzm	~CFLNR~V
	${CP}	${ZLIB}		ImageLib:o.zlib_lib	~CFLNR~V
	${CP}	${ZLIBZ}	ImageLib:o.zlib_libzm	~CFLNR~V
        @echo ${COMPONENT}: export complete (libs)

local_dirs:
	${MKDIR} o
	${MKDIR} z
	
dirs:
        ${MKDIR} ${LIBDIR}
        ${MKDIR} ${LIBDIR}.ImageLib
        ${MKDIR} ImageLib:h
        ${MKDIR} ImageLib:o
        
#
# Final link
#
${TARGET}: ${OBJS} local_dirs
        ${LB} ${LBFLAGS} -o o.${COMPONENT} ${OBJS}

${TARGETZ}: ${OBJSZ} local_dirs
	${LB} ${LBFLAGS} -o o.${COMPONENTZ} ${OBJSZ}

${EXP_HDR}.${COMPONENT}: hdr.${COMPONENT}
        ${CP} hdr.${COMPONENT} $@ ${CPFLAGS}

# Dynamic dependencies:
