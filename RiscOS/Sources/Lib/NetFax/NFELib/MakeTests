#	Project Post (769)
#	Acorn Risc Technologies
#	Copyright © 1997. All Rights Reserved.
#
#	FILE:		MkNFEtest
#	AUTHOR:		Richard D. Warren
#	VERSION:	0.03 for RISC OS
#
#	OVERVIEW
#	========
#	Makefile for NFELib test harness
#	
#	HISTORY
#	=======
#	19/09/97	0.01	RDW	Initial version
#	27/11/97	0.02	RDW	Fixed NFEDecode target
#	27/11/97	0.03	RDW	Added MemCheck support for a MemCheck build

#
# Paths
#
EXP_HDR = <export$dir>

#
# Generic options:
#
MKDIR   = cdir
AS      = objasm -tb
CC      = cc
C++     = c++
CMHG    = cmhg
CP      = copy
LD      = link
RM      = remove
MODSQZ  = modsqz
WIPE    = -wipe
CD	= dir
LIBFILE = libfile
MemCheckCC	= #MemCheck.CC

CPFLAGS = ~cfr~v
WFLAGS = ~c~v

#
# Include files
#
INCLUDES=	C:

#
# Program specific options:
#
ENCCOMP = NFEencode
DECCOMP = NFEdecode
TARGETE = NFEencode
TARGETD = NFEdecode
LIBRARY = l.NFELib

# app or module definitions


# You may want to link with TinyStubs. if you do, set LD to tlink and
# uncomment this TINYSTUBS, and comment out the STUBS

TINYSTUBS=	#-DTINYSTUBS
STUBS=		C:o.Stubs

ROMCSTUBS=      RISC_OSLib:o.romcstubs
ABSSYM=         RISC_OSLib:o.AbsSym

C++LIB=		C:o.c++lib 

DEBUG=		#-DMEMCHECK #-DDEBUGLIB

CFLAGS=		-ffah -I${INCLUDES} ${DEBUG}\
		-Wp -depend !Depend -c -g -throwback ${TINYSTUBS}

C++FLAGS=	-I${INCLUDES} ${DEBUG}\
		-Wp -depend !Depend -c +g -throwback ${TINYSTUBS}		


DBUGOBJS=       #MemCheck:o.MC #tml_podule.o debuglib.o trace_PL.o# 

ASMFLAGS=       

EOBJS=		tstNFELibc.o
DOBJS=		tstNFELDec.o

#
# Rule patterns
#
.SUFFIXES:	.o .s .c
.c.o:;		$(MemCheckCC) $(CC) $(CFLAGS) -o $@ $<
.c++.o:;	$(MemCheckCC) $(C++) $(C++FLAGS) -o $@ $<
.s.o:;		$(AS) ${ASMFLAGS} -o $@ $<

encode:		library ${EOBJS}
		$(LD) -aif -C++ -d -o NFEencode $(LIBRARY) ${EOBJS} $(OBJS) $(C++LIB) $(DBUGOBJS) $(STUBS)
        	@echo ${TARGETE}: complete
decode:		library ${DOBJS}
		$(LD) -aif -C++ -d -o NFEdecode $(LIBRARY) ${DOBJS} $(OBJS) $(C++LIB) $(DBUGOBJS) $(STUBS)
        	@echo ${TARGETD}: complete
all: 		encode decode
        	@echo ${TARGETL}: all complete

clean:
		$(WIPE) $(EOBJS)	$(WFLAGS)
		$(WIPE) $(DOBJS)	$(WFLAGS)
		@echo $(TARGET): cleaned out

#
# Target 
#

#
# Some rules that need explicitly declaring
#
library:
        Amu -f makefile library
	
# Dynamic dependencies:
o.tstNFELibc:	c.tstNFELibc
o.tstNFELibc:	h.NFELib
o.tstNFELibc:	C:h.kernel
o.tstNFELibc:	h.ELib
o.tstNFELDec:	c.tstNFELDec
o.tstNFELDec:	h.NFELib
o.tstNFELDec:	C:h.kernel
o.tstNFELDec:	h.ELib
