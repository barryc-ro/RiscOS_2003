
#ifndef encpriv_H
#define encpriv_H

#include "encoding.h"

typedef struct EncodingPriv EncodingPriv;

typedef int (*encoding_reset_fn)(EncodingPriv *, int for_encoding);

typedef unsigned int (*encoding_read_fn)(EncodingPriv *e,
				encoding_read_callback_fn ucs_out,
				const char *s,
				unsigned int n,
				void *handle);

typedef int (*encoding_write_fn)(EncodingPriv *e, UCS4 c, char **buf, int *bufsize);

typedef struct EncList EncList;

struct EncList
{
    int identifier;
    char *names;
    EncodingPriv *encoding;
    char *preload;
    char *encoder_data;
};

/*
 * An Encoding structure provides a uniform interface to a document
 * encoding (such as ISO 8859/1, Shift-JIS, KSC 5601-1987), with
 * utilities for conversion to and from UTF-8 and UCS-4.
 */

struct EncodingPriv
{
    /* values set up by the encoding scheme */
    encoding_read_fn read;
    encoding_reset_fn reset;

    int ws_size;

    void (*delete_enc)(EncodingPriv *);
    void (*enable_iso2022)(EncodingPriv *);

    encoding_write_fn write;

    /* generic data storage */
    EncList *list_entry;
    int for_encoding;
};

/* Exported function pointers for the library internal use only */

extern encoding_alloc_fn encoding__alloc;
extern encoding_free_fn encoding__free;

/* Encoding table functions */

typedef struct table_info *encoding_table;

extern UCS2 *encoding_table_ptr(encoding_table t);
extern int encoding_n_table_entries(encoding_table t);
extern int encoding_lookup_in_table(UCS4 u, encoding_table t);

/*
 * Load a named map file into a malloc block, or return a pointer to it if in
 * ResourceFS.
 */

extern encoding_table encoding_load_map_file(const char *fname);
extern void encoding_discard_map_file(encoding_table t);

#if DEBUG
#define fdebugf fprintf
#else
#define fdebugf 1?0:fprintf
#endif

#endif
