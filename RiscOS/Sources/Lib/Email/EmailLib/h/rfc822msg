#if !defined(__rfc822msg_h)              /* Sentry, use file only if it's not already included. */
#define __rfc822msg_h
/*	Project Post (769)
	Acorn Risc Technologies
	Copyright © 1997. All Rights Reserved.

	FILE:		rfc822msg.h
	AUTHOR:		Richard D. Warren
	VERSION:	0.05D for RISC OS

	OVERVIEW
	========
	Class definition for a rfc822msg object.
	rfc822msg is a class derived from the entity class adding specific
	RFC822 msg methods.  

	HISTORY
	=======
	12/09/97	0.01	RDW	initial version
					Merged file and memory constructors into one
	19/09/97	0.02	RDW	GetMIMEentity method added
	21/09/97	0.03	RDW	added operator+=
	12/05/98	0.03D	RDW	virtual copy constructor, clone(), added
	25/05/98	0.04D	RDW	#ifdef DISPLAY round Display method added
	10/06/98	0.05D	RDW	GetRegistryEntries private method added and
					got_registry_entries flag, mime, content_type,
					to and from registry type values added
*/


/* ************************************************************************** */
/*                                                                            */
/* Include header files - System                                              */
/*                                                                            */
/* ************************************************************************** */


/* ************************************************************************** */
/*                                                                            */
/* Include header files - Project defined                                     */
/*                                                                            */
/* ************************************************************************** */
#include "entity.h"
#include "to.h"
#include "from.h"
#include "MIMEentity.h"

extern "C"
{
  #include "ELib.h"
}


/* ************************************************************************** */
/*                                                                            */
/* New enumerated types                                                       */
/*                                                                            */
/* ************************************************************************** */


/* ************************************************************************** */
/*                                                                            */
/* Class definition                                                           */
/*                                                                            */
/* ************************************************************************** */
class rfc822msg : public entity
{
  // Declaration of PUBLIC member functions
  public:
   // Constructor (memory)
    rfc822msg(BOOL f,								// file (TRUE) or memory(FALSE)?
           char   *membase,							// set to start of memory block that rfc822msg is in
           uint32  offset,							// number of characters from membase to start of rfc822msg
           uint32  length,							// length of rfc822msg in characters from it's start
           BOOL    owner = FALSE);						// does the object 'own' this memory block? (TRUE = destroy membase on destruction)
    rfc822msg(const rfc822msg &object);						// copy constructor
    virtual elibbase* clone(void) const { return new rfc822msg(*this); }	// Virtual Copy constructor
    
    rfc822msg& operator=(const rfc822msg &object);				// assignment operator
    rfc822msg& operator+=(const MIMEentity &object);				// assignment operator take on a MIME entity->a MIME email message!ha!
    virtual ~rfc822msg(void);							// Desctructor
    
    NFE_rcode SetTo(to &obj);
    NFE_rcode SetFrom(from &obj);
    
    to*   GetTo(void);								// get pointer to to object
    from* GetFrom(void);							// get pointer to from object
    MIMEentity* GetMIMEentity(void) { return mime_obj;}
    
#ifdef DISPLAY    
    virtual void Display(void);							// for debug/development work.  Can be removed in final version
#endif
    NFE_rcode parse(NFE_CONTEXT &context, clock_t t_slice);			// parse the data from file or memory


  // Declaration of PROTECTED member functions
  protected:
    
  // Declaration of PRIVATE member functions
  private:
    void copyrfc822msgobject(const rfc822msg &object);				// method to copy object.  Used by copy constructor and assignment operator
    NFE_rcode SetAHdr(header &obj, NFE_HDR_TYPE t, int32 &index);		// move to entity class as protected member function?
    header* GetAHdr(NFE_HDR_TYPE t, int32 &index);				// move to entity class as protected member function?
    void GetRegistryEntries(void);						// method called by all constructors to ensure the class data members are initialised
    
  // Declaration of PUBLIC data members
  public:
    
  // Declaration of PROTECTED data members
  protected:

  // Declaration of PRIVATE data members
  private:
    int32 to_index;
    int32 from_index;
    int32 date_index;
    MIMEentity *mime_obj;
    
    static BOOL         got_registry_entries;					// Has the class got the runtime type numbers for the headers it uses?
    static NFE_HDR_TYPE mime_version_hdr_type;					// The runtime type number for the MIME-Version header
    static NFE_HDR_TYPE content_type_hdr_type;					// The runtime type number for the Content-Type header
    static NFE_HDR_TYPE to_hdr_type;						// The runtime type number for the To header
    static NFE_HDR_TYPE from_hdr_type;						// The runtime type number for the From header
};

#endif  /* end of sentry #ifdef */
