/*name and version number:@(#)v_test.c	1.2*/
/*date of get: 		  09/06/00 16:59:36*/
/*date of delta:	  01/26/00 22:19:19*/
/*****************************************************************************
** File        : test.c                                                      *
** Version     : 3.0                                                         *
**---------------------------------------------------------------------------*
** Description :                                                             *
**                                                                           *
**     Function Name            | Access  | Summary                          *
**  ----------------------------+---------+--------------------------------- *
**  test_tx_config              | GLOBAL  | Initialises Tx system (dummy)    *
**  test_rx_config              | GLOBAL  | Initialises Rx system (dummy)    *
**  test_tx                     | GLOBAL  | Protocol-free media Transmit     *
**  test_rx                     | GLOBAL  | Protocol-free media Receive      *
**                                                                           *
**---------------------------------------------------------------------------*
**                               HISTORY                                     *
**[Release 2]----------------------------------------------------------------*
** Date            Ver   Dev  Comments                                       *
** 19th Jan  1999  2.0   RGT  Initial Revision                               *
**                                                                           *
** 20th Apr  1999  2.1   RGT  Changed config routines to void - they now use *
**                            global core exchanger call config structure.   *
**                                                                           *
**[Release 3]----------------------------------------------------------------*
** Date            Ver   Dev  Comments                                       *
** 31   Aug  1999  3.0   JA    CS4 multi-instance integration on SA          *
******************************************************************************/

#include <v_glob.h>


void test_tx_config(VGLOB *vglob_ptr)
{
}



void test_rx_config(VGLOB *vglob_ptr)
{
}

word TEMP_GLOBAL;
byte tooOldCount;
word BUILDOUT;
word DISCARDS;

void test_tx(VGLOB *vglob_ptr, packet_t *pkt)
{
	frame_t	  frame;	// pushes 6 bytes onto the stack DON'T USE POINTER !!
						// If concerned about overhead - declare global.

	frame.length = pkt->length;
	if (frame.length < 80)
		frame.codec = G729;
	else
		frame.codec = G711;
	frame.ID     = TEMP_GLOBAL++;

	if (queue_frame(vglob_ptr, &frame, pkt->media) == TOO_OLD)
		tooOldCount++;

	/*************************************************************************
	** HACK to correct for packet loss over the network & through the system *
	**************************************************************************/
	if (tooOldCount > 5) {
		TEMP_GLOBAL = set_buildout(vglob_ptr, 4);
		frame.ID = TEMP_GLOBAL;
		queue_frame(vglob_ptr, &frame, pkt->media);
		tooOldCount =  0;
	}
}



void test_rx(VGLOB *vglob_ptr, frame_t * frame)
{
	packet_t pkt;

	pkt.length = (word)frame->length;
	for ( int i = 0; i < pkt.length; i++ ) {
		pkt.media[i] = frame->media[i];
	}

	/*****************************************************
	** Keep trying to shift the frame through the system *
	******************************************************/
	send_packet_to_network(vglob_ptr, &pkt, PNET_MEDIA);
}


