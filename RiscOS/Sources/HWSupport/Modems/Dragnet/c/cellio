/*name and version number:@(#)cellio.c	1.13*/
/*date of get: 		  09/06/00 16:58:48*/
/*date of delta:	  01/05/99 14:54:59*/
/*****************************************************************
File : cellio.c
Description :
	Contains the routines for cellular phone direct connect.

Procedures Contained :

Revision History :
	Initials        Date            Change
	EYL             05/01/96        Initial
*****************************************************************/

#include "llglob_d.h"

#ifdef DC0

#include "dpglob.h"
#include "cellular.h"
#include "allglobs.h"

/************************************************************************
************************************************************************/
void cell_disable_system_int ( void )
{
#ifndef MODEM_Z80
	extern void x_disable ( void ) ;
	x_disable () ;
#endif
}

/************************************************************************
************************************************************************/
void cell_enable_system_int ( void )
{
#ifndef MODEM_Z80
	extern void x_enable ( void ) ;
	x_enable () ;
#endif
}

/************************************************************************
************************************************************************/
void cell_disable_dc_i_int ( void )
{
	DC_I_INT_DISABLE ;
	DC_I_INT_SET ;
}

/************************************************************************
************************************************************************/
void cell_enable_dc_i_int ( void )
{
	DC_I_INT_CLR ;
	DC_I_INT_CLR_RESET ;
	DC_I_INT_ENABLE ;
	DC_I_INT_SET ;
}


/************************************************************************
************************************************************************/
void cell_disable_dc_io1_int ( void )
{
	DC_IO1_INT_DISABLE ;
	DC_IO1_INT_SET ;
}

/************************************************************************
************************************************************************/
void cell_enable_dc_io1_int ( void )
{
	DC_IO1_INT_CLR ;
	DC_IO1_INT_CLR_RESET ;
	DC_IO1_INT_ENABLE ;
	DC_IO1_INT_SET ;
}

/************************************************************************
************************************************************************/
void cell_dc_cntrl1_low ( void )
{
	DC_CNTRL1_LOW ;
	DC_CNTRL1_SET ;
}

/************************************************************************
************************************************************************/
void cell_dc_cntrl1_high ( void )
{
	DC_CNTRL1_HIGH ;
	DC_CNTRL1_SET ;
}
/************************************************************************
************************************************************************/
void cell_dc_cntrl2_low ( void )
{
	DC_CNTRL2_LOW ;
	DC_CNTRL2_SET ;
}

/************************************************************************
************************************************************************/
void cell_dc_cntrl2_high ( void )
{
	DC_CNTRL2_HIGH ;
	DC_CNTRL2_SET ;
}

/************************************************************************
************************************************************************/
byte cell_dc_i_read ( void )
{
	return ( DC_I_READ ) ;
}

/************************************************************************
************************************************************************/
byte cell_dc_io2_read ( void )
{
	return ( DC_IO2_READ ) ;
}

/************************************************************************
************************************************************************/
byte cell_dc_io1_read ( void )
{
	return ( DC_IO1_LEVEL ) ;
}

/************************************************************************
*                                                                       *
*       Routine:        void cell_set_busy_line_high ( void )		*
*       Author:         EL                                              *
*                                                                       *
*       Creation Date:  07/11/96                                        *
*                                                                       *
*       Description:                                                    *
*                                                                       *
*       Input: None                                                     *
*       Output: None                                                    *
*                                                                       *
*       Global Variables Changed:                                       *
*       Users:                                                          *
*                                                                       *
*************************************************************************/
void cell_set_busy_line_high ( void )
{
	x_debug_msg ( "cell - Set busy HIGH" ) ;
	DC_I_HIGH ; // busy line high
	DC_I_INPUT ;
	cell_enable_dc_i_int () ;
}

/************************************************************************
*                                                                       *
*       Routine:        void cell_set_busy_line_low ( void )		*
*       Author:         EL                                              *
*                                                                       *
*       Creation Date:  07/11/96                                        *
*                                                                       *
*       Description:                                                    *
*                                                                       *
*       Input: None                                                     *
*       Output: None                                                    *
*                                                                       *
*       Global Variables Changed:                                       *
*       Users:                                                          *
*                                                                       *
*************************************************************************/
byte cell_set_busy_line_low ( void )
{
	word wTimer ;

	cell_disable_dc_i_int () ;
	wTimer = x_current_time () ; 

	while ( x_elapsed_time ( wTimer ) <= MS100 ) 
	{
		if ( cell_dc_i_read () != 0 )
		{
			DC_I_OUTPUT ;
			DC_I_LOW ;  // busy line low
			x_debug_msg ( "cell - Set busy LOW" ) ;
			return ( TRUE ) ;
		}
	}
	x_debug_msg ( "cell - Set busy LOW failed" ) ;
	cell_enable_dc_i_int () ;
	return ( FALSE ) ;
}

/************************************************************************
*                                                                       *
*       Routine:        cell_init_io ()                                 *
*       Author:         ELI                                             *
*                                                                       *
*       Creation Date:  05/01/96
*                                                                       *
*       Description:                                                    *
*                                                                       *
*       Input: None                                                     *
*       Output: None                                                    *
*                                                                       *
*       Global Variables Changed:					*
*       Users:								*
*                                                                       *
*************************************************************************/
void cell_init_io ( void )
{
	// init DC_CNTRL1 port
	DC_CNTRL1_INIT ;
	DC_CNTRL1_OUTPUT ; // io direction output
	DC_CNTRL1_HIGH ; // keep DC_CNTRL1 high for motorola phone.
	DC_CNTRL1_SET ;

	// init DC_I port as a input port
	DC_I_INIT ;
	DC_I_INPUT ;

	// init DC_CNTRL2 port
	DC_CNTRL2_INIT ;
	DC_CNTRL2_OUTPUT ; // io direction output
	DC_CNTRL2_HIGH ; // keep DC_CNTRL1 high for motorola phone.
	DC_CNTRL2_SET ;

	// init DC_IO2 port to a input port
	DC_IO2_INIT ;
	DC_IO2_INPUT ;

	DC_IO1_SYSTEM_INT_ENABLE ;
	DC_IO1_SYSTEM_INT_SET ;
	DC_IO1_INT_RISE_EDGE ;
}

#endif // DC0
