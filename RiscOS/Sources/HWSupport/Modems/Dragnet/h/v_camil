/*name and version number:@(#)v_camil.h	1.15*/
/*date of get: 		  09/06/00 16:59:30*/
/*date of delta:	  05/22/00 13:50:20*/
/*****************************************************************************
** File        : media.h                                                     *
** Version     : 1.0                                                         *
**---------------------------------------------------------------------------*
** Description :                                                             *
**   Include file for modules wishing to use the camil driver functions      *
** implemented in the file media.c                                           *
**                                                                           *
**---------------------------------------------------------------------------*
**                               HISTORY                                     *
** Date            Ver   Dev  Comments                                       *
** 08/25/1999      1.0   jyu  Initial Revision                               *
**                                                                           *
******************************************************************************/

#ifndef __V_CAMIL_H
	#define __V_CAMIL_H

/****************************************************************************
          ####   ###   #   #   ###  #####   ###  #   #  #####  ###
         #      #   #  ##  #  #       #    #   # ##  #    #   #
         #      #   #  # # #   ###    #    ##### # # #    #    ###
         #      #   #  #  ##      #   #    #   # #  ##    #       #
          ####   ###   #   #  ####    #    #   # #   #    #   ####
*****************************************************************************/

	/*************************************************
	**       Constants for 'C' and Assembler        **
	**************************************************/
//		#define GOTO_CMD			0x1B
		#define DLOAD_CMD			0x1A
		
		#define BaseAddress			0xC0
		#define	BaseAddressData		0xC1
		#define BaseAddress2		0xC2

#ifndef ASSEMBLER
	/*************************************************
	** 'C' Camil Interrupt Function Modes           **
	**************************************************/
		#define	DISABLE				   0
		#define ENABLE				   1
		#define	GET_MASK  			   2
		#define SET_MASK			   3
		#define GET_STATS			   4
		#define GET_USTATS			   5
		#define CLEAR				   6
		#define INIT				   7

	/*************************************************
	** Camil Media Driver & State Machine Constants **
	**************************************************/
		#define GET_FRAME_ELEMENT	0x01
		#define TRANSFER_CONTROL_WORD	0x02
		#define GET_MEMORY		0x03
		#define TRANSFER_MEDIA		0x04
		#define DISCARD_CONTROL_WORD	0x12
		#define DISCARD_MEDIA		0x14
		#define FRAME_END		0x05
#endif


/****************************************************************************
                #   #   ###    ####  ####    ###    ###
                ## ##  #   #  #      #   #  #   #  #
                # # #  #####  #      ####   #   #   ###
                #   #  #   #  #      #  #   #   #      #
                #   #  #   #   ####  #   #   ###   ####
*****************************************************************************/


#if defined ASSEMBLER
	/*************************************************
	**       Assembler CAMIL Register Access        **
	**************************************************/
WRITE_CAMILZ	MACRO
		LD		A, \1
		out0	(0xC0), A
		LD		A, \2
		out0	(0xC1), A
ENDM


READ_CAMILZ		MACRO
		LD		A, \1
		out0	(0xC0), A
		in		A, (0xC1)
ENDM

#else
	/*************************************************
	**      'C' CAMIL Macros                        **
	**************************************************/
#endif

/****************************************************************************
            #####  #   #  ####   #####  ####   #####  #####  ###
              #    #   #  #   #  #      #   #  #      #     #
              #     ###   ####   ###    #   #  ###    ###    ###
              #      #    #      #      #   #  #      #         #
              #      #    #      #####  ####   #####  #     ####
*****************************************************************************/
#ifndef ASSEMBLER
		#include "v_defs.h"
		#include "v_config.h"

		typedef struct {
			word	address;
			word	fileSize;
			word	checksum;
		} dspFileHdr;

		typedef struct {
			frame_t		* frame;
			word		  frameID;
			codecType	  codec;
			byte		  state;
			byte		  frameIndex;
			byte		  frameBytes;
			byte		  byteOffset;
			byte		  numFrames;
			#if defined(V_FORCE_ERASURE)
			word	force_erasure;
			#endif // V_FORCE_ERASURE
		} stateInfo_t;
	
		typedef struct {
			stateInfo_t	  rx;
			stateInfo_t	  tx;
		} camilSM_t;

#endif


/****************************************************************************
           ####   ####    ###   #####  #   #  ####   #####   ###
           #   #  #   #  #   #    #    #   #  #   #  #      #
           ####   ####   #   #    #     ###   ####   ###     ###
           #      #  #   #   #    #      #    #      #          #
           #      #   #   ###     #      #    #      #####  ####
*****************************************************************************/
#ifndef ASSEMBLER
	#include <v_glob.h>
	#include <sa_cdefs.h>

void dsp_isr(VGLOB *vglob_ptr);
void dsp_isr_init(VGLOB *vglob_ptr);

void dsp_media_read(VGLOB *vglob_ptr, U8 *inbuf, U8 len);
U8 dsp_media_write(VGLOB *vglob_ptr, U8 *outbuf);
void init_frame_pools(VGLOB *vglob_ptr);
byte txframe_pool_full_count(VGLOB *vglob_ptr);

#if defined(G729_VIA_CAMIL)
 void dual_port_write ( byte *src, byte wdcnt );
 byte dual_port_read( byte *dst );
#endif	// G729_VIA_CAMIL

#if defined (FRAME_POOL_AUDIT)
	void dump_txframe_pool(VGLOB *vglob_ptr);
	void dump_rxframe_pool(VGLOB *vglob_ptr);
	void audit_frame_pools(VGLOB *vglob_ptr);
#else
	#define dump_txframe_pool(p)
	#define dump_rxframe_pool(p)
	#define audit_frame_pools(p)
#endif	// FRAME_POOL_AUDIT

#endif

/****************************************************************************
              #####  #   #  #####  #####  ####   #   #   ###
              #       # #     #    #      #   #  ##  #  #
              ###      #      #    ###    ####   # # #   ###
              #       # #     #    #      #  #   #  ##      #
              #####  #   #    #    #####  #   #  #   #  ####
*****************************************************************************/

#endif  // __V_CAMIL_H
