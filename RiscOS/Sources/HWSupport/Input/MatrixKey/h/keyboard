/*************************************************************************
Copyright [2000] Pace Micro Technology PLC. All rights reserved.

The copyright in this material is owned by Pace Micro Technology PLC
("Pace"). This material is regarded as highly confidential trade secret
of Pace. It may not be reproduced, used, sold or in any other way exploited
or transferred to any third party without the prior written permission of
Pace.
*************************************************************************/


#include "ADTs.h"


#ifndef _KEYBOARD_H
#define _KEYBOARD_H


#define NUMBER_OF_KEYCODES 0x7f


#define RSVD 0xFF     /* Reserved keys that have no mapping */
#define NEQV 0xFF     /* Keys in RCMM that have no RISC OS equivalent */
#define UDEF 0xFF     /* Keys that are undefined (although these do have valid mappings defined by Philips) */
#define SPEC 0xFE     /* a special key. when this key is down mapping table will be switched to one above it. */


typedef enum key_states {KEY_UP, KEY_DOWN} KEY_STATES;

// prototypes
void DriverInit(void);
void Driver(void);



class mapping_table
{
      public:
             mapping_table();
             ~mapping_table();
             void erase(void);
             bool load_key_code(int key_code);
             bool set_key_state(unsigned int row, unsigned int column, KEY_STATES state);
             KEY_STATES get_key_state(unsigned int row, unsigned int column) const;
             int translate(unsigned int row, unsigned int column) const;
             void flush(void);
      private:
             int* translation_table;
             unsigned int size_of_translation_table;
             unsigned int number_of_loaded_key_codes;
             KEY_STATES* states_of_keys;

};


class keyboard
{
        public:
               keyboard();
               bool extract_layouts(const char* pathname);
               void poll_keys(void);
               void inform_kernel(void);
               unsigned int get_number_of_mapping_tables(void) {return number_of_mapping_tables;};
               void flush_all(void);
               unsigned int number_of_rows;
               unsigned int number_of_columns;
               mapping_table* mapping_tables;    // array of mapping table objects

        private:
               unsigned int scan_matrix(int column);
               keys_buffer keys_up, keys_down;
               unsigned int number_of_mapping_tables;
               unsigned int current_mapping_table;
};







#endif
