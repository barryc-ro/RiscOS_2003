;******************************************************************************
;
;      File: pipasm.c
;   Purpose: pip assembler routines
;    Author: A.Pirozek
;   History: 11-05-98 - AJP Created
;
;******************************************************************************

        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:EnvNumbers

r0      RN      0
a1      RN      0
r1      RN      1
a2      RN      1
r2      RN      2
a3      RN      2
r3      RN      3
a4      RN      3

r4      RN      4
v1      RN      4
r5      RN      5
v2      RN      5
r6      RN      6
v3      RN      6
r7      RN      7
v4      RN      7
r8      RN      8
v5      RN      8
r9      RN      9
v6      RN      9

r10     RN     10
r11     RN     11
r12     RN     12
r13     RN     13

sl      RN     10
fp      RN     11
ip      RN     12
sp      RN     13
lr      RN     14
pc      RN     15

;******************************************************************************
;
;  Area infromation
;
;******************************************************************************
        AREA |C$$code|, CODE, READONLY

;******************************************************************************
;
;  Constants
;
;******************************************************************************
USR_Mode        *       0

;******************************************************************************
;
;  Exported Values
;
;******************************************************************************
        EXPORT  Processor_UserMode
        EXPORT  Processor_SVCMode

;******************************************************************************
;
; Switch processor to user mode
;
;******************************************************************************
Processor_UserMode
	STMDB	r0!, {r1-r12,r14}
	TEQP	pc, #USR_Mode
	MOV	r0, r0
	MOV	sp, r0
	LDMIA	sp!, {r1-r12,pc}

;******************************************************************************
;
; Switch processor to SVC mode
;
;******************************************************************************
Processor_SVCMode
	STMDB	r0!, {r1-r12,r14}
	SWI	XOS_EnterOS
	MOV	r0, r0
	LDMIA	r0!, {r1-r12,pc}

;******************************************************************************
        END

