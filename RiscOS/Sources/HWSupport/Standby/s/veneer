; > veneer.s
;
;       Veneer for events and vectors.
;

        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:ModHand


; Explicit imports/exports.
;
        IMPORT  |_Lib$Reloc$Off$DP|

        EXPORT  veneer_irqs_off
        EXPORT  veneer_irqs_on


; Macro for defining input veneers.
;
        MACRO
$label  InputVeneer $function
        EXPORT  $label
        IMPORT  $function
$label.Indirect
        DCD     $function
$label  Push    "r10-r12,lr"
        LDR     r11, $label.Indirect
        B       CallC
        MEND


        AREA    |veneer$$code|,REL,CODE,READONLY

veneer_irqs_off
        MOV     r0, #I_bit
        TST     r0, pc
        TEQEQP  r0, pc
        MOVNE   r0, #0
        MOV     pc, lr

veneer_irqs_on
        TEQP    r0, pc
        MOV     r0, r0
        MOV     pc, lr

        END
