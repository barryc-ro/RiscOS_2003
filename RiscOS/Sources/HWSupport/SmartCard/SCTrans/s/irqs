;/************************************************************************/
;/*                  Copyright 1996 Acorn Computers Ltd                  */
;/*                                                                      */
;/*  This material is the confidential trade secret and proprietary      */
;/*  information of Acorn Computers. It may not be reproduced, used      */
;/*  sold, or transferred to any third party without the prior written   */
;/*  consent of Acorn Computers. All rights reserved.                    */
;/*                                                                      */
;/************************************************************************/
;
;  irqs.s
;
        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:ModHand

; Explicit imports/exports.
;
        IMPORT  |_Lib$Reloc$Off$DP|

        EXPORT  irqs_off
        EXPORT  irqs_on
        EXPORT  user_mode_donothing

        AREA    |veneer$$code|,REL,CODE,READONLY

irqs_off
        MOV     r0, #I_bit
        TST     r0, pc
        TEQEQP  r0, pc			; irqs are enabled
        MOVNE   r0, #0			; irqs are disabled
        MOV     pc, lr

irqs_on
        TEQP    r0, pc
        MOV     r0, r0
        MOV     pc, lr

; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
user_mode_donothing ROUT

	STMFD r13!,{lr}

	; Now execute a SWI in user mode to trigger callbacks
	TEQP pc, #0			; To user mode
	MOV r0, #0
	MOV r1, #1
	SWI XOS_Byte			; Read OS version
	SWI XOS_EnterOS			; Back to SVC mode

	LDMFD r13!,{pc}^


	END
