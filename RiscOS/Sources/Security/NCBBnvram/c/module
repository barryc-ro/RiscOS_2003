#include <stdlib.h>

#include "header.h"
#include "bootblock.h"

_kernel_oserror *module_init(const char *cmd_tail, int podule_base, void *pw)
{
    bootblock_init();
    return NULL;
}

_kernel_oserror *module_final(int fatal, int podule, void *pw)
{
    bootblock_final();
    return NULL;
}

_kernel_oserror *module_swi_handler(int swi_offset, _kernel_swi_regs *r, void *pw)
{
    switch (swi_offset)
    {
        case NCBootblock_Enquiry - NCBootblock_00:
            r->r[0] = (int) bootblock_enquiry(r->r[0], &r->r[1]);
            return NULL;
        case NCBootblock_Status - NCBootblock_00:
            r->r[0] = bootblock_status(r->r[0], (unsigned int *) &r->r[2]);
            return NULL;
        case NCBootblock_Write - NCBootblock_00:
            r->r[0] = bootblock_write((unsigned char *) r->r[0], r->r[1]);
            return NULL;
        case NCBootblock_PinInfo - NCBootblock_00:
            r->r[0] = r->r[1] = 0;
            return NULL;
        case NCBootblock_Reinitialise - NCBootblock_00:
            r->r[0] = bootblock_reinitialise();
            return NULL;
        default:
            return error_BAD_SWI;
    }
}

