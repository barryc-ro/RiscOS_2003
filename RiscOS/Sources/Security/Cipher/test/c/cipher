/* 
 * cipher test
 */
#include <stdio.h>
#include <string.h>
 
#include "kernel.h"
#include "swis.h"
#include "cipher.h"

#define CHK_ERR(X) if (!X); else printf("Error %s (0x%x)\n",X->errmess,X->errnum);

unsigned char data[] = {0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,
			0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31};
			
unsigned char key1[] = {0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30};
unsigned char key2[] = {0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32};

void
dump(unsigned char *data, int len)
{
  int i;
  for(i=0; i<len; i++)
    printf("%02x ",data[i]);
  printf("\n");
}
int
main (void)
{
  _kernel_oserror *err=NULL;
  unsigned char result[64];
  unsigned char data2[64];
  
  _swix(Cipher_DESEncrypt,_INR(0,3),0,data,sizeof(data),result,key1);
  
  printf("DES Encrypt : "); dump(data,sizeof(data));
  printf("       with : "); dump(key1,sizeof(key1));
  printf("    and get : "); dump(result,sizeof(result));
  printf("\n");
  memcpy(data2,result,sizeof(result));
  
  _swix(Cipher_DESDecrypt,_INR(0,3),0,data2,sizeof(data2),result,key1);

  printf("DES Decrypt : "); dump(data2,sizeof(data2));
  printf("       with : "); dump(key1,sizeof(key1));
  printf("    and get : "); dump(result,sizeof(result));
  printf("\n");
  
  _swix(Cipher_DESTripleEncrypt,_INR(0,4),0,data,sizeof(data),result,key1,key2);
  
  printf("Triple DES Encrypt : "); dump(data,sizeof(data));
  printf("              with : "); dump(key1,sizeof(key1));
  printf("              and  : "); dump(key2,sizeof(key2));
  printf("           and get : "); dump(result,sizeof(result));
  printf("\n");
  
  memcpy(data2,result,sizeof(result));

  _swix(Cipher_DESTripleDecrypt,_INR(0,4),0,data2,sizeof(data2),result,key1,key2);
  
  printf("Triple DES Decrypt : "); dump(data2,sizeof(data2));
  printf("              with : "); dump(key1,sizeof(key1));
  printf("              and  : "); dump(key2,sizeof(key2));
  printf("           and get : "); dump(result,sizeof(result));
  printf("\n");
  
  _swix(Cipher_MD5,_INR(0,3),0,data,sizeof(data),result);
  
  printf("     MD5 : "); dump(data,sizeof(data));
  printf(" and get : "); dump(result,8);
  printf("\n");

  printf("Check bad params should get error '");
  err = _swix(Cipher_DESTripleDecrypt,_INR(0,5),0,0,sizeof(data),
  		result,key1,key2);
  if (err)
    printf("%s (0x%x)'\n",err->errmess,err->errnum);
  else
    printf("wrong !!!'\n");

  return 0;
}
