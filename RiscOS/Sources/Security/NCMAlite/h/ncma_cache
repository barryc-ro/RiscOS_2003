// header file for NCMA_CACHE.H

/* Begin-Prologue */
#ifndef NCMA_CACHE_H
#define NCMA_CACHE_H
#undef DECLARE
#undef INIT
#ifdef PROTOTYPES_INTERNAL
#define DECLARE
#define INIT(x) =(x)
#else
#define DECLARE extern
#define INIT(x)
#endif
/* End-Prologue */


#define MAX_TAG_CACHE    72
#define TAG_CACHE_SIZE	 8192

#define TAG_MAPPING_STRING    1          /* a string (not terminated) */
#define TAG_MAPPING_INT	      2		 /* a big endian integer */

#define TAG_MAPPING_HOST      3          /* a hostname or textual IP address string */
#define TAG_MAPPING_IP        4		 /* a big endian IP address word */
#define TAG_MAPPING_PROXY     5		 /* a string, optional :port terminator */

#define TAG_MAPPING_SOAK      6          /* special NCITestTag -> soak test mapping */
#define TAG_MAPPING_PLIP      7		 /* special NCITestTag -> plip boot mapping */


#define TEST_TAG_SOAK         4          /* stupid values to get around the fact that */
#define TEST_TAG_PLIP	      8		 /* this tag is duplicated by browsermode */

typedef struct {
  const char *tag;
  unsigned int nci_tag;
  unsigned int mapping;
  char *val;
  int bytes;
} TAG_ENTRY;

typedef struct {
  char *base;                     /* base of cache workspace */
  char *free;                     /* ptr to next free entry in tag wspc */
  int tags;			  /* no. of tags in cache */
  int bytes;			  /* bytes used in cache wspc */
  int max;			  /* max. size of cache wspc */
  int valid;			  /* is the cache ready to support tag reads? */
  TAG_ENTRY tag[MAX_TAG_CACHE];	  /* tag index, mappings, etc */
} TAG_CACHE;


#ifdef PROTOTYPES_INTERNAL
  TAG_CACHE tag_cache = {
  NULL,
  NULL,
  0,
  0,
  TAG_CACHE_SIZE,
  0,
  {
    "SEND_EXPECT", NCIDialScriptTag, TAG_MAPPING_STRING, NULL, 0,
    "SYSTEM_FLAGS", 0, 0, NULL, 0,
    "SYSTEM_FLAGS1", 0, 0, NULL, 0,
    "SYSTEM_FLAGS2", 0, 0, NULL, 0,
    "SYSTEM_FLAGS3", 0, 0, NULL, 0,
    "IP_SCHEME", 0, 0, NULL, 0,
    "MAIL_RX", 0, 0, NULL, 0,
    "MAIL_TX", 0, 0, NULL, 0,
    "BOOTP", 0, 0, NULL, 0,
    "LINK_AUTH", 0, 0, NULL, 0,
    "NFS_TYPE", 0, 0, NULL, 0,
    "USER_PREFS", 0, 0, NULL, 0,
    "SC_REGISTERED", 0, 0, NULL, 0,
    "AUTH_ENABLE", 0, 0, NULL, 0,
    "STATE_ENABLE", 0, 0, NULL, 0,
    "WRITE_ENABLE", 0, 0, NULL, 0,
    "CLIENT_UPDATE", 0, 0, NULL, 0,
    "ISP_ID", NCIEnterpriseIDTag, TAG_MAPPING_INT, NULL, 0,
    "NC_ID", 0, 0, NULL, 0,
    "PSTN_NUM", NCIPOPPhoneNumberTag, TAG_MAPPING_STRING, NULL, 0,
    "PSTN_BACKUP", 0, 0, NULL, 0,
    "STATIC_IP", NCIStaticIPAddressTag, TAG_MAPPING_IP, NULL, 0,
    "DNS_PRIMARY", NCIPrimaryDNSTag, TAG_MAPPING_IP, NULL, 0,
    "DNS_BACKUP", NCIBackupDNSTag, TAG_MAPPING_IP, NULL, 0,
    "TIME_PRIMARY", NCINetworkTimeTag, TAG_MAPPING_HOST, NULL, 0,
    "TIME_BACKUP", NCIBackupTimeTag, TAG_MAPPING_HOST, NULL, 0,
    "HTTP_PROXY", NCIHTTPProxyTag, TAG_MAPPING_PROXY, NULL, 0,
    "FTP_PROXY", NCIFTPProxyTag, TAG_MAPPING_PROXY, NULL, 0,
    "SECURITY_PROXY", NCISecurityProxyTag, TAG_MAPPING_PROXY, NULL, 0,
    "LOGIN_ID", NCIPOPUserNameTag, TAG_MAPPING_STRING, NULL, 0,
    "LOGIN_SECRET", NCIPOPPasswordTag, TAG_MAPPING_STRING, NULL, 0,
    "ISP_DOMAIN", NCIDomainNameTag, TAG_MAPPING_STRING, NULL, 0,
    "URL_INIT", NCIURLTag, TAG_MAPPING_STRING, NULL, 0, /* NCI tag value has no meaning really - could be one of 4 possibilities */
    "URL_INITC", NCIURLCardSerialTag, TAG_MAPPING_STRING, NULL, 0,
    "URL_INITB", NCIURLBoxSerialTag, TAG_MAPPING_STRING, NULL, 0,
    "URL_INITBC", NCIURLBoxCardSerialTag, TAG_MAPPING_STRING, NULL, 0,
    "ISP_NAME", NCIEnterpriseNameTag, TAG_MAPPING_STRING, NULL, 0, /* 56 */
    NULL, 0, NULL, 0
  }
};
#else
extern TAG_CACHE tag_cache;
#endif

DECLARE int cache_smartcard(void);
DECLARE int cache_info(void);
DECLARE int cache_enquiry(char *, char *, int);
DECLARE char *cache_ptr(char *, int *);
DECLARE void unlock_cache(void);
DECLARE int build_ram_cache(void);
DECLARE int cache_write(char *, char *, int);
DECLARE int reset_cache(void);


/* Begin-Epilogue */
#undef PROTOTYPES_INTERNAL
#undef INIT
#undef DECLARE
#endif
/* End_Epilogue */

