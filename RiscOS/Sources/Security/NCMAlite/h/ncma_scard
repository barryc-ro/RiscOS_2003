// header file for NCMA_SCARD.H

/* Begin-Prologue */
#ifndef NCMA_SCARD_H
#define NCMA_SCARD_H
#undef DECLARE
#undef INIT
#ifdef PROTOTYPES_INTERNAL
#define DECLARE
#define INIT(x) =(x)
#else
#define DECLARE extern
#define INIT(x)
#endif
/* End-Prologue */

#ifndef DUAL_SMARTCARDS
  #ifndef NCBootblock_EnumerateNetworkDrivers
    #define NCBootblock_EnumerateNetworkDrivers    0x4f380
    #define NCBootblock_Enquiry		           0x4f382
    #define NCBootblock_Status		           0x4f383
    #define NCBootblock_Write		           0x4f384
    #define NCBootblock_Authenticate	           0x4f385
    #define NCBootblock_ChangeSmartCardCHV	   0x4f386
    #define NCBootblock_Proxy		           0x4f387
    #define NCBootblock_PinInfo		           0x4f388
    #define NCBootblock_UnblockCHV		   0x4f389
  #endif /* CBootblock_EnumerateNetworkDrivers */

  #ifndef SCInterface_ChangeCHV
    #define SCInterface_GetATR                     0x4d344
    #define SCInterface_ChangeCHV                  0x4d345
    #define SCInterface_UnBlockCHV		   0x4d347
    #define SCInterface_FileInfo		   0x4d348
    #define SCInterface_Status		           0x4d34a
  #endif /* SCInterface_ChangeCHV */
#else
  #ifndef NCBootblock1_EnumerateNetworkDrivers
    #define NCBootblock1_EnumerateNetworkDrivers   0x200380
    #define NCBootblock1_Enquiry		   0x200382
    #define NCBootblock1_Status		           0x200383
    #define NCBootblock1_Write		           0x200384
    #define NCBootblock1_Authenticate	           0x200385
    #define NCBootblock1_ChangeSmartCardCHV	   0x200386
    #define NCBootblock1_Proxy		           0x200387
    #define NCBootblock1_PinInfo		   0x200388
    #define NCBootblock1_UnblockCHV		   0x200389
  #endif /* NCBootblock1_EnumerateNetworkDrivers */

  #ifndef SCInterface1_ChangeCHV
    #define SCInterface1_GetATR                    0x200344
    #define SCInterface1_ChangeCHV                 0x200345
    #define SCInterface1_UnBlockCHV		   0x200347
    #define SCInterface1_FileInfo		   0x200348
    #define SCInterface1_Status		           0x20034a
  #endif /* SCInterface1_ChangeCHV */
#endif /* DUAL_SMARTCARDS */



#ifdef TWIN_SMARTCARD_DEMO
  #ifndef NCBootblock1_EnumerateNetworkDrivers
    #define NCBootblock1_EnumerateNetworkDrivers   0x200380
    #define NCBootblock1_Enquiry		   0x200382
    #define NCBootblock1_Status		           0x200383
    #define NCBootblock1_Write		           0x200384
    #define NCBootblock1_Authenticate	           0x200385
    #define NCBootblock1_ChangeSmartCardCHV	   0x200386
    #define NCBootblock1_Proxy		           0x200387
    #define NCBootblock1_PinInfo		   0x200388
    #define NCBootblock1_UnblockCHV		   0x200389
  #endif /* NCBootblock1_EnumerateNetworkDrivers */

  #ifndef SCInterface1_ChangeCHV
    #define SCInterface1_GetATR                    0x200344
    #define SCInterface1_ChangeCHV                 0x200345
    #define SCInterface1_UnBlockCHV		   0x200347
    #define SCInterface1_FileInfo		   0x200348
    #define SCInterface1_Status		           0x20034a
  #endif /* SCInterface1_ChangeCHV */
#endif /* TWIN_SMARTCARD_DEMO */



#define REGISTRY_STATUS      0xba
#define REGISTRY_STATUS1     0x2ba

#define SELECT_NET_STATUS    0x1
#define SELECT_SC_STATUS     0x2

#define BB_STATUS_INSERTED   0x1
#define BB_STATUS_SC_VALID   0x2
#define BB_STATUS_BB_VALID   0x4
#define BB_STATUS_PIN	     0x8  /* boot block is chv1 protected */
#define BB_STATUS_LOCKED     0x10 /* protected bootblock is locked, ie no valid authentication has taken place */
#define BB_STATUS_WRITEOK    0x20
#define BB_STATUS_WRITEFAIL  0x40
#define BB_STATUS_CLIENT     0x80
#define BB_STATUS_AUTHFAIL   0x100 /* authentication failure */
#define BB_STATUS_TOO_OLD    0x200 /* bootblock major version too old */
#define BB_STATUS_TOO_NEW    0x400 /* bootblock major version too new */
#define BB_STATUS_READOK     0x800
#define BB_STATUS_READFAIL   0x1000
#define BB_STATUS_BADVERSION 0x2000

#define CARD_SCAN_TIMEOUT    5

DECLARE int registry_status INIT(0);
DECLARE int registry_delta INIT(0);

DECLARE char unblock_pin[12];
DECLARE int unblock_pin_size INIT(0);
DECLARE char chv_pin[12];
DECLARE int chv_pin_size INIT(0);
DECLARE char old_chv_pin[12];
DECLARE int old_chv_pin_size INIT(0);

#ifdef CHIMPANZEE_INTERFACE
#define MAX_DEFAULT_PIN       8
#define DEFAULT_PIN	      "0000"
DECLARE int default_pin(void);
#endif

DECLARE int smartcard_status(int *);
DECLARE int smartcard_present(void);
DECLARE int smartcard_valid(void);
DECLARE int smartcard_pin_protected(void);
DECLARE int smartcard_blocked(void);
DECLARE int validate_pin(char *);
DECLARE int registry_status_asserted(int);
DECLARE int registry_status_cleared(int);
DECLARE int registry_status_set(int);
DECLARE int registry_status_clear(int);
DECLARE int registry_status_changed(int);
DECLARE int change_pin(char *);
DECLARE int do_unblock_pin(char *);
DECLARE int bootblock_read_succeeded(void);
DECLARE int bootblock_read_failed(void);
DECLARE int bootblock_write_succeeded(void);
DECLARE int bootblock_write_failed(void);
DECLARE int poll_bootblock_write(void);
DECLARE int smartcard_present_low_level(void);

#ifdef TWIN_SMARTCARD_DEMO
  DECLARE int smartcard1_present(void);
  DECLARE int smartcard1_status(int *);
  DECLARE int smartcard1_pin_protected(void);
  DECLARE int smartcard1_blocked(void);
  DECLARE int smartcard1_present_low_level(void);
  #ifdef CHIMPANZEE_INTERFACE
    #define MAX_DEFAULT1_PIN       8
    #define DEFAULT1_PIN          "0000"
    DECLARE int default_pin1(void);
  #endif
#endif /* TWIN_SMARTCARD_DEMO */


/* Begin-Epilogue */
#undef PROTOTYPES_INTERNAL
#undef INIT
#undef DECLARE
#endif
/* End_Epilogue */

