                TFTP Client Software Functional Specification
                =============================================

                    Drawing Number:         2209,503/FS
                    Issue:                  A
                    Date:                   29 July 1999
                    Previous Issue:         
                    Status:                 Draft
                    Change:
                    Author:                 Kevin Bracey
                    Classification:         Pace Secret
                    Master Format:          Plain text



Contents
========

 1  Copyright
 2  Scope and Purpose of Document
 3  Overview
 4  Client Features
 5  Limitations
 6  User Interface
 A  References



1.  Copyright
=============

This document is copyright (C) Pace Micro Technologies 1999.


2.  Scope and Purpose of Document
=================================

This document details a RISC OS Trivial File Transfer Protocol (TFTP) client
with multicasting extensions, implemented as a relocatable module. This
specification assumes familiarity with the TFTP documentation in the
references.


3.  Overview
============

The RISC OS TFTP module provides a simple yet powerful client implementation of
the Internet Trivial File Transfer Protocol (TFTP). It supports file reading
only, but implements many of the recent TFTP extensions, including multicast.


4.  Client Features
===================

Can stream to a file, load a relocatable module, or execute an Obey file.
Supports TFTP option negotiation, as per RFC 2347.
Can support up to 16K blocksize, negotiated as per RFC 2348.
Requests transfer size option as per RFC 2349 to allow early abort.
Supports TFTP Multicast as per RFC 2090.
*Command interface, with GSTransed parameters.
Can set Inet$Error rather than returning an error.
Cooperates with task windows.
Re-entrant, so that multiple concurrent operations possible via task windows.
Exponential backoff.
Detects ICMP Destination Unreachable messages.
Handles escape conditions gracefully.
Uses "minimize delay" TOS.
Fast acknowledgement - ACK is sent before data written to file.
Module is only 8K when squeezed.
Static RAM usage a little over 4K (minimum for a C module is 3.5K).


5.  Limitations
===============

Only reading is supported.
Doesn't "dally" after sending final ACK.
Doesn't retry RRQ if RRQ with options causes an ERROR.
*TFTPLoadModule and *TFTPObey don't allow parameters to be passed.


6.  User Interface
==================

The TFTP module provides the following two *Commands.


                                                              *TFTPRead
                                                              =========

   Read a file from a TFTP server.

Syntax
------
   *TFTPRead [-e] [-netascii|-octet] <server> <server_filename> <local_filename>

Parameters
----------
   -e               If an error occurs, set Inet$Error instead of
                    returning an error.

   -netascii        Fetch in netascii (text) mode. Also -a.

   -octet           Fetch in octet (binary) mode (the default).
                    Also -b.

   server           The name or address of the TFTP server.

   server_filename  The file to download from the server.

   local_filename   The filename to save the file as locally.

Use
---
   *TFTPRead reads the file <server_filename> from the
   server <server>, saving it as <local_filename>. The
   file can be transferred either in netascii or octet mode.

   If transferred in netascii mode, line endings are converted
   to RISC OS format.

   If the server filename ends in ",xxx" where xxx are hex
   digits, the file's type is set accordingly; this mimics the default
   behaviour of NFS. Otherwise the type is set to Text or Data
   for netascii and octet modes respectively.

Example
-------
   *TFTPRead -netascii server-1 index.txt Index

Related commands
----------------
   *TFTPLoadModule



                                                        *TFTPLoadModule
                                                        ===============

   Load a relocatable module from a TFTP server.

Syntax
------
   *TFTPLoadModule [-e] <server> <server_filename>

Parameters
----------
   -e               If an error occurs, set Inet$Error instead of
                    returning an error.

   server           The name or address of the TFTP server.

   server_filename  The file to download from the server.

Use
---
   *TFTPLoadModule reads the file <server_filename> in octet mode from
   the server <server>, and installs it as a relocatable module.

Example
-------
   *TFTPLoadModule server-1 mymodule

Related commands
----------------
   *TFTPRead, *RMLoad (PRM 1-274)



                                                              *TFTPObey
                                                              =========

   Run on Obey file stored on a TFTP server.

Syntax
------
   *TFTPObey [-e] [-v] <server> <server_filename>

Parameters
----------
   -e               If an error occurs, set Inet$Error instead of
                    returning an error.

   -v               Echo each line before it is executed (*Obey's
                    -v flag).

   server           The name or address of the TFTP server.

   server_filename  The file to download from the server.

Use
---
   *TFTPObey reads the file <server_filename> in netascii mode from
   the server <server>, and executes it as an Obey file. The file
   is cached in memory before execution starts.

   The Obey file may start a new application - appropriate safeguards
   are taken.

Example
-------
   *TFTPObey server-1 !BootTFTP

Related commands
----------------
   *TFTPRead, *Obey (PRM 4-350)


A.  References
==============

RFC 1123 Requirements for Internet Hosts -- Application and Support
RFC 1350 THE TFTP PROTOCOL (REVISION 2)
RFC 1785 TFTP Option Negotiation Analysis
RFC 2090 TFTP Multicast Option
RFC 2347 TFTP Option Extension
RFC 2348 TFTP Blocksize Option
RFC 2349 TFTP Timeout Interval and Transfer Size Options

