/* Centralised control for trace/debug output
 */

#include "NFS.h"
#if DEBUGON

#include <string.h>
#include <stdarg.h>
#include <stdio.h>

#include "db.h"

#define FrequentClose 0
#define FrequentFlush 0

#define DEBUGFILE "InetDev:debugf"

static FILE *debugf = NULL;

void db_off(void)
  {
  if (debugf) fclose(debugf);
  debugf = NULL;
  }

void db_trace(char *format, ...)
  {
  va_list args;
  if (debugf==NULL)
    debugf = fopen(DEBUGFILE,"w");
#if FrequentClose
  else
    debugf = fopen(DEBUGFILE,"a");
#endif
  if (debugf==NULL) return;
  va_start(args, format);
  if (strlen(format) > 0)
    {
    vfprintf(debugf, format, args);
#if FrequentFlush
    fflush(debugf);
#endif
#if FrequentClose
    fclose(debugf);
#endif
    }
  va_end(args);
  }

int db_is_on(void)
  {
  return debugf != NULL;
  }

#endif
