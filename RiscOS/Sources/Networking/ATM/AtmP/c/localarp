/*	LOCALARP.C

© Acorn Computers Ltd

Project :
Module:

Purpose:


History:

Date      Who     Description of change
===========================================
5/6/98     CP     Header added

                  Converted to use Acorn's DCI headers

***************************************************************************/
/* arp.c */
#include "kernel.h"
#include "swis.h"
/*#include "dci4.h"*/
#include "sys/dcistructs.h"
#include "sys/types.h"
#include "strings.h"
#include "module.h"
#define PROTOTYPES_INTERNAL
#include "localarp.h"
#include "utils.h"
#include "dci_stuff.h"


void local_arp(void)
{
    struct ether_arp *ea = (struct ether_arp *)arpbuf;
    u_short op = ntohs(ea->arp_op);

    if (arplen == sizeof(struct ether_arp) && op == ARPOP_REQUEST) {
        memcpy(&macadr[2], ea->arp_spa, 4);
        if (memcmp(ea->arp_spa, ea->arp_tpa, 4) != 0) {
            memcpy(ea->arp_spa, ea->arp_tpa, 4);
            memset(ea->arp_sha, 0, 2);
            memcpy(&ea->arp_sha[2], ea->arp_tpa, 4);
            ea->arp_op = htons(ARPOP_REPLY);
            rx_dci(arpbuf, arplen, MESSAGE_TYPE_ARP);
        }
    }
    arplen = 0;
}
