	GET	Hdr:ListOpts
	GET	Hdr:Macros
	GET	Hdr:System
	GET	Hdr:HostFS
	GET	Hdr:NdrDebug
	GET	Hdr:DDVMacros

	AREA	customcalls,  PIC, CODE, REL, READONLY

	GBLL	debug
	GBLL	hostvdu

debug	SETL	false
hostvdu	SETL	true

stuff	SETD	true

	EXPORT	callproto
	EXPORT	|asm_status_changed|

callproto
	MOV	R12, R3
	MOV	R15, R2

|asm_status_changed|
	STMFD	sp!, {r0-r3, r12, lr}

	Debug	stuff, "sp", sp
	Debug	stuff, "lr", lr

	LDMIA	r12!, {r1-r3}
	MOV	r0, #0
	STR	r0, [r12], #4
	LDR	r12, [r12]

	Debug	stuff, "handle", r1
	Debug	stuff, "state", r2
	Debug	stuff, "routine", r3
	Debug	stuff, "workspace", r12

	MOV	lr, pc
	ADD	lr, lr, #return-.-4

	MOV	pc, r3

return
	Debug	stuff, "returned"

	LDMFD	sp!, {r0-r3, r12, lr}

	Debug	stuff, "sp", sp
	Debug	stuff, "lr", lr

	MOVS	pc, lr

 [ debug
	InsertNDRDebugRoutines
 ]

	LTORG

	END
