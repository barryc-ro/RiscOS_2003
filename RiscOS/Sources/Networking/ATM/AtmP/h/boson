#ifndef AtmP_boson_h
#define AtmP_boson_h

/* File:    boson.h
   Purpose: Interface to Boson ASIC handling routines
   Author:  Ben Laughton

   Copyright 1999 Element 14 Ltd.

   This material is the confidential trade secret and proprietary information
   of Element 14 Ltd. It may not be reproduced, used sold, or transferred to
   any third party without the prior written consent of Element 14 Ltd.
   All rights reserved.

   History:

   1999-02-24: BAL
   Inherited and added this header
 */




/* =============================================================================
 * Include header files
 */

/* CLib */
#include "kernel.h"
#include <stddef.h>

/* Local */
#include "module.h"




/* =============================================================================
 * Constants definitions
 */

#define Boson_BlockToARMAddr    ((volatile unsigned int *)(0x88800280 + (podule<<24)))
#define Boson_CommitFromARMAddr ((volatile unsigned int *)(0x888002c0 + (podule<<24)))




/* =============================================================================
 * Macro defintions
 */

#define CMD_MSG(_handle, _cmd, _param) \
 ((_handle & 0x3ff) | 0x400 | ((_cmd & 0xf) << 11) | ((_param & 0xffffU) << 16))

#define ASM_GET_MSG(reg, buf, size)\
    if ((reg) != 0 && (buf) != NULL && (size) != 0) asm_get_msg (reg, buf, size)




/* =============================================================================
 * Global variable declarations
 */

extern int  timeoutError;
extern int  irq_closes;
extern int  irq_closeds;
extern int  irq_errors;
extern int  irq_connects;
extern int  irq_connect_reqs;
extern int  irq_data_ends;
extern int  irq_datas;
extern int  irq_refusals;
extern int  irq_packets;
extern int  irq_rx_discards;
extern int  irq_rx_errors;
extern int  irq_con_req_errors;
extern int  irq_con_ack_errors;
extern int  irq_con_req_acks;
extern int  irq_con_refusals;
extern int  irq_connection_errors;
extern int  irq_bogus_pkts;
extern int  irq_pkt_hiwm;
extern int  irq_buffer_recovers;
extern int  irq_ip_pkts_dropped;
extern int  irq_data_aborts;
extern int  irq_data_lengths;
extern unsigned char  irq_buffer[];




/* =============================================================================
 * Function prototype declarations
 */

#ifdef __cplusplus
extern "C"
{
#endif

extern void asm_get_msg (unsigned int *   reg,
                         unsigned char *  buf,
                         unsigned int     size);

extern void asm_junk_msg (unsigned int  reg,
                          unsigned int  size);

extern int asm_write_fifo (unsigned int     handle,
                           const int        command,
                           unsigned char *  buf,
                           unsigned int     size,
                           unsigned int *   reg);

extern int  boson_fifo_space (void);
extern void boson_block_write (unsigned int  w);
extern unsigned int boson_block_read (void);

extern int  boson_tx_data (const int             handle,
                           const unsigned int *  data,
                           int                   data_bytes);

extern _kernel_oserror *  boson_display_trail (int  argc, char *  argv[]);
extern _kernel_oserror *  boson_display_status (int  argc, char *  argv[]);
extern _kernel_oserror *  boson_display_info (int argc, char *  argv[]);

extern _kernel_oserror *  boson_claim_interrupts (void);
extern _kernel_oserror *  boson_release_interrupts (void);
extern void  boson_enable_interrupts (void);
extern void  boson_disable_interrupts (void);
extern void  boson_disable_all_interrupts (void);

extern int ensure_irqs_off (void);
extern int ensure_irqs_on (void);
extern void restore_irqs (int);

#ifdef __cplusplus
} /* extern "C" */
#endif

#endif
