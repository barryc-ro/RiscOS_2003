#include <stdio.h>
#include "kernel.h"
#include "swis.h"

#include "nt_nvram.h"

static char tag[] = "SystemTime";

int nvram_gettime(void)
{
    _kernel_swi_regs r;
    char time[8];

    r.r[0] = (int)tag;
    r.r[1] = (int)&time;
    r.r[2] = 8;
    _kernel_swi(NVRAM_Read, &r, &r);

    return(*(int *)time);
}

void nvram_settime(int time)
{
    _kernel_swi_regs r;

    r.r[0] = (int)tag;
    r.r[1] = (int)&time;
    r.r[2] = 4;
    _kernel_swi(NVRAM_Write, &r, &r);
    return;
}

int read_os_var(char *varname, char *buff, int n)
{
  _kernel_swi_regs r;

  r.r[0] = (int)varname;
  r.r[1] = (int)buff;
  r.r[2] = (buff==NULL)?0x80000000:n;
  r.r[3] = 0;
  r.r[4] = 0;
  if(_kernel_swi(OS_ReadVarVal, &r, &r) != NULL) return(-1);
  if(buff) {
      *(buff + r.r[2]) = 0;
      return(r.r[2]);
  }
  return(-(r.r[2]));

}
