; General purpose full 32-bit multiply (to 64-bit result).
; Adapted from code in back of Acorn Assembler manual.

	AREA |C$$Code|, CODE, READONLY

	EXPORT mul64[LEAF]
mul64
	STMFD	sp!,{v1-v2,lr}
	MOVS	v2,a1,LSR #16
	BIC	a1,a1,v2,LSL #16
	MOV	v1,a2,LSR #16
	BIC	a2,a2,v1,LSL #16
	MUL	a4,a1,a2
	MUL	a2,v2,a2
	MUL	a1,v1,a1
	MULNE	v2,v1,v2
	ADDS	a1,a1,a2
	ADDCS	v2,v2,#&10000
	ADDS	a4,a4,a1,LSL #16
	ADC	v2,v2,a1,LSR #16
	STMIA	a3,{a4,v2}
	LDMFD	sp!,{v1-v2,pc}^

	END
