; Title:   s.ExtLib
; Purpose: Resolver utility functions
;

        AREA    Resolver_Utilities,REL,CODE,READONLY
	GET	hdr.RegDefs
	GET	hdr.SwiNos

	EXPORT	filedate
        EXPORT  collect_callbacks


; Takes filepath pointer in R0, and returns in R0 date/time stamp of that file
; as centi-seconds since 1st Jan 1900 / 256.
; returns 0 if no file found.
filedate
	STMFD	sp!, {r4-r6, link}
	MOV	r1, r0
	MOV	r0, #23
	SWI	XOS_File
	TEQ	r0, #0
	MOVNE	r0, r3, LSR #8
	ORRNE	r0, r0, r2, LSL #24
	LDMFD	sp!, {r4-r6, pc}

; Enclosed is the source to the function user_mode_donothing.  This drops you
; into user mode, does an OS_Byte 0,1 and then returns to supervisor mode.
; As the OS returns from the OS_Byte call callbacks are collected.

; _kernel_oserror *collect_callbacks();
collect_callbacks
        STMFD	sp!, {r0-r2, link}
        TSTP 	pc,#&fc             	; Set User_mode.
        MOV	r0, r0			; NOP
        MOV 	r0, #0
        MOV 	r1, #1
        SWI 	OS_Byte
        SWI 	OS_EnterOS              ; Set SVC mode.
        MOV	r0, r0                  ; NOP
	LDMFD	sp!, {r0-r2, pc}^	; Exit with no recovery

        END
