/****************************************************************************
/
/    Copyright 1988,1989,1990,1991,1992,1993,1994. All Rights Reserved by:
/        Cirrus Logic, Inc.
/        3100 West Warren Avenue
/        Fremont, CA 94538
/        (510) 623-8300
/
/
/   This document contains material confidential to Cirrus Logic its contents must
/    not be revealed, used or disclosed to anyone or company with out
/    written permission by Cirrus Logic.  The information contained herein is solely
/    for the use of RSA.
/
/    File:        ptt00cfg.c
/
/    Module Version: ACU
/
/    Function:
/
/
/    Product:    ACU core code
/
/  History:
/
/
/        Created: 5/22/96
/
/
/        ---------------------------------------------------------
/        -            Modifications            -
/        ---------------------------------------------------------
/
/        Author & Date:    Cirrus
/        Description:
/        Reason:
/
*****************************************************************************/
#include   <string.h>
#include "sys_def.h"
#include "acu_def.h"
#include "acu_mem.h"
#include "mt_pro.h"
#include "ee_def.h"
#include "ptt.h"
#include "homolig1.h"

/***********************************************/
/*   ac00ptt.c required global variable        */
/***********************************************/

ubyte CountryInfo;
ubyte BlackNoEntry;
ubyte AvailableCell;
ubyte ToneModeSwitch;
ubyte ToneResult;
ubyte DigitCode;
ubyte black_size;
ubyte ErrorCode;
int OnTime;
int OffTime;
ubyte ToneStatus;
ubyte BlackListDialed;

BlackList BlackLst[BLACKLIST_MAX_CELL_NUM];
ToneModeEntry Tone[NoOfTonesPerCountry];
ubyte TmpPhoneCell[30];
ubyte *TmpDialPtr;
uword tempp1;
ubyte busy_count[4];
struct SREG22 s22orig;
/***********************************************/
/*             Black List Table                */
/***********************************************/
const ubyte ReservedSpace[8] = {-1,-1,-1,-1,-1,-1,-1,-1};
#if 1
country_black_list_table PTTBlackLst[7] = {
/* U.S.A. Black List Table */
    {1,                             /* Retry times */
     1,                           /* Maximum phone cells */
     0,                                /* Cycle timing */
     {0,0,0,0,0,0,0,0,0,0,0,0}    /* Retry timing */
    },

/* Japan Black List Table */
    {3,
    12,
     180,
     {0,0,0,255,255,255,255,255,255,255,255,255}
    },

/* United Kingdom Black List Table */
    {7,
     12,
       7200,
     {5,120,120,120,120,120,120,255,255,255,255,255}
    },

/* Germany Black List Table */
    {2,
    1,
     30,
     {30,255,255,255,255,255,255,255,255,255,255,255}
    },

/* France Black List Table*/
    {6,
    12,
     65535,
     {60,60,60,60,60,60,255,255,255,255,255,255}
    },

/* Netherland Black List Table*/
    {6,
    12,
      65535,
     {60,60,60,60,60,60,255,255,255,255,255,255}
    },

/* Gereric Country Black List Table */
    {9,
    12,
     7200,
     {5,5,5,5,120,120,120,120,255,255,255,255}
    },
    };
#endif

/***********************************************/
/*    Call Progress Tone A Cadence             */
/***********************************************/
country_tone_table PTT_Tone[7] = {
/* U.S.A. Tone Table */
    {
        1,0xee,  50,  5,  0,  0,1,0xee,         /* Dial Tone */
        2,0xee,  90, 40, 90, 40,3,0xee,          /* Busy Tone 1 */
        2,0xee,  90, 40, 90, 40,3,0xee,          /* Busy Tone 2 */
        2,0xee,  90, 40, 90, 40,3,0xee,          /* Congestion Tone 1 */
        2,0xee,  90, 40, 90, 40,3,0xee,          /* Congestion Tone 2 */
        2,0xee,  240,140,420,390,5,0xee            /* Ring Back Tone*/
    },

/* Japan Tone Table */
    {
        1,0xee, 100, 90,  0,  0,1,0xee,        /* Dial Tone */
        2,0xee,  95, 40, 55, 30,3,0xee,        /* Busy Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Busy Tone 2 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 105, 90,205,180,5,0xee            /* Ring Back Tone */
    },

/* United Kingdom Tone Table */
    {
        1,0xee,2000,100,  0,  0,1,0xee,        /* Dial Tone */
        2,0xee,  45, 35, 45, 35,3,0xee,        /* Busy Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Busy Tone 2 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 110, 80,205,185,5,0xee           /* Ring Back Tone */
    },

/* Germany Tone Table */
    {
        1,0xee,2000, 10,  0,  0, 1,0xee,        /* Dial Tone */
        2,0xee,  53, 43,  53, 43,3,0xee,        /* Busy Tone 1 */
        2,0xee,  21,  9,  58, 38,3,0xee,        /* Busy Tone 2 */
        2,0xee,  27, 21,  30, 26,3,0xee,        /* Congestion Tone 1 */
        2,0xee,  21,  9,  58, 38,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 111, 78, 441,369,5,0xee              /* Ring Back Tone */
    },

/* France Tone Table */
    {
        1,0xee,2000,100,  0,  0,1,0xee,         /* Dial Tone */
        2,0xee,  60, 40, 60, 40,3,0xee,        /* Busy Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Busy Tone 2 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 180,100,360,300,5,0xee            /* Ring Back Tone */
    },

/* Netherland Tone Table */
    {
        1,0xee,2000,100,  0,  0,1,0xee,        /* Dial Tone */
        2,0xee,  90, 30, 90, 30,3,0xee,        /* Busy Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Busy Tone 2 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 1 */
        2,0xee,   0,  1,  0,  1,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 130, 60,420, 60,5,0xee            /* Ring Back Tone */
    },

/* Gereric Country Tone Table*/
    {
        2,0xee,  70, 35,120,  50,1,0xee,        /* Dial Tone */
        2,0xee,  45, 15, 45,  15,3,0xee,        /* Busy Tone 1 */
        2,0xee,   0,  1,  0,   1,3,0xee,        /* Busy Tone 2 */
        2,0xee,   0,  1,  0,   1,3,0xee,        /* Congestion Tone 1 */
        2,0xee,   0,  1,  0,   1,3,0xee,        /* Congestion Tone 2 */
        2,0xee, 120, 80,410,  50,5,0xee       /* Ring Back Tone */
    },
};


/* shujin 1/19/98 */
/***************************************************/
/*    Call Progress Ring Period and Candence       */
/*    The table contains the period i.e. 1/f in ms */
/***************************************************/
country_ring_table    PTT_Ring[7] = {
    {14,66, 125,490, 175,2250, 500,4450},   /*   U.S.A. */
    {14,66, 125,490, 175,2250, 500,4450},   /* ? Japan. */
    {14,66, 125,490, 175,2250, 500,4450},   /* ? United Kingdom. */
    {18,48, 125,490, 210,6500, 500,5500},   /*   Germany */
    {14,66, 125,490, 175,2250, 500,4450},   /* ? France */
    {14,66, 125,490, 175,2250, 500,4450},   /* ? Netherland */
    {14,66, 125,490, 175,2250, 500,4450},   /* ? Gereric Country*/
    };

/***********************************************/
/*    Call Progress Tone A Biquad Coefficient  */
/***********************************************/

country_filter_taps PTT_Taps[7] = {
/* U.S.A. Tone A filter taps */
    {16384,                /*b12*/
     -28708,             /*b11*/
     16384,                /*b10*/
     -15987,             /*a12*/
     31396,                /*a11*/
     16383,                /*b22*/
     -32444,             /*b21*/
     16384,                /*b20*/
     -15918,             /*a22*/
     30949,                /*a21*/
    },

/*Center frequency 420, Band width 250*/

/* Japan Tone A filter taps */
    {16384,                /*b12*/
     -28708,             /*b11*/
     16384,                /*b10*/
     -15987,             /*a12*/
     31396,                /*a11*/
     16383,                /*b22*/
     -32444,             /*b21*/
     16384,                /*b20*/
     -15918,             /*a22*/
     30949,                /*a21*/
    },

/* United Kingdom Tone A filter taps */
    {16384,                /*b12*/
     -28708,             /*b11*/
     16384,                /*b10*/
     -15987,             /*a12*/
     31396,                /*a11*/
     16383,                /*b22*/
     -32444,             /*b21*/
     16384,                /*b20*/
     -15918,             /*a22*/
     30949,                /*a21*/
    },

/* 437, 115 Germany Tone A filter taps */
    {1638,                 /*b12*/
     -2576,             /*b11*/
     1638,                /*b10*/
     -15653,            /*a12*/
     30413,                /*a11*/
     16383,                /*b22*/
     -32540,             /*b21*/
     16384,                /*b20*/
     -15802,            /*a22*/
     31173,                /*a21*/
    },

/* France Tone A filter taps */
    {1638,                 /*b12*/
     -3270,             /*b11*/
     1638,                /*b10*/
     -15574,            /*a12*/
     31150,                /*a11*/
     16383,                /*b22*/
     -6561,             /*b21*/
     16383,                /*b20*/
     -15012,            /*a22*/
     28969,                /*a21*/
    },

/* Netherland Tone A filter taps */
    {1638,                 /*b12*/
     -3270,             /*b11*/
     1638,                /*b10*/
     -15574,            /*a12*/
     31150,                /*a11*/
     16383,                /*b22*/
     -6561,             /*b21*/
     16383,                /*b20*/
     -15012,            /*a22*/
     28969,                /*a21*/
    },

/* Gereric Country Tone A filter taps */
    {1638,                 /*b12*/
     -3270,             /*b11*/
     1638,                /*b10*/
     -15574,            /*a12*/
     31150,                /*a11*/
     16383,                /*b22*/
     -6561,             /*b21*/
     16383,                /*b20*/
     -15012,            /*a22*/
     28969,                /*a21*/
    },
    };

/***********************************************/
/*                    DTMF                                */
/***********************************************/
country_DTMF_Level PTT_DTMF_Level[7] = {
    {78, 58,0xFFFF},    /* US DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
    {88, 68,0xFFFF},    /* JP DTMF Lvl_1 = -9.00dBm Lvl_2 = -7.00dBm */
    {108,88,0xFFFF},    /* GB DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
    {108,78,0xFFFF},    /* GR DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
    {78, 58,0xFFFF},    /* FR DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
    {108,88,0xFFFF},    /* NT DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
    {78, 58,0xFFFF},    /* IT DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
    };

/***********************************************/
/*    International S Registers                      */
/***********************************************/
country_depend_S_registers PTT_SReg[7] = {
    {    /* USA */
        {0 ,  0,255,0xFE},   /* S0 */
        {2 ,  2,255,0xFE},    /* S6 */
        {60,  1,255,0xFE},    /* S7 */
        {2 ,  0,255,0xFE},    /* S8 */
        {14,  1,255,0xFE},    /* S10*/
        {70, 50,255,0xFE},    /* S11*/
        {0x76,0,255,0xFE},    /* S22*/
        {0x0f,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x11,0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91*/
    },
    {    /* JAPAN */
        {0 ,  0,255,0xFE},    /* S0 */
        {3 ,  3,255,0xFE},    /* S6 */
        {60,  1,255,0xFE},    /* S7 */
        {2 ,  0,255,0xFE},    /* S8 */
        {14,  1,255,0xFE},    /* S10*/
        {70, 60,255,0xFE},    /* S11*/
        {0xf6,0,255,0xFE},    /* S22*/
        {0x0f,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x19,0,255,0xFE},    /* S31*/
        {15,  6, 15,0xFE},    /* S91 and S92 */
    },
    {    /* UNITED KINGDOM */
        {0 ,  0,255,0xFE},   /* S0 */
        {4 ,  4,  8,0xFE},    /* S6 */
        {60,  1,255,0xFE},    /* S7 */
        {4 ,  4, 11,0xFE},    /* S8 */
        {14,  1,255,0xFE},    /* S10*/
        {70, 70,255,0xFE},    /* S11*/
        {0x76,0,255,0xFE},    /* S22*/
        {0x81,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x19,0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91 and S92 */
    },
    {    /* GERMANY */
        {0 ,  0,  9,0xFE},   /* S0 */
        {3 ,  3,  9,0xFE},    /* S6 */
        {60,  1, 99,0xFE},    /* S7 */
        {2 ,  0, 10,0xFE},    /* S8 */
        {14,  1, 99,0xFE},    /* S10*/
        {90, 90, 90,0xFE},    /* S11*/
        {0x76,0,255,0xFE},    /* S22*/
        {0x81,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x19,0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91 and S92 */
    },
    {    /* FRANCE */
        {0 ,  0,  3,0xFE},   /* S0 */
        {6 ,  6, 12,0xFE},    /* S6 */
        {60, 35, 60,0xFE},    /* S7 */
        {2 ,  0,255,0xFE},    /* S8 */
        {14,  1, 99,0xFE},    /* S10*/
        {70, 70, 85,0xFE},    /* S11*/
        {0x76,0,255,0xFE},    /* S22*/
        {0x81,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x19,0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91 and S92 */
    },
    {    /* NETHERLAND */
        {0 ,  0,255,0xFE},   /* S0 */
        {2 ,  2, 12,0xFE},    /* S6 */
        {60,  1,120,0xFE},    /* S7 */
        {2 ,  0,255,0xFE},    /* S8 */
        {14,  1, 99,0xFE},    /* S10*/
        {70, 70,255,0xFE},    /* S11*/
        {0x76,0,255,0xFE},    /* S22*/
        {0x81,0,255,0xFE},    /* S23*/
        {0x40,0,255,0xFE},    /* S27*/
        {0x19,0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91 and S92 */
    },
    {    /* Gereric Country */
        {0 ,  0,255,0xFE},   /* S0 */
        {2 ,  2, 12,0xFE},    /* S6 */
        {60,  1,120,0xFE},    /* S7 */
        {2 ,  0,255,0xFE},    /* S8 */
        {14,  1, 99,0xFE},    /* S10*/
        {70, 70,255,0xFE},    /* S11*/
        {0 ,  0,255,0xFE},    /* S22*/
        {0 ,  0,255,0xFE},    /* S23*/
        {0 ,  0,255,0xFE},    /* S27*/
        {0 ,  0,255,0xFE},    /* S31*/
        {10,  9, 16,0xFE},    /* S91 and S92 */
    },
    };


/***********************************************/
/*    International Dial Tone Time Out              */
/***********************************************/
const uword PTT_DialToneTimeOut[8] = {
    500,         /* U.S.A. */
    1000,        /* Japan */
    1000,        /* United Kingdom */
    1900,        /* Germany */
    600,         /* France */
    500,         /* Netherland */
    500,         /* Gereric Country */
    0xFFFF       /* For alignment purpose*/
    };

/***********************************************/
/*    International Hook Flash Time               */
/***********************************************/
const uword PTT_HookFlash[8] = {
    50,         /* U.S.A. */
    50,         /* Japan */
    50,         /* United Kingdom */
    25,         /* Germany */
    270,        /* France */
    115,        /* Netherland */
    50,         /* Gereric Country */
    0xFFFF        /* For alignment purpose */
    };

/***********************************************/
/*    International Pulse Stop Time               */
/***********************************************/
// resolution is 50ms.  15x50=750
const ubyte PTT_PulseStop[NUM_OF_COUNTRIES_SUPPORTED] = {
    15,         /* U.S.A. */
    15,         /* Japan */
    15,         /* United Kingdom */
    15,         /* Germany */
    15,         /* France */
    15,         /* Netherland */
    15,         /* Gereric Country */
//    255         /* for alignment purpose */
    };
/***********************************************/
/*    International Data/Fax Transmit Level      */
/***********************************************/
country_transmit_level PTT_TransmitLevel[7] = {
    {0x1F60,0x1F60},     /* U.S.A. */
    {0x1F60,0x1F60},     /* Japan */
    {0x1F60,0x1F60},     /* United Kingdom */
    {0x1F60,0x1F60},     /* Germany */
    {0x1F60,0x1F60},     /* France */
    {0x1F60,0x1F60},     /* Netherland */
    {0x1F60,0x1F60},     /* Gereric Country */
    };

/***********************************************/
/* International Pulse Make Break Time Table      */
/***********************************************/
country_Make_Break_Time PTT_MakeBreak_Time[7] = {
    {61,39,67,33},    /* U.S.A. */
    {67,33,67,33},    /* Japan */
    {67,33,67,33},    /* United Kingdom */
    {60,40,60,40},    /* Germany */
    {67,33,67,33},    /* France */
    {62,38,62,38},    /* Netherland */
    {67,33,67,33},    /* Gereric Country */
    };

/***********************************************/
/* ATI7 Information                                       */
/***********************************************/

#if INTERNATIONAL_CODE == 1
const ubyte ati7[60] = {
    'G','E','R','M','A','N',' ','V','E','R','S','I','O','N',' ',' ',' ',' ',' ',' ',
    'M','O','D','E','M',' ','E','N','G','I','N','E','E','R','I','N','G',' ',' ',' ',
    'C','I','R','R','U','S',' ','L','O','G','I','C',' ','1','2','1','6','9','7',0
    };
#else
const ubyte ati7[60] = {
    'C','I','R','R','U','S',' ','L','O','G','I','C',',',' ','I','N','C','.',' ',' ',

    'M','O','D','E','M',' ','E','N','G','I','N','E','E','R','I','N','G',' ',' ','F',

    'I','R','M','W','A','R','E',' ','D','E','P','A','R','T','M','E','N','T',0
    };
#endif

/***********************************************/
/* ATI10 Information                                     */
/***********************************************/
const ubyte ati10[4] = {-1,-2,-3,-4};

/***********************************************/
/* ATI11 Information                                   */
/***********************************************/
/*const ubyte ati11[1] = {-2};*/



/*    ***** BA ***** */
/***********************************************/
/* ATI4 Information                                       */
/***********************************************/
const ubyte ati4[60] = {
    'G','E','R','M','A','N',' ','V','E','R','S','I','O','N',' ',' ',' ',' ',' ',' ',
    'M','O','D','E','M',' ','E','N','G','I','N','E','E','R','I','N','G',' ',' ',' ',
    'C','I','R','R','U','S',' ','L','O','G','I','C',' ','X','X','X','X','X','X',0
    };

/*********************************************/
/*********************************************/
/***  The following data not to be changed ***/
/***  by Configuration Utility             ***/
/*********************************************/
/*********************************************/

/*************************************/
/* Nominal ON_OFF time for ring back */
/*************************************/
country_Nominal_RingBack_Cadence PTT_RingBack[7] = {
    {200,400},  /* U.S.A. */
    {100,200},  /* Japan */
    {100,200},  /* United Kingdom */
    {95,385},   /* Germany */
    {150,350},  /* France */
    {100,400},  /* Netherland */
    {100,400},  /* Gereric Country */
    };

/***********************************************/
/*             DTMF single level                       */
/***********************************************/
const ubyte DTMFLvl[28] = {
    0,        /* -0.0  dBm */
    8,        /* -1.0  dBm */
    18,    /* -2.0  dBm */
    28,    /* -3.0  dBm */
    38,    /* -4.0  dBm */
    48,    /* -5.0  dBm */
    58,    /* -6.0  dBm */
    68,    /* -7.0  dBm */
    78,    /* -8.0  dBm */
    88,    /* -9.0  dBm */
    98,    /* -10.0 dBm */
    108,    /* -11.0 dBm */
    119,    /* -12.0 dBm */
    129,    /* -13.0 dBm */
    139,    /* -14.0 dBm */
    149,    /* -15.0 dBm */
    159,    /* -16.0 dBm */
    169,    /* -17.0 dBm */
    179,    /* -18.0 dBm */
    189,    /* -19.0 dBm */
    199,    /* -20.0 dBm */
    209,    /* -21.0 dBm */
    219,    /* -22.0 dBm */
    229,    /* -23.0 dBm */
    239,    /* -24.0 dBm */
    249,    /* -25.0 dBm */
    255,    /* For alignment purpose */
    255    /* For alignment purpose */
    };

/***********************************************/
/*    Data/Fax Transmit Level    Addressed by S91 and S92 */
/***********************************************/
const uword S91_PTT_TransmitLevel[18] = {
    0x4000,    /* -00.0 dBm */
    0x2E00,    /* -01.0 dBm */
    0x2C00,    /* -02.0 dBm */
    0x2A00,    /* -03.0 dBm */
    0x2800,    /* -04.0 dBm */
    0x2800,    /* -05.0 dBm */
    0x2400,    /* -06.0 dBm */
    0x2400,    /* -07.0 dBm */
    0x2400,    /* -08.0 dBm */
    0x2400,    /* -09.0 dBm */
    0x1F60,    /* -10.0 dBm */
    0x1C00,    /* -11.0 dBm */
    0x1980,    /* -12.0 dBm */
    0x16A0,    /*    -13.0 dBm */
    0x1410,    /* -14.0 dBm */
    0x1210,  /* -15.0 dBm */
    0x1000,     /* -16.1 dBm */
    0xFFFF    /* For alignment purpose */
    };
/* ************************************************************************
ADD ALL NEW TABLES AT THE END OF THE FILE ONLY,
THIS IS NEEDED FOR COMPATIBILITY WITH NEW CONFIG UTILITY,
**************************************************************************/

/***********************************************/
/*                non-DTMF dual freq tone          */
/***********************************************/
country_DTMF_Level PTT_dual_freq_Level[7] = {
    {100, 100,0xFFFF},    /* U.S.A. */
    {100, 100,0xFFFF},    /* Japan */
    {100, 100,0xFFFF},    /* United Kingdom */
    {100, 100,0xFFFF},    /* Germany */
    {100, 100,0xFFFF},    /* France */
    {100, 100,0xFFFF},    /* Netherland */
    {100, 100,0xFFFF},    /* Gereric Country */
    };

const ubyte gen_country_name[4] = {'X','Y','Z',0 };
