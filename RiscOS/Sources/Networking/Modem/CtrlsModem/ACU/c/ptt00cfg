/****************************************************************************
/
/	Copyright 1988,1989,1990,1991,1992,1993,1994. All Rights Reserved by:
/	    Cirrus Logic, Inc.
/	    3100 West Warren Avenue
/	    Fremont, CA 94538
/	    (510) 623-8300
/
/
/   This document contains material confidential to Cirrus Logic its contents must
/	not be revealed, used or disclosed to anyone or company with out
/	written permission by Cirrus Logic.  The information contained herein is solely
/	for the use of RSA.
/
/	File:		ptt00cfg.c
/
/	Module Version: ACU
/
/	Function:
/           
/
/	Product:	ACU core code
/
/  History:
/
/
/		Created: 5/22/96
/
/
/		---------------------------------------------------------
/		-			Modifications			-
/		---------------------------------------------------------
/
/		Author & Date:	Cirrus
/		Description:
/		Reason:
/
*****************************************************************************/
#include   <string.h>
#include "sys_def.h"
#include "acu_def.h"
#include "acu_mem.h"
#include "mt_pro.h"
#if 0
#include "ll_pro.h"
#include "v25_pro.h"
#endif
#include "ee_def.h"
#include "ptt.h"

/***********************************************/
/*   ac00ptt.c required global variable        */
/***********************************************/

ubyte CountryInfo;                      
ubyte BlackNoEntry;
ubyte AvailableCell;
ubyte ToneModeSwitch;
ubyte ToneResult;
ubyte DigitCode;
ubyte black_size;
ubyte ErrorCode;
int OnTime;
int OffTime;
ubyte ToneStatus;

BlackList BlackLst[12];
ToneModeEntry Tone[3];
ubyte TmpPhoneCell[30];
ubyte *TmpDialPtr;
uword tempp1;
ubyte busy_count;
struct SREG22 s22orig;
/***********************************************/
/*             Black List Table                */
/***********************************************/
#define US_RETRY_LIMIT		1
#define US_CELL_LIMIT		1

#define JP_RETRY_LIMIT		3
#define JP_CELL_LIMIT		12

#define UK_RETRY_LIMIT		7
#define UK_CELL_LIMIT		12

#define GR_RETRY_LIMIT		12
#define GR_CELL_LIMIT		12

#define FR_RETRY_LIMIT		6
#define FR_CELL_LIMIT		12

#define NT_RETRY_LIMIT		6
#define NT_CELL_LIMIT		12

#define IT_RETRY_LIMIT		9
#define IT_CELL_LIMIT		12

const ubyte ReservedSpace[8] = {-1,-1,-1,-1,-1,-1,-1,-1};

country_black_list_table PTTBlackLst[7] = {
/* U.S.A. Black List Table */
	{US_RETRY_LIMIT,  			/* Retry times */
	 US_CELL_LIMIT,		   	/* Maximum phone cells */
	 0,								/* Cycle timing */
	 {0,0,0,0,0,0,0,0,0,0,0,0}	/* Retry timing */
	},

/* Japan Black List Table */
	{JP_RETRY_LIMIT,
	 JP_CELL_LIMIT,
	 180,
	 {0,0,0,255,255,255,255,255,255,255,255,255}

/*mrm83196*/
/*we are allowed three tries to each number*/

	 /*{60,60,60,255,255,255,255,255,255,255,255,255}*/
	},

/* United Kingdom Black List Table */
	{UK_RETRY_LIMIT,
	 UK_CELL_LIMIT,
  	 7200,
	 {5,120,120,120,120,120,120,255,255,255,255,255}
	},

/* Germany Black List Table */
	{GR_RETRY_LIMIT,
	 GR_CELL_LIMIT,
	 65535,
	 {5,5,5,5,5,5,5,5,5,5,5,5}
	},

/* France Black List Table*/
	{FR_RETRY_LIMIT,
	 FR_CELL_LIMIT,
	 65535,
	 {60,60,60,60,60,60,255,255,255,255,255,255}
	},

/* Netherland Black List Table*/
	{NT_RETRY_LIMIT,
	 NT_CELL_LIMIT,
 	 65535,
	 {60,60,60,60,60,60,255,255,255,255,255,255}
	},

/* Italy Black List Table */
	{IT_RETRY_LIMIT,
	 IT_CELL_LIMIT,
	 7200,
	 {5,5,5,5,120,120,120,120,255,255,255,255}
	},
	};


/***********************************************/
/*    Call Progress Tone A Cadence             */
/***********************************************/

country_tone_table PTT_Tone[7] = {
/* U.S.A. Tone Table */
	{
		{1,0xee,  50,  5,  0,  0,1,0xee}, 		/* Dial Tone */
		{2,0xee,  90, 40, 90, 40,3,0xee},  		/* Busy Tone */
		{2,0xee, 240,140,420,390,5,0xee}			/* Ring Back Tone*/
	},

/* Japan Tone Table */
	{										
		{1,0xee, 100, 90,  0,  0,1,0xee},		/* Dial Tone */
		{2,0xee,  95, 40, 55, 30,3,0xee},		/* Busy Tone */
		{2,0xee, 105, 90,205,180,5,0xee}			/* Ring Back Tone */
	},

/* United Kingdom Tone Table */
	{
		{1,0xee,2000,100,  0,  0,1,0xee},		/* Dial Tone */
		{2,0xee,  45, 35, 45, 35,3,0xee},		/* Busy Tone */
		{2,0xee, 110, 80,205,185,5,0xee}   		/* Ring Back Tone */
	},

/* Germany Tone Table */
	{
		{1,0xee,2000, 10,  0,  0,1,0xee},		/* Dial Tone */
		{2,0xee,  90, 30, 90, 30,3,0xee},		/* Busy Tone */
		{2,0xee, 120, 30,395,340,5,0xee}	  		/* Ring Back Tone */
	},

/* France Tone Table */
	{
		{1,0xee,2000,100,  0,  0,1,0xee}, 		/* Dial Tone */
		{2,0xee,  60, 40, 60, 40,3,0xee},		/* Busy Tone */
		{2,0xee, 180,100,360,300,5,0xee}			/* Ring Back Tone */
	},

/* Netherland Tone Table */
	{
		{1,0xee,2000,100,  0,  0,1,0xee},		/* Dial Tone */
		{2,0xee,  90, 30, 90, 30,3,0xee},		/* Busy Tone */
		{2,0xee, 130, 60,420, 60,5,0xee}			/* Ring Back Tone */
	},

/* Italy Tone Table*/
	{
		{2,0xee,  70, 35,120,  50,1,0xee},		/* Dial Tone */
		{2,0xee,  45, 15, 45,  15,3,0xee},		/* Busy Tone */
		{2,0xee, 120, 80,410,  50,5,0xee}	   /* Ring Back Tone */
	},
	};


/***********************************************/
/*    Call Progress Ring Frequency Range       */
/***********************************************/

country_ring_table PTT_Ring[7] = { /* In ms */
/* U.S.A. Ring Table */
	{14,66,0xFEFE},

/* Japan Ring Table */
	{14,66,0xFEFE},

/* United Kingdom Ring Table */
	{14,66,0xFEFE},

/* Germany Ring Table */
	{14,66,0xFEFE},

/* France Ring Table */
	{9 ,66,0xFEFE},

/* Netherland Ring Table */
	{14,66,0xFEFE},

/* Italy Ring Table */
	{14,66,0xFEFE},
	};


/***********************************************/
/*    Call Progress Tone A Biquad Coefficient  */
/***********************************************/

country_filter_taps PTT_Taps[7] = {
/* U.S.A. Tone A filter taps */
	{16384,				/*b12*/
	 -28708,     		/*b11*/
	 16384,				/*b10*/
	 -15987,     		/*a12*/
	 31396,				/*a11*/
	 16383,				/*b22*/
	 -32444,     		/*b21*/
	 16384,				/*b20*/
	 -15918,     		/*a22*/
	 30949,				/*a21*/
	},

/*Center frequency 420, Band width 250*/

/* Japan Tone A filter taps */
	{16384,				/*b12*/
	 -28708,     		/*b11*/
	 16384,				/*b10*/
	 -15987,     		/*a12*/
	 31396,				/*a11*/
	 16383,				/*b22*/
	 -32444,     		/*b21*/
	 16384,				/*b20*/
	 -15918,     		/*a22*/
	 30949,				/*a21*/
	},

/* United Kingdom Tone A filter taps */
	{16384,				/*b12*/
	 -28708,     		/*b11*/
	 16384,				/*b10*/
	 -15987,     		/*a12*/
	 31396,				/*a11*/
	 16383,				/*b22*/
	 -32444,     		/*b21*/
	 16384,				/*b20*/
	 -15918,     		/*a22*/
	 30949,				/*a21*/
	},

/* Germany Tone A filter taps */
	{1638, 				/*b12*/
	 -3270,     		/*b11*/
	 1638,				/*b10*/
	 -15574,    		/*a12*/
	 31150,				/*a11*/
	 16383,				/*b22*/
	 -6561,     		/*b21*/
	 16383,				/*b20*/
	 -15012,    		/*a22*/
	 28969,				/*a21*/
	},

/* France Tone A filter taps */
	{1638, 				/*b12*/
	 -3270,     		/*b11*/
	 1638,				/*b10*/
	 -15574,    		/*a12*/
	 31150,				/*a11*/
	 16383,				/*b22*/
	 -6561,     		/*b21*/
	 16383,				/*b20*/
	 -15012,    		/*a22*/
	 28969,				/*a21*/
	},

/* Netherland Tone A filter taps */
	{1638, 				/*b12*/
	 -3270,     		/*b11*/
	 1638,				/*b10*/
	 -15574,    		/*a12*/
	 31150,				/*a11*/
	 16383,				/*b22*/
	 -6561,     		/*b21*/
	 16383,				/*b20*/
	 -15012,    		/*a22*/
	 28969,				/*a21*/
	},

/* Italy Tone A filter taps */
	{1638, 				/*b12*/
	 -3270,     		/*b11*/
	 1638,				/*b10*/
	 -15574,    		/*a12*/
	 31150,				/*a11*/
	 16383,				/*b22*/
	 -6561,     		/*b21*/
	 16383,				/*b20*/
	 -15012,    		/*a22*/
	 28969,				/*a21*/
	},
	};

/***********************************************/
/*    				DTMF  							  */
/***********************************************/


country_DTMF_Level PTT_DTMF_Level[7] = {
	{78, 58,0xFFFF},	/* US DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
	{88, 68,0xFFFF},	/* JP DTMF Lvl_1 = -9.00dBm Lvl_2 = -7.00dBm */
	{108,88,0xFFFF},	/* GB DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
	{108,88,0xFFFF},	/* GR DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
	{78, 58,0xFFFF},	/* FR DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
	{108,88,0xFFFF},	/* NT DTMF Lvl_1 = -11.0dBm Lvl_2 = -9.00dBm */
	{78, 58,0xFFFF},	/* IT DTMF Lvl_1 = -8.00dBm Lvl_2 = -6.00dBm */
	};


/***********************************************/
/*    International S Registers					  */  
/***********************************************/


country_depend_S_registers PTT_SReg[7] = {
	{	/* USA */
		{0 ,  0,255,0xFE},   /* S0 */
		{2 ,  2,255,0xFE},	/* S6 */
		{60,  1,255,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1,255,0xFE},	/* S10*/ 
		{70, 50,255,0xFE},	/* S11*/
		{0x76,0,255,0xFE},	/* S22*/
		{0x0f,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x11,0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	{	/* JAPAN */
		{0 ,  0,255,0xFE},	/* S0 */
		{3 ,  3,255,0xFE},	/* S6 */
		{60,  1,255,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1,255,0xFE},	/* S10*/ 
		{70, 60,255,0xFE},	/* S11*/
		{0xf6,0,255,0xFE},	/* S22*/
		{0x0f,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x19,0,255,0xFE},	/* S31*/
		{15,  6, 15,0xFE},	/* S91*/
	},
	{	/* UNITED KINGDOM */
		{0 ,  0,255,0xFE},   /* S0 */
		{4 ,  4,  8,0xFE},	/* S6 */
		{60,  1,255,0xFE},	/* S7 */
		{4 ,  4, 11,0xFE},	/* S8 */
		{14,  1,255,0xFE},	/* S10*/ 
		{70, 70,255,0xFE},	/* S11*/
		{0x76,0,255,0xFE},	/* S22*/
		{0x81,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x19,0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	{	/* GERMANY */
		{0 ,  0,  5,0xFE},   /* S0 */
		{3 ,  3,  6,0xFE},	/* S6 */
		{60,  1, 99,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1, 99,0xFE},	/* S10*/ 
		{90, 85, 95,0xFE},	/* S11*/
		{0x76,0,255,0xFE},	/* S22*/
		{0x81,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x19,0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	{	/* FRANCE */
		{0 ,  0,  3,0xFE},   /* S0 */
		{6 ,  6, 12,0xFE},	/* S6 */
		{60, 35, 60,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1, 99,0xFE},	/* S10*/ 
		{70, 70, 85,0xFE},	/* S11*/
		{0x76,0,255,0xFE},	/* S22*/
		{0x81,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x19,0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	{	/* NETHERLAND */
		{0 ,  0,255,0xFE},   /* S0 */
		{2 ,  2, 12,0xFE},	/* S6 */
		{60,  1,120,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1, 99,0xFE},	/* S10*/ 
		{70, 70,255,0xFE},	/* S11*/
		{0x76,0,255,0xFE},	/* S22*/
		{0x81,0,255,0xFE},	/* S23*/
		{0x40,0,255,0xFE},	/* S27*/
		{0x19,0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	{	/* ITALY */
		{0 ,  0,255,0xFE},   /* S0 */
		{2 ,  2, 12,0xFE},	/* S6 */
		{60,  1,120,0xFE},	/* S7 */
		{2 ,  0,255,0xFE},	/* S8 */
		{14,  1, 99,0xFE},	/* S10*/ 
		{70, 70,255,0xFE},	/* S11*/
		{0 ,  0,255,0xFE},	/* S22*/
		{0 ,  0,255,0xFE},	/* S23*/
		{0 ,  0,255,0xFE},	/* S27*/
		{0 ,  0,255,0xFE},	/* S31*/
		{10,  9, 16,0xFE},	/* S91*/
	},
	};


/***********************************************/
/*    International Dial Tone Time Out			  */  
/***********************************************/

const uword PTT_DialToneTimeOut[8] = {
/* US Dial Tone Time Out */
	500,

/* JP Dial Tone Time Out */
	1000,

/* UK Dial Tone Time Out */
	1000,

/* GR Dial Tone Time Out */
	1900,

/* FR Dial Tone Time Out */
	600,

/* NT Dial Tone Time Out */
	500,

/* IT Dial Tone Time Out */
	500,

/*	For alignment purpose*/
	0xFFFF
	};

/***********************************************/
/*    International Hook Flash Time 			  */  
/***********************************************/

const uword PTT_HookFlash[8] = {
/* US Hook Flash Time*/
	50,

/* JP Hook Flash Time*/
	50,

/* UK Hook Flash Time*/
	50,

/* GR Hook Flash Time*/
	50,

/* FR Hook Flash Time*/
	270,

/* NT Hook Flash Time*/
	115,

/* IT Hook Flash Time*/
	50,

/* For alignment purpose */
	0xFFFF					
	};

/***********************************************/
/*    International Pulse Stop Time 			  */  
/***********************************************/

const ubyte PTT_PulseStop[8] = {
/* US Pulse Stop Time*/
	75,

/* JP Pulse Stop Time*/
	75,

/* UK Pulse Stop Time*/
	75,

/* GR Pulse Stop Time*/
	75,

/* FR Pulse Stop Time*/
	75,

/* NT Pulse Stop Time*/
	75,

/* IT Pulse Stop Time*/
	75,

/* for alignment purpose */	
	255
	};


/***********************************************/
/*    International Data/Fax Transmit Level	  */  
/***********************************************/

country_transmit_level PTT_TransmitLevel[7] = {
/* US data/fax transmit level */
	{0x1F60,0x1F60},

/* JP data/fax transmit level */
	{0x1F60,0x1F60},

/* UK data/fax transmit level */
	{0x1F60,0x1F60},

/* GR data/fax transmit level */
	{0x1F60,0x1F60},

/* FR data/fax transmit level */
	{0x1F60,0x1F60},

/* NT data/fax transmit level */
	{0x1F60,0x1F60},

/* IT data/fax transmit level */
	{0x1F60,0x1F60},
	};

/***********************************************/
/* International Pulse Make Break Time Table	  */  
/***********************************************/

country_Make_Break_Time PTT_MakeBreak_Time[7] = {
/* US Make Break Time */
	{61,39,67,33},

/* JP Make Break Time */
	{67,33,67,33},				/* changed by ramn 9/25/96, on shiang's advice */

/* UK Make Break Time */
	{67,33,67,33},

/* GR Make Break Time */
	{60,40,60,40},

/* FR Make Break Time */
	{67,33,67,33},

/* NT Make Break Time */
	{62,38,62,38},

/* IT Make Break Time */
	{67,33,67,33},
	};

/***********************************************/
/* ATI7 Information 									  */  
/***********************************************/

const ubyte ati1[60] = {
	'C','I','R','R','U','S',' ','L','O','G','I','C',',','I','N','C','.',' ',' ',' ',

	'M','O','D','E','M',' ','E','N','G','I','N','E','E','R','I','N','G',' ',' ',' ',

	'F','I','R','M','W','A','R','E',' ','D','E','P','A','R','T','M','E','N','T',0
	};

/***********************************************/
/* ATI10 Information   								  */  
/***********************************************/

const ubyte ati10[4] = {-1,-2,-3,-4};

/***********************************************/
/* ATI11 Information 								  */  
/***********************************************/

/*const ubyte ati11[1] = {-2};*/


/*********************************************/
/*********************************************/
/***  The following data not to be changed ***/
/***  by Configuration Utility             ***/
/*********************************************/
/*********************************************/

/*************************************/
/* Nominal ON_OFF time for ring back */
/*************************************/
/* For De-glitch purpose				 */

country_Nominal_RingBack_Cadence PTT_RingBack[7] = {
/* US Ring Back ON_OFF time */
	{200,400},

/* JP Ring Back ON_OFF time */
	{100,200},

/* UK Ring Back ON_OFF time */
	{100,200},

/* GR Ring Back ON_OFF time */
	{95,385},

/* FR Ring Back ON_OFF time */
	{150,350},

/* NT Ring Back ON_OFF time */
	{100,400},

/* IT Ring Back ON_OFF time */
	{100,400},
	};

/***********************************************/
/* 			DTMF single level 					  */  
/***********************************************/

const ubyte DTMFLvl[28] = {
	0,		/* -0.0  dBm */
	8,		/* -1.0  dBm */
	18,	/* -2.0  dBm */
	28,	/* -3.0  dBm */
	38,	/* -4.0  dBm */
	48,	/* -5.0  dBm */
	58,	/* -6.0  dBm */
	68,	/* -7.0  dBm */
	78,	/* -8.0  dBm */
	88,	/* -9.0  dBm */
	98,	/* -10.0 dBm */
	108,	/* -11.0 dBm */
	119,	/* -12.0 dBm */
	129,	/* -13.0 dBm */
	139,	/* -14.0 dBm */
	149,	/* -15.0 dBm */
	159,	/* -16.0 dBm */
	169,	/* -17.0 dBm */
	179,	/* -18.0 dBm */
	189,	/* -19.0 dBm */
	199,	/* -20.0 dBm */
	209,	/* -21.0 dBm */
	219,	/* -22.0 dBm */
	229,	/* -23.0 dBm */
	239,	/* -24.0 dBm */
	249,	/* -25.0 dBm */
	255,	/* For alignment purpose */
	255	/* For alignment purpose */
	};

/***********************************************/
/*    Data/Fax Transmit Level	Addressed by S91 */  
/***********************************************/

const uword S91_PTT_TransmitLevel[18] = {
	0x4000,	/* -00.0 dBm */
	0x2E00,	/* -01.0 dBm */
	0x2C00,	/* -02.0 dBm */
	0x2A00,	/* -03.0 dBm */
	0x2800,	/* -04.0 dBm */
	0x2800,	/* -05.0 dBm */
	0x2400,	/* -06.0 dBm */
	0x2400,	/* -07.0 dBm */
	0x2400,	/* -08.0 dBm */
	0x2400,	/* -09.0 dBm */
	0x1F60,	/* -10.0 dBm */
	0x1C00,	/* -11.0 dBm */
	0x1980,	/* -12.0 dBm */
	0x16A0,	/*	-13.0 dBm */
	0x1410,	/* -14.0 dBm */
	0x1210,  /* -15.0 dBm */
	0x1000, 	/* -16.1 dBm */
	0xFFFF	/* For alignment purpose */
	};

