/* -*-C-*-
 *
 * $Header$
 * $Source$
 *
 * Copyright (c) 1995 Acorn Computers Ltd., Cambridge, England
 *
 * $Log$
 * Revision 1.1  95/04/20  09:49:57  kwelton
 * Initial revision
 * 
 */
#include "errno.h"
#include "kernel.h"
#include "swis.h"

#include "unixlib.h"

int chmod(char *path, int mode)
{
    _kernel_swi_regs r;
    int attr;

    r.r[0] = 17;
    r.r[1] = (int)path;
    r.r[4] = 0;
    (void)_kernel_swi(XOS_Bit | OS_File, &r, &r);

    if(r.r[0] == 0 )
    {
	errno = ENOENT;
	return (-1);
    }

    attr = r.r[5];

    if( mode & 0200 )
	attr |= 0x02;
    else
	attr &= ~0x02;

    if( mode & 0400 )
	attr |= 0x01;
    else
	attr &= ~0x01;

    r.r[0] = 4;
    r.r[1] = (int)path;
    r.r[5] = attr;
    (void)_kernel_swi(XOS_Bit | OS_File, &r, &r);

    errno = 0;
    return(0);
}

/* EOF chmod.c */
