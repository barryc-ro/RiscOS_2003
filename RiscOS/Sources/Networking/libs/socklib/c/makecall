/* -*-C-*-
 *
 * $Header$
 * $Source$
 *
 * Copyright (c) 1995 Acorn Computers Ltd., Cambridge, England.
 *
 * :RCS Log discontinued:
 * Revision 1.3  95/05/02  17:24:25  kwelton
 * makecall() has been renamed to _makecall(), which is what it should have
 * been called in the first place.
 * 
 * Revision 1.2  95/04/20  13:43:05  kwelton
 * All library functions are now prototyped in socklib.h.
 * 
 * Revision 1.1  95/03/08  11:37:57  kwelton
 * Initial revision
 * 
 */
#include "stubs.h"
#include "socklib.h"

/*
 * global error variables - errno is used by several libraries,
 * including this one.  _inet_error is used exclusively by this
 * library, and is used to contain the most recent error block
 * returned from a call into the internet module
 */
int errno = 0;
_kernel_oserror _inet_error = { 0 };

/**********************************************************************/

/*
 * _makecall - call the internet module, and deal with return value
 */
int _makecall(int swinum, _kernel_swi_regs *in, _kernel_swi_regs *out)
{
    _kernel_oserror *e;

    if( (e = _kernel_swi(swinum, in, out)) != NULL )
    {
	errno = GETDCI4ERRNO(e->errnum);
	(void)memcpy(&_inet_error, e, sizeof(_inet_error));
    }
    else
	errno = 0;

    /*
     * limit errno to a sensible value
     */
    if( errno > EREMOTE )
	errno = ESRCH;

    return((errno) ? -1 : out->r[0]);
}

/**********************************************************************/

/* EOF makecall.c */
