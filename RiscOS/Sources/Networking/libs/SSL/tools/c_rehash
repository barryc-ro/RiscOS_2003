#!/bin/sh
#
# redo the hashes for the certificates in your cert path or the ones passed
# on the command line.
#

PATH=<SSLeay$Dir>/bin:$PATH

SSL_DIR=<SSLeay$Dir>/certs

if [ "$*" = "" ]; then
	CERTS=${*:-${SSL_CERT_DIR:-$SSL_DIR}}
else
	CERTS=$*
fi

IFS=': '
for i in $CERTS
do
  (
  IFS=' '
  if [ -d $i -a -w $i ]; then
    cd $i
    echo "Doing $i"
    for i in *.pem
    do
      if [ $i != '*.pem' ]; then
        h=`ssleay x509 -hash -noout -in $i`
        if [ -f $h.0 ]; then
          /bin/rm -f $h.0
        fi
        echo "$i => $h.0"
        ln -s $i $h.0
      fi
    done
  fi
  )
done
