;------------------------------------------------
; calls.s
;------------------------------------------------

	AREA	|C$$code|, CODE, READONLY

;------------------------------------------------
; enter_critical saves the current interrupt
; status in r0 before setting the disable interrupt
; bits (IRQ and FIQ).  restore_critical restores
; the interrupt status read by enter_critical.
;-------------------------------------------------

	EXPORT enter_critical
	EXPORT restore_critical

PSRIFBits	* 	(3 :SHL: 26)	; IRQ and FIQ

enter_critical	ROUT
	AND	r0, lr, #PSRIFBits
	ORR	lr, lr, #PSRIFBits
	MOVS	pc, lr

restore_critical
	BIC	lr, lr, #PSRIFBits
	ORR	lr, lr, r0
	MOVS	pc, lr

;-------------------------------------------------

	END
