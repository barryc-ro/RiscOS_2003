#ifndef filewatch_H
#define filewatch_H

/* C header file for FileWatch
 * written by DefMod (Aug 30 1995) on Tue May 28 12:59:25 1996
 * Simon Middleton
 */

#ifndef types_H
#include "types.h"
#endif

#ifndef os_H
#include "os.h"
#endif

#ifndef __kernel_h
#include "kernel.h"
#endif

/**********************************
 * SWI names and SWI reason codes *
 **********************************/
#undef  FileWatch_RegisterInterest
#define FileWatch_RegisterInterest              0x4D240
#undef  XFileWatch_RegisterInterest
#define XFileWatch_RegisterInterest             0x6D240
#undef  FileWatch_DeRegisterInterest
#define FileWatch_DeRegisterInterest            0x4D241
#undef  XFileWatch_DeRegisterInterest
#define XFileWatch_DeRegisterInterest           0x6D241
#undef  FileWatch_Poll
#define FileWatch_Poll                          0x4D242
#undef  XFileWatch_Poll
#define XFileWatch_Poll                         0x6D242

/************************************
 * Structure and union declarations *
 ************************************/
typedef struct filewatch_h_                     *filewatch_h;
typedef union  filewatch_register_interest_args filewatch_register_interest_args;
typedef union  filewatch_de_register_interest_args filewatch_de_register_interest_args;
typedef union  filewatch_poll_args              filewatch_poll_args;

/********************
 * Type definitions *
 ********************/
typedef bits filewatch_register_interest_flags;

union filewatch_register_interest_args
   {  struct
      {  filewatch_register_interest_flags flags;
         int *reasons;
         union
         {  char *file_prefix;
            os_f file_handle;
         }
         match;
      }
      in;
      struct
      {  filewatch_h handle;
      }
      out;
   };

typedef bits filewatch_de_register_interest_flags;

union filewatch_de_register_interest_args
   {  struct
      {  filewatch_de_register_interest_flags flags;
         filewatch_h handle;
      }
      in;
   };

typedef bits filewatch_poll_flags;

union filewatch_poll_args
   {  struct
      {  filewatch_poll_flags flags;
         filewatch_h handle;
         byte *buffer;
         int buffer_size;
      }
      in;
      struct
      {  int reserved [2];
         byte *updated_buffer;
         int updated_buffer_size;
         int file_count;
      }
      out;
   };

/************************
 * Constant definitions *
 ************************/
#define error_FILE_WATCH_BASE                   0x80FB00u
      /*256 errors*/
#define error_FILE_WATCH_NO_MEM                 0x80FB00u
      /*Not enough memory for some allocation*/
#define error_FILE_WATCH_BAD_HANDLE             0x80FB01u
      /*Bad FileWatch handle passed to SWI*/
#define error_FILE_WATCH_WHAT_FS                0x80FB02u
      /*Can't decode filing system*/
#define filewatch_REGISTER_INTEREST_FILE_HANDLE ((filewatch_register_interest_flags) 0x1u)

/*************************
 * Function declarations *
 *************************/

#ifdef __cplusplus
   extern "C" {
#endif

/* ------------------------------------------------------------------------
 * Function:      filewatch_register_interest()
 *
 * Description:   Register an interest in some files changing
 *
 * Input:         flags - value of R0 on entry
 *                reasons - value of R1 on entry
 *                file_prefix - value of R2 on entry
 *
 * Output:        handle - value of R0 on exit (X version only)
 *
 * Returns:       R0 (non-X version only)
 *
 * Other notes:   Calls SWI 0x4D240.
 */

extern _kernel_oserror *xfilewatch_register_interest (filewatch_register_interest_flags flags,
      int const *reasons,
      char const *file_prefix,
      filewatch_h *handle);
__swi (0x4D240) filewatch_h filewatch_register_interest (filewatch_register_interest_flags flags,
      int const *reasons,
      char const *file_prefix);

/* ------------------------------------------------------------------------
 * Function:      filewatch_de_register_interest()
 *
 * Description:   Deregister an interest
 *
 * Input:         flags - value of R0 on entry
 *                handle - value of R1 on entry
 *
 * Other notes:   Calls SWI 0x4D241.
 */

extern _kernel_oserror *xfilewatch_de_register_interest (filewatch_de_register_interest_flags flags,
      filewatch_h handle);
__swi (0x4D241) void filewatch_de_register_interest (filewatch_de_register_interest_flags flags,
      filewatch_h handle);

/* ------------------------------------------------------------------------
 * Function:      filewatch_poll()
 *
 * Description:   Poll for changes
 *
 * Input:         flags - value of R0 on entry
 *                handle - value of R1 on entry
 *                buffer - value of R2 on entry
 *                buffer_size - value of R3 on entry
 *
 * Output:        updated_buffer - value of R2 on exit
 *                updated_buffer_size - value of R3 on exit
 *                file_count - value of R4 on exit
 *
 * Other notes:   Calls SWI 0x4D242.
 */

extern _kernel_oserror *xfilewatch_poll (filewatch_poll_flags flags,
      filewatch_h handle,
      byte *buffer,
      int buffer_size,
      byte **updated_buffer,
      int *updated_buffer_size,
      int *file_count);
extern void filewatch_poll (filewatch_poll_flags flags,
      filewatch_h handle,
      byte *buffer,
      int buffer_size,
      byte **updated_buffer,
      int *updated_buffer_size,
      int *file_count);

#ifdef __cplusplus
   }
#endif

#endif
