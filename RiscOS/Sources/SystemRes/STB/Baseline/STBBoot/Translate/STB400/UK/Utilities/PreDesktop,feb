| >!STBBoot.Utilities.PreDesktop
| Copyright © Pace Micro Technology plc, 2002
| All rights reserved.

| Set sys vars for uniqie ID, RAM size and location of public directory
Set NFS$CreateAccess 0777
Run STBResources:!Internet.bin.IPVars
Run STBUtilities:Unique

| Load the splash screen stuff if it is configured to be on (display screen if network booting)
| NOTE: the SplashText string MUST use hard spaces (Alt-Space) as 'Do' screws things up nicely with
| quotes or soft spaces.
If SplashScreen Then RMEnsure STBSplash 1.18 Run STBUtilities:KillSplash
If SplashScreen Then RMCheck  STBSplash 1.18 STBSplash
If "<NetRoot$Dir>" = "<STBRoot$Dir>" Then SplashImage <Splash$Picture>
If "<NetRoot$Dir>" = "<STBRoot$Dir>" Then Do SplashText ««PreDesk_Vsn»»<Baseline$Version>

| Load various modules on all STBs if not there already.
RMCheck SharedCLibrary 5.34 CLib
RMCheck Serial         0.26 Serial
{ > null: }MemoryA 3010FE4 5
| This MemoryA is to disable MODEM interrupts (these cause box stiffs)
RMCheck DeviceFS       0.59 DeviceFS
RMCheck TaskWindow     0.68 TaskWindow
RMCheck TaskModule     0.20 TaskModule
RMCheck Toolbox        1.50 Toolbox.Toolbox
RMCheck ToolAction     0.24 Toolbox.ToolAction
RMCheck Window         1.66 Toolbox.Window
RMCheck BootCommands   1.20 BootCmds
RMCheck MessageQueue   0.06 MsgQueue
RMCheck IIC            0.17 IIC
RMCheck IconHigh       0.33 IconHigh
RMCheck IR             2.19 IR
RMCheck PowerOn        0.09 PowerOn
RMCheck SharedSound    1.03 SSound

| Ensure that CacheFS is loaded because NCFresco uses it, and <Choices$Write> may also
RMCheck CacheFS      0.28 CacheFS
If "<CacheFS$Size>" <> "" Then Do CacheFS_SetMax <CacheFS$Size>
If "<Wimp$ScrapDir>" = "" Then Set Wimp$ScrapDir Cache:$.ScrapDir
If "<Wimp$Scrap>" = ""    Then Set Wimp$Scrap    <Wimp$ScrapDir>.ScrapFile

| Switch the current working directory to CacheFS
CacheFS

| Move the AddToRes utility into ResourceFS for speed of access
AddToRes STBLibrary:AddToRes   !Boot.Utils.AddToRes
Set Alias$AddToRes Run Resources:$.!Boot.Utils.AddToRes %%*0
AddToRes STBUtilities:TerrFont !Boot.Utils.TerrFont
Set Alias$TerrFont Run Resources:$.!Boot.Utils.TerrFont %%*0

| Execute all the global PreDesktop scripts
If BootRun$PreDesk Then BootPreRun <STBPreDesk$Dir>

| Execute all the STB-specific PreDesktop scripts
If BootRun$HookPreDesk Then BootPreRun <STBHookPreDesk$Dir>
