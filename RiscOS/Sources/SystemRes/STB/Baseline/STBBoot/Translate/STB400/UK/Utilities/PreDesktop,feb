| >!STBBoot.Utilities.PreDesktop
| Copyright © Pace Micro Technology plc, 2000
| All rights reserved.

| Set sys vars for uniqie ID, RAM size and location of public directory
Set NFS$CreateAccess 0777
Run STBResources:!Internet.bin.IPVars
Run STBUtilities:Unique

| Load the splash screen stuff if it is configured to be on (display screen if network booting)
| NOTE: the SplashText string MUST use hard spaces (Alt-Space) as 'Do' screws things up nicely with
| quotes or soft spaces.
If SplashScreen Then RMEnsure STBSplash 1.18 Run STBUtilities:KillSplash
If SplashScreen Then RMCheck  STBSplash 1.18 STBSplash
If "<NetRoot$Dir>" = "<STBRoot$Dir>" Then SplashImage <Splash$Picture>
If "<NetRoot$Dir>" = "<STBRoot$Dir>" Then Do SplashText ««PreDesk_Vsn»»<Baseline$Version>

| Load various modules on all STBs if not there already
RMCheck BootCommands 1.20 BootCmds
RMCheck MessageQueue 0.06 MsgQueue
RMCheck IIC          0.17 IIC
RMCheck IconHigh     0.33 IconHigh
RMCheck IR           2.19 IR

| Ensure that CacheFS is loaded because NCFresco uses it, and <Choices$Write> may also
If "<CacheFS$Size>" <> "" Then Do CacheFS_SetMax <CacheFS$Size>
If "<Wimp$ScrapDir>" = "" Then Set Wimp$ScrapDir Cache:$.ScrapDir
If "<Wimp$Scrap>" = ""    Then Set Wimp$Scrap    <Wimp$ScrapDir>.ScrapFile

| Move the FCopy utility into CacheFS for speed of access
FCopy STBLibrary:FCopy Cache:$.FCopy
Access Cache:$.FCopy Lwr/r
Set Alias$FCopy Cache:$.FCopy %%*0

| Execute all the global PreDesktop scripts
If BootRun$PreDesk Then BootPreRun <STBPreDesk$Dir>

| Execute all the STB-specific PreDesktop scripts
If BootRun$HookPreDesk Then BootPreRun <STBHookPreDesk$Dir>
