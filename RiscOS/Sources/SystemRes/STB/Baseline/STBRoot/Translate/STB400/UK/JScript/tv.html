<HTML>
<HEAD>
<META NAME="ncbrowsermode" CONTENT="SELECTED=SELECTION; NOSCROLL">
<TITLE>êêHTMLMulti_Titleëë</TITLE>
<SCRIPT LANGUAGE="JavaScript1.1">

// allocate two media objects to leap-frog channel changing to make it faster.
// this is only a marginal speed up and not necessary.
var mediaObjects = new Array(2);
var mediaObjects[0] = new MediaCtrl();
var mediaObjects[1] = new MediaCtrl();

// current object
var c_o = -1;
var visible = true;

// define a global error block this is to pass errors
var error = null;

// define a timer event for getting responses.
var ResponseCallback = null;

// define an array of possible channels
var channels = new Array(4);
var current_channel = -1;

channels[0] = new Object();
channels[0].name = new String("BBC†1");
channels[0].value = 1;

channels[1] = new Object();
channels[1].name = new String("BBC†2");
channels[1].value = 2;

channels[2] = new Object();
channels[2].name = new String("ITV");
channels[2].value = 3;

channels[3] = new Object();
channels[3].name = new String("Ch†4");
channels[3].value = 4;

// this function uses the error object and based on what it is acts appropriately.
// in this case it just 'alerts' the error.
function errorHandler()
{
        if (error != null)
        {
          alert("ERROR:("+error.identifier+") "+error.description);
          error = null;
        }
}

// set the default behaviour of the media objects, this calls the setOptions, note that
// you cannot call the get Options method until a media object is loaded.
function setMediaObjects()
{
        var count = 0;

        while ((error == null)&&(count < mediaObjects.length ))
        {
                error = mediaObjects[count].setOption("change screen mode", false);
                if (error == null) error = mediaObjects[count].setOption("clear screen after", false);
                if (error == null) error = mediaObjects[count].setOption("clear screen before", false);
                if (error == null) error = mediaObjects[count].setOption("set palette", true);
                count++;
        }

        if (error != null)
        {
                errorHandler();
        }
        else
        {
                loadMovie();
        }
}

// this will set the current channel from the select list and prime the media object appropriately.
function loadMovie()
{
        current_channel =  document.movieOptions.elements[0].selectedIndex;
        LoadCurrentChannel();
}

// this will prime the media object setting it to play the currently selected channel
// this method is where the leapfrogging of media objects occurrs
function LoadCurrentChannel()
{
        error = null;
        var new_co;

        if (c_o == 0)
                new_co = 1;
        else
                new_co = 0;

        error = mediaObjects[new_co].load("rtsp:///multicast?channel="+channels[current_channel].value);

        if (error == null)
        {
                var count = 0;
                var response = false;

                while ( (response == false) && ( count < 100 ) )
                {
                        error = mediaObjects[new_co].getResponse(response, code);
                        count++;
                }

                if (count == 100)
                {
                        alert("timeout on getting load response");
                }
                else
                {
                        if (c_o != -1)
                                error = mediaObjects[c_o].unload();
                        error = mediaObjects[new_co].play();

                        c_o = new_co;
                }
        }

        if (error != null)
        {
                errorHandler();
        }
        else
        {
                document.movieOptions.elements[0].selectedIndex = current_channel;
                getResponse();
        }
}

// this increments the current channel (if available) looping to the least significant channel if necessary
function channelUp()
{
        if (current_channel != -1)
        {
                if (current_channel == 3)
                {
                        current_channel = 0;
                }
                else
                {
                        current_channel++;
                }

                LoadCurrentChannel();
        }
}

// this decrements the current channel (if available) looping to the most significant channel if necessary
function channelDown()
{
        if (current_channel != -1)
        {
                if (current_channel == 0)
                {
                        current_channel = 3;
                }
                else
                {
                        current_channel--;
                }

                LoadCurrentChannel();
        }
}

// this method gets the response from the RTSP server prompting an error if one occurrs
// note the body block is deleted without being looked at.
function getResponse()
{
        var response_received = false;
        var code = 0;
        var count = 0;

        error = null;

        error = mediaObjects[c_o].getResponse(response_received, code);

        if (error != null)
        {
                errorHandler();
        }
        else
        {
                if (response_received == true)
                {
                        if (code != 200)
                        {
                                error = new Object;
                                error.identifier = 0;
                                error.description = "received bad error from response "+code;

                                errorHandler();
                        }

                        return true;
                }
                else
                {       // if we don't have a response check again in one seconds time
                        ResponseCallback = setTimeout("getResponse()", 100);
                }
        }
        return false;
}

// this function handles all of the key presses, this takes the opportunity to look for keys that would
// mean leaving the page these unload the current movie.  This is not necessary as they will be deleted anyway
// but by clearing the IP link we can allow a faster loading of the next page.
// this uses the info key to scroll page out of visability and back in.  If this is selected we do not want it
// to do its usual action of displaying the info pop-up so we return false.  Similarly page up and down is overloaded
// to change channels up and down.
function key_handler(e)
{
        if (e.which < 0)
        {
                switch (e.which)
                {
                        case 0x80000084:// back
                        case 0x80000083:// home
                                if (c_o != -1)
                                        error = mediaObjects[c_o].unload();
                                return true;
                        case 0x80000082://info
                                if (visible == true)
                                {
                                        window.scroll(0,132);
                                        visible = false;
                                }
                                else
                                {
                                        window.scroll(0,-132);
                                        visible = true;
                                }
                                return false;
                        case 0x8000009e:// channel down (page up)
                                channelDown();
                                return false;
                        case 0x8000009f:// channel up
                                channelUp();
                                return false;
                        default:
                                return true;
                }
        }
        return true;
}
</SCRIPT>
</HEAD>

<BODY onkeypress="javascript:return key_handler(event)" bgcolor="transparent" onload="javascript:setMediaObjects()">
<DIV ALIGN="right">
<TABLE CELLSPACING="0" CELLPADDING="0">

<TR>
<TD ROWSPAN=3><IMG SRC="../images/multicast/left.gif"></TD>

<!--TD ROWSPAN=3><img src="../images/multicast/divide.gif"></TD-->
<TD><img src="../images/multicast/top.gif"></TD>
<TD><img src="../images/multicast/top.gif"></TD> <!-- this is the top of the selection form the mid and bottom are defined below -->
<!--TD ROWSPAN=3><img src="../images/multicast/divide.gif"></TD-->

<TD ROWSPAN=3><FORM METHOD="GET" ACTION="javascript:channelUp()"><INPUT TYPE=SUBMIT VALUE="" SELIMAGE="../images/multicast/chup2.gif" BORDERIMAGE="../images/multicast/chup.gif"></FORM></TD>

<TD ROWSPAN=3><FORM METHOD="GET" ACTION="javascript:channelDown()"><INPUT TYPE=SUBMIT VALUE="" SELIMAGE="../images/multicast/chdn2.gif" BORDERIMAGE="../images/multicast/chdn.gif"></FORM></TD>

<TD ROWSPAN=3><IMG SRC="../images/multicast/right.gif"></TD>

</TR>

<tr>
<TD BGCOLOUR="#FFFFFF" ALIGN="CENTER" HEIGHT="32" COLSPAN="2">
<FORM  NAME="movieOptions" METHOD="GET" ACTION="javascript:loadMovie()">
<SELECT ID="SELECTION" onChange="javascript:loadMovie()">
<SCRIPT LANGUAGE = "JavaScript1.1">
var i = 0;
        for (i=0; i<4; i++)
        {
                document.write("<OPTION>"+channels[i].name);
        }
</SCRIPT>
</SELECT>
</FORM>
</TD>
</TR>
<TR>
<TD ALIGN=BOTTOM><img src="../images/multicast/bottom.gif"></TD>
<TD ALIGN=BOTTOM><img src="../images/multicast/bottom.gif"></TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>
