	GET	"OS:Hdr.OSModule"
	GET	"OS:Hdr.Wimp"
	GET	"OS:Hdr.Window"
	GET	"OS:Hdr.Gadget"

	AREA	|ObjAsm$$Code|,CODE,READONLY

	EXPORT	SmallDragRender
SmallDragRender
	STMFD	SP!,{V1-V5,LR}
	SUB	SP,SP,#4
	MOV	V4,A1
	MOV	V5,A2
	MOV	A1,#OSModule_Alloc
	MOV	A4,#2048
	SWI	OS_Module
	MOV	V3,R2
	MOV	A1,#0
	MOV	A2,V4
	MOV	A3,#Gadget_GetIconList
	MOV	A4,V5
	MOV	V1,SP
	MOV	V2,#Int
	SWI	Toolbox_ObjectMiscOp
	TEQS	V2,#0
	ADDEQ	SP,SP,#4
	LDMEQFD	SP!,{V1-V6,PC}^
	MOV	A1,#0
	MOV	A2,V4
	MOV	A3,#Window_GetWimpHandle
	SWI	Toolbox_ObjectMiscOp
	STR	A1,[V3,#Wimp_WindowInfo_w]
	MOV	A2,V3
	SWI	Wimp_GetWindowInfo
	ADD	A2,V3,#Wimp_WindowInfo_icons
	LDR	A1,[SP]
	ADD	A2,A2,A1,LSL #5
	SWI	Wimp_PlotIcon
	MOV	A1,#OSModule_Free
	MOV	A3,V3
	SWI	OS_Module
	ADD	SP,SP,#4
	LDMFD	SP!,{V1-V5,PC}^

	END
