	AREA |test$$code|,CODE,READONLY

	EXPORT i2c
i2c
;src	dest	add
;r0	r1	r2

	STMFD R13!,{r4-r12,lr}
	MOV R3,#8
	MOV R12,#&FF
loop

	LDMIA R0!,{R4-r11}
	ADD R4,R4,#4
	ADD R5,R5,#4
	ADD R6,R6,#4
	ADD R7,R7,#4
	ADD R8,R8,#4
	ADD R9,R9,#4
	ADD R10,R10,#4
	ADD R11,R11,#4

	AND R4,R12,R4, LSR #3
	AND R5,R12,R5, LSR #3
	ORR R5,R4,R5, LSL #8

	AND R6,R12,R6, LSR #3
	AND R7,R12,R7, LSR #3
	ORR R7,R6,R7, LSL #8

	ORR R7,R5,R7,LSL #16

	AND R8,R12,R8, LSR #3
	AND R9,R12,R9, LSR #3
	ORR R9,R8,R9, LSL #8

	AND R10,R12,R10, LSR #3
	AND R11,R12,R11, LSR #3
	ORR R11,R10,R11, LSL #8

	ORR R11,R9,R11,LSL #16


	STMIA R1,{R7,R11}
	ADD R1,R1,R2
	SUBS R3,R3,#1
	BNE  loop
	LDMFD R13!,{r4-r12,pc}^ ;should there be a ^ here?


	END
