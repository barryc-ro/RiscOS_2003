***************************************************************************
*                                                                         *
*  Project: Ursula                                                        *
*                                                                         *
*  Module:  Filer                                                         *
*                                                                         *
*  Created: Wed 23-Mar-97      By: Richard Leggett                        *
*                                                                         *
*  First version: 1.86                                                    *
*                                                                         *
*    Copyright:    (C) 1997, Acorn Computers Ltd., Cambridge, England.    *
*                                                                         *
***************************************************************************

---------------------------------------------------------------------------

Version: 1.86 Fri 23-Mar-97        Richard Leggett

* Added ability to Alt+Click on icons to change their filename.

---------------------------------------------------------------------------

Version: 1.86 Wed 09-Jul-97        Richard Leggett

* Got rid of minor caret positioning bug (was using absmousex instead of
  relmousex)

---------------------------------------------------------------------------

Version: 1.87 Wed 14-Aug-97        Richard Leggett

* Completed filename truncation for long filenames in large icon displays.

---------------------------------------------------------------------------

Version: 1.87 Thu 15-Aug-97        Richard Leggett

* Fixed bug in Full Info display when an application name exceeds 14
  characters, resulting in the rest of the information changing colour.
  
---------------------------------------------------------------------------

Version: 1.87 Tue 19-Aug-97        Richard Leggett

* Introduced new *command (Filer_Truncation) to set the width that
  filenames are truncated to in the Filer.
* Fixed bug present in old Filer where indirected icon text buffer is
  only 60 characters, so that any filenames over that corrupt memory.
  
---------------------------------------------------------------------------

Version: 1.87 Fri 22-Aug-97        Richard Leggett

* Introduced three replacements for file_xxx:
  - file_lae - for files which have load and execution addresses, rather than
               filetypes.
    file_unf - for unfinished files (load an execution = &DEADDEAD)
    file_xxx - for files where sprite file_nnn (where nnn is their type) is
               not cached.

---------------------------------------------------------------------------

Version: 1.88 Tue 26-Aug-97        Richard Leggett

* Changed 'New directory' into a SaveAs style window.

Version 1.88 checked in to CVS.

---------------------------------------------------------------------------

Version: 1.89 Wed 27-Aug-97        Richard Leggett

* With a file selection made, a click with menu on a file in another
  viewer will remove the old selection and select the new file.
* Flag 'menuclearselection' in s.Options will turn this off.
  
---------------------------------------------------------------------------

Version: 1.89 Fri 12-Sep-97        Richard Leggett

* Introduced code to enable files to be copied to an iconbar device icon:
  - Intercept Message_FilerDevicePath which an FS Filer will send when
    it receives a Message_DataLoad (which the Filer sends when a file
    is dragged to the FS Filer's iconbar icon).
  - The Filer uses this as the path to copy to the last selection which
    was made.
  - However, by the time the Filer receives Message_FilerDevicePath, it
    will have removed the selection. So a new bit is added to the flags
    word for each file entry in a dirviewer - dfs_wasselected. This is
    set when a selection is cleared, for each file which had dfs_selected
    set. It is cleared for each file which did not have dfs_selected set.
  - A new workspace variable, was_seldir, is used to point to the dirviewer
    where the last selection came from.



To do:

* dirnamebuffer is still 256 bytes - should this be more?
* userdata is probably okay at 1024 bytes?