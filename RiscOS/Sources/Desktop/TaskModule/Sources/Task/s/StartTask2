	AREA	|C$code|, CODE, READONLY
	
	EXPORT	TaskModule_StartTask_CallStartTaskWithCallback

XOS_Bit		EQU &020000
OS_EnterOS	EQU &16
XWimp_StartTask	EQU &400DE+XOS_Bit


TaskModule_StartTask_CallStartTaskWithCallback

	STMFD	r13!, { r0-r12, lr}
	
	SWI	XWimp_StartTask
	
	SWI	OS_EnterOS
	
	MOV	r12, a3
	
	;Do 'BL	a2'
	MOV	lr, pc
	MOV	pc, a2
	
	TEQP	pc, #0	; -> USR mode.
	MOV	r0, r0
	
	LDMFD	r13!, { r0-r12, pc}^
	
	
	
	END
