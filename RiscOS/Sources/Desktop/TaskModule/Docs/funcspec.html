<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>
    TaskModule Software Functional Specification
  </title>
</head>

<body BGCOLOR="#ffffff">

<center>
<h1>TaskModule Software Functional Specification</h1>
<hr>

<table>
  <tr>
    <td align="right">Drawing Number:</td>
    <td>2103,706&shy;03/FS</td>
  </tr>
  <tr>
    <td align="right">Issue:</td>
    <td>3a</td>
  </tr>
  <tr>
    <td align="right">Date:</td>
    <td>2000&shy;02&shy;25</td>
  </tr>
  <tr>
    <td align="right">Previous Issue:</td>
    <td>3.0</td>
  </tr>
  <tr>
    <td align="right">Status:</td>
    <td>Live</td>
  </tr>
  <tr>
    <td align="right">Change:</td>
    <td>ECO 4126</td>
  </tr>
  <tr>
    <td align="right">Classification:</td>
    <td>Pace Restricted &shy; Confidential</td>
  </tr>
  <tr>
    <td align="right">Owner:</td>
    <td>Julian Smith</td>
  </tr>
  <tr>
    <td align="right">Author(s):</td>
    <td>Steve Cormie</td>
  </tr>
  <tr>
    <td align="right">&nbsp;</td>
    <td>Julian Smith</td>
  </tr>
  <tr>
    <td align="right">&nbsp;</td>
    <td>Ben Laughton</td>
  </tr>
  <tr>
    <td align="right">&nbsp;</td>
    <td>John Beranek</td>
  </tr>
  <tr>
    <td align="right">Master Format:</td>
    <td>HTML</td>
  </tr>
</table>

</center>

<hr>

<h2>Contents</h2>

<ol>
  <li><a href="#history">History</a>
  <li><a href="#outstanding">Outstanding issues</a>
  <li><a href="#overview">Overview</a>
  <li><a href="#prog">Programmer interface</a>
</ol>

<hr>

<h2><a name="history">1.0 History</a></h2>

<table>
  <tr valign="top">
    <td>0.01</td>
    <td>JS</td>
    <td>1996&shy;06&shy;05</td>
    <td>First created.</td>
  </tr>
  <tr valign="top">
    <td>0.02</td>
    <td>SMC</td>
    <td>1996&shy;06&shy;11</td>
    <td>Reorganised and firmed up.</td>
  </tr>
  <tr valign="top">
    <td>0.03</td>
    <td>JS</td>
    <td>1996&shy;06&shy;14</td>
    <td>Added SWI TaskModule_StartTask.</td>
  </tr>
  <tr valign="top">
    <td>0.04</td>
    <td>JS</td>
    <td>1996&shy;06&shy;17</td>
    <td>Added allocated SWI numbers.</td>
  </tr>
  <tr valign="top">
    <td>0.05</td>
    <td>JS</td>
    <td>1996&shy;06&shy;24</td>
    <td>Service call handling moved into standard spec, and allocated SWI numbers. Added detection of broadcast
        messages for non&shy;task modules.</td>
  </tr>
  <tr valign="top">
    <td>0.06</td>
    <td>JS</td>
    <td>1996&shy;06&shy;24</td>
    <td>Added message number for Message_Service.</td>
  </tr>
  <tr valign="top">
    <td>0.07</td>
    <td>JS</td>
    <td>1996&shy;06&shy;24</td>
    <td>TaskModule_DeRegisterService can now deregister all services calls registered with a task.</td>
  </tr>
  <tr valign="top">
    <td>0.08</td>
    <td>JS</td>
    <td>1996&shy;06&shy;24</td>
    <td>Only R0&shy;R9 are sent in Message_Service.</td>
  </tr>
  <tr valign="top">
    <td>0.09</td>
    <td>JS</td>
    <td>1996&shy;06&shy;27</td>
    <td>Clarified task handle&nbsp;=&nbsp;0 in TaskModule_(De)RegisterService.</td>
  </tr>
  <tr valign="top">
    <td>0.10</td>
    <td>JS</td>
    <td>1996&shy;06&shy;03</td>
    <td>Now copes with Event 18 messages which are acknowledged.</td>
  </tr>
  <tr valign="top">
    <td colspan="4"><strong>Issue 1</strong></td>
  </tr>
  <tr valign="top">
    <td><br>0.14</td>
    <td><br>JS</td>
    <td><br>1997&shy;03&shy;13</td>
    <td><br>Added support for sending non&shy;message events with TaskModule_SendMessage.</td>
  </tr>
  <tr valign="top">
    <td>0.15</td>
    <td>JS</td>
    <td>1997&shy;04&shy;23</td>
    <td>Added TaskModule_ForceRedraw, for use by (for example) IconHigh.</td>
  </tr>
  <tr valign="top">
    <td>0.16</td>
    <td>JS</td>
    <td>1997&shy;08&shy;18</td>
    <td>Added TaskModule_AddCallBack, TaskModule_RemoveCallBack</td>
  </tr>
  <tr valign="top">
    <td>0.17</td>
    <td>BAL</td>
    <td>1998&shy;07&shy;22</td>
    <td>Added optional flag to TaskModule_RegisterService to guarantee Wimp message delivery order.</td>
  </tr>
  <tr valign="top">
    <td colspan="4"><strong>Issue 2</strong></td>
  </tr>
  <tr valign="top">
    <td><br>0.18</td>
    <td><br>BAL</td>
    <td><br>1998&shy;11&shy;03</td>
    <td><br>Added support for applications receiving UpCalls via new TaskModule_(De)RegisterUpCall SWIs and
            new Message_UpCall Wimp message.</td>
  </tr>
  <tr valign="top">
    <td colspan="4"><strong>Issue 3</strong></td>
  </tr>
  <tr valign="top">
    <td>0.18</td>
    <td>JPB</td>
    <td>2000&shy;02&shy;25</td>
    <td>Added optional flag to TaskModule_SendMessage to guarantee Wimp message delivery order.</td>
  </tr>
  <tr valign="top">
    <td colspan="4"><strong>Issue 3a</strong></td>
  </tr>
</table>

<hr>

<h2><a name="outstanding">2.0 Outstanding issues</a></h2>
<p>
There are no outstanding issues.

<hr>

<h2><a name="overview">3.0 Overview</a></h2>
<p>
This document contains the software functional specification for the
TaskModule module.

<p>
The module is intended to give modules limited access to the Wimp
message system and, similarly, non&shy;module Wimp tasks limited access to
OS notification functions e.g. service calls.

<p>
This is done by enabling Wimp messages to be sent from non&shy;tasks via a
TaskModule SWI, and the sending of Wimp messages containing service call
information to those tasks that request them.

<p>
Italicised text is used where issues are still to be decided or
where contents are liable to change.

<hr>

<h2><a name="prog">4.0 Programmer interface</a></h2>

<h3>4.1 SWIs</h3>

<h4>TaskModule_SendMessage (SWI &4D300)</h4>

<p>
Send a Wimp message from a non&shy;task

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>flags:</td>
              <td><strong>bit</strong></td>
              <td>&nbsp;</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>0</td>
              <td>If set, R6 specifies the event number and R4&shy;R5 are ignored<br>
                  Otherwise, R6 is ignored, and the event number used is 17 (R4&nbsp;=&nbsp;0) or 18 (R4 non zero)</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>1</td>
              <td>If set, messages are sent in the order they are added by calls to SendMessage<br>
                  Otherwise, messages are sent in the order their Desk event handlers get called (which is currently reverse order).</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>2&shy;31</td>
              <td>reserved (must be 0)</td>
            </tr>
          </table>
        </td>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>message block as used by Wimp_SendMessage</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>destination task handle/window (or 0 to broadcast)</td>
      </tr>
      <tr valign="top">
        <td>R3&nbsp;=&nbsp;</td>
        <td>icon (c.f. Wimp_SendMessage)</td>
      </tr>
      <tr valign="top">
        <td colspan="2">If R0 bit 0 set</td>
      </tr>
      <tr valign="top">
        <td>&nbsp;</td>
        <td colspan="3">
          <table  border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>R4&nbsp;=&nbsp;</td>
              <td>reply handler (0 if not required)</td>
            </tr>
            <tr valign="top">
              <td>R5&nbsp;=&nbsp;</td>
              <td>R12 value with which to call R4&shy;function (not used if R4&nbsp;=&nbsp;0)</td>
            </tr>
            <tr valign="top">
              <td>R6&nbsp;=&nbsp;</td>
              <td>event number</td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>This SWI enables modules to send Wimp messages and receive their
      replies, without them having to be full module&shy;tasks, optionally
      providing the address of a function to be called with any reply.
      It is intended for use by modules which only send messages infrequently,
      to avoid the complexity of making the module into a task.

      <p>
      If bit 0 of R0 is 0 and R4 (reply handler) is not 0 then R4 is taken to
      be a pointer to a function to call with any reply to the message which
      was sent. TaskModule_SendMessage sends the message as event number 18,
      so there will always be a reply of some sort (either event 17/18 from a
      task, or event 19 denoting no reply) sent to the reply handler.

      <p>
      There is one exception to this &shy; if a receiver acknowledges the message
      with a reply with Wimp event number 19, this prevents any sort of reply
      being sent back to TaskModule (See PRMs 3&shy;197). This means that
      TaskModule could potentially be left waiting for a reply forever.

      <p>
      To cope with this, TaskModule registers a handler for null events as
      well as message&shy;events each time it sends a message. These event&shy;claims
      and the data associated with the message&shy;reply detection are freed on
      receipt of either a reply to the message or a null event.

      <p>
      Because null events are only delivered at lower pririty than messages,
      this mechanism ensures that 1) TaskModule cleans up its data&shy;structure
      for acknowledged messages and 2) null events are only actually delivered
      to TaskModule when a message is acknowleged.

      <p>
      If bit 0 of R0 is 0 and R4 is 0 then TaskModule_SendMessage sends the
      message as event number 17, and any reply is ignored.

      <p>
      If bit 0 of R0 is set, then TaskModule_SendMessage will send a Wimp
      event with number specified by R6 (eg R6&nbsp;=&nbsp;1 sends a redraw event).
      Although this can be used to send messages (R6&nbsp;=&nbsp;17 or 18), note that
      TaskModule will not call any function pointed to by R4. This facility is
      only available when bit 0 of R0 is unset.

      <p>
      The reply handler is called in SVC mode as follows, and is allowed to call
      TaskModule SWIs.

      <dl>
        <dt>On entry
        <dd><p>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>R0&nbsp;=&nbsp;</td>
              <td>Wimp event number (17, 18 or 19)</td>
            </tr>
            <tr valign="top">
              <td>R1&nbsp;=&nbsp;</td>
              <td>pointer to message block</td>
            </tr>
            <tr valign="top">
              <td>R12&nbsp;=&nbsp;</td>
              <td>private word (R5 in original call to TaskModule_SendMessage)</td>
            </tr>
          </table>

        <dt>On exit
        <dd>All registers preserved
    </dl>
</dl>

<h4>TaskModule_StartTask (SWI &4D301)</h4>

<p>
Start a Wimp task from a non&shy;task

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>pointer to *command to be executed with Wimp_StartTask</td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>pointer to function to be called with information returned in R0 by Wimp_StartTask, or 0</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>R12 value with which to call R1 function</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>This provides non&shy;tasks with access to the Wimp_StartTask SWI (PRM 3&shy;177).

      <p>
      Wimp_StartTask is called at some future time by the Wimp&shy;task
      part of TaskModule, and any call&shy;back function (address in R1 on entry)
      is then called in SVC mode with the returned registers from
      Wimp_StartTask.

      <p>
      The conditions for the call&shy;back function are:

      <dl>
        <dt>On entry
        <dd><p>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>R0&nbsp;=&nbsp;</td>
              <td>handle of task started, if it is still alive; 0 otherwise</td>
            </tr>
            <tr valign="top">
              <td>R12&nbsp;=&nbsp;</td>
              <td>private word (R2 in original call to TaskModule_StartTask)</td>
            </tr>
          </table>

        <dt>On exit
        <dd>All registers preserved

        <dt>Processor Mode
        <dd>Processor is in SVC mode
      </dl>
</dl>

<h4>TaskModule_RegisterService (SWI &4D302)</h4>

<p>
Register interest in a service call

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>flags:</td>
              <td><strong>bit</strong></td>
              <td>&nbsp;</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>0</td>
              <td>If set, Wimp messages are guaranteed to be sent in
                               the same order as the service calls occurred in.
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>1&shy;31</td>
              <td>reserved (must be 0)</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>service number</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>task handle (0 to broadcast)</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>This is for use by non&shy;module tasks which want to hear about a specific
      service calls. The task is notified of service calls using a new Wimp message,
      Message_Service, which is described in the next section.

      Calling with R2 (task handle) = 0 results in the message being broadcast.

</dl>

<h4>TaskModule_DeRegisterService (SWI &4D303)</h4>

<p>
Deregister interest in a service call

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>flags (reserved, must be 0)</td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>service number, or 0 to deregister all the task's services</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>task handle</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>R0&shy;R2 should be the same as in a previous call to
      TaskModule_RegisterService (including the case where R2&nbsp;=&nbsp;0, messages are
      broadcast), except that R1&nbsp;=&nbsp;0 deregisters all the task's service call
      registrations.

      <p>
      R2&nbsp;=&nbsp;0 only effects service call broadcasts, not specific&shy;task
      service call messages.

      <p>
      Thus R1&nbsp;=&nbsp;R2&nbsp;=&nbsp;0 will deregister all service call broadcasts. It won't
      deregister registrations for specific tasks.

      TaskModule looks for applications quitting using Service_WimpCloseDown and de
      registers service call interest automatically.

      <p>
      However, it is expected that applications call SWI
      TaskModule_DeRegisterService before they exit for all registered
      service calls, e.g. with R1&nbsp;=&nbsp;0.
</dl>

<h4>TaskModule_RegisterBroadcastMessage (SWI &4D304)</h4>

<p>
Allow non&shy;task modules to receive broadcast Wimp messages

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>flags (reserved, must be 0)</td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>pointer to list of messages, terminated by 0 word</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>address of handler routine</td>
      </tr>
      <tr valign="top">
        <td>R3&nbsp;=&nbsp;</td>
        <td>R12 value with which to call handler</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>R1 behaves in a similar way to the list of messages passed
      to Wimp_Initialise (PRMs 5a&shy;666): an empty list means all broadcast messages,
      R1&nbsp;=&nbsp;0 means no messages (which is pointless of course).

      <p>
      The handler routine is called as follows:

      <dl>
        <dt>On entry
        <dd><p>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>R0&nbsp;=&nbsp;</td>
              <td>Wimp event number (17, 18 or 19)</td>
            </tr>
            <tr valign="top">
              <td>R1&nbsp;=&nbsp;</td>
              <td>pointer to message block</td>
            </tr>
            <tr valign="top">
              <td>R12&nbsp;=&nbsp;</td>
              <td>private word (R3 in original call to TaskModule_RegisterBroadcastMessage)</td>
            </tr>
          </table>

        <dt>On exit
        <dd>All registers preserved

        <dt>Processor Mode
        <dd>Processor is in SVC mode

      </dl>
</dl>

<h4>TaskModule_UnRegisterBroadcastMessage (SWI &4D305)</h4>

<p>
Deregister a non&shy;task module's interest in a broadcast Wimp message

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>flags (reserved, must be 0)</td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>reserved, must be 0</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>address of handler routine, as passed to TaskModule_RegisterBroadcastMessage</td>
      </tr>
      <tr valign="top">
        <td>R3&nbsp;=&nbsp;</td>
        <td>R12 value, as passed to TaskModule_RegisterBroadcastMessage</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>It is impractical for TaskModule to keep track of modules quitting, so
      all client modules' finalisation code <em>must</em> ensure that all
      broadcast&shy;handlers are unregistered.
</dl>

<p>
<h4>TaskModule_ForceRedraw (SWI &4D306)</h4>

<p>
Allow non&shy;task modules to call <code>Wimp_ForceRedraw</code>

<p>
<dl>
  <dt>On entry
  <dd>R0&shy;R4 as in Wimp_ForceRedraw (PRMs 3&shy;150). i.e.:
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>window handle</td>
      </tr>
      <tr valign="top">
        <td>R1&shy;R4&nbsp;=&nbsp;</td>
        <td>rectangle to be redrawn</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>This calls <code>Wimp_ForceRedraw</code> with the given values of R0&shy;R4,
      from within TaskModule's task. This SWI is provided because one cannot
      call <code>Wimp_ForceRedraw</code> from (for example) a transient
      callback, because an application might be in a redraw loop at the time.
      If this is attempted, the redrawing application can receive a
      <code>Get_Rectangle not called correctly</code> error.
</dl>

<h4>TaskModule_AddCallBack (0x4d307)</h4>

<p>
Add a TaskModule CallBack to the list

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>flags:</td>
              <td><strong>bit</strong></td>
              <td>&nbsp;</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>0</td>
              <td>0 =&gt; call back after TaskModule receives a nonzero pollword event<br>
                  1 =&gt; call back after TaskModule receives a null event</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>1&shy;31</td>
              <td>reserved (must be 0)</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>address of handler routine</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>R12 value with which to call handler routine</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>SWI is re&shy;entrant

  <dt>Use
  <dd>The handler routine is called by TaskModule's task, either in response
      to TaskModule's pollword being nonzero (R0 bit 0 unset), or when
      TaskModule receives a null event (R0 bit 0 set).

      <p>
      R0 bit 0 unset can be used to guarantee that one isn't in the middle of
      a redraw loop, allowing calls to e.g. Wimp_SetCaret.

      <p>
      R0 bit 0 set will return after a longer delay, as null events are sent
      out at lower priority than nonzero pollword events. It can be used to
      get control after sending a non&shy;message event to a task with
      TaskModule_SendMessage, when one wants control after the event has been
      handled.

      <p>
      The conditions for the handler routine are:

      <dl>
        <dt>On extry
        <dd>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>R12&nbsp;=&nbsp;</td>
              <td>value passed in R2 to TaskModule_AddCallBack</td>
            </tr>
          </table>

        <dt>On exit
        <dd>All registers preserved

        <dt>Processor Mode
        <dd>Processor is in SVC mode
      </dl>
</dl>

<p>
<h4>TaskModule_RemoveCallBack (SWI 0x4d308)</h4>

<p>
Remove a TaskModule CallBack from the list

<p>
<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&shy;R3&nbsp;=&nbsp;</td>
        <td>values used in a previous call to TaskModule_AddCallBack</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>Cancels a callback added previously with TaskModule_AddCallBack.
</dl>

<h4>TaskModule_RegisterUpCall (SWI &4D309)</h4>

<p>
Register interest in an UpCall

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>
          <table border="0" cellspacing="0" cellpadding="0">
            <tr valign="top">
              <td>flags:</td>
              <td><strong>bit</strong></td>
              <td>&nbsp;</td>
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>0</td>
              <td>If set, Wimp messages are guaranteed to be sent in
                  the same order as the UpCalls occurred in.
            </tr>
            <tr valign="top">
              <td>&nbsp;</td>
              <td>1&shy;31</td>
              <td>reserved (must be 0)</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>UpCall number</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>task handle (0 to broadcast)</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>This is for use by non&shy;module tasks which want to hear about a specific
      UpCall. The task is notified of UpCalls using a new Wimp message,
      Message_UpCall, which is described in the next section.

      Calling with R2 (task handle) = 0 results in the message being broadcast.

</dl>

<h4>TaskModule_DeRegisterUpCall (SWI &4D30A)</h4>

<p>
Deregister interest in an UpCall

<dl>
  <dt>On entry
  <dd><p>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr valign="top">
        <td>R0&nbsp;=&nbsp;</td>
        <td>flags (reserved, must be 0)</td>
      </tr>
      <tr valign="top">
        <td>R1&nbsp;=&nbsp;</td>
        <td>UpCall number, or 0 to deregister all the task's UpCalls</td>
      </tr>
      <tr valign="top">
        <td>R2&nbsp;=&nbsp;</td>
        <td>task handle</td>
      </tr>
    </table>

  <dt>On exit
  <dd>All registers preserved

  <dt>Interrupts
  <dd>Undefined

  <dt>Processor Mode
  <dd>Processor is in SVC mode

  <dt>Re&shy;entrancy
  <dd>Undefined

  <dt>Use
  <dd>R0&shy;R2 should be the same as in a previous call to
      TaskModule_RegisterUpCall (including the case where R2&nbsp;=&nbsp;0, messages are
      broadcast), except that R1&nbsp;=&nbsp;0 deregisters all the task's UpCall
      registrations.

      <p>
      R2&nbsp;=&nbsp;0 only effects UpCall broadcasts, not specific&shy;task
      UpCall messages.

      <p>
      Thus R1&nbsp;=&nbsp;R2&nbsp;=&nbsp;0 will deregister all UpCall broadcasts. It won't
      deregister registrations for specific tasks.

      TaskModule looks for applications quitting using Service_WimpCloseDown and
      deregisters UpCall interest automatically.

      <p>
      However, it is expected that applications call SWI
      TaskModule_DeRegisterUpCall before they exit for all registered
      UpCalls, e.g. with R1&nbsp;=&nbsp;0.
</dl>

<h3>4.1 Wimp Messages</h3>

<h4>Message_Service (&4D300)</h4>

<p>
This message is used to send service call information to a Wimp task.

<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>R1+20&nbsp;=&nbsp;</td>
    <td>register set R0&shy;R9</td>
  </tr>
</table>

<p>
NB only R0&shy;R9 are sent because these are all that are available to
TaskModule from its CMHG veneer.


<h4>Message_UpCall (&4D301)</h4>

<p>
This message is used to send UpCall information to a Wimp task.

<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>R1+20&nbsp;=&nbsp;</td>
    <td>register set R0&shy;R9</td>
  </tr>
</table>

<p>
NB only R0&shy;R9 are sent because these are all that are available to
TaskModule from its CMHG veneer.

<hr>

</body>
</html>
