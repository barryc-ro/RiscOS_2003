 SUBT MPEGVideo module SWIs ; => &.Hdr.MPEGVideo

; ***********************************
; ***    C h a n g e   L i s t    ***
; ***********************************

; Date       Who  Version       Description
; ----       ---  -------       -----------
; 06-Mar-95  TMD  -		Added ResetStream SWI
; 10-Mar-95  TMD  -		Added VideoStructureSize
; 01-May-95  TMD  -		Added ReadParametersReason_ReadSCR
; 12-May-95  TMD  -		Added new VideoStructureFlags bits to skip SetVideoFormat, SetBorder and SetWindow commands
;				 (primarily for DisplayStill usage).
; 24-Oct-95  TMD  -		Added ReadParametersReason_ReadBufferFullness
; 26-Oct-95  TMD  -		Added VideoStructureFlags_BlankOnResetStream
; 21-Nov-95  TMD  -		Added VideoStructureFlags_OutputYUVNotRGB
; 14-Dec-95  TMD  -		Added CardControlReason_SendMacroCommand
; 15-Jan-96  TMD  -		Added CardControlReason_SetColourMode
; 17-Jan-96  TMD  -		Added VideoStructureFlags_UseBorderTop
; 22-Jan-96  TMD  -		Added ReadParametersReason_CheckDisplayReady
; 05-Feb-96  TMD  -		Added VideoStructure_InputType, VideoStructureFlags_InputTypeExtension and VideoInputType symbols
; 06-Mar-96  TMD  -		Added VideoStructureFlags_CountUnderruns
; 07-Mar-96  TMD  -		Added SWI MPEGVideo_Stats
; 12-Aug-96  TMD  -		Added CardControlReason_ReadStatusRegister
; 14-Aug-96  TMD  -		Added UpdateControlRegister bits
; 28-Nov-96  TMD  -		Added VideoStructureFlags_IFrameSyncWhenNoAudio
; 14-Feb-97  TMD  -		Added VideoStructureFlags_BlankingExtension, VideoStructure_BlankedSequences/Fields

OldOpt SETA {OPT}
 OPT OptNoList+OptNoP1List

SWIClass SETS "MPEGVideo"

 ^ MPEGVideoSWI_Base

 AddSWI OpenStream
 AddSWI FullPackets
 AddSWI CloseStream
 AddSWI Play
 AddSWI SetSpeed
 AddSWI CardControl
 AddSWI SetSCR
 AddSWI ReadParameters
 AddSWI ResetStream
 AddSWI DisplayStill
 AddSWI Stats

MPEGVideoSWICheckValue * @

 OPT OldOpt

; Video parameters structure

        ^       0

VideoStructure_FormatType       #       4
VideoStructure_Flags            #       4
VideoStructure_ScreenMode       #       4
VideoStructure_DisplayedLines   #       4
VideoStructure_BorderLeft       #       4
VideoStructure_BorderTop        #       4
VideoStructure_InputType	#	4			; only present if bit 13 of the flags is set
VideoStructure_BlankedSequences #	4			; only present if bit 16 of the flags is set
VideoStructure_BlankedFields	#	4			; only present if bit 16 of the flags is set
VideoStructureSize		*	@			; size of structure

VideoStructureFlags_DontCLS             *       1 :SHL: 0       ; when set, don't clear screen at start
VideoStructureFlags_DontChangePalette   *       1 :SHL: 1       ; when set, don't change palette at start
VideoStructureFlags_NTSC                *       1 :SHL: 2       ; when set, configure for NTSC output

; The next three bits control skipping of data when starting in middle of a stream -
; at the moment this is implemented by blanking the screen until the relevant item has been decoded

VideoStructureFlags_SkipToSequenceHdr   *       1 :SHL: 3       ; when set, skip until sequence_header_code on startup
VideoStructureFlags_SkipToGOP           *       1 :SHL: 4       ; when set, skip until GOP on startup
VideoStructureFlags_SkipToPic           *       1 :SHL: 5       ; when set, skip until first picture on startup

VideoStructureFlags_NoInterlace         *       1 :SHL: 6       ; when set, disable interlace on the card by setting
                                                                ; bit 7 of the Control Register
VideoStructureFlags_DontSetVideoFormat	*	1 :SHL: 7	; when set, don't send SetVideoFormat() command
VideoStructureFlags_DontSetBorder	*	1 :SHL: 8	; when set, don't send SetBorder() command
VideoStructureFlags_DontSetWindow	*	1 :SHL: 9	; when set, don't send SetWindow() command
VideoStructureFlags_BlankOnResetStream	*	1 :SHL: 10	; when set, on ResetStream blank screen until sequence header found
VideoStructureFlags_OutputYUVNotRGB	*	1 :SHL: 11	; when set, make decoder output YUV not RGB
VideoStructureFlags_UseBorderTop	*	1 :SHL: 12	; when set, actually use BorderTop field, rather than auto-centring
VideoStructureFlags_InputTypeExtension  *	1 :SHL: 13	; when set, video structure has extra word on end for input type
VideoStructureFlags_CountUnderruns	*	1 :SHL: 14	; when set, enable counting of underrun conditions
VideoStructureFlags_IFrameSyncWhenNoAudio *	1 :SHL: 15	; when set, enable code to skip/repeat I-frames when no audio
								; (ie when playing duff DEC fast-forward/rewind files)
VideoStructureFlags_BlankingExtension	*	1 :SHL: 16	; when set, video structure has the BlankedSequences and
								; BlankedFields entries

; Reason codes for MPEGVideo_CardControl

                                        ^       0
CardControlReason_ClaimAudioIRQ         #       1
CardControlReason_ReleaseAudioIRQ       #       1
CardControlReason_UpdateControlRegister #       1
CardControlReason_ControlPowerDown	#	1
CardControlReason_SendMacroCommand	#	1
CardControlReason_SetColourMode		#	1
CardControlReason_ReadStatusRegister	#	1
CardControlBadReason                    *       @

; Reason codes for MPEGVideo_ReadParameters

                                        ^       0
ReadParametersReason_TimeCode           #       1
ReadParametersReason_SetSCR             #       1
ReadParametersReason_ReadDebugInfo      #       1
ReadParametersReason_ReadSCR		#	1
ReadParametersReason_ReadBufferFullness #	1
ReadParametersReason_CheckDisplayReady	#	1
ReadParametersBadReason                 *       @

; Values in VideoStructure_InputType

					^	0
VideoInputType_Unknown			#	1
VideoInputType_ElementalVideo		#	1
VideoInputType_VideoPackets		#	1
VideoInputType_SystemOrProgramStream	#	1

; Bits to pass in to CardControlReason_UpdateControlRegister
; These map to old bit positions in MPEG 1 card

UpdateControlRegister_CLKSelect		*	1 :SHL: 4
UpdateControlRegister_CTRL0		*	1 :SHL: 5
UpdateControlRegister_CTRL1		*	1 :SHL: 6

        END
