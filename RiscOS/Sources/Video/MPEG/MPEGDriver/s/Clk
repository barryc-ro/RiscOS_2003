; /****** Clk.s **************************************************************
;
; Project:	STB-400
; Component:	MPEGDriver
; This file:	33-bit clock arithmetic
;
; Copyright 1999 Pace Micro Technology plc. All rights reserved.
;
; This material is the confidential trade secret and proprietary information
; of Pace Micro Technology plc. It may not be reproduced, used, sold, or
; transferred to any third party without the prior written consent of
; Pace Micro Technology plc.
;
; History:
; Date		Who	Change
; ----------------------------------------------------------------------------
; 01/09/1999	BJGA	Created
; 02/12/1999	BJGA	Updated to use Hdr:APCS.<APCS>
;
; ***************************************************************************/


; Included headers
; ----------------

        GET     Hdr:ListOpts
        GET     Hdr:Macros
        GET     Hdr:System
        GET     Hdr:APCS.<APCS>


; Notes:
; ------
; Memory layout of clk structure:
; +0 - +3 / lower register : least significant 32 bits
; +4      / upper register : most significant bit in bit 0


        AREA    |Asm$$Code|, CODE, READONLY

; bool Clk_Greater (clk a, clk b);

; In:   Two clock references to compare
; Out:  |true| if a>b (with wraparound)

; a is in (a1,a2)
; b is in (a3,a4)

        EXPORT  Clk_Greater
Clk_Greater
        CMP     a3, a1
        SBC     a1, a4, a2
        AND     a1, a1, #1      ; if (b-a) < 0, this will have value 1 (true)
        Return  , LinkNotStacked

; bool Clk_Less (clk a, clk b);

; In:   Two clock references to compare
; Out:  |true| if a<b (with wraparound)

; a is in (a1,a2)
; b is in (a3,a4)

        EXPORT  Clk_Less
Clk_Less
        CMP     a1, a3
        SBC     a1, a2, a4
        AND     a1, a1, #1      ; if (a-b) < 0, this will have value 1 (true)
        Return  , LinkNotStacked

; clk Clk_Diff (clk a, clk b);

; In:   Two clock references to compare
; Out:  The value of a-b (a 33-bit value)

; a is in (a2,a3)
; b is in (a4,[sp])
; return result in ([a1],[a1,#4])

        EXPORT  Clk_Diff
Clk_Diff
        LDR     ip, [sp]
        SUBS    a2, a2, a4
        SBC     a3, a3, ip
        AND     a3, a3, #1
        STMIA   a1, {a2, a3}
        Return  , LinkNotStacked

        END
