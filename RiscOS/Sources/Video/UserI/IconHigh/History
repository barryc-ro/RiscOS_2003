22 Jan 1997

Got SWI chunk allocated.



29 Jan 1997
Current status: Moves between icons in the current window in highlight
mode. Ballistic emulation works ok, with accelaration etc.

Works by sitting on PointerV and KeyV.

Problems so far: Detection of cursor keys is fine when looking for key
up/down events for ballistic emulation. However, highlighting needs to
be given keys after autorepeat has been added by the kernel. At the
moment I can't do this - tried to use OS_Byte 4 to make cursor keys
output normal key codes, but this didn't work. Hence ballistic emulation
currently responds to 2,4,8 and 6 being pressed (either on numeric
keypad or in main part of keyboard). The key events aren't intercepted
yet.


30 Jan 1997

Now /adds/ ballistic movement to that specified by the usual mouse, so
that IconHigh doesn't stop the normal mouse from being used.



03 Feb 1997

In highlight mode, distance now weighted according to direction.

Now scrolls window if needed to expose icon. This uses new feature of
TaskModule 0.05.


Added two Desk libraries locally, which allow veneers which pass a
reference to the client handler (as well as CMHG's pw), and a high-level
interface to the filter manager. Both seem to work.


04 Feb 1997

Added extra filter code for filters which munge the app's pollmask so
that the required events are always detected by the filter, even if the
task masks them out.

Seems to work ok. Note that testing the filtering out of the added code
with WimpMon doesn't work too well - WimpMon can see the extra events if
its filter is called before IconHigh's mask-restoring filter.

Added code to handle ptrenter/leave, and switch to appropriate emulation
mode. Works reasonably, but pointer stops moving and one has to press
cursor key again in ballistic mode. Tried hack to find initial state of
cursor keys, but doesn't work.


06 Feb 1997

Doesn't restart emulation when moving to new window if emulation is
unchanged.


07 Feb 1997

Seemed to have solved most of the problems. 

One was that sometimes a pointer enter event is received but
WImp_GetPointerInfo thinks pointer is still over old window. Thus
IconHigh chose the wrong window to test for presence of icons etc. The
intermitency of this was probably caused by the random order in which
IconHigh's filter detected event_LTRLEAVE/ENTER.

Another (which resulted in spurious movement of mouse and extra key
events being delivered to wimp apps) was caused by IconHigh blithely
moving the mouse inresponse to buffered autorepat events. It now only
moves the mouse in highlight mode if the appropriate key is still
pressed.

Now carries on moving after switching to ballisticmode from highlight
mode.

Need to stop cursor presses from reaching applications. Probably have to
use a filter.


11 Feb 1997

Bug causes no stack for trap handler etc. Seems that ptr enter/leave
code corrupts the memory of the task which is being filtered.

Seems to be ptr leave - eg moving onto titlebar. If no new emulation is
started (which is mosdt of the time because EmulationPointerStart
returns immediately if new emulation == old emulation) then everything
is ok.

Trying to ignore ptr leave com,pletely.
probkem is caused by ptr enter too. Even caused when
PtrEnterLeaveHandler calls EmulationPointerStart() straightaway, without
any checking of window info etc.

Problem goes away if Desk_Filter2_ClaimPost2 claim/relese is ommited...

Maybe it is the setting of r0to -1 after postfilter

Bug was caused by Desk_Filter2_ not coping with a filter being
unregistered by its client function. Hurray for MemCheck...


Still seems to be problem, only occurs after emulation has restarted,
and when key events are masked out...

**Check that MC checking isn't turnied ofand not restored...**
**try with direct CMHG veneers instead of Desk_ModHand etc.**



12 Feb 1997
Trying with direct CMHG veneers...Also removwed all mouse-buffer
functions in c.pointer - they were unused anyway. Seems to work ok.

13 Feb 1997
Made all key nbymers be #defines.


14 Feb 1997

Keeps lastmovement up to date.


17 Feb 1997

Problem with Filtermanager not understanding the inconsistent version
numbers used by Windowmanagr. It checks for version 3.80, and assumes
that all later versions have new filter code. Ubfortuntely, they don't.
Now have a hacked version which checks for version 3.96. This is on my
NC's NFS directory.


Works ok.


18 Feb 1997

Now intercepts KeyV in ballistic mode when key press is a cursor
direction key. Should prevent on-screen keyboard from detecting cursor
keypress KeyV and thus think that there is a real kbd present, and thus
closing down.

Now moves highlight when real mouse is moved.
Modified MoveHighlight() to cope with directioni_NULL - looks for valid
icon under pointer.

Problems are caused when window containing iconhighlightong is closed -
looks like redrawmanager doesn't detect this...?
Oops - problem was called by IconHigh calling Wimp[_ForceRedraw when
highlight was removed - caused problems when window doesn't exist any
more... Seems to be fixed now...
