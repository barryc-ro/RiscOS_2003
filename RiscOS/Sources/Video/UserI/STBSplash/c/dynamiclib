
/***************************************************

  Name   : dynamiclib.c
  Purpose: Dynamic area library functions

***************************************************/

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#include "kernel.h"
#include "swis.h"
//#include "os.h"

#include "dynamiclib.h"

void dynamiclib_init(void)
{
  
}

int dynamiclib_alloc(dynamiclib_str *in)
{
  _kernel_swi_regs r;
  char areaname[12];

  strcpy(areaname, in->name);
  if (areaname[0] < 32)
    strcpy(areaname, "<Untitled>");

  if (in->size > 0)
  {
    r.r[0] = 0;
    r.r[1] = -1;
    r.r[2] = in->size;
    r.r[3] = -1;
    r.r[4] = 128;
    r.r[5] = -1;

    r.r[6] = 0;
    r.r[7] = 0;
    r.r[8] = (int) in->name;
    _kernel_swi(0x66, &r, &r);

    in->area = (int *) r.r[3];
    in->area_number = r.r[1];

    in->allocated = 1;            /* Area is allocated */

    return(1);
  }

  return(0);
}

void dynamiclib_free(dynamiclib_str in)
{
  _kernel_swi_regs r;

  r.r[0] = 1;
  r.r[1] = in.area_number;
  _kernel_swi(0x66, &r, &r);
}
