# Makefile fragment for Binary Build Environment exporting.
#
# $Id$
#
# This Makefile is included directly by srcbuild as the core implementation
# of the binary build environment phase.
#
#
STDMAKEFILE=$Id$

.SILENT:

# Set the default option - component Makefile changes BBETYPE to override this
# Makefile's generic rules, but can of course depend on them by constructing
# the correct target.

BBETYPE=generic

# Get the components Makefile in case it wants to override the rules

include Makefile


# The default rule invoked by srcbuild simply invokes the correct sub-rule
bbe: bbe-${BBETYPE}
  @echo ${COMPONENT}: BBE phase complete


# Now all the default rules for the different module types

bbe-generic: bbe-${COMPONENTTYPE}-generic
  @|

bbe-C-generic: bbe-generic-resources
  @| C modules need a special rule to export the AOF file that they have built
  @| srcbuild generates this all on its own

bbe-ASM-generic: internal-bbe-generic
  @|

bbe-BAS-generic: internal-bbe-generic
  @|

bbe-KERNEL-generic: internal-bbe-generic
  @|

bbe-DATA-generic: internal-bbe-generic
  @|

bbe-RES-generic: internal-bbe-generic
  @|

bbe-HAL-generic: internal-bbe-generic
  @|

internal-bbe-generic: bbe-generic-resources bbe-generic-rom
  @|

#
# Now the generic ROM and resources rules
#
include Makefiles:StdTools

bbe-generic-rom:
  ${MKDIR} ${BBEDIR}.rm
  ${MAKE} install_rom MACHINE=${MACHINE} LOCALE=${LOCALE} SYSTEM=${SYSTEM} BUILD=${BUILD} UserIF=${UserIF} APCS=${APCS} INSTDIR=${BBEDIR}.rm COMPONENT=${COMPONENT} TARGET=${TARGET}
  @|

bbe-generic-resources-get-alias:
  @| Component Makefiles may rely on the BBE_Export_Dir alias.
  SetMacro Alias$BBEExportResourcesRule IfThere %0 Then ${CP} %0 ${BBEDIR}.%0 ${CPFLAGS}
  SetMacro Alias$BBEExportDirectoryRule IfThere %0 Then ${MKDIR} ${BBEDIR}.%0
  SetMacro Alias$BBE_Export_Dir BBEExportDirectoryRule %0|MBBEExportResourcesRule %0

bbe-generic-resources: bbe-generic-resources-get-alias
  ${MKDIR} ${BBEDIR}.Resources
  @| Generic rules copy the appropriate parts of the Resources directory.
  BBE_Export_Dir Resources.${LOCALE}
  BBE_Export_Dir Resources.Common.${LOCALE}
  BBE_Export_Dir Resources.${SYSTEM}.${LOCALE}
  BBE_Export_Dir Resources.${USERIF}.${LOCALE}
  BBE_Export_Dir Resources.${SYSTEM}.Common
  BBE_Export_Dir Translate.${LOCALE}
  BBE_Export_Dir Translate.Common.${LOCALE}
  BBE_Export_Dir Translate.${SYSTEM}.${LOCALE}
  BBE_Export_Dir Translate.${USERIF}.${LOCALE}
  BBE_Export_Dir Translate.${SYSTEM}.Common
  
# EOF
