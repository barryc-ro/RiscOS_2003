# Makefile fragment for assembler modules targetted at ROMming, built using AAsm
#
# $Id$
#
# This fragment requires the following macros to be set
# by the component master makefile:
#
#
# COMPONENT        (the name of the component)
#
# ROM_MODULE       (local filename - must be rm.<component>)
# ROM_OBJS         (component's object files for romming)
# ROM_LIBS         (libraries to link again ROM_OBJS to generate ROM_MODULE)
#
# DIRS             (magic target to ensure object directories are present)
#
#
# It relies on the following from the build system:
#
#
# INSTDIR          (installation directory for ROM_MODULE)
#
#
# It relies on the following generic tool macros from the Tools makefile
#
# CP               (copy, cp etc.)
# CPFLAGS          (flags after the dest arg - for RISC OS builds)
#
# MKDIR            (cdir/mkdir -p)
#
#
#
#

TARGET     .= ${COMPONENT}
ROM_MODULE .= rm.${COMPONENT}
ROM_SOURCE .= s.${COMPONENT}

#
# RISC OS ROM build rules:
#
rom: ${ROM_MODULE}
        @${ECHO} ${COMPONENT}: rom module built

install_rom: ${ROM_MODULE}
        ${CP} ${ROM_MODULE} ${INSTDIR}.${TARGET} ${CPFLAGS}
        @${ECHO} ${COMPONENT}: rom module installed

#
# Actually make the linked ROM target 
#
${ROM_MODULE}: ${ROM_SOURCE} ${DIRS}
        ${MKDIR} rm
        ${AASM} ${AASMFLAGS} -module -To $@ -From ${ROM_SOURCE}

#
# Clean the module
#
clean:
        ${RM} ${ROM_MODULE}
        @${ECHO} ${COMPONENT}: cleaned

#
# Export phases
#
export_hdrs: ${EXPORTS}
        @${ECHO} ${COMPONENT}: header export complete

export_libs:
        @${ECHO} ${COMPONENT}: library export complete

export: export_${PHASE}
        @|

#
# Resources
#
RESFSDIR .= ${RESDIR}.${COMPONENT}

resources_common:
        ${MKDIR} ${RESFSDIR}
        ${TOKENCHECK} LocalRes:Messages
        ${CP} LocalRes:Messages ${RESFSDIR}.Messages ${CPFLAGS}
        
resources-None: resources_common
        @|

resources-: resources_common
        ${TOKENCHECK} LocalRes:CmdHelp
        ${CAT} LocalRes:CmdHelp { >> ${RESFSDIR}.Messages }
        
resources: resources-${CMDHELP}
        @${ECHO} ${COMPONENT}: resources copied to Messages module


EOFSTDMAKEFILE=$Id$
# EOF
