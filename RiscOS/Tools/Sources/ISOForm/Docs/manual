

                ACORN ISO 9660 CD-ROM FORMATTER - USER GUIDE

                                Version 1.11
 


0  CONTENTS


  1  ABOUT THIS GUIDE

  2  INTRODUCTION

  3  HOW TO INSTALL ISOFORM
    3.1  Hardware requirements
    3.2  Installation procedure

  4  HOW TO PRODUCE A CD-ROM
    4.1  Designing the hierarchy
    4.2  The ISO 9660 standard and RISC OS
    4.3  Constructing an image
    4.4  How to store an image on a SCSI disc
      4.4.1  Specifying the image area
      4.4.2  A dedicated disc
      4.4.3  A disc shared with RISC OS
      4.4.4  Further information
    4.5  Producing a CD-ROM

  5  TECHNICAL REFERENCE - COMMAND LINE PROGRAM
    5.1  Introduction
    5.2  Notation
    5.3  Starting the Formatter
    5.4  Options
    5.5  Link files
    5.6  Output options
    5.7  Errors
    5.8  Warnings
    5.9  Progress messages
    5.10 Report format

  6  TECHNICAL REFERENCE - DESKTOP APPLICATION
    6.1  Introduction
    6.2  Loading the application
    6.3  The Application menu
    6.4  The SetUp dialogue box and its menu
    6.5  The Text and Summary windows

  7  TECHNICAL NOTES ON IMAGE STRUCTURE



1  ABOUT THIS GUIDE


You must complete the following steps in order to make a CD-ROM:

  1 - Create a directory structure containing all the files that you wish
      to include on the disc.

  2 - Transform this structure into an "ISO 9660 image".

  3 - Create a trial disc from the image, and check that it works.

  4 - Duplicate quantities of the disc.

This guide tells you how to use the ISO 9660 CD-ROM Formatter software to
complete step 2.

The rest of this guide tells you

  * how to install the software;

  * how to produce a CD-ROM - including practical advice on aspects such
      as file naming to make sure that your CD is not only ISO 9660
      conformant but also as compatible as possible with other Acorn
      software systems;

  * how to use each of the Formatter options, with details in the Technical
    Reference sections.



2  INTRODUCTION


The ISO 9660 standard defines a format for encoding a hierarchy of files onto
a Mode 1 CD-ROM, and is supported by all major manufacturers including IBM,
Apple and Sun. Acorn supports the standard with CDFS - the Compact Disc
Filing System - through which RISC OS users can access files and run
applications from a CD-ROM in exactly the same way that they access data from
a floppy or hard disc.

The Formatter creates the image as a sequence of blocks, each 2048 bytes
long, which may be written to a RISC OS file or directly to a specified area
on a SCSI disc. The image may then be taken to a specialist company where
it is transferred to a "write-once" CD-R disc - often called a "gold disc" -
which you can test out on your normal CD-ROM drive. If all is well, you may
now send the gold disc as master to a CD manufacturer to replicate your
CD-ROM in production quantities.



3  HOW TO INSTALL ISOFORM


3.1  Hardware requirements

The Formatter software itself has no special hardware requirements, and will
run successfully on any Archimedes computer with the RISC OS operating
system.

However, if you wish to construct an ISO image you will need sufficient disc
space to hold that image together with your original hierarchy. Remember that
a CD-ROM can contain over 600MB of data, and so it may be convenient to hold
the image on an external SCSI disc which you can then detach and take to a
suitable specialist company when you are ready to make a gold disc.


3.2  Installation procedure

You must first make sure that your !System directory contains up-to-date
versions of the system modules required by ISOForm. The easiest way to do
this is to use the !SysMerge application to merge the contents of the !System
directory supplied with ISOForm with your own master !System. If you are
not familiar with !SysMerge, details can be found in the !Help file inside
the application: this file can also be displayed by choosing the Help
sub-menu option from the Filer.

The Formatter can be run either as a multi-tasking desktop application, or
directly from the command line. The desktop version is !ISOForm, which you
should copy to a convenient location. The command line version is held in
the file ISOForm which you should copy to your Library directory.



4  HOW TO PRODUCE A CD-ROM


4.1  Designing the hierarchy

The properties of CD-ROM drives are quite different from those of hard disc
drives, and you should keep in mind limitations on access time and transfer
rates when designing the structure of your application. The maximum data
transfer rate is 150K per second, and for a drive with an average seek time
of 400mS typical seek times can vary from around 250mS for adjacent data to
as much as 800mS for data at the other end of the disc: compare these with
600K per second and 16mS for a typical SCSI disc. Some modern CD-ROM
drives include substantial buffer storage which can help mitigate the effects
of seek time when reading data that is clustered together on the disc, so it
is wise to check out your application on an older unbuffered drive before
committing to quantity production.

Performance can often be improved by making sure that files which are likely
to be accessed together are stored close together on the disc, and so an
understanding of the way in which the Formatter lays out files in the image
may be useful. The normal rules are as follows (but see also the -first
option described in the Technical Reference section):

   * The files within a given directory are stored one after the other in
     alphabetical order.

   * All directories at the same level are stored (with their files) one
     after the other in alphabetical order.

   * The root directory (and its files) appears at the start of the image,
     and is followed by all level 1 directories, then level 2, and so on.

A compact disc is written from the inside out, and so files in the root
directory will be closest to the centre, and files deepest in the hierarchy
will be closest to the edge. You can use the -report option when running the
Formatter to see exactly where each of your files will be stored.

The contents of a CD are not restricted to data, and you can design a "mixed
mode" CD which includes one or more audio tracks as well as the data track;
any specialist CD facility will be able to provide details of how to prepare
audio material to be incorporated in the gold disc.


4.2  The ISO 9660 standard and RISC OS

The ISO 9660 standard imposes a number of constraints on the form of the
hierarchy and the names of directories and files within it. These are all
checked by the Formatter, and any violations are reported as errors. The
major constraints of which you should be aware are as follows:

  * The hierarchy must contain no more than 8 levels; in other words, no
    path name can have more components than:

               $.dir1.dir2.dir3.dir4.dir5.dir6.dir7.file8

    where $ represents the root directory of your hierarchy.

  * File and directory names may only contain the following characters:

               - upper-case letters
               - digits
               - underlines

  * File names may contain no more than 30 characters.

  * Directory names may contain no more than 31 characters.

Most RISC OS filing systems are case-insensitive, and so the Formatter
automatically replaces lower-case letters by their upper-case equivalents
in file and directory names. Many RISC OS filing systems also limit name
lengths to 10 characters, and for this reason it is wise to restrict your own
names in the same way: the Formatter will generate a warning message if any
name longer than 10 characters is found.

How are application names handled, when exclamation marks are not permitted
characters? The Formatter replaces any leading ! by an underline, and records
special "system-specific" information in the image to inform CDFS of the
replacement; when the file or directory is accessed from CDFS, the ! is
reinstated.

The RISC OS file type, date/time stamp, and attributes (including access
rights) are also recorded in this way, so that CDFS can access this
information when required. System-specific extensions of this kind are
permitted by the ISO 9660 standard, and do not prevent the files from being
accessed on other systems.

If you wish your disc to be compatible with Acorn's Level 4 Fileserver
software, you should also meet the following requirements:

  * The disc must have a volume identifier, which must contain no more than
    16 characters of which the first is a letter.

  * All relevant files should have "public read" access.

  * No directory should contain more than 77 files.

Empty directories and files are also best omitted: although CDFS will handle
such objects correctly, other CD-ROM filing systems may not do so.

These conditions are all checked by the Formatter, and warning messages
issued if any violation is found.


4.3  Constructing an image

Double-click on the !ISOForm application to load it onto the icon bar, and
then click on the application icon to open the "set up" window; now fill in
fields as follows:

 Root directory

   You can either type the directory name into the field, or you can drag the
   corresponding icon from a directory display and drop it into the  field.

 Volume id

   Enter this in upper-case; it will become the name by which CDFS recognises
   the disc.

 Check hierarchy only

   Make sure that this is the output option that is selected.

Now click on the "Run" button, and the Formatter will start executing,
sending its output to a new window on the screen. Typical output might be as
follows:

  Acorn ISO 9660 CD-ROM Formatter version 1.00 at 17:24:23 on 24-Jan-1992
  Checking the hierarchy
    SCSI::Disc4.$.isoroot
    SCSI::Disc4.$.isoroot.ISOFORM
  *** Error: File or directory name 'COMP+go' contains illegal character(s)
         while examining directory 'SCSI::Disc4.$.isoroot.ISOFORM'
  *** Error: File or directory name 'EX-image' contains illegal character(s)
         while examining directory 'SCSI::Disc4.$.isoroot.ISOFORM'
    SCSI::Disc4.$.isoroot.MISCPROGS
              ....

    SCSI::Disc4.$.isoroot.MISCPROGS.H
  *** Warning: This directory is empty
         while examining directory 'SCSI::Disc4.$.isoroot.MISCPROGS.H'
    SCSI::Disc4.$.isoroot.MISCPROGS.O
  *** Warning: This directory is empty
         while examining directory 'SCSI::Disc4.$.isoroot.MISCPROGS.O'
  Check complete

  ********************************* Warnings ********************************
    78 files do not have Public Read access, and so will not be accessible
      from a Level 4 Fileserver
    There are 2 empty directories
  ***************************************************************************

  The size of the ISO image will be 313 ISO blocks (626k) containing:
         9 directories
        78 files

  ***************************************************************************
    Structure does not conform to ISO 9660 standard - 2 errors reported
  ***************************************************************************

When it is complete, you should check all error and warning messages, making
corrections to your hierarchy as necessary. You are now ready to create an
ISO 9660 image.

The image can be directed to a RISC OS file, or to a specified area on a SCSI
disc; you should choose the option most convenient to the company who is to
make the gold disc for you. In most cases this will be the SCSI option, and
section 4.4 below gives details of how you can set up a SCSI disc ready to
receive an image.

For the moment we shall assume output to a file, and you should now click on
the "Write image to file" option and fill in the corresponding field. If the
CD you are creating is to be accessed over a network you should also click on
the "Public access" button, and if you want details of where your files will
appear in the image you should click on the "Report image contents" button.

Click on "Run" to start the Formatter again. This time (provided there are
no more errors) an image will be written to the file, and details will be
reported in the window:

  Acorn ISO 9660 CD-ROM Formatter version 1.00 at 17:34:42 on 24-Jan-1992
  Checking the hierarchy
    SCSI::Disc4.$.isoroot
    SCSI::Disc4.$.isoroot.ISOFORM
    SCSI::Disc4.$.isoroot.MISCPROGS
    SCSI::Disc4.$.isoroot.ISOFORM.C
    SCSI::Disc4.$.isoroot.ISOFORM.H
    SCSI::Disc4.$.isoroot.ISOFORM.O
    SCSI::Disc4.$.isoroot.MISCPROGS.C
  Check complete
  The size of the ISO image will be 311 ISO blocks (622k) containing:
         7 directories
        78 files
  Writing the image

                                                    Start             Size in
  Object                                     Type  Address  Length     Bytes

  System Area                                  -         0      16      32768
  Primary Volume Descriptor                    -        16       1       2048
  Volume Descriptor Set Terminator             -        17       1       2048
  Type L Path Table                            -        18       1         84
  Type M Path Table                            -        19       1         84
  Root directory                               D        20       1       2048
  STATUS                                       F        21       3       5525
  ISOFORM                                      D        24       1       2048
  ISOFORM.COMPGO                               F        25       5       9928
  ISOFORM.EXIMAGE                              F        30      15      28828
                                  .......

  ISOFORM.O.TOFILE                             F       290       1       1900
  ISOFORM.O.TOSCSI                             F       291       3       4784
  MISCPROGS.C                                  D       294       1       2048
  MISCPROGS.C.DIRSCAN                          F       295       3       5258
  MISCPROGS.C.FREX                             F       298       2       2121
  MISCPROGS.C.SCSIEX                           F       300       3       5389
  MISCPROGS.C.SCSIEX2                          F       303       4       6553
  MISCPROGS.C.SORTEX                           F       307       2       3118
  MISCPROGS.C.VARGEX                           F       309       2       2220
  Image complete

If you wish to save or print the output, you can bring up a "Save" box by
clicking menu over the window and choosing the "Save" option.
 
Looking at the output above, you will see that the Formatter works in two
stages: checking the hierarchy, and creating the image.

During the first stage, the hierarchy is thoroughly checked for conformance
to the ISO 9660 standard. Any problems are reported as errors or warnings,
and progress is indicated by writing out the name of each directory just
before its contents are checked. When the check is complete, summaries of any
errors or warnings are produced, and information about the size of the image
is printed.

During the second stage, the image itself is written out, including tables
containing information gathered during the first stage. The program assumes
that no changes will be made to any of the files in the hierarchy between
these two stages, and so you must be careful not to alter the hierarchy or
its contents in any way whilst the Formatter is running.


4.4  How to store an image on a SCSI disc


4.4.1  Specifying the image area

The Formatter provides an option for writing the image to a specified area on
a SCSI disc. To do this, you must supply the device identifier, a start block
address, and the length of the area:

 Device identifier

   This is the number allocated to the device on the SCSI bus, and is in the
   range 0 to 6. Use the *devices command if you do not know the device id
   for the disc which you wish to use.

 Start block

   This defines whereabouts on the disc you wish the image to be recorded. It
   may be left blank, in which case an appropriate default will be chosen -
   see below.

 Length

   This defines how much of the disc is to be used. It may be left blank, in
   which case the Formatter assumes that all space from the start block until
   the end of the disc is available. The Formatter checks that the image will
   fit into this space before starting to write it.

The start block and length are measured in terms of the SCSI device's block
size, whereas information about image size is normally reported in terms of
the ISO 9660 logical block size of 2048 bytes. Many SCSI discs have a block
size of 512 bytes, in which case a length of 102400 would reserve space for
an image up to 50MB - or 25600 ISO blocks - in size. 

When you write an image to a SCSI disc you should make a note of the start
block and length ready to give to the company who makes the gold disc: such
images are not held in any filing system, and so there is no other way of
locating them.

There are two simple ways of preparing a new SCSI disc for use by the
Formatter, and these are described below. You will need a copy of SCSIDM
(supplied with the ACORN SCSI Expansion Card) in order to configure the
disc: further information on how to use SCSIDM can be found in the SCSI
Expansion Card User Guide.

If you wish to re-configure an existing disc you MUST take a back-up copy
first, since any data on it will be destroyed by the configuration process.


4.4.2  A dedicated disc

If you wish to dedicate a whole disc to image storage, you should use SCSIDM
to format the disc only. After formatting, you would normally use the section
command to partition the drive; you should omit this stage:

   *scsidm
   scsidm> device 2
   Current device is 2, type 0 (direct access)
   Device identifies itself as ....
   scsidm> format
       ...format complete
   reading new disc shape...done
   scsidm> quit
   *

You can now specify any part of the disc for image storage, although you
would normally start at the beginning - block 0; this is the default value
assumed by the Formatter if no start block is given.


4.4.3  A disc shared with RISC OS

In this case, you should follow the format command with the section command,
answering "yes" to the question about RISCiX partitions, and specifying the
number of blocks which you wish to be allocated to RISC OS:

   *scsidm
   scsidm> device 2
   Current device is 2, type 0 (direct access)
   Device identifies itself as ....
   scsidm> format
       ...format complete
   reading new disc shape...done
   scsidm> section
   Include RISCiX partitions? (yes) >y
   Device 2 has a block size of 512 bytes
   The RISC OS area must be between 1275 and 480124 blocks long
   size of RISC OS area (1275)? >240000
   Rounded number of blocks in RISC OS partition up to 240975
         ....
   Writing RISC OS partition...done
   scsidm> quit
   *

In the above example, blocks 0 to 240974 will be used by the RISC OS SCSIFS
filing system, and blocks 240975 to 480123 are available for storing images.
If you do not give a start block value, the Formatter will recognise that a
RISC OS area is present, and will use as default the first block that is
free - 240975 in this example.


4.4.4  Further information

More complicated situations are possible in which your SCSI disc also
contains one or more RISC iX partitions, and in such cases you should always
specify an explicit start block and length.

The Formatter always checks to make sure that the specified image area does
not overlap with any part of the disc occupied by either RISC OS or RISC iX
data, and will refuse to write out the image if any overlap is found. This
means that you will need to reconfigure any SCSI disc that is already fully
allocated before you can use it to store ISO images.

If the image itself is smaller than the space allocated for it, the Formatter
(unless instructed otherwise by the -nowipe option) writes zeros to the
remaining blocks. This makes sure that any data previously on the SCSI disc
is not accidentally copied to the CD-ROM when the gold disc is made. 


4.5  Producing a CD-ROM

Once you have your image on a SCSI disc you can take or send this to a
specialist company for a test pressing. Before doing so, you should check
once more that all the data you require has been included: it is impossible
to add more files to a gold disc once it has been written. In many cases, a
gold disc can be produced "while you wait", at a cost of a few hundred
pounds.

The final stage - quantity production - involves the most financial outlay,
and so you should check your gold disc carefully. Once satisfied, the gold
disc itself (or tapes produced at the same time) can be used as the master
for quantity production, with typical costs around £2 a disc with a once off
mastering charge of around £1000.



5  TECHNICAL REFERENCE - COMMAND LINE PROGRAM


5.1  Introduction

This section explains how to use the Formatter from the Command Line, and
gives details of all the available options.

The program operates in two phases.

During the first phase, the specified hierarchy of files is checked for
conformance to the ISO 9660 standard. This phase is normally quite fast,
since only directories are accessed and file names checked: there is no need
to read the contents of the files themselves.

The image itself is constructed during the second phase. This may take some
time for large images as all of the data has to be copied from the hierarchy
to the image.

The Formatter assumes that no changes are made to the hierarchy between the
two phases, and so you must be careful not to access any of the files
involved whilst formatting is in progress.


5.2  Notation

The next section describes the syntax of each option using a formal notation.
Items enclosed in angle brackets stand for parameters which the user must
supply; for example <dirname> should be replaced by a suitable RISC OS
directory name.

The following items are common to a number of options, and are to be
interpreted as follows:

  <dirname>   -  any valid RISC OS directory name

  <filename>  -  any valid RISC OS file name

  <d-string>  -  a string composed only of the following characters:

                       * upper-case letters
                           (although the Formatter will automatically
                            convert any lower-case letters to upper-case)
                       * digits
                       * underlines

  <a-string>  -  a string composed only of the following characters:

                       * upper-case letters
                           (although the Formatter will automatically
                            convert any lower-case letters to upper-case)
                       * digits
                       * underlines
                       * spaces
                       * special characters

                 where the special characters are:  !"%&'()*+,-./:;<=>?

                 Any <a-string> parameter that includes one or more spaces
                 or quotes must itself be quoted with each internal quote
                 doubled. For example, the <a-string> FRED AND "JIM" would
                 have to be entered as "FRED AND ""JIM""".

  <int>       -  a sequence of digits representing an integer

Square brackets are used to enclose optional items, and a vertical bar is
used to separate alternatives. For example, <int>[k|K] means that the user
should supply an integer optionally followed by the letter k or K.


5.3  Starting the Formatter

The program is invoked by the command *ISOForm, optionally followed by a
number of options:

        *ISOForm [ <option> ... ]

Each <option> is identified by a minus sign immediately followed by a
sequence of letters; this may be followed by one or more parameter values.

Normally the option list will include at least the -root option, together
with one of the output options. If no option is given, the command responds
with a short description of all available options.


5.4  Options

  -root <dirname>

    Specifies <dirname> as the directory that defines the hierarchy of files
    that is to be formatted.

    The hierarchy may consist of a number of separate parts (on different
    devices, or even in different filing systems) which are linked together;
    details are given in the "Link files" section below.

  -check

    If this option is present, no image is created: instead, the hierarchy
    is simply checked to make sure that it conforms to ISO 9660 requirements.

  -tofile <filename>

    Specifies that the image is to be written to the file <filename>.

  -toscsi <deviceid> [ <startblock> [ <numblocks> ] ]

    Specifies that the image is to be written as "raw" data to SCSI device
    number <deviceid>: <deviceid> is an <int> whose value lies between
    0 and 6.

    If <startblock> and, optionally, <numblocks> are present, then these
    define explicitly the portion of the device to be used: if <numblocks>
    is absent, the portion is assumed to run from <startblock> to the end of
    the device.

    If not, all of the device following any RISC OS partition present is to
    be used.

    Both <startblock> and <numblocks> have the form [&]<int>; if the optional
    ampersand is present, the digit sequence may include the letters A to F,
    and will be interpreted as a hexadecimal value.

  -toscsilength <numblocks>

    This is an alternative way of specifying the length of the image; see
    the examples in the section on "Output options" below.

  -volid <d-string>

    The given string is recorded as the Volume Identifier for the CD-ROM,
    which will be used as the disc name by CDFS. It may contain at most 32
    characters.

  -pubid <a-string>

    The given string is recorded as the Publisher Identifier for the CD-ROM.
    It may contain at most 128 characters.

  -copyid <d-string>

    Specifies <d-string> as the Copyright File Identifier. <d-string> must be
    the name of a file inside the directory specified by the -root <dirname>
    option, and must be no more than 8 characters long.

  -help

    Lists and gives information about these options.

  -nowipe

    If present, this prevents any unused blocks in a SCSI destination area
    from being cleared to zero.

  -quiet

    Progress is normally indicated by output of a line each time a directory
    in the hierarchy is opened; such messages are inhibited if this option is
    selected.

  -nowarn

    Certain legal but possibly undesirable circumstances normally generate
    warning messages; details are given in a later section. These messages
    are suppressed if this option is selected, but a summary of all warning
    messages will still be written at the end.

  -report

    This option causes details of the location and size of each object to be
    produced as the image is created during the second phase. These details
    replace any progress messages which might otherwise appear (see -quiet
    option above).

  -public

    This option causes "public read" access to be added to every file and
    directory in the image.

    If it is not set, a warning message noting the number of files without
    public read access is printed: note that no such file can be accessed
    from a CD-ROM on a Level 4 Fileserver, for example. 

  -first <filetype>

    This option causes all files of type <filetype> to be written to the
    image before any other files or directories. This means that such files
    will be closer to the centre of the disc than other files, which may
    help access under certain circumstances.

    <filetype> is entered as &ddd where each d is a hexadecimal digit.

  -ptsize <int>[k|K]

    Specifies the number of bytes to be allocated to an internal data
    structure called the "path table structure".

    The amount of storage required depends on the number of directories in
    the hierarchy and on the length of their directory names. The default
    value of 120k should be sufficient for a hierarchy containing up to
    3000 directories with names around 8 characters long.

  -dirsize <int>[k|K]

    Specifies the number of bytes to be allocated to an internal data
    structure called the "directory structure".

    The amount of storage required depends on the maximum number of objects
    in any one directory in the hierarchy, and on the length of the names of
    those objects. The default value of 25k should be sufficient for a
    directory containing up to 500 objects with names around 8 characters
    long.

  -opts <filename>

    Specifies <filename> as the "command file" in which (further) program 
    options may be found.

    Each line of the file must either be empty, or must contain a single
    option.

    If an option is specified both on the command line and in the command
    file, then the command line option takes precedence.

Notes:

  (1)  If no option is present, the effect is as if the option -help had
       been given.

  (2)  Exactly one of the options -check, -tofile and -toscsi must be given.

  (3)  Either of the options -tofile and -toscsi given in the command line
       will override either of them given in any command file.


5.5  Link files

A "link file" is a file whose name starts with the character + and which
contains the name of a RISC OS directory called the "target" directory. The
target directory name should be given as a full pathname, and may be preceded
and/or followed by spaces and newlines.

Whenever the Formatter encounters a link file in the source hierarchy, it is
replaced by any files and directories found in the corresponding target
directory (which may themselves be, or may include, further link files which
are processed in the same way).

You can link files to split a large source hierarchy into a number of more
manageable portions, and it is the only way in which you can build very large
images from filing systems such as ADFS where a limit of 512MB of data per
device is imposed.

As a simple example, suppose you wish to make an image containing just five
large files: FL1 and FL2 from disc 4, and FL3, FL4, FL5 from disc 5.

First, create directory structures on the two devices as follows:

             adfs::4.$.mycd                 adfs::5.$.others
                   |                               |        
            ---------------                 ---------------
           |       |       |               |       |       |
         +link    FL1     FL2             FL3     FL4     FL5

where the link file +link contains the string "adfs::5.$.others".

Now run ISOForm with -root adfs::4.$.mycd to create an image whose structure
is:

                                 root
                                  |
                   -------------------------------
                  |       |       |       |       |
                 FL1     FL2     FL3     FL4     FL5


5.6  Output options

The ISO image can be written as a RISC OS file (to any device) using the
-tofile option, or as a "raw" stream of data blocks to a direct-access SCSI
device using the -toscsi option. This latter option provides a system-
independent interchange format.

If the -tofile option is selected, no checks are made: any pre-existing file
with the same name will be overwritten by the new image.

The -toscsi option specifies a raw SCSI destination by providing a device
identifier, a start address, and a length:

   <deviceid>    - this is the SCSI device identifier, given in the range
                   0 to 6.

   <startblock>  - this may be given explicitly as a SCSI block address; if
                   omitted, the destination area is assumed to start
                   immediately after any RISC OS section found on the device.

   <numblocks>   - the length in SCSI blocks; if omitted, the destination
                   area is assumed to occupy all of the device from the start
                   address to the end.

Some examples may help to make this clear:

    options                       destination area

    -toscsi 2 20000 1000          Blocks 20000 to 20999 inclusive

    -toscsi 2                     All of device 2 (excluding any RISC OS
                                  section)

    -toscsi 2 20000               From block 20000 to the end of the device

    -toscsi 2 -toscsilength 1000  1000 blocks starting immediately after any
                                  RISC OS section

In all cases, a check is made to see whether the requested destination area
is free: if any part of it appears to be part of a RISC OS or RISC iX
partition, then the program will refuse to proceed. (Note that a SCSI disc
without either a RISC OS or RISC iX partition can be created by using SCSIDM
just to format the disc.)

If all is well, the image is written to the destination from the start
address onwards as a sequence of blocks. If the image is smaller than the
specified length, all remaining blocks in the destination are zeroed, unless
the -nowipe option is set.


5.7  Errors

Faults in user-supplied options are reported immediately and the program
proceeds no further; suitability of the selected output option is also
verified before phase 1 is entered.

During phase 1, the Formatter reports as errors any non-conformances found as
it scans the root hierarchy; phase 2 - writing the image - will only be
entered if no errors are found.

The program can be interrupted at any time by the user pressing "Escape".


5.8  Warnings

The following circumstances will generate warning messages (unless suppressed
by the -nowarn option):

  * A file or directory name contains more than 10 characters.

  * A file or directory is empty.

  * No Volume Identifier has been specified.

  * The specified Volume Identifier contains more than 16 characters, or does
    not start with a letter.

  * A directory contains more than 77 objects.

  * Files without Public Read access are present.

These situations do not create non-conformant images, but may cause
difficulties when inter-working with other RISC OS software.


5.9  Progress messages

Progress messages reporting the start and finish of each major phase of the
Formatter's operation are always produced.

A message is also output each time a new directory in the hierarchy is
processed, unless the -quiet option is selected.

Typical output might be as follows:

    Acorn ISO 9660 CD-ROM Formatter version 1.0 at 14:10:24 on 20-Jan-1992
    SCSI device 2 has no RISC OS or RISC iX partitions and contains
        2107704 blocks of size 512 bytes
    The ISO 9660 image will be written from block 0 to block 2107703
        (length 2107704 blocks)
    Checking the hierarchy
      adfs::Disc4.$.carparts
      adfs::Disc4.$.carparts.A
                ....

      adfs::Disc4.$.carparts.C.D.F1
      adfs::Disc4.$.carparts.C.D.F2
    Check complete
    Writing the image
      adfs::Disc4.$.carparts
      adfs::Disc4.$.carparts.A
                ....

      adfs::Disc4.$.carparts.C.D.F1
      adfs::Disc4.$.carparts.C.D.F2
    Padding with zeros
    Image complete


5.10 Report format

When the -report option is selected, a report similar to the example below
is produced during phase 2:
                                           
                                               Start           Size in
      Object                          Type    Address  Length   Bytes

      System Area                       -         0       16    32768
      Primary Volume Descriptor         -        16        1     2048
      Volume Descriptor Set Terminator  -        17        1     2048
      Type L Path Table                 -        18        1      796
      Type M Path Table                 -        19        1      796
      Root Directory                    D        20        1      200
      README                            F        21        2     2973
      SORTED                            F        23        2     3725
      IMAGES                            D        25        1      240
      IMAGES.CAT                        F        26       11    21530
      IMAGES.DOG                        F        37        3     4572

The first five lines give details of the location and size of various system
tables required to be present on an ISO 9660 CD-ROM; the following lines give
details of every file (Type = F) and directory (Type = D) in the image.

The Start Address is given relative to the beginning of the image, and both
Start Address and Length are given in terms of ISO blocks, each of which is
2048 bytes long.
 


6  TECHNICAL REFERENCE - DESKTOP APPLICATION


6.1  Introduction

The desktop version of the ISO Formatter has been developed using Acorn's
DDE (Desktop Development Environment) FrontEnd tools, and those familiar
with the Acorn Desktop C or Acorn Desktop Assembler products will recognise
most of the features of the Formatter's user interface.

The Formatter is run as a desktop application as follows:

 1  Load the !ISOForm application onto the icon bar.

 2  Click on the ISOForm icon to display the SetUp dialogue box.

 3  Set Formatter options by filling in fields in the SetUp box, or by
    choosing appropriate entries in the SetUp menu.

 4  Click on the RUN button: the Formatter starts executing, with output
    directed to the Text window that now appears on the screen.

 5  During execution it may be convenient to "iconise" the Text window by
    clicking Adjust on the window's Close icon; it is then replaced by a
    smaller Summary window. The original Text window is recovered by
    clicking Adjust on the Summary window's Close icon.

 6  When formatting is complete, the contents of the Text window can be
    saved by choosing the appropriate entry from the Text window menu.

Each of these steps is described in detail in the following sections.


6.2  Loading the application

Bring up a directory display containing the !ISOForm application directory,
and double-click on the !ISOForm icon. This will load the application onto
the icon bar at the bottom of the display.


6.3  The Application menu

The Application menu is displayed by clicking menu on the !ISOForm icon on
the icon bar. The following entries are available:

    Info =>

      This entry leads to a dialogue box displaying information about the
      program including identification, copyright, version number and date.

    Save options

      Choosing this option will save the current options defined by the
      Options menu below. These should not be confused with the Formatter
      options which are specified in the SetUp box and its associated menu:
      these options are not saved.

    Options =>

      This entry leads to the following sub-menu:

        Auto Run

          Choosing this entry toggles "auto-run" status: the entry is ticked
          if auto-run is switched on.

          To use the auto-run option, you must create a "command file" in
          which each program option appears on a separate line; for example,
          the file could consist of the following lines:

             -root  adfs::4.$.cdapp
             -toscsi 2
             -report
             -volid ARCHMED

          Make sure that auto-run is switched on, and drag the icon
          representing this file from a directory display and drop it onto
          the ISOForm icon on the icon bar; the Formatter will start
          executing immediately with the options specified in the command
          file.

          If auto-run is off, the Formatter does not start executing, but the
          SetUp dialogue box appears with the "Options file" field already
          filled in with the name of the command file.
        
        Auto Save

          This option is not available to ISOForm, and the entry is
          permanently greyed-out.

        Display =>

          This leads to a sub-menu containing two entries called "Text" and
          "Summary". Choosing one of these entries ticks it, and causes the
          other to be un-ticked.

          When Text is ticked, ISOForm will display a Text window when it
          starts executing, but when Summary is ticked, execution starts with
          a Summary window. 

    Help

      Choosing this option brings up a scrollable window containing a summary
      of the Formatter options available with a short description of each
      one.

    Quit

      Removes the application from the icon bar.


6.4  The SetUp dialogue box and its menu

The SetUp box is displayed by clicking on the ISOForm application icon on the
icon bar, and its menu is displayed by menuing over the SetUp box itself.

Most of the fields in the SetUp box and entries in the menu correspond to
Formatter options, as defined below; the options themselves are more fully
explained in the reference section 5, and an example of how to use them to
construct an image appears in section 4.3.

The SetUp box contains the following fields:

    Root directory

      This defines the value of the -root option. You may enter a directory
      name explicitly, or drag an icon representing the root directory and
      drop it onto the field.

    Volume id

      The -volid option.

    Output options

      Exactly one of these options should be selected: choose the one you
      want by clicking on the corresponding radio button.

        Write image to file

          The -tofile option: enter a file name, or drag an icon representing
          the desired output file and drop it onto the field.

        To SCSI device

          The -toscsi option: enter a digit between 0 and 6 for the device
          id, and enter values into the Start block and Length fields as
          required.

        Check hierarchy only

    Report image contents

      Click on this option icon to set the -report option; click again to
      reset it.

    Options file

      The -opts option: enter a file name, or drag an icon representing your
      command file and drop it onto the field.

    Public access

      Click on this option icon to set the -public option; click again to
      reset it.

    Run

      Click on this button to start the Formatter executing after you have
      set all the options you need.

    Cancel

      Click on this button to remove the SetUp box from the display.

The SetUp menu has the following entries:

    Command Line =>

      This entry leads to a dialogue box in which the command line
      corresponding to the options already selected is displayed. You may
      edit this line in any way you wish, and then click on the Run button to
      start the Formatter executing.

    Publisher =>

      This entry leads to a writable field for the -pubid option.

    Copyright =>

      This entry leads to a writable field for the -copyid option.

    No warnings

      Choose this entry to toggle the state of the -nowarn option: the entry
      is ticked when the option is selected.

    No wipe

      Choose this entry to toggle the state of the -nowipe option: the entry
      is ticked when the option is selected.

    Quiet

      Choose this entry to toggle the state of the -quiet option: the entry
      is ticked when the option is selected.

    PT size =>

      This entry leads to a writable field for the -ptsize option.

    Dir size =>

      This entry leads to a writable field for the -dirsize option.

    First =>

      This entry leads to a writable field for the -first option.


6.5  The Text and Summary windows

As soon as the Formatter starts execution, a Text window containing output
appears on the screen (unless the Summary Display option has been chosen -
see above). There is a menu associated with this window with the following
entries:

    Info =>

      This entry leads to a dialogue box containing information about the
      ISOForm program.

    Cmd line =>

      This entry leads to a dialogue box containing a field in which the
      command line corresponding to the options selected for this run is
      displayed. You may edit this field in any way you wish, and clicking
      on the ReRun button will create a new task corresponding to the options
      now specified.

      Running two copies of the Formatter at the same time is not likely to
      be useful, and this option is normally only selected to re-run with
      the same options as before after correcting errors found in the
      previous run.

    Save =>

      This entry leads to a standard RISC OS Save box. You can use this
      to take a copy of the contents of the Text window even while the
      Formatter is still running, making it easy to examine the output
      produced so far.

    Abort

      Choose this option to terminate the Formatter run; the Text window
      remains on display, and its contents can be examined before closing it.

    Pause

      Choose this option to halt execution of the Formatter temporarily.

    Continue

      Choose this option to resume execution of a paused Formatter.

A Text window may be turned into a Summary window by clicking Adjust on its
Close icon - and vice-versa.

The Summary window displays the number of lines of output produced so far,
contains two buttons, and has a menu with three entries called Info,
Cmd line and Save; the buttons and menu entries duplicate the functions
available from the Text window menu in an obvious way.



7  TECHNICAL NOTES ON IMAGE STRUCTURE


These notes describe details of the way in which the Formatter constructs an
ISO 9660 image from a hierarchy of RISC OS files.

This section assumes a knowledge of the ISO 9660 standard: details are given
in the standards document reference "ISO 9660: 1988 (E)" entitled
"Information processing - Volume and file structure of CD-ROM for information
interchange".

  The image does not contain any Supplementary Volume Descriptors, nor any
  Optional Path Table Occurrences.

  Every file name is recorded with a null extension and a version number 1:
  for example, the RISC OS filename "trainspot" will be recorded as the ISO
  filename "TRAINSPOT.;1".

  The following fields in the Primary Volume Descriptor are left unset:

       - System Identifier
       - Volume Set Identifier
       - Application Identifier
       - Abstract File Identifier
       - Bibliographic File Identifier
       - Volume Expiration Date and Time
       - Volume Effective Date and Time

  The Data Preparer Identifier in the Primary Volume Descriptor is recorded
  as "ACORN ISO 9660 FORMATTER VERSION 1.10".

  The Volume Creation Date and Time and Volume Modification Date and Time in
  the Primary Volume Descriptor are recorded as the time when the Formatter
  is run.

  The Recording Date and Time field in a Directory Record is recorded as the
  timestamp information associated with the corresponding RISC OS directory
  or file.

  The GMT offset field in Date and Time values is always recorded as zero.

                              *****************


The product described in this manual and products for use with it are subject
to continuous development and improvement. All information of a technical
nature and particulars of the product and its use (including the information
and particulars in this manual) are given by Acorn Computers Limited in good
faith. However, Acorn Computers Limited cannot accept any liability for any
loss or damage arising from the use of any information or particulars in this
manual. 

ACORN is a trademark of Acorn Computers Limited.
All other trademarks are acknowledged.

Copyright © 1992 Acorn Computers Limited. All rights reserved. 

Published by Acorn Computers Limited 

Part number 0484,083 

Issue 2, August 1992
