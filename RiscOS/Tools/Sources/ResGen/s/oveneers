r0              RN      0
r1              RN      1
r2              RN      2
r3              RN      3
sp              RN      13
lr              RN      14
pc              RN      15

                EXPORT  init
                EXPORT  die
                EXPORT  service
                EXPORT  messages
                EXPORT  hdr

XResourceFS_RegisterFiles       EQU     &61b40
XResourceFS_DeregisterFiles     EQU     &61b41

Service_ResourceFSStarting      EQU     &60

                AREA    Hdr, CODE, READONLY

hdr
init            STMDB   sp!, {lr}
                ADR     r0, messages
                SWI     XResourceFS_RegisterFiles
                LDMIA   sp!, {pc}

die             STMDB   sp!, {lr}
                ADR     r0, messages
                SWI     XResourceFS_DeregisterFiles
                LDMIA   sp!, {pc}

service         TEQ     r1, #Service_ResourceFSStarting
                MOVNE   pc, lr
                STMDB   sp!, {r0-r3, lr}
                ADR     r0, messages
                MOV     lr, pc
                MOV     pc, r2
                LDMIA   sp!, {r0-r3, pc}^

messages
                END
