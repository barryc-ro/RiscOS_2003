#include "MemCheck:MemCheck.h"

#include "flexlib.flex.h"
#include "MemCheck:Flex.h"


int	main( void)
	{
	char*	memory1;
	char*	memory2;
	
	printf( "Started\n");
	
	MemCheck_Init();
	MemCheck_InterceptSCLStringFunctions();

	flex_init( "Test", NULL);
	flex_alloc( (flex_ptr) &memory1, 2048);
	flex_alloc( (flex_ptr) &memory2, 1024);
	
	/* Check checking is on again...	*/
	if ( memory1[ 2047])	;
	if ( memory1[ 2048])	;	/* Deliberate error	*/
	
	flex_free( (flex_ptr) &memory1);
	
	if ( memory2[ 512])	;
	if ( memory2[ -1])	;	/* Deliberate error	*/
	
	memory2[-1] = 99;	/* Deliberate error - corrupts flex's data	*/
	
	flex_free( (flex_ptr)&memory2);	/* This will cause an error	*/
	
	printf( "Finished\n");
	return 0;
	}
