#include <stdio.h>

#include "HierProf:Data.h"
#include "MemCheck.MemCheck.h"


int	main( int argc, char** argv)
{
HierProf_info	hpinfo;

MemCheck_Init();

if ( argc!=2)	{
	printf( "\n");
	printf( "Usage:\n");
	printf( "%s <filename of HierProf output file>\n\n", argv[0]);
	return 1;
	}

	{
	const char*	err;
	err = HierProf_LoadData( &hpinfo, argv[1]);
	if (err)	{
		printf( "Couldn't get HierProf data from '%s' - '%s'\n", argv[1], err);
		return 1;
		}
	}

printf( "Num functions = %i, num nestings = %i\n", hpinfo.num_nestingstrings, hpinfo.numfns);
printf( "Timer frequency = %i Hz\n", hpinfo.tickfreq);
printf( "Nestings are:\n\n");

	{
	int			i;
	HierProf_ref_type	*f;
	
	for ( i=1; i<=hpinfo.num_nestingstrings; i++)	{
		
		printf( "% i n=% 8i t=% 10i tmin=% 10i tmax=% 10i tt=%  10g", 
			i, hpinfo.nestings[i].n, 
			hpinfo.nestings[i].t,
			hpinfo.nestings[i].tmin,
			hpinfo.nestings[i].tmax,
			(double) hpinfo.nestings[i].tt.lo + (double) hpinfo.nestings[i].tt.hi * (double) (1U<<31) * 2.0
			);
		
		/* Each element in nesting string is the number of a function:	*/
		for ( f=hpinfo.nestings[i].string; *f; f++)	{
			printf( ":%s", hpinfo.functions[ *f].name);
			}
		
		printf( "\n");
		}
	}
	
	
printf( "Hello world\n");

return 0;
}
