#!/usr/local/bin/perl
#
# $Id$
#
# tagproduct reads the modules file and applies the given tag to the
# given components, moving the tag if necessary.  This enables buildmasters
# to apply a single tag across all the directories involved in a build to
# enable that revision of that directory to be matched back against thee
# current modules file.
#

my $script  = $0;
$script  =~ s/^.*\///;
$usage = "Usage: $script <tag>\n";
my $admin = "cam-cvsadmin";
my $verbose = 1;

my ($tag)=@ARGV;
die($usage) unless $tag;

open(MODULES, '<modules') || die("$script: loading of module file failed: $!\n");

while (<MODULES>) {
  s/\#.*//;
  next unless /\S/;
  if (/\A(\S+)\s+(\S+)\s*(\S+)?\s*\Z/) {
    my $command = "cvs -fQq rtag -F -r $2 $tag $1";
    print $command . "\n" if $verbose;
    system($command);
    die("$script: failed ($command)\n") if ($? >> 8);
  }
}

close(MODULES);

exit 0;

