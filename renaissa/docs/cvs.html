<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
   <title>CVS Instructions</title>
</head>
<body bgcolor="#FFFFFF">

<center>
  <img align=center src="pics/acorn.gif" alt="Acorn" height=64 width=40>
</center>

<center><h1>CVS Instructions</h1></center>

<hr>
<blockquote>
  <pre>
    Distribution: COMPANY CONFIDENTIAL

    Project:      renaissance
    Issue:        0.03
    Author(s):    Neil Turton
    Date:         4-Dec-96
    Last Issue:   0.02
  </pre>
</blockquote>
<hr>

<p><h2><a name="Contents">Contents</a></h2></p>

<ul>
  <li><a href="#History">      History</a>
  <li><a href="#outstanding">  Outstanding issues</a>
  <li><a href="#overview">     Overview</a>
  <li><a href="#environment">  Environment</a>
  <li><a href="#deficiencies"> Known deficiencies </a>
  <ul>
    <a href="#def_directories">Directories </a>
  </ul>

  <li> <a href="#users">       Notes for CVS users </a>
  <ul>
    <li> <a href="#user_checkout"> Checking out files </a>
    <li> <a href="#user_commit">   Committing changes </a>
    <li> <a href="#user_update">   Updating files </a>
  </ul>
  
  <li> <a href="#builders"> Notes for build administrators </a>
  <ul>
    <li><a href="#Export">   Exporting files</a>
    <li><a href="#Import">   Importing files</a>
    <li><a href="#branches"> Branches</a>
  </ul
</ul>

</ul>

<p>
<h2><a name="History">History</a></h2>
<pre>
 Ver   Date      Who  Comments
 0.01  14/11/96  ndt  Document created
 0.02  20/11/96  ndt  Added note on branch numbers
 0.03  04/12/96  rwb  Changed structure and added things for non-build
 		      people and environment.
</pre>

<p>
<h2><a name="outstanding">Outstanding issues</a></h2>
The following have not been documented here so far and probably should be...
<ul>
  <li> CVS handing of binary files.
</ul>

<p>
<h2><a name="overview">Overview</a></h2>

CSV (Concurrent Version System) is a source control system that allows files to be independently edited and automatically merged when updates are committed. Acorn is moving towards using CVS for control of the RiscOS sources and project documentation.
<p>
There are a few core operations in CVS which allow you to manipulate individual modules, branchs of the tree the whole tree. CVS is able to work on the whole tree just as well as it works on individual modules. 
<p>
There are two ways of retrieving files from the CVS repository, known as checking out, and exporting, which differ in that checking out create CVS administrive files in every directory, but exporting does not. When retrieving files for full builds or for for final release, the administrative files should not be present, as thay can easily cause problems (force files/directory limits to be hit, find their way into ResourceFS, etc).  When making modifications to a file, CVS will need the administrative files to merge changes back into the repository.

<p>
<h2><a name="environment">Environment</a></h2>

CVS is a unix command line tool installed on valhalla. To access this you therefore need a interactive login on valhalla and a reasonable amount of free space on your home mount. The following unix environment variables require setting (examples are for bash). This should ideally be done as part of your login scripts.
<p>
<blockquote>
<pre>
<b> export EDITOR=vi </b> or other if preferred
<b> export CVSROOT=/projects2/renaissa/cvsroot </b>
<b> umask 2 </b>
</pre>
</blockquote>
<p>
If you are accessing valhalla though a telnet session on a RiscPC, !FreeTerm is recommended in preference to !VT220 as normally supplied.
<p>
Scripts referred to in this document can be found in /projects2/renaissa/bin. The scripts themselves are under CVS source control and automatically placed in this directory whenever changes are made to them.

<p>
<h2><a name="deficiencies">Known deficiencies</a></h2>

<h3><a name="def_directories">Directories</a></h3>

Although files can have 'tags' attached to indicate that the files is present in a particular release, it is not possible to put a similar tags on directories.  Directories are created during an export or checkout, if they contain any files.
<p>
This behaviour breaks the build of RiscOS modules, as the 'rm' and 'o' directories don't contain files.  It was decided that all empty directories should contain a file, to force those directories to be created. This file is called <b>.cvstag</b>. Scripts have been provided to automatically create these tag files when importing modules into the cvs repository and remove them on export. See XXXX.

<p>
<h2><a name="users">Notes for CVS users </a> </h2>

<p>
<h3><a name="user_checkout"> Checking out files </a></h3>

Files are checked out in order to make modifications to a module. Individual files or whole directories can be checked out using the command <b>cvs checkout</b> as described below.
<p>
<blockquote>
<pre>
either  <b>cvs checkout [module name] </b>
or      <b>cvs co [module name] </b>
example <b>cvs checkout RiscOS/Sources/Kernel </b>
</pre>
</blockquote>
<p>
Where [module name] is the full path to the module from the root of the repository. The checked out version will be copied to the current working directory with all directories in the hierarchy created (if not already present). The checked out version will contain CVS control files along with the .cvstag files mentioned earlier. These should not be deleted as they are required by CVS when checking changes back into the repository.

<p>
<h3><a name="user_commit">   Committing changes </a></h3>

Once files have been edited and are ready for committing back into the repository, the following commands should be issued.
<p>
<blockquote>
<pre>
either  <b>cvs commit [filename] </b>
or      <b>cvs ci [filename] </b>
example <b>cvs commit Makefile </b>
</pre>
</blockquote>
<p>
If no filename is specified, all files in the current working directory are committed into the repository (if they have changed). CVS knows where to place these files in the repository by using the CVS control files created by the checkout process.
<p>
When checking in, CVS will first check that the files in the working directory are up to date.  If modifications have been made to the repository version in the time between the files being checked out and them being committed, CVS will complain, and suggest using the update command.

<p>
<h3><a name="user_update">   Updating files </a></h3>

A set of checked out files can become stale by someone else independantly editing them and checking their changes back into the repository. Updating your copy of the files using the following command will replace any stale files and automatically merge any changes into modified files.
<p>
<blockquote>
<pre>
        <b>cvs update </b>
</pre>
</blockquote>
<p>
You should be in the directory containing the files when issuing this command.

<p>
<h2><a name="builders"> Notes for build administrators. </a> </h2>

<p>
<h3><a name="Export">Exporting files</a></h3>

Files are exported in order to build, or release a module.  Since files (.cvstag) are created in empty directories, they must be deleted before the module is compiled.  This is fairly easy to do with a couple of commands, but it is made even easier by the existance of a script <b>cvsexport</b>. This will call CVS to export a module, and then remove all files named .cvstag in the newly created directory.
<p>
This process takes about between 1 and 4 hours for the whole build tree depending on valhalla loading.

<p>
<h3><a name="Import">Importing files</a></h3>

Importing is used to bring a module under CVS control.  To make sure that empty directories are created on checkout and export, the .cvstag files need creating. This can be done by using the <b>cvsimport</b> script.  The script should be invoked from the module directory. An example would be:
<p>
<blockquote>
<pre>
<b>cvsimport -b 1.1.1 RiscOS/Sources/Kernel Black RO_3_60</b>
</pre>
</blockquote>
<p>
This will create a module on branch number 1.1.1, with branch name Black, and revision name RO_3_60.

<p>
<h3><a name="branches">Branches</a></h3>

The branch number given should normally be non-existant, as otherwise the branch tags on that branch become unusable. The branch number should be odd, as even numbers can be used by CVS. The branches and tags currently in use are:
<p>
<blockquote>
<pre>
  Number   Tag         Description
  4.1.1    Black       Used to import RiscOS 360 from the CD
  4.1.3    StrongARM   Used to import RiscOS 370 from the CD
  4.1.5    STB         Used to import NCOS 1.06 from SrcFiler
</pre>
</blockquote>

</body>
</html>
