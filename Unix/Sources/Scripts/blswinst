#!/bin/sh
#
# Baseline Server Support Software Installation
# $Id$
#
# Copyright (C) Pace Micro Technology plc. 2000
# All rights reserved
#

# The program which will perform the installation.
INSTALL=install

# Path to the inetd configuration file
INETDCONF=/etc/inetd.conf

# Where binaries are installed, and the TFTP root
# directory.  You should not alter these.
BINDIR=/usr/local/bin
TFTPBOOT=/tftpboot

# The name of the TFTP server configuration file and
# the Solaris autostart file.
CONFIG=mtftpd.conf
RCFILE=S94mtftpd

# Install with owner UID and group GID, using the modes
# specified for files/directories as appropriate
UID=bin
GID=bin
FILEMODE=644
PROGMODE=755
DIRMODE=2755

# Create the TFTP base directory if necessary and install
# the configuration file in it.
$INSTALL -u $UID -g $GID -m $DIRMODE -d $TFTPBOOT
$INSTALL -u $UID -g $GID -m $DIRMODE -d $TFTPBOOT/etc
$INSTALL -u $UID -g $GID -m $FILEMODE -c $TFTPBOOT/etc $CONFIG

# Ensure that the binary directory is present
$INSTALL -u $UID -g $GID -m $DIRMODE -d $BINDIR

# Now install the perl scripts and the compiled binaries
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR blconf
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR blbuild
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR modgen
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR modsqz
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR mtftpd
$INSTALL -u $UID -g $GID -m $PROGMODE -c $BINDIR unmodsqz

# Now install the autostart script into the Solaris autoboot
# script so that the server starts when run level 3 is entered
# (multi-user with networking)
#
$INSTALL -u $UID -g $GID -m $PROGMODE -c /etc/rc3.d $RCFILE

# Set up the link for the configuration file.
echo Creating softlink for configuration file.
ln -s $TFTPBOOT/etc/$CONFIG /etc/$CONFIG

TFTP=`grep '^tftp' $INETDCONF`
if [ "$TFTP" <> "" ]; then
  cp $INETDCONF $INETDCONF.pace && \
  sed 's/^tftp/\#Disabled by Pace baseline server software installation script\
\#tftp/' <$INETDCONF.pace >$INETDCONF && \
  echo Built-in TFTP service disabled - old $INETDCONF stored as $INETDCONF.pace
fi


