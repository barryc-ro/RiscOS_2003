Echo
Echo ======================================================
Echo Performing Release Bethany specific things...
Echo ======================================================
Echo

Echo In project Bethany, all we do is copy over the release note and ReadMe
Echo  files over the ones that come from the template.

Echo
Echo It searches through these two files and replaces tokens with ones set in
Echo  system variables. This allows files to be altered in simple ways
Echo  without buildmaster invention.

Echo
Echo Currently recognised tags are :
Echo ${Release} (the release number);
Echo ${BuildMaster} (the buildmaster's email address); 
Echo ${BuildDate} (The date that the build was performed).
Echo ${BuildImageName} (The name of the image that was produced from this source tree).
Echo ${CPUType} (The CPU type that was on the build machine)
Echo ${OSVersion} (The OS Version running on the build machine)
Echo ${DRAMSize} (The amount of DRAM in the build machine)
Echo ${VRAMSize} (The amount of VRAM in the build machine)

|
| Please note - the section belowic opied from the DoRelease script.

Echo DoRelease : ****************************************************************************** 
Echo DoRelease : Preparing the image for release...
Echo DoRelease : <Sys$Date> <Sys$Time>
Echo DoRelease : ****************************************************************************** 

set AutoBuild$CurrentDoReleaseDir <obey$dir>

| Run the !SetEnvs file that was copied over from the build.
|<AutoBuild$CurrentDoReleaseDir>.^.sysvars

| Ensure that certain required files are present...

| Get the required image name
<AutoBuild$ImageRepositoryDir>.<Build$ImageName>.Package.Releaser 

| Rename the image...
Echo DoRelease :
Echo DoRelease : Renaming the image...
Rename <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.<Build$ImageName> <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.<AutoBuild$ReleaseName>
Echo DoRelease :
Echo DoRelease : Renaming the repository directory...
| Rename the repository directory...
Rename <AutoBuild$ImageRepositoryDir>.<Build$ImageName> <AutoBuild$ImageRepositoryDir>.<AutoBuild$ReleaseName>

| Set the sys var to point to the new name.
Set Build$ImageName <AutoBuild$ReleaseName>
Set AutoBuild$CurrentDoReleaseDir <AutoBuild$ImageRepositoryDir>.<AutoBuild$ReleaseName>
Set obey$dir <AutoBuild$CurrentDoReleaseDir>
Dir <obey$dir>

| Now create a filecrc of the image
Echo DoRelease :
Echo DoRelease : Creating a FileCRC of the image...
Inet:bin.X do filecrc -create -crc -single -d <SrcBuild$ImageLocation> -f <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.ImageCRC

| Now do a RomInfo of the image.
Echo DoRelease :
Echo DoRelease : Performing a ROMInfo of the image...
Inet:bin.X do rominfo -csv <SrcBuild$ImageLocation> { > <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.RomInfo }
Settype <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.RomInfo fff

| Now zip up the image.
Echo DoRelease :
Echo DoRelease : Archiving the image...
Dir <AutoBuild$ImageRepositoryDir>.<Build$ImageName>
Inet:bin.X do zip <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.imagezip <Build$ImageName> -9 

| Now create a filecrc of the image archive
Echo DoRelease :
Echo DoRelease : Creating a FileCRC of the image archive...
Inet:bin.X do filecrc -create -crc -single -d <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.imagezip -f <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.ArcCRC


|
| Create the 'Altered' directory if not already there.
Set AutoBuild$TempAlterationsDir <obey$dir>.Altered
show <AutoBuild$TempAlterationsDir>
Ifthere <AutoBuild$TempAlterationsDir> Then Echo Else mkdir -p <AutoBuild$TempAlterationsDir>

|
| Get the system information...
Do <AutoBuildBin$Dir>.CPU+Mem



|
| Now create the SIS for the Bethany UK/French/Italian main OS image.
| Need to set some system variables...
Set AutoBuildProject$DONumber 2503,013
Set AutoBuildProject$DOTitle Bethany OS for IAC hardware (UK, French and Italian)
<obey$dir>.Package.GetECO
Set AutoBuildProject$DOIssNumber $ENV{$Project_env_ReleaseNum};
Perl <AutoBuildBin$Dir>.CreateSIS <Obey$Dir>.Originals.Beth1SIS <AutoBuild$TempAlterationsDir>.Beth1SIS

|
| Now create the SIS for the first split UK/French/Italian image.
| Need to set some system variables...
Set AutoBuildProject$DONumber 2503,016
Set AutoBuildProject$DOTitle Bethany OS for IAC hardware (UK, French and Italian).
Set AutoBuildProject$DOTitle2 ROM 0 [data 0..15]
<obey$dir>.Package.GetECO
Set AutoBuildProject$DOIssNumber $ENV{$Project_env_ReleaseNum};
Perl <AutoBuildBin$Dir>.CreateSIS <Obey$Dir>.Originals.Split10SIS <AutoBuild$TempAlterationsDir>.Split10SIS

|
| Now create the SIS for the second split UK/French/Italian image.
| Need to set some system variables...
Set AutoBuildProject$DONumber 2503,017
Set AutoBuildProject$DOTitle Bethany OS for IAC hardware (UK, French and Italian).
Set AutoBuildProject$DOTitle2 ROM 0 [data 16..31]
<obey$dir>.Package.GetECO
Set AutoBuildProject$DOIssNumber $ENV{$Project_env_ReleaseNum};
Perl <AutoBuildBin$Dir>.CreateSIS <Obey$Dir>.Originals.Split11SIS <AutoBuild$TempAlterationsDir>.Split11SIS



|
| Now perform SED operations on the !ReadMe and HowBuild files...
Perl <AutoBuildBin$Dir>.CreateSIS <Obey$Dir>.Originals.!ReadMe <AutoBuild$TempAlterationsDir>.!ReadMe
Perl <AutoBuildBin$Dir>.CreateSIS <Obey$Dir>.Originals.HowBuild <AutoBuild$TempAlterationsDir>.HowBuild



|
| Now copy the files over to their proper location in the CD structure.
Do copy <AutoBuild$TempAlterationsDir>.HowBuild <AutoBuild$CDArchivePath>.<AutoBuild$ReleaseName>.ReadMe.HowBuild ~CF~V
Do copy <AutoBuild$TempAlterationsDir>.!ReadMe <AutoBuild$CDArchivePath>.<AutoBuild$ReleaseName>.ReadMe.!ReadMe ~CF~V


| Copy the SIS's over into their own directory in the image repository directory.
Do mkdir -p <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.SIS
settype <AutoBuild$TempAlterationsDir>.Beth1SIS FAF
settype <AutoBuild$TempAlterationsDir>.Split10SIS FAF
settype <AutoBuild$TempAlterationsDir>.Split11SIS FAF
Do copy <AutoBuild$TempAlterationsDir>.Beth1SIS <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.SIS.Beth1SIS ~CF~V
Do copy <AutoBuild$TempAlterationsDir>.Split10SIS <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.SIS.Split10SIS ~CF~V
Do copy <AutoBuild$TempAlterationsDir>.Split11SIS <AutoBuild$ImageRepositoryDir>.<Build$ImageName>.SIS.Split11SIS ~CF~V

| Open the altered files. Hopefully this will make people actually read them.
Filer_Run <AutoBuild$CDArchivePath>.<AutoBuild$ReleaseName>.ReadMe.HowBuild
Filer_Run <AutoBuild$CDArchivePath>.<AutoBuild$ReleaseName>.ReadMe.!ReadMe


|
| Tidy up - remove temporary files.
Remove <AutoBuild$TempAlterationsDir>.!ReadMe
Remove <AutoBuild$TempAlterationsDir>.!ReadMe2
Remove <AutoBuild$TempAlterationsDir>.!ReadMe3
Remove <AutoBuild$TempAlterationsDir>.HowBuild
Remove <AutoBuild$TempAlterationsDir>.HowBuild2
Remove <AutoBuild$TempAlterationsDir>.HowBuild3
Remove <AutoBuild$TempAlterationsDir>.Beth1SIS
Remove <AutoBuild$TempAlterationsDir>.Split10SIS
Remove <AutoBuild$TempAlterationsDir>.Split11SIS

|
| We have finished.
Echo
Echo ======================================================
Echo Finished Release Bethany specific things...
Echo ======================================================
Echo
